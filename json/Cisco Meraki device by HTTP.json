{
    "zabbix_export": {
        "version": "7.0",
        "template_groups": [
            {
                "uuid": "a571c0d144b14fd4a87a9d9b2aa9fcd6",
                "name": "Templates/Applications"
            },
            {
                "uuid": "36bff6c29af64692839d077febfc7079",
                "name": "Templates/Network devices"
            }
        ],
        "templates": [
            {
                "uuid": "2cae7d2eeca04e6fa7419759ac9ad814",
                "template": "Cisco Meraki device by HTTP",
                "name": "Cisco Meraki device by HTTP",
                "description": "Generated by official Zabbix template tool \"Templator\"",
                "vendor": {
                    "name": "Zabbix",
                    "version": "7.0-0"
                },
                "groups": [
                    {
                        "name": "Templates/Applications"
                    },
                    {
                        "name": "Templates/Network devices"
                    }
                ],
                "items": [
                    {
                        "uuid": "0c97a8fcad764133b4e7c35d0134665c",
                        "name": "Get status",
                        "type": "HTTP_AGENT",
                        "key": "meraki.device.get.status",
                        "delay": "{$MERAKI.GET.STATUS.INTERVAL}",
                        "history": "0",
                        "value_type": "TEXT",
                        "trends": "0",
                        "description": "Item for gathering device status from Meraki API.",
                        "preprocessing": [
                            {
                                "type": "JSONPATH",
                                "parameters": [
                                    "$[0]"
                                ]
                            }
                        ],
                        "timeout": "{$MERAKI.DATA.TIMEOUT}",
                        "url": "https://{$MERAKI.API.URL}/organizations/{$ORGANIZATION_ID}/devices/statuses?serials[]={$SERIAL}",
                        "http_proxy": "{$MERAKI.HTTP_PROXY}",
                        "headers": [
                            {
                                "name": "X-Cisco-Meraki-API-Key",
                                "value": "{$MERAKI.TOKEN}"
                            },
                            {
                                "name": "User-Agent",
                                "value": "ZabbixServer/1.1 Zabbix"
                            }
                        ],
                        "tags": [
                            {
                                "tag": "component",
                                "value": "raw"
                            }
                        ]
                    },
                    {
                        "uuid": "2280b9212c474d99835ec1334ff780eb",
                        "name": "public IP",
                        "type": "DEPENDENT",
                        "key": "meraki.device.public.ip",
                        "delay": "0",
                        "history": "7d",
                        "value_type": "CHAR",
                        "trends": "0",
                        "description": "Device public IP\nNetwork: {$NETWORK.ID}\nMAC: {$MAC}",
                        "preprocessing": [
                            {
                                "type": "JSONPATH",
                                "parameters": [
                                    "$.publicIp"
                                ]
                            }
                        ],
                        "master_item": {
                            "key": "meraki.device.get.status"
                        },
                        "tags": [
                            {
                                "tag": "component",
                                "value": "network"
                            }
                        ]
                    },
                    {
                        "uuid": "324b748bfe2e4383927176046e246acb",
                        "name": "status",
                        "type": "DEPENDENT",
                        "key": "meraki.device.status",
                        "delay": "0",
                        "history": "7d",
                        "description": "Device operational status\nNetwork: {$NETWORK.ID} \nMAC: {$MAC}",
                        "valuemap": {
                            "name": "Device status"
                        },
                        "preprocessing": [
                            {
                                "type": "JSONPATH",
                                "parameters": [
                                    "$.status"
                                ]
                            },
                            {
                                "type": "JAVASCRIPT",
                                "parameters": [
                                    "switch (value) {\n\tcase 'offline':\n\t\treturn 0\n\tcase 'online':\n\t\treturn 1\n\tcase 'dormant':\n\t\treturn 2\n\tdefault:\n\t\treturn 10\n}"
                                ]
                            }
                        ],
                        "master_item": {
                            "key": "meraki.device.get.status"
                        },
                        "tags": [
                            {
                                "tag": "component",
                                "value": "health"
                            }
                        ],
                        "triggers": [
                            {
                                "uuid": "00583ac9e9824f7db22a1685421f0be9",
                                "expression": "last(/Cisco Meraki device by HTTP/meraki.device.status)<>1",
                                "name": "Status is not online",
                                "priority": "WARNING",
                                "tags": [
                                    {
                                        "tag": "scope",
                                        "value": "availability"
                                    }
                                ]
                            }
                        ]
                    },
                    {
                        "uuid": "e4963b68cdde453f91767ff9e3a31d16",
                        "name": "Get device data",
                        "type": "SCRIPT",
                        "key": "meraki.get.device",
                        "delay": "{$MERAKI.UPLINK.LL.TIMESPAN}",
                        "history": "0",
                        "value_type": "TEXT",
                        "trends": "0",
                        "params": "var params = JSON.parse(value);\n\nvar request = new HttpRequest();\n\nrequest.addHeader('X-Cisco-Meraki-API-Key:' + params.token);\nrequest.addHeader('User-Agent: ZabbixServer/1.1 Zabbix');\n\nvar response,\n\terror_msg = '',\n\tdevice = [],\n\tuplinksLL = [];\n\nfunction isFloat(n) {\n\tn = parseFloat(n);\n\treturn Number(n) === n && n % 1 !== 0;\n};\n\nfunction checkNumber(string) {\n\tif (typeof string !== \"string\" || isNaN(string) || isFloat(string)) {\n\t\tthrow 'Incorrect \"timespan\" parameter given: ' + string + ' Must be an unsigned number';\n\t}\n\treturn string;\n};\n\nfunction getHttpData(url) {\n\tresponse = request.get(url);\n\tZabbix.log(4, '[ Meraki API ] [ ' + url + ' ] Received response with status code ' + request.getStatus() + ': ' + response);\n\n\tif (response !== null) {\n\t\ttry {\n\t\t\tresponse = JSON.parse(response);\n\t\t}\n\t\tcatch (error) {\n\t\t\tthrow 'Failed to parse response received from Meraki API. Check debug log for more information.';\n\t\t}\n\t}\n\n\tif (request.getStatus() !== 200) {\n\t\tif (response.errors) {\n\t\t\tthrow response.errors.join(', ');\n\t\t} else {\n\t\t\tthrow 'Failed to receive data: invalid response status code.';\n\t\t}\n\t}\n\n\tif (typeof (response) !== 'object' || response === null) {\n\t\tthrow 'Cannot process response data: received data is not an object.';\n\t}\n\n\treturn response;\n};\n\ntry {\n\n\tif (params.token === '{' + '$MERAKI.TOKEN}') {\n\t\tthrow 'Please change {' + '$MERAKI.TOKEN} macro to the proper value.';\n\t}\n\n\tif (params.url.indexOf('http://') === -1 && params.url.indexOf('https://') === -1) {\n\t\tparams.url = 'https://' + params.url;\n\t}\n\n\tif (!params.url.endsWith('/')) {\n\t\tparams.url += '/';\n\t}\n\n\tif (typeof params.httpproxy !== 'undefined' && params.httpproxy !== '') {\n\t\trequest.setProxy(params.httpproxy);\n\t}\n\n\ttimespan = checkNumber('{$MERAKI.UPLINK.LL.TIMESPAN}');\n\n\tif (timespan > 86400 || timespan < 1) {\n\t\tthrow 'Incorrect \"timespan\" parameter given: ' + timespan + ' Must be between 1 and 86400 seconds.';\n\t}\n\n\tuplinksLL = getHttpData(params.url + 'organizations/' + encodeURIComponent(params.organizationId) + '/devices/uplinksLossAndLatency?timespan=' + timespan);\n\n\tif (uplinksLL.length > 0) {\n\t\tuplinksLL = uplinksLL.filter(function (device) {\n\t\t\treturn device.serial == params.serial;\n\t\t});\n\t}\n\n} catch (error) {\n\terror_msg = error;\n};\n\nreturn JSON.stringify({\n\t'uplinksLL': uplinksLL,\n\t'error': error_msg.toString()\n});",
                        "description": "Item for gathering device data from Meraki API.",
                        "timeout": "{$MERAKI.DATA.TIMEOUT}",
                        "parameters": [
                            {
                                "name": "httpproxy",
                                "value": "{$MERAKI.HTTP_PROXY}"
                            },
                            {
                                "name": "organizationId",
                                "value": "{$ORGANIZATION_ID}"
                            },
                            {
                                "name": "serial",
                                "value": "{$SERIAL}"
                            },
                            {
                                "name": "token",
                                "value": "{$MERAKI.TOKEN}"
                            },
                            {
                                "name": "url",
                                "value": "{$MERAKI.API.URL}"
                            }
                        ],
                        "tags": [
                            {
                                "tag": "component",
                                "value": "raw"
                            }
                        ]
                    },
                    {
                        "uuid": "b673516073354c9aaaf60cf3ce2e2fa6",
                        "name": "Device data item errors",
                        "type": "DEPENDENT",
                        "key": "meraki.get.device.errors",
                        "delay": "0",
                        "history": "7d",
                        "value_type": "TEXT",
                        "trends": "0",
                        "description": "Item for gathering errors of the device item.",
                        "preprocessing": [
                            {
                                "type": "JSONPATH",
                                "parameters": [
                                    "$.error"
                                ]
                            },
                            {
                                "type": "DISCARD_UNCHANGED_HEARTBEAT",
                                "parameters": [
                                    "1h"
                                ]
                            }
                        ],
                        "master_item": {
                            "key": "meraki.get.device"
                        },
                        "tags": [
                            {
                                "tag": "component",
                                "value": "error"
                            }
                        ],
                        "triggers": [
                            {
                                "uuid": "c8f8af6c92f14dc0bcdf426b124c7344",
                                "expression": "length(last(/Cisco Meraki device by HTTP/meraki.get.device.errors))>0",
                                "name": "There are errors in 'Get device data' metric",
                                "priority": "WARNING",
                                "tags": [
                                    {
                                        "tag": "scope",
                                        "value": "availability"
                                    }
                                ]
                            }
                        ]
                    }
                ],
                "discovery_rules": [
                    {
                        "uuid": "9c7e5d2ccad7416b8d58237be4218154",
                        "name": "Uplinks loss and quality discovery",
                        "type": "DEPENDENT",
                        "key": "meraki.device.uplinks.discovery",
                        "delay": "0",
                        "filter": {
                            "evaltype": "AND",
                            "conditions": [
                                {
                                    "macro": "{#IP}",
                                    "value": "{$MERAKI.DEVICE.LOSS.LATENCY.IP.MATCHES}",
                                    "formulaid": "A"
                                },
                                {
                                    "macro": "{#IP}",
                                    "value": "{$MERAKI.DEVICE.LOSS.LATENCY.IP.NOT_MATCHES}",
                                    "operator": "NOT_MATCHES_REGEX",
                                    "formulaid": "B"
                                },
                                {
                                    "macro": "{#UPLINK}",
                                    "value": "{$MERAKI.DEVICE.UPLINK.MATCHES}",
                                    "formulaid": "C"
                                },
                                {
                                    "macro": "{#UPLINK}",
                                    "value": "{$MERAKI.DEVICE.UPLINK.NOT_MATCHES}",
                                    "operator": "NOT_MATCHES_REGEX",
                                    "formulaid": "D"
                                }
                            ]
                        },
                        "item_prototypes": [
                            {
                                "uuid": "abf642b1bb944d16bebf90dcf58dbd86",
                                "name": "Uplink [{#IP}]: [{#UPLINK}]: Latency",
                                "type": "DEPENDENT",
                                "key": "meraki.device.latency[{#IP},{#UPLINK}]",
                                "delay": "0",
                                "history": "7d",
                                "value_type": "FLOAT",
                                "units": "s",
                                "description": "Latency of the device uplink. \nNetwork: {#NETWORK.ID}. \nDevice serial: {#SERIAL}.",
                                "preprocessing": [
                                    {
                                        "type": "JSONPATH",
                                        "parameters": [
                                            "$.uplinksLL[?(@.ip == '{#IP}' && @.uplink== '{#UPLINK}')].timeSeries.[0].latencyMs.first()"
                                        ],
                                        "error_handler": "CUSTOM_VALUE",
                                        "error_handler_params": "-1000"
                                    },
                                    {
                                        "type": "MULTIPLIER",
                                        "parameters": [
                                            "0.001"
                                        ]
                                    }
                                ],
                                "master_item": {
                                    "key": "meraki.get.device"
                                },
                                "tags": [
                                    {
                                        "tag": "component",
                                        "value": "network"
                                    },
                                    {
                                        "tag": "ip",
                                        "value": "{#IP}"
                                    },
                                    {
                                        "tag": "network",
                                        "value": "{#NETWORK.ID}"
                                    },
                                    {
                                        "tag": "serial-number",
                                        "value": "{#SERIAL}"
                                    },
                                    {
                                        "tag": "uplink",
                                        "value": "{#UPLINK}"
                                    }
                                ],
                                "trigger_prototypes": [
                                    {
                                        "uuid": "b559ad94b15848089d89e85e4d9db7ff",
                                        "expression": "min(/Cisco Meraki device by HTTP/meraki.device.latency[{#IP},{#UPLINK}],#3)>{$MERAKI.DEVICE.LATENCY}",
                                        "name": "Uplink [{#IP}]: [{#UPLINK}]: latency > {$MERAKI.DEVICE.LATENCY}",
                                        "priority": "WARNING",
                                        "tags": [
                                            {
                                                "tag": "scope",
                                                "value": "performance"
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                "uuid": "bded34f64113486ab0672210e5a8eb1d",
                                "name": "Uplink [{#IP}]: [{#UPLINK}]: Loss, %",
                                "type": "DEPENDENT",
                                "key": "meraki.device.loss.pct[{#IP},{#UPLINK}]",
                                "delay": "0",
                                "history": "7d",
                                "value_type": "FLOAT",
                                "units": "%",
                                "description": "Loss percent of the device uplink. \nNetwork: {#NETWORK.ID}. \nDevice serial: {#SERIAL}.",
                                "preprocessing": [
                                    {
                                        "type": "JSONPATH",
                                        "parameters": [
                                            "$.uplinksLL[?(@.ip == '{#IP}' && @.uplink== '{#UPLINK}')].timeSeries.[0].lossPercent.first()"
                                        ],
                                        "error_handler": "CUSTOM_VALUE",
                                        "error_handler_params": "-1"
                                    }
                                ],
                                "master_item": {
                                    "key": "meraki.get.device"
                                },
                                "tags": [
                                    {
                                        "tag": "component",
                                        "value": "network"
                                    },
                                    {
                                        "tag": "ip",
                                        "value": "{#IP}"
                                    },
                                    {
                                        "tag": "network",
                                        "value": "{#NETWORK.ID}"
                                    },
                                    {
                                        "tag": "serial-number",
                                        "value": "{#SERIAL}"
                                    },
                                    {
                                        "tag": "uplink",
                                        "value": "{#UPLINK}"
                                    }
                                ],
                                "trigger_prototypes": [
                                    {
                                        "uuid": "1309e71025614ce4bb4242e6e291ae48",
                                        "expression": "min(/Cisco Meraki device by HTTP/meraki.device.loss.pct[{#IP},{#UPLINK}],#3)>{$MERAKI.DEVICE.LOSS}",
                                        "name": "Uplink [{#IP}]: [{#UPLINK}]: loss > {$MERAKI.DEVICE.LOSS}%",
                                        "priority": "WARNING",
                                        "tags": [
                                            {
                                                "tag": "scope",
                                                "value": "performance"
                                            }
                                        ]
                                    }
                                ]
                            }
                        ],
                        "graph_prototypes": [
                            {
                                "uuid": "4e9d84e08b32489c8c3a2cbbd4c6119a",
                                "name": "Uplink [{#IP}]: [{#UPLINK}]: Latency",
                                "ymin_type_1": "FIXED",
                                "graph_items": [
                                    {
                                        "color": "199C0D",
                                        "item": {
                                            "host": "Cisco Meraki device by HTTP",
                                            "key": "meraki.device.latency[{#IP},{#UPLINK}]"
                                        }
                                    }
                                ]
                            },
                            {
                                "uuid": "ebf262afc6d94d29b9831d418fb07edb",
                                "name": "Uplink [{#IP}]: [{#UPLINK}]: Loss",
                                "ymin_type_1": "FIXED",
                                "graph_items": [
                                    {
                                        "color": "199C0D",
                                        "item": {
                                            "host": "Cisco Meraki device by HTTP",
                                            "key": "meraki.device.loss.pct[{#IP},{#UPLINK}]"
                                        }
                                    }
                                ]
                            }
                        ],
                        "master_item": {
                            "key": "meraki.get.device"
                        },
                        "lld_macro_paths": [
                            {
                                "lld_macro": "{#IP}",
                                "path": "$.ip"
                            },
                            {
                                "lld_macro": "{#NETWORK.ID}",
                                "path": "$.networkId"
                            },
                            {
                                "lld_macro": "{#SERIAL}",
                                "path": "$.serial"
                            },
                            {
                                "lld_macro": "{#UPLINK}",
                                "path": "$.uplink"
                            }
                        ],
                        "preprocessing": [
                            {
                                "type": "JSONPATH",
                                "parameters": [
                                    "$.uplinksLL"
                                ]
                            }
                        ]
                    }
                ],
                "tags": [
                    {
                        "tag": "class",
                        "value": "network"
                    },
                    {
                        "tag": "target",
                        "value": "cisco-meraki-dashboard"
                    }
                ],
                "macros": [
                    {
                        "macro": "{$MERAKI.API.URL}",
                        "value": "api.meraki.com/api/v1",
                        "description": "Cisco Meraki dashboard API URL, e.g., api.meraki.com/api/v1"
                    },
                    {
                        "macro": "{$MERAKI.DATA.TIMEOUT}",
                        "value": "60",
                        "description": "Response timeout for an API."
                    },
                    {
                        "macro": "{$MERAKI.DEVICE.LATENCY}",
                        "value": "0.15",
                        "description": "Devices uplink latency threshold, in seconds."
                    },
                    {
                        "macro": "{$MERAKI.DEVICE.LOSS}",
                        "value": "15",
                        "description": "Devices uplink loss threshold, in percent."
                    },
                    {
                        "macro": "{$MERAKI.DEVICE.LOSS.LATENCY.IP.MATCHES}",
                        "value": "^((25[0-5]|(2[0-4]|1\\d|[1-9]|)\\d)\\.?\\b){4}$",
                        "description": "This macro is used in loss and latency checks discovery. Can be overridden on the host or linked template level."
                    },
                    {
                        "macro": "{$MERAKI.DEVICE.LOSS.LATENCY.IP.NOT_MATCHES}",
                        "value": "^null$",
                        "description": "This macro is used in loss and latency checks discovery. Can be overridden on the host or linked template level."
                    },
                    {
                        "macro": "{$MERAKI.DEVICE.UPLINK.MATCHES}",
                        "value": ".*",
                        "description": "This macro is used in loss and latency checks discovery. Can be overridden on the host or linked template level."
                    },
                    {
                        "macro": "{$MERAKI.DEVICE.UPLINK.NOT_MATCHES}",
                        "value": "^null$",
                        "description": "This macro is used in loss and latency checks discovery. Can be overridden on the host or linked template level."
                    },
                    {
                        "macro": "{$MERAKI.GET.STATUS.INTERVAL}",
                        "value": "300",
                        "description": "Update interval for get status item."
                    },
                    {
                        "macro": "{$MERAKI.HTTP_PROXY}",
                        "description": "HTTP proxy for API requests. You can specify it using the format [protocol://][username[:password]@]proxy.example.com[:port]. See documentation at https://www.zabbix.com/documentation/7.0/manual/config/items/itemtypes/http"
                    },
                    {
                        "macro": "{$MERAKI.TOKEN}",
                        "type": "SECRET_TEXT",
                        "description": "Cisco Meraki dashboard API token."
                    },
                    {
                        "macro": "{$MERAKI.UPLINK.LL.TIMESPAN}",
                        "value": "180",
                        "description": "Timespan in seconds for getting device uplinks loss and quality stats. Used in the metric configuration and in the JavaScript API query. Must be between 1 and 86400 seconds."
                    }
                ],
                "dashboards": [
                    {
                        "uuid": "76c4525eacc64f268572fefd76accc2f",
                        "name": "Meraki: General",
                        "pages": [
                            {
                                "name": "Meraki: Uplinks",
                                "widgets": [
                                    {
                                        "type": "graphprototype",
                                        "name": "Loss",
                                        "width": "36",
                                        "height": "5",
                                        "fields": [
                                            {
                                                "type": "INTEGER",
                                                "name": "columns",
                                                "value": "1"
                                            },
                                            {
                                                "type": "GRAPH_PROTOTYPE",
                                                "name": "graphid.0",
                                                "value": {
                                                    "host": "Cisco Meraki device by HTTP",
                                                    "name": "Uplink [{#IP}]: [{#UPLINK}]: Loss"
                                                }
                                            },
                                            {
                                                "type": "STRING",
                                                "name": "reference",
                                                "value": "AAAAA"
                                            }
                                        ]
                                    },
                                    {
                                        "type": "graphprototype",
                                        "name": "Latency",
                                        "x": "36",
                                        "width": "36",
                                        "height": "5",
                                        "fields": [
                                            {
                                                "type": "INTEGER",
                                                "name": "columns",
                                                "value": "1"
                                            },
                                            {
                                                "type": "GRAPH_PROTOTYPE",
                                                "name": "graphid.0",
                                                "value": {
                                                    "host": "Cisco Meraki device by HTTP",
                                                    "name": "Uplink [{#IP}]: [{#UPLINK}]: Latency"
                                                }
                                            },
                                            {
                                                "type": "STRING",
                                                "name": "reference",
                                                "value": "AAAAB"
                                            }
                                        ]
                                    }
                                ]
                            }
                        ]
                    }
                ],
                "valuemaps": [
                    {
                        "uuid": "24967dff65a048578eae18b2485907cb",
                        "name": "Device status",
                        "mappings": [
                            {
                                "value": "0",
                                "newvalue": "offline"
                            },
                            {
                                "value": "1",
                                "newvalue": "online"
                            },
                            {
                                "value": "2",
                                "newvalue": "dormant"
                            },
                            {
                                "value": "10",
                                "newvalue": "unknown"
                            }
                        ]
                    }
                ]
            }
        ]
    }
}