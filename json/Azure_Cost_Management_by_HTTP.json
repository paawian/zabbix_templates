{
    "zabbix_export": {
        "version": "7.0",
        "template_groups": [
            {
                "uuid": "c2c162144c2d4c5491c8801193af4945",
                "name": "Templates/Cloud"
            }
        ],
        "templates": [
            {
                "uuid": "c0263df8d8c14d30b24afcf45a6a354f",
                "template": "Azure Cost Management by HTTP",
                "name": "Azure Cost Management by HTTP",
                "description": "This template is designed to monitor Microsoft Cost Management by HTTP.\nIt works without any external scripts and uses the script item.\n\nSetup:\n  1. Create an Azure service principal via the Azure command-line interface (Azure CLI) for your subscription.\n    `az ad sp create-for-rbac --name zabbix --role reader --scope /subscriptions/<subscription_id>`\n    See https://docs.microsoft.com/en-us/cli/azure/create-an-azure-service-principal-azure-cli for more details.\n  2. Link the template to a host.\n  3. Configure the macros: {$AZURE.APP.ID}, {$AZURE.PASSWORD}, {$AZURE.TENANT.ID}, {$AZURE.SUBSCRIPTION.ID}.\n\nYou can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback/\n\nGenerated by official Zabbix template tool \"Templator\"",
                "vendor": {
                    "name": "Zabbix",
                    "version": "7.0-0"
                },
                "groups": [
                    {
                        "name": "Templates/Cloud"
                    }
                ],
                "items": [
                    {
                        "uuid": "f50c96da86654a25b937756cc7f7010e",
                        "name": "Get daily costs",
                        "type": "SCRIPT",
                        "key": "azure.get.daily.costs",
                        "delay": "0s;h/5m/30",
                        "history": "0",
                        "value_type": "TEXT",
                        "trends": "0",
                        "params": "var AzureCost = {\n\tparams: {},\n\ttoken: null,\n\n\tsetParams: function (params) {\n\t\t['app_id', 'password', 'tenant_id', 'subscription_id'].forEach(function (field) {\n\t\t\tif (typeof params !== 'object' || typeof params[field] === 'undefined' || params[field] === '') {\n\t\t\t\tthrow 'Required param is not set: ' + field + '.';\n\t\t\t}\n\t\t});\n\t\tAzureCost.params = params;\n\t},\n\n\tlogin: function () {\n\t\tvar response,\n\t\t\tlogin = new HttpRequest();\n\n\t\tif (typeof AzureCost.params.proxy !== 'undefined' && AzureCost.params.proxy !== '') {\n\t\t\tlogin.setProxy(AzureCost.params.proxy);\n\t\t}\n\n\t\tlogin.addHeader('Content-Type: application/x-www-form-urlencoded');\n\t\tresponse = login.post(\n\t\t\t'https://login.microsoftonline.com/' + encodeURIComponent(AzureCost.params.tenant_id) + '/oauth2/token',\n\t\t\t'grant_type=client_credentials&resource=' + encodeURIComponent('https://management.azure.com/') + '&client_id=' + encodeURIComponent(AzureCost.params.app_id) + '&client_secret=' + encodeURIComponent(AzureCost.params.password)\n\t\t);\n\n\t\tif (login.getStatus() !== 200) {\n\t\t\tthrow 'Login failed with status code ' + login.getStatus() + ': ' + response;\n\t\t}\n\t\ttry {\n\t\t\tresponse = JSON.parse(response);\n\t\t}\n\t\tcatch (error) {\n\t\t\tthrow 'Failed to parse login session response.';\n\t\t}\n\t\tif (!response.hasOwnProperty('access_token')) {\n\t\t\tthrow 'Authentication response does not contain access token.';\n\t\t}\n\n\t\tAzureCost.token = response['access_token'];\n\t},\n\n\trequest: function (url, body) {\n\t\tif (typeof body === 'undefined' || body === null) {\n\t\t\tbody = '';\n\t\t}\n\t\tvar response,\n\t\t\theaders,\n\t\t\tregex = /-retry-after\":\"(\\d+)\"/,\n\t\t\tratelimit,\n\t\t\trequest = new HttpRequest();\n\n\t\tif (typeof AzureCost.params.proxy !== 'undefined' && AzureCost.params.proxy !== '') {\n\t\t\trequest.setProxy(AzureCost.params.proxy);\n\t\t}\n\t\tif (!AzureCost.token) {\n\t\t\tthrow 'Request does not contain access token.';\n\t\t}\n\t\trequest.addHeader('Accept: application/json');\n\t\trequest.addHeader('Content-Type: application/json');\n\t\trequest.addHeader('Authorization: Bearer ' + AzureCost.token);\n\n\t\tZabbix.log(4, '[ AzureCost ] request url: ' + url);\n\n\t\tresponse = request.post(url, body);\n\t\theaders = JSON.stringify(request.getHeaders());\n\n\t\tif (headers.match(regex) !== null && request.getStatus() === 429) {\n\t\t\tratelimit = headers.match(regex)[1];\n\t\t\tZabbix.log(4, '[ AzureCost ] Microsoft Cost Management have rate limit requests per 1 minute, retrying after ' + ratelimit + ' seconds');\n\t\t\tZabbix.sleep(ratelimit * 1010);\n\t\t\tresponse = request.post(url, body);\n\t\t}\n\t\tif (request.getStatus() !== 200) {\n\t\t\tthrow 'Request failed with status code ' + request.getStatus() + ': ' + response;\n\t\t}\n\n\t\ttry {\n\t\t\treturn JSON.parse(response);\n\t\t}\n\t\tcatch (error) {\n\t\t\tthrow 'Failed to parse response received from API.';\n\t\t}\n\t},\n\n\tgetField: function (data, path) {\n\t\tvar steps = path.split('.');\n\t\tfor (var i = 0; i < steps.length; i++) {\n\t\t\tvar step = steps[i];\n\t\t\tif (typeof data !== 'object' || typeof data[step] === 'undefined') {\n\t\t\t\tthrow 'Required field was not found: ' + path;\n\t\t\t}\n\t\t\tdata = data[step];\n\t\t}\n\n\t\treturn data;\n\t},\n\n\tgetCost: function () {\n\t\tvar metricData = {},\n\t\t\ttoday = new Date(),\n\t\t\tstart_date = new Date(today);\n\t\tstart_date.setDate(today.getDate() - 1);\n\n\t\tbodyRawCost = {\n\t\t\ttype: 'Usage',\n\t\t\t'timeframe': 'Custom',\n\t\t\t'timePeriod': {\n\t\t\t\t'from': start_date,\n\t\t\t\t'to': start_date\n\t\t\t},\n\t\t\tdataset: {\n\t\t\t\tgranularity: 'Daily',\n\t\t\t\taggregation: {\n\t\t\t\t\ttotalCost: {\n\t\t\t\t\t\tname: 'PreTaxCost',\n\t\t\t\t\t\tfunction: 'Sum'\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tgrouping: [\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'Dimension',\n\t\t\t\t\t\tname: 'Meter',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'Dimension',\n\t\t\t\t\t\tname: 'MeterSubcategory',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'Dimension',\n\t\t\t\t\t\tname: 'ResourceGroup',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'Dimension',\n\t\t\t\t\t\tname: 'ServiceName',\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'Dimension',\n\t\t\t\t\t\tname: 'ResourceLocation',\n\t\t\t\t\t}\n\t\t\t\t]\n\t\t\t}\n\t\t};\n\t\tmetricData = AzureCost.request('https://management.azure.com/subscriptions/' + AzureCost.params.subscription_id + '/providers/Microsoft.CostManagement/query?api-version=2023-11-01', JSON.stringify(bodyRawCost));\n\n\t\tvar columns = AzureCost.getField(metricData, 'properties.columns');\n\n\t\treturn transformedData = {\n\t\t\tdata: AzureCost.getField(metricData, 'properties.rows').map(function (row) {\n\t\t\t\trowData = {};\n\t\t\t\tcolumns.forEach(function (column, i) {\n\t\t\t\t\tcolumnName = columns[i].name;\n\t\t\t\t\tcolumnType = columns[i].type;\n\t\t\t\t\tcellValue = row[i];\n\t\t\t\t\trowData[columnName] = column.type === \"Number\" ? cellValue.toString() : cellValue;\n\t\t\t\t});\n\t\t\t\trowData.UsageDate = rowData.UsageDate.replace(/(\\d{4})(\\d{2})(\\d{2})/, \"$1-$2-$3\");\n\n\t\t\t\treturn rowData;\n\t\t\t})\n\t\t};\n\t}\n};\n\ntry {\n\tAzureCost.setParams(JSON.parse(value));\n\tAzureCost.login();\n\n\treturn JSON.stringify(AzureCost.getCost());\n}\ncatch (error) {\n\terror += (String(error).endsWith('.')) ? '' : '.';\n\tZabbix.log(3, '[ AzureCost ] ERROR: ' + error);\n\n\treturn JSON.stringify({ 'error': error });\n}",
                        "description": "The result of API requests is expressed in the JSON.",
                        "timeout": "{$AZURE.DATA.TIMEOUT}",
                        "parameters": [
                            {
                                "name": "app_id",
                                "value": "{$AZURE.APP.ID}"
                            },
                            {
                                "name": "password",
                                "value": "{$AZURE.PASSWORD}"
                            },
                            {
                                "name": "proxy",
                                "value": "{$AZURE.PROXY}"
                            },
                            {
                                "name": "subscription_id",
                                "value": "{$AZURE.SUBSCRIPTION.ID}"
                            },
                            {
                                "name": "tenant_id",
                                "value": "{$AZURE.TENANT.ID}"
                            }
                        ],
                        "tags": [
                            {
                                "tag": "component",
                                "value": "raw"
                            }
                        ]
                    },
                    {
                        "uuid": "bbf6a0b136464d76a535ca016dcb8ae1",
                        "name": "Get monthly costs",
                        "type": "SCRIPT",
                        "key": "azure.get.monthly.costs",
                        "delay": "0s;h/12",
                        "history": "0",
                        "value_type": "TEXT",
                        "trends": "0",
                        "params": "var AzureCost = {\n\tparams: {},\n\ttoken: null,\n\n\tsetParams: function (params) {\n\t\t['app_id', 'password', 'tenant_id', 'subscription_id', 'month'].forEach(function (field) {\n\t\t\tif (typeof params !== 'object' || typeof params[field] === 'undefined' || params[field] === '') {\n\t\t\t\tthrow 'Required param is not set: ' + field + '.';\n\t\t\t}\n\t\t});\n\t\tAzureCost.params = params;\n\n\t\ttoday = new Date();\n\t\tAzureCost.params.end_date = today.toISOString();\n\t\tmonth = today.getMonth();\n\t\ttoday.setMonth(month - params.month);\n\t\tAzureCost.params.start_time = new Date(today.getFullYear(), today.getMonth()).toISOString();\n\t},\n\n\tlogin: function () {\n\t\tvar response,\n\t\t\tlogin = new HttpRequest();\n\n\t\tif (typeof AzureCost.params.proxy !== 'undefined' && AzureCost.params.proxy !== '') {\n\t\t\tlogin.setProxy(AzureCost.params.proxy);\n\t\t}\n\n\t\tlogin.addHeader('Content-Type: application/x-www-form-urlencoded');\n\t\tresponse = login.post(\n\t\t\t'https://login.microsoftonline.com/' + encodeURIComponent(AzureCost.params.tenant_id) + '/oauth2/token',\n\t\t\t'grant_type=client_credentials&resource=' + encodeURIComponent('https://management.azure.com/') + '&client_id=' + encodeURIComponent(AzureCost.params.app_id) + '&client_secret=' + encodeURIComponent(AzureCost.params.password)\n\t\t);\n\n\t\tif (login.getStatus() !== 200) {\n\t\t\tthrow 'Login failed with status code ' + login.getStatus() + ': ' + response;\n\t\t}\n\t\ttry {\n\t\t\tresponse = JSON.parse(response);\n\t\t}\n\t\tcatch (error) {\n\t\t\tthrow 'Failed to parse login session response.';\n\t\t}\n\t\tif (!response.hasOwnProperty('access_token')) {\n\t\t\tthrow 'Authentication response does not contain access token.';\n\t\t}\n\n\t\tAzureCost.token = response['access_token'];\n\t},\n\n\trequest: function (url, body) {\n\t\tif (typeof body === 'undefined' || body === null) {\n\t\t\tbody = '';\n\t\t}\n\t\tvar response,\n\t\t\theaders,\n\t\t\tregex = /-retry-after\":\"(\\d+)\"/,\n\t\t\tratelimit,\n\t\t\trequest = new HttpRequest();\n\n\t\tif (typeof AzureCost.params.proxy !== 'undefined' && AzureCost.params.proxy !== '') {\n\t\t\trequest.setProxy(AzureCost.params.proxy);\n\t\t}\n\t\tif (!AzureCost.token) {\n\t\t\tthrow 'Request does not contain access token.';\n\t\t}\n\t\trequest.addHeader('Accept: application/json');\n\t\trequest.addHeader('Content-Type: application/json');\n\t\trequest.addHeader('Authorization: Bearer ' + AzureCost.token);\n\n\t\tZabbix.log(4, '[ AzureCost ] request url: ' + url);\n\n\t\tresponse = request.post(url, body);\n\t\theaders = JSON.stringify(request.getHeaders());\n\n\t\tif (headers.match(regex) !== null && request.getStatus() === 429) {\n\t\t\tratelimit = headers.match(regex)[1];\n\t\t\tZabbix.log(4, '[ AzureCost ] Microsoft Cost Management have rate limit requests per 1 minute, retrying after ' + ratelimit + ' seconds');\n\t\t\tZabbix.sleep(ratelimit * 1010);\n\t\t\tresponse = request.post(url, body);\n\t\t}\n\t\tif (request.getStatus() !== 200) {\n\t\t\tthrow 'Request failed with status code ' + request.getStatus() + ': ' + response;\n\t\t}\n\n\t\ttry {\n\t\t\treturn JSON.parse(response);\n\t\t}\n\t\tcatch (error) {\n\t\t\tthrow 'Failed to parse response received from API.';\n\t\t}\n\t},\n\n\tgetField: function (data, path) {\n\t\tvar steps = path.split('.');\n\t\tfor (var i = 0; i < steps.length; i++) {\n\t\t\tvar step = steps[i];\n\t\t\tif (typeof data !== 'object' || typeof data[step] === 'undefined') {\n\t\t\t\tthrow 'Required field was not found: ' + path;\n\t\t\t}\n\t\t\tdata = data[step];\n\t\t}\n\n\t\treturn data;\n\t},\n\n\tgetCost: function (grouping) {\n\t\tvar metricData = {},\n\t\t\tbodyRawCost = {\n\t\t\t\ttype: 'Usage',\n\t\t\t\ttimeframe: 'Custom',\n\t\t\t\ttimePeriod: {\n\t\t\t\t\tfrom: AzureCost.params.start_time,\n\t\t\t\t\tto: AzureCost.params.end_date\n\t\t\t\t},\n\t\t\t\tdataset: {\n\t\t\t\t\taggregation: {\n\t\t\t\t\t\ttotalCost: {\n\t\t\t\t\t\t\tname: 'PreTaxCost',\n\t\t\t\t\t\t\tfunction: 'Sum'\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tgrouping: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: 'Dimension',\n\t\t\t\t\t\t\tname: 'BillingMonth'\n\t\t\t\t\t\t},\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\ttype: 'Dimension',\n\t\t\t\t\t\t\tname: grouping\n\t\t\t\t\t\t},\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t};\n\n\t\tmetricData = AzureCost.request('https://management.azure.com/subscriptions/' + AzureCost.params.subscription_id + '/providers/Microsoft.CostManagement/query?api-version=2023-11-01', JSON.stringify(bodyRawCost));\n\n\t\tvar columns = AzureCost.getField(metricData, 'properties.columns');\n\n\t\treturn transformedData = {\n\t\t\tdata: AzureCost.getField(metricData, 'properties.rows').map(function (row) {\n\t\t\t\trowData = {};\n\t\t\t\tcolumns.forEach(function (column, i) {\n\t\t\t\t\tcolumnName = columns[i].name;\n\t\t\t\t\tcellValue = row[i];\n\t\t\t\t\trowData[columnName] = column.type === \"Number\" ? cellValue.toString() : cellValue;\n\t\t\t\t});\n\t\t\t\trowData.BillingMonth = rowData.BillingMonth.slice(0, 7);\n\n\t\t\t\treturn rowData;\n\t\t\t})\n\t\t};\n\t}\n};\n\ntry {\n\tAzureCost.setParams(JSON.parse(value));\n\tAzureCost.login();\n\n\tserviceCost = AzureCost.getCost('ServiceName');\n\tresourceGroupCost = AzureCost.getCost('ResourceGroup');\n\tresourceLocationCost = AzureCost.getCost('ResourceLocation');\n\tmonthCost = AzureCost.getCost('SubscriptionId');\n\n\treturn JSON.stringify({ resourceGroupCost, resourceLocationCost, serviceCost, monthCost });\n}\ncatch (error) {\n\terror += (String(error).endsWith('.')) ? '' : '.';\n\tZabbix.log(3, '[ AzureCost ] ERROR: ' + error);\n\n\treturn JSON.stringify({ 'error': error });\n}",
                        "description": "The result of API requests is expressed in the JSON.",
                        "timeout": "{$AZURE.DATA.TIMEOUT}",
                        "parameters": [
                            {
                                "name": "app_id",
                                "value": "{$AZURE.APP.ID}"
                            },
                            {
                                "name": "month",
                                "value": "{$AZURE.BILLING.MONTH}"
                            },
                            {
                                "name": "password",
                                "value": "{$AZURE.PASSWORD}"
                            },
                            {
                                "name": "proxy",
                                "value": "{$AZURE.PROXY}"
                            },
                            {
                                "name": "subscription_id",
                                "value": "{$AZURE.SUBSCRIPTION.ID}"
                            },
                            {
                                "name": "tenant_id",
                                "value": "{$AZURE.TENANT.ID}"
                            }
                        ],
                        "tags": [
                            {
                                "tag": "component",
                                "value": "raw"
                            }
                        ]
                    }
                ],
                "discovery_rules": [
                    {
                        "uuid": "1220188c7a1c4df8b75e9021c4515149",
                        "name": "Azure daily costs by services discovery",
                        "type": "DEPENDENT",
                        "key": "azure.daily.services.costs.discovery",
                        "delay": "0",
                        "filter": {
                            "evaltype": "AND",
                            "conditions": [
                                {
                                    "macro": "{#AZURE.RESOURCE.GROUP}",
                                    "value": "{$AZURE.LLD.FILTER.RESOURCE.GROUP.MATCHES}",
                                    "formulaid": "A"
                                },
                                {
                                    "macro": "{#AZURE.RESOURCE.GROUP}",
                                    "value": "{$AZURE.LLD.FILTER.RESOURCE.GROUP.NOT_MATCHES}",
                                    "operator": "NOT_MATCHES_REGEX",
                                    "formulaid": "B"
                                },
                                {
                                    "macro": "{#AZURE.RESOURCE.LOCATION}",
                                    "value": "{$AZURE.LLD.FILTER.RESOURCE.LOCATION.MATCHES}",
                                    "formulaid": "C"
                                },
                                {
                                    "macro": "{#AZURE.RESOURCE.LOCATION}",
                                    "value": "{$AZURE.LLD.FILTER.RESOURCE.LOCATION.NOT_MATCHES}",
                                    "operator": "NOT_MATCHES_REGEX",
                                    "formulaid": "D"
                                },
                                {
                                    "macro": "{#AZURE.SERVICE.NAME}",
                                    "value": "{$AZURE.LLD.FILTER.SERVICE.MATCHES}",
                                    "formulaid": "E"
                                },
                                {
                                    "macro": "{#AZURE.SERVICE.NAME}",
                                    "value": "{$AZURE.LLD.FILTER.SERVICE.NOT_MATCHES}",
                                    "operator": "NOT_MATCHES_REGEX",
                                    "formulaid": "F"
                                }
                            ]
                        },
                        "description": "Discovery of daily costs by services.",
                        "item_prototypes": [
                            {
                                "uuid": "848ccd4cec2c4902990aa25f90f502a8",
                                "name": "Service [\"{#AZURE.SERVICE.NAME}\"]: Meter [\"{#AZURE.BILLING.METER}\"]: Subcategory [\"{#AZURE.BILLING.METER.SUBCATEGORY}\"] daily cost",
                                "type": "DEPENDENT",
                                "key": "azure.daily.cost[\"{#AZURE.SERVICE.NAME}\", \"{#AZURE.BILLING.METER}\", \"{#AZURE.BILLING.METER.SUBCATEGORY}\",\"{#AZURE.RESOURCE.GROUP}\"]",
                                "delay": "0",
                                "history": "7d",
                                "value_type": "FLOAT",
                                "units": "!{#AZURE.BILLING.UNIT}",
                                "description": "The daily cost by service {#AZURE.SERVICE.NAME}, meter {#AZURE.BILLING.METER}, subcategory {#AZURE.BILLING.METER.SUBCATEGORY}.",
                                "preprocessing": [
                                    {
                                        "type": "JSONPATH",
                                        "parameters": [
                                            "$.data.[?(@.ServiceName == \"{#AZURE.SERVICE.NAME}\" && @.Meter == \"{#AZURE.BILLING.METER}\" && @.MeterSubcategory == \"{#AZURE.BILLING.METER.SUBCATEGORY}\")].PreTaxCost.first()"
                                        ],
                                        "error_handler": "DISCARD_VALUE"
                                    }
                                ],
                                "master_item": {
                                    "key": "azure.get.daily.costs"
                                },
                                "tags": [
                                    {
                                        "tag": "component",
                                        "value": "cost"
                                    },
                                    {
                                        "tag": "location",
                                        "value": "{#AZURE.RESOURCE.LOCATION}"
                                    },
                                    {
                                        "tag": "meter",
                                        "value": "{#AZURE.BILLING.METER}"
                                    },
                                    {
                                        "tag": "resource-group",
                                        "value": "{#AZURE.RESOURCE.GROUP}"
                                    },
                                    {
                                        "tag": "service",
                                        "value": "{#AZURE.SERVICE.NAME}"
                                    }
                                ]
                            }
                        ],
                        "graph_prototypes": [
                            {
                                "uuid": "2a1e03e65b1c40cba783493871e245d5",
                                "name": "Daily Cost: \"{#AZURE.SERVICE.NAME}\",\"{#AZURE.BILLING.METER}\",\"{#AZURE.BILLING.METER.SUBCATEGORY}\",\"{#AZURE.RESOURCE.GROUP}\"",
                                "graph_items": [
                                    {
                                        "drawtype": "GRADIENT_LINE",
                                        "color": "2E7D32",
                                        "item": {
                                            "host": "Azure Cost Management by HTTP",
                                            "key": "azure.daily.cost[\"{#AZURE.SERVICE.NAME}\", \"{#AZURE.BILLING.METER}\", \"{#AZURE.BILLING.METER.SUBCATEGORY}\",\"{#AZURE.RESOURCE.GROUP}\"]"
                                        }
                                    }
                                ]
                            }
                        ],
                        "master_item": {
                            "key": "azure.get.daily.costs"
                        },
                        "lld_macro_paths": [
                            {
                                "lld_macro": "{#AZURE.BILLING.METER.SUBCATEGORY}",
                                "path": "$.MeterSubcategory"
                            },
                            {
                                "lld_macro": "{#AZURE.BILLING.METER}",
                                "path": "$.Meter"
                            },
                            {
                                "lld_macro": "{#AZURE.BILLING.UNIT}",
                                "path": "$.Currency"
                            },
                            {
                                "lld_macro": "{#AZURE.RESOURCE.GROUP}",
                                "path": "$.ResourceGroup"
                            },
                            {
                                "lld_macro": "{#AZURE.RESOURCE.LOCATION}",
                                "path": "$.ResourceLocation"
                            },
                            {
                                "lld_macro": "{#AZURE.SERVICE.NAME}",
                                "path": "$.ServiceName"
                            }
                        ],
                        "preprocessing": [
                            {
                                "type": "JSONPATH",
                                "parameters": [
                                    "$.data"
                                ],
                                "error_handler": "DISCARD_VALUE"
                            }
                        ]
                    },
                    {
                        "uuid": "9c65b60a8e1840dd81367aefe6b0de18",
                        "name": "Azure monthly costs discovery",
                        "type": "DEPENDENT",
                        "key": "azure.monthly.costs.discovery",
                        "delay": "0",
                        "description": "Discovery of monthly costs.",
                        "item_prototypes": [
                            {
                                "uuid": "f91a60d2c1124eb6b297539b0a115c66",
                                "name": "Month [\"{#AZURE.BILLING.MONTH}\"] cost",
                                "type": "DEPENDENT",
                                "key": "azure.monthly.cost[\"{#AZURE.BILLING.MONTH}\"]",
                                "delay": "0",
                                "history": "7d",
                                "value_type": "FLOAT",
                                "units": "!{#AZURE.BILLING.UNIT}",
                                "description": "The monthly cost.",
                                "preprocessing": [
                                    {
                                        "type": "JSONPATH",
                                        "parameters": [
                                            "$.monthCost.data.[?(@.BillingMonth == \"{#AZURE.BILLING.MONTH}\")].PreTaxCost.first()"
                                        ],
                                        "error_handler": "DISCARD_VALUE"
                                    }
                                ],
                                "master_item": {
                                    "key": "azure.get.monthly.costs"
                                },
                                "tags": [
                                    {
                                        "tag": "component",
                                        "value": "cost"
                                    },
                                    {
                                        "tag": "month",
                                        "value": "{#AZURE.BILLING.MONTH}"
                                    }
                                ]
                            }
                        ],
                        "graph_prototypes": [
                            {
                                "uuid": "347342d3d0cc478bab33036872570cdb",
                                "name": "Azure Cost: Month [\"{#AZURE.BILLING.MONTH}\"] cost",
                                "graph_items": [
                                    {
                                        "drawtype": "GRADIENT_LINE",
                                        "color": "2E7D32",
                                        "item": {
                                            "host": "Azure Cost Management by HTTP",
                                            "key": "azure.monthly.cost[\"{#AZURE.BILLING.MONTH}\"]"
                                        }
                                    }
                                ]
                            }
                        ],
                        "master_item": {
                            "key": "azure.get.monthly.costs"
                        },
                        "lld_macro_paths": [
                            {
                                "lld_macro": "{#AZURE.BILLING.MONTH}",
                                "path": "$.BillingMonth"
                            },
                            {
                                "lld_macro": "{#AZURE.BILLING.UNIT}",
                                "path": "$.Currency"
                            }
                        ],
                        "preprocessing": [
                            {
                                "type": "JSONPATH",
                                "parameters": [
                                    "$.monthCost.data"
                                ],
                                "error_handler": "DISCARD_VALUE"
                            }
                        ]
                    },
                    {
                        "uuid": "e9a4bf192feb4472aedd40ba2371d286",
                        "name": "Azure monthly costs by location discovery",
                        "type": "DEPENDENT",
                        "key": "azure.monthly.location.costs.discovery",
                        "delay": "0",
                        "filter": {
                            "evaltype": "AND",
                            "conditions": [
                                {
                                    "macro": "{#AZURE.RESOURCE.LOCATION}",
                                    "value": "{$AZURE.LLD.FILTER.RESOURCE.LOCATION.MATCHES}",
                                    "formulaid": "A"
                                },
                                {
                                    "macro": "{#AZURE.RESOURCE.LOCATION}",
                                    "value": "{$AZURE.LLD.FILTER.RESOURCE.LOCATION.NOT_MATCHES}",
                                    "operator": "NOT_MATCHES_REGEX",
                                    "formulaid": "B"
                                }
                            ]
                        },
                        "description": "Discovery of monthly costs by location.",
                        "item_prototypes": [
                            {
                                "uuid": "7fb097f81a8445acaa6b17bdc4daaaa6",
                                "name": "Location: [\"{#AZURE.RESOURCE.LOCATION}\"]: Month [\"{#AZURE.BILLING.MONTH}\"] cost",
                                "type": "DEPENDENT",
                                "key": "azure.monthly.location.cost[\"{#AZURE.RESOURCE.LOCATION}\", \"{#AZURE.BILLING.MONTH}\"]",
                                "delay": "0",
                                "history": "7d",
                                "value_type": "FLOAT",
                                "units": "!{#AZURE.BILLING.UNIT}",
                                "description": "The monthly cost by location {#AZURE.RESOURCE.LOCATION}.",
                                "preprocessing": [
                                    {
                                        "type": "JSONPATH",
                                        "parameters": [
                                            "$.resourceLocationCost.data.[?(@.BillingMonth == \"{#AZURE.BILLING.MONTH}\")]"
                                        ],
                                        "error_handler": "DISCARD_VALUE"
                                    },
                                    {
                                        "type": "JSONPATH",
                                        "parameters": [
                                            "$.[?(@.ResourceLocation == \"{#AZURE.RESOURCE.LOCATION}\")].PreTaxCost.first()"
                                        ],
                                        "error_handler": "DISCARD_VALUE"
                                    }
                                ],
                                "master_item": {
                                    "key": "azure.get.monthly.costs"
                                },
                                "tags": [
                                    {
                                        "tag": "component",
                                        "value": "cost"
                                    },
                                    {
                                        "tag": "location",
                                        "value": "{#AZURE.RESOURCE.LOCATION}"
                                    },
                                    {
                                        "tag": "month",
                                        "value": "{#AZURE.BILLING.MONTH}"
                                    }
                                ]
                            }
                        ],
                        "graph_prototypes": [
                            {
                                "uuid": "e3df27afabb147d3ae07e1a2fa36e89a",
                                "name": "Azure Cost: [\"{#AZURE.RESOURCE.LOCATION}\"]: Month [\"{#AZURE.BILLING.MONTH}\"] cost",
                                "graph_items": [
                                    {
                                        "drawtype": "GRADIENT_LINE",
                                        "color": "2E7D32",
                                        "item": {
                                            "host": "Azure Cost Management by HTTP",
                                            "key": "azure.monthly.location.cost[\"{#AZURE.RESOURCE.LOCATION}\", \"{#AZURE.BILLING.MONTH}\"]"
                                        }
                                    }
                                ]
                            }
                        ],
                        "master_item": {
                            "key": "azure.get.monthly.costs"
                        },
                        "lld_macro_paths": [
                            {
                                "lld_macro": "{#AZURE.BILLING.MONTH}",
                                "path": "$.BillingMonth"
                            },
                            {
                                "lld_macro": "{#AZURE.BILLING.UNIT}",
                                "path": "$.Currency"
                            },
                            {
                                "lld_macro": "{#AZURE.RESOURCE.LOCATION}",
                                "path": "$.ResourceLocation"
                            }
                        ],
                        "preprocessing": [
                            {
                                "type": "JSONPATH",
                                "parameters": [
                                    "$.resourceLocationCost.data"
                                ],
                                "error_handler": "DISCARD_VALUE"
                            }
                        ]
                    },
                    {
                        "uuid": "4dfa3b60721e463d97f2f820106f816d",
                        "name": "Azure monthly costs by resource group discovery",
                        "type": "DEPENDENT",
                        "key": "azure.monthly.resource.group.costs.discovery",
                        "delay": "0",
                        "filter": {
                            "evaltype": "AND",
                            "conditions": [
                                {
                                    "macro": "{#AZURE.RESOURCE.GROUP}",
                                    "value": "{$AZURE.LLD.FILTER.RESOURCE.GROUP.MATCHES}",
                                    "formulaid": "A"
                                },
                                {
                                    "macro": "{#AZURE.RESOURCE.GROUP}",
                                    "value": "{$AZURE.LLD.FILTER.RESOURCE.GROUP.NOT_MATCHES}",
                                    "operator": "NOT_MATCHES_REGEX",
                                    "formulaid": "B"
                                }
                            ]
                        },
                        "description": "Discovery of monthly costs by resource group.",
                        "item_prototypes": [
                            {
                                "uuid": "9a5ed573ac374c08abf81f2b7296f260",
                                "name": "Resource group: [\"{#AZURE.RESOURCE.GROUP}\"]: Month [\"{#AZURE.BILLING.MONTH}\"] cost",
                                "type": "DEPENDENT",
                                "key": "azure.monthly.resource.group.cost[\"{#AZURE.RESOURCE.GROUP}\", \"{#AZURE.BILLING.MONTH}\"]",
                                "delay": "0",
                                "history": "7d",
                                "value_type": "FLOAT",
                                "units": "!{#AZURE.BILLING.UNIT}",
                                "description": "The monthly cost by resource group {#AZURE.RESOURCE.GROUP}.",
                                "preprocessing": [
                                    {
                                        "type": "JSONPATH",
                                        "parameters": [
                                            "$.resourceGroupCost.data.[?(@.BillingMonth == \"{#AZURE.BILLING.MONTH}\")]"
                                        ],
                                        "error_handler": "DISCARD_VALUE"
                                    },
                                    {
                                        "type": "JSONPATH",
                                        "parameters": [
                                            "$.[?(@.ResourceGroup == \"{#AZURE.RESOURCE.GROUP}\")].PreTaxCost.first()"
                                        ],
                                        "error_handler": "DISCARD_VALUE"
                                    }
                                ],
                                "master_item": {
                                    "key": "azure.get.monthly.costs"
                                },
                                "tags": [
                                    {
                                        "tag": "component",
                                        "value": "cost"
                                    },
                                    {
                                        "tag": "month",
                                        "value": "{#AZURE.BILLING.MONTH}"
                                    },
                                    {
                                        "tag": "resource-group",
                                        "value": "{#AZURE.RESOURCE.GROUP}"
                                    }
                                ]
                            }
                        ],
                        "graph_prototypes": [
                            {
                                "uuid": "fab17244d2c648e089c57c99615af537",
                                "name": "Azure Cost: [\"{#AZURE.RESOURCE.GROUP}\"]: Month [\"{#AZURE.BILLING.MONTH}\"] cost",
                                "graph_items": [
                                    {
                                        "drawtype": "GRADIENT_LINE",
                                        "color": "2E7D32",
                                        "item": {
                                            "host": "Azure Cost Management by HTTP",
                                            "key": "azure.monthly.resource.group.cost[\"{#AZURE.RESOURCE.GROUP}\", \"{#AZURE.BILLING.MONTH}\"]"
                                        }
                                    }
                                ]
                            }
                        ],
                        "master_item": {
                            "key": "azure.get.monthly.costs"
                        },
                        "lld_macro_paths": [
                            {
                                "lld_macro": "{#AZURE.BILLING.MONTH}",
                                "path": "$.BillingMonth"
                            },
                            {
                                "lld_macro": "{#AZURE.BILLING.UNIT}",
                                "path": "$.Currency"
                            },
                            {
                                "lld_macro": "{#AZURE.RESOURCE.GROUP}",
                                "path": "$.ResourceGroup"
                            }
                        ],
                        "preprocessing": [
                            {
                                "type": "JSONPATH",
                                "parameters": [
                                    "$.resourceGroupCost.data"
                                ],
                                "error_handler": "DISCARD_VALUE"
                            }
                        ]
                    },
                    {
                        "uuid": "b9b024a7e42540f0b8387af77367b15c",
                        "name": "Azure monthly costs by services discovery",
                        "type": "DEPENDENT",
                        "key": "azure.monthly.services.costs.discovery",
                        "delay": "0",
                        "filter": {
                            "evaltype": "AND",
                            "conditions": [
                                {
                                    "macro": "{#AZURE.SERVICE.NAME}",
                                    "value": "{$AZURE.LLD.FILTER.SERVICE.MATCHES}",
                                    "formulaid": "A"
                                },
                                {
                                    "macro": "{#AZURE.SERVICE.NAME}",
                                    "value": "{$AZURE.LLD.FILTER.SERVICE.NOT_MATCHES}",
                                    "operator": "NOT_MATCHES_REGEX",
                                    "formulaid": "B"
                                }
                            ]
                        },
                        "description": "Discovery of monthly costs by services.",
                        "item_prototypes": [
                            {
                                "uuid": "dbad6436c70e41268e3b59c2a7f0e2a2",
                                "name": "Service [\"{#AZURE.SERVICE.NAME}\"]: Month [\"{#AZURE.BILLING.MONTH}\"] cost",
                                "type": "DEPENDENT",
                                "key": "azure.monthly.service.cost[\"{#AZURE.SERVICE.NAME}\", \"{#AZURE.BILLING.MONTH}\"]",
                                "delay": "0",
                                "history": "7d",
                                "value_type": "FLOAT",
                                "units": "!{#AZURE.BILLING.UNIT}",
                                "description": "The monthly cost by service {#AZURE.SERVICE.NAME}.",
                                "preprocessing": [
                                    {
                                        "type": "JSONPATH",
                                        "parameters": [
                                            "$.serviceCost.data.[?(@.BillingMonth == \"{#AZURE.BILLING.MONTH}\")]"
                                        ],
                                        "error_handler": "DISCARD_VALUE"
                                    },
                                    {
                                        "type": "JSONPATH",
                                        "parameters": [
                                            "$.[?(@.ServiceName == \"{#AZURE.SERVICE.NAME}\")].PreTaxCost.first()"
                                        ],
                                        "error_handler": "DISCARD_VALUE"
                                    }
                                ],
                                "master_item": {
                                    "key": "azure.get.monthly.costs"
                                },
                                "tags": [
                                    {
                                        "tag": "component",
                                        "value": "cost"
                                    },
                                    {
                                        "tag": "month",
                                        "value": "{#AZURE.BILLING.MONTH}"
                                    },
                                    {
                                        "tag": "service",
                                        "value": "{#AZURE.SERVICE.NAME}"
                                    }
                                ]
                            }
                        ],
                        "graph_prototypes": [
                            {
                                "uuid": "31f1e30f99ed426d81b48411cc7ffd7f",
                                "name": "Azure Cost: [\"{#AZURE.SERVICE.NAME}\"]: Month [\"{#AZURE.BILLING.MONTH}\"] cost",
                                "graph_items": [
                                    {
                                        "drawtype": "GRADIENT_LINE",
                                        "color": "2E7D32",
                                        "item": {
                                            "host": "Azure Cost Management by HTTP",
                                            "key": "azure.monthly.service.cost[\"{#AZURE.SERVICE.NAME}\", \"{#AZURE.BILLING.MONTH}\"]"
                                        }
                                    }
                                ]
                            }
                        ],
                        "master_item": {
                            "key": "azure.get.monthly.costs"
                        },
                        "lld_macro_paths": [
                            {
                                "lld_macro": "{#AZURE.BILLING.MONTH}",
                                "path": "$.BillingMonth"
                            },
                            {
                                "lld_macro": "{#AZURE.BILLING.UNIT}",
                                "path": "$.Currency"
                            },
                            {
                                "lld_macro": "{#AZURE.SERVICE.NAME}",
                                "path": "$.ServiceName"
                            }
                        ],
                        "preprocessing": [
                            {
                                "type": "JSONPATH",
                                "parameters": [
                                    "$.serviceCost.data"
                                ],
                                "error_handler": "DISCARD_VALUE"
                            }
                        ]
                    }
                ],
                "tags": [
                    {
                        "tag": "class",
                        "value": "software"
                    },
                    {
                        "tag": "target",
                        "value": "azure"
                    },
                    {
                        "tag": "target",
                        "value": "cost"
                    }
                ],
                "macros": [
                    {
                        "macro": "{$AZURE.APP.ID}",
                        "description": "The App ID of Microsoft Azure."
                    },
                    {
                        "macro": "{$AZURE.BILLING.MONTH}",
                        "value": "11",
                        "description": "Months to get historical data from Azure Cost Management API, no more than 11 (plus current month). The time period for pulling the data cannot exceed 1 year."
                    },
                    {
                        "macro": "{$AZURE.DATA.TIMEOUT}",
                        "value": "60s",
                        "description": "A response timeout for API."
                    },
                    {
                        "macro": "{$AZURE.LLD.FILTER.RESOURCE.GROUP.MATCHES}",
                        "value": ".*",
                        "description": "Filter of discoverable resource groups by name."
                    },
                    {
                        "macro": "{$AZURE.LLD.FILTER.RESOURCE.GROUP.NOT_MATCHES}",
                        "value": "CHANGE_IF_NEEDED",
                        "description": "Filter to exclude discovered resource groups by name."
                    },
                    {
                        "macro": "{$AZURE.LLD.FILTER.RESOURCE.LOCATION.MATCHES}",
                        "value": ".*",
                        "description": "Filter of discoverable locations by name."
                    },
                    {
                        "macro": "{$AZURE.LLD.FILTER.RESOURCE.LOCATION.NOT_MATCHES}",
                        "value": "CHANGE_IF_NEEDED",
                        "description": "Filter to exclude discovered locations by name."
                    },
                    {
                        "macro": "{$AZURE.LLD.FILTER.SERVICE.MATCHES}",
                        "value": ".*",
                        "description": "Filter of discoverable services by name."
                    },
                    {
                        "macro": "{$AZURE.LLD.FILTER.SERVICE.NOT_MATCHES}",
                        "value": "CHANGE_IF_NEEDED",
                        "description": "Filter to exclude discovered services by name."
                    },
                    {
                        "macro": "{$AZURE.PASSWORD}",
                        "type": "SECRET_TEXT",
                        "description": "Microsoft Azure password."
                    },
                    {
                        "macro": "{$AZURE.PROXY}",
                        "description": "Sets HTTP proxy value. If this macro is empty then no proxy is used."
                    },
                    {
                        "macro": "{$AZURE.TENANT.ID}",
                        "description": "Microsoft Azure tenant ID."
                    }
                ],
                "dashboards": [
                    {
                        "uuid": "a1c2ce224f07483b865ce48090338dc4",
                        "name": "Overview Azure Costs",
                        "pages": [
                            {
                                "name": "Monthly costs",
                                "widgets": [
                                    {
                                        "type": "graphprototype",
                                        "width": "72",
                                        "height": "25",
                                        "fields": [
                                            {
                                                "type": "GRAPH_PROTOTYPE",
                                                "name": "graphid.0",
                                                "value": {
                                                    "host": "Azure Cost Management by HTTP",
                                                    "name": "Azure Cost: Month [\"{#AZURE.BILLING.MONTH}\"] cost"
                                                }
                                            },
                                            {
                                                "type": "STRING",
                                                "name": "reference",
                                                "value": "AAAAA"
                                            },
                                            {
                                                "type": "INTEGER",
                                                "name": "rows",
                                                "value": "6"
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                "name": "Monthly costs by service",
                                "widgets": [
                                    {
                                        "type": "graphprototype",
                                        "width": "72",
                                        "height": "25",
                                        "fields": [
                                            {
                                                "type": "GRAPH_PROTOTYPE",
                                                "name": "graphid.0",
                                                "value": {
                                                    "host": "Azure Cost Management by HTTP",
                                                    "name": "Azure Cost: [\"{#AZURE.SERVICE.NAME}\"]: Month [\"{#AZURE.BILLING.MONTH}\"] cost"
                                                }
                                            },
                                            {
                                                "type": "STRING",
                                                "name": "reference",
                                                "value": "AAAAB"
                                            },
                                            {
                                                "type": "INTEGER",
                                                "name": "rows",
                                                "value": "6"
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                "name": "Monthly costs by location",
                                "widgets": [
                                    {
                                        "type": "graphprototype",
                                        "width": "72",
                                        "height": "25",
                                        "fields": [
                                            {
                                                "type": "GRAPH_PROTOTYPE",
                                                "name": "graphid.0",
                                                "value": {
                                                    "host": "Azure Cost Management by HTTP",
                                                    "name": "Azure Cost: [\"{#AZURE.RESOURCE.LOCATION}\"]: Month [\"{#AZURE.BILLING.MONTH}\"] cost"
                                                }
                                            },
                                            {
                                                "type": "STRING",
                                                "name": "reference",
                                                "value": "AAAAC"
                                            },
                                            {
                                                "type": "INTEGER",
                                                "name": "rows",
                                                "value": "6"
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                "name": "Monthly costs by resource group",
                                "widgets": [
                                    {
                                        "type": "graphprototype",
                                        "width": "72",
                                        "height": "25",
                                        "fields": [
                                            {
                                                "type": "GRAPH_PROTOTYPE",
                                                "name": "graphid.0",
                                                "value": {
                                                    "host": "Azure Cost Management by HTTP",
                                                    "name": "Azure Cost: [\"{#AZURE.RESOURCE.GROUP}\"]: Month [\"{#AZURE.BILLING.MONTH}\"] cost"
                                                }
                                            },
                                            {
                                                "type": "STRING",
                                                "name": "reference",
                                                "value": "AAAAD"
                                            },
                                            {
                                                "type": "INTEGER",
                                                "name": "rows",
                                                "value": "6"
                                            }
                                        ]
                                    }
                                ]
                            },
                            {
                                "name": "Daily costs by service",
                                "widgets": [
                                    {
                                        "type": "graphprototype",
                                        "width": "72",
                                        "height": "20",
                                        "fields": [
                                            {
                                                "type": "GRAPH_PROTOTYPE",
                                                "name": "graphid.0",
                                                "value": {
                                                    "host": "Azure Cost Management by HTTP",
                                                    "name": "Daily Cost: \"{#AZURE.SERVICE.NAME}\",\"{#AZURE.BILLING.METER}\",\"{#AZURE.BILLING.METER.SUBCATEGORY}\",\"{#AZURE.RESOURCE.GROUP}\""
                                                }
                                            },
                                            {
                                                "type": "STRING",
                                                "name": "reference",
                                                "value": "AAAAE"
                                            },
                                            {
                                                "type": "INTEGER",
                                                "name": "rows",
                                                "value": "5"
                                            }
                                        ]
                                    }
                                ]
                            }
                        ]
                    }
                ]
            }
        ]
    }
}