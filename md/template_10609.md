# Template: MSSQL by Zabbix agent 2

## Template ID
10609

## Description
This template is designed for the effortless deployment of MSSQL monitoring by Zabbix via Zabbix agent 2 and uses a loadable plugin to run SQL queries.

Setup:

1. Deploy Zabbix agent 2 with the MSSQL plugin. You can use this template starting with Zabbix versions 6.0.27 / 6.4.12.

  For more information, see MSSQL plugin documentation: https://git.zabbix.com/projects/AP/repos/mssql/browse
  
  Loadable plugin requires installation of one of the following:

  - Separate package
  
  - Binary file
  
  - Compilation from sources: https://www.zabbix.com/documentation/7.0/manual/extensions/plugins/build

2. Create an MSSQL user for monitoring.

  View Server State and View Any Definition permissions should be granted to the user.
  Grant this user read permissions to the sysjobschedules, sysjobhistory, and sysjobs tables.

  For more information, see MSSQL documentation:
  
  - Create a database user: https://docs.microsoft.com/en-us/sql/relational-databases/security/authentication-access/create-a-database-user?view=sql-server-ver16
  
  - GRANT Server Permissions: https://docs.microsoft.com/en-us/sql/t-sql/statements/grant-server-permissions-transact-sql?view=sql-server-ver16
  
  - Configure a User to Create and Manage SQL Server Agent Jobs: https://docs.microsoft.com/en-us/sql/ssms/agent/configure-a-user-to-create-and-manage-sql-server-agent-jobs?view=sql-server-ver16

3. Set the user name and password in the host macros ({$MSSQL.USER} and {$MSSQL.PASSWORD}).

4. Set the connection string for the MSSQL instance in the {$MSSQL.URI} macro as a URI, such as <protocol://host:port>, or specify the named session - <sessionname>.

The "Service's TCP port state" item uses the {$MSSQL.HOST} and {$MSSQL.PORT} macros to check the availability of the MSSQL instance, change these if necessary.

Note: You can use the context macros {$MSSQL.BACKUP_FULL.USED}, {$MSSQL.BACKUP_LOG.USED}, and {$MSSQL.BACKUP_DIFF.USED} to disable backup age triggers for a certain database. If set to a value other than "1", the trigger expression for the backup age will not fire.

Generated by official Zabbix template tool "Templator"

## Linked Hosts
None

## Items

### Item: Get Access Methods counters
- **Description**: The item gets server information about access methods.
- **Interval**: 0
- **Data Type**: 4

### Item: Auto-param attempts per second
- **Description**: Number of auto-parameterization attempts per second. The total should be the sum of the failed, safe, and unsafe auto-parameterizations. Auto-parameterization occurs when an instance of SQL Server tries to parameterize a Transact-SQL request by replacing some literals with parameters so that reuse of the resulting cached execution plan across multiple similar-looking requests is possible. Note that auto-parameterizations are also known as simple parameterizations in the newer versions of SQL Server. This counter does not include forced parameterizations.
- **Interval**: 0
- **Data Type**: 0

### Item: Get availability groups
- **Description**: The item gets availability group states - name, primary and secondary health, synchronization health.
- **Interval**: 1m
- **Data Type**: 4

### Item: Average latch wait time
- **Description**: Average latch wait time (in milliseconds) for latch requests that had to wait.
- **Interval**: 0;m0-59s3
- **Data Type**: 0

### Item: Average latch wait time base
- **Description**: For internal use only.
- **Interval**: 0
- **Data Type**: 3

### Item: Average latch wait time raw
- **Description**: Average latch wait time (in milliseconds) for latch requests that had to wait.
- **Interval**: 0
- **Data Type**: 3

### Item: Total average wait time
- **Description**: The average wait time, in milliseconds, for each lock request that had to wait.
- **Interval**: 0;m0-59s3
- **Data Type**: 0

### Item: Total average wait time base
- **Description**: For internal use only.
- **Interval**: 0
- **Data Type**: 3

### Item: Total average wait time raw
- **Description**: Average amount of wait time (in milliseconds) for each lock request that resulted in a wait. Information for all locks.
- **Interval**: 0
- **Data Type**: 3

### Item: Batch requests per second
- **Description**: Number of Transact-SQL command batches received per second. This statistic is affected by all constraints (such as I/O, number of users, cache size, complexity of requests, and so on). High batch requests mean good throughput.
- **Interval**: 0
- **Data Type**: 0

### Item: Buffer cache hit ratio
- **Description**: Indicates the percentage of pages found in the buffer cache without having to read from the disk. The ratio is the total number of cache hits divided by the total number of cache lookups over the last few thousand page accesses. After a long period of time, the ratio changes very little. Since reading from the cache is much less expensive than reading from the disk, a higher value is preferred for this item. To increase the buffer cache hit ratio, consider increasing the amount of memory available to MSSQL Server or using the buffer pool extension feature.
- **Interval**: 0
- **Data Type**: 0

### Item: Get Buffer Manager counters
- **Description**: The item gets server information about the buffer pool.
- **Interval**: 0
- **Data Type**: 4

### Item: Cache hit ratio
- **Description**: Ratio between cache hits and lookups.
- **Interval**: 0
- **Data Type**: 0

### Item: Get Cache counters
- **Description**: The item gets server information about cache.
- **Interval**: 0
- **Data Type**: 4

### Item: Cache object counts
- **Description**: Number of cache objects in the cache.
- **Interval**: 0
- **Data Type**: 3

### Item: Cache objects in use
- **Description**: Number of cache objects in use.
- **Interval**: 0
- **Data Type**: 3

### Item: Cache pages
- **Description**: Number of 8-kilobyte (KB) pages used by cache objects.
- **Interval**: 0
- **Data Type**: 3

### Item: Checkpoint pages per second
- **Description**: Indicates the number of pages flushed to the disk per second by a checkpoint or other operation which required all dirty pages to be flushed.
- **Interval**: 0
- **Data Type**: 0

### Item: Database pages
- **Description**: Indicates the number of pages in the buffer pool with database content.
- **Interval**: 0
- **Data Type**: 3

### Item: Total data file size
- **Description**: Total size of all data files.
- **Interval**: 0
- **Data Type**: 3

### Item: Get database
- **Description**: Getting databases - database name and recovery model.
- **Interval**: 1h
- **Data Type**: 4

### Item: Get DB counters
- **Description**: The item gets summary information about databases.
- **Interval**: 0
- **Data Type**: 4

### Item: Total errors per second
- **Description**: Number of errors per second.
- **Interval**: 0
- **Data Type**: 0

### Item: Failed auto-params per second
- **Description**: Number of failed auto-parameterization attempts per second. This number should be small. Note that auto-parameterizations are also known as simple parameterizations in the newer versions of SQL Server.
- **Interval**: 0
- **Data Type**: 0

### Item: Forwarded records per second
- **Description**: Number of records per second fetched through forwarded record pointers.
- **Interval**: 0
- **Data Type**: 0

### Item: Free list stalls per second
- **Description**: Indicates the number of requests per second that had to wait for a free page.
- **Interval**: 0
- **Data Type**: 0

### Item: Full scans per second
- **Description**: Number of unrestricted full scans per second. These can be either base-table or full-index scans. Values greater than 1 or 2 indicate that there are table / index page scans. If that is combined with high CPU, this counter requires further investigation, otherwise, if the full scans are on small tables, it can be ignored.
- **Interval**: 0
- **Data Type**: 0

### Item: Get General Statistics counters
- **Description**: The item gets general statistics information.
- **Interval**: 0
- **Data Type**: 4

### Item: Granted Workspace Memory
- **Description**: Specifies the total amount of memory currently granted to executing processes, such as hash, sort, bulk copy, and index creation operations.
- **Interval**: 0
- **Data Type**: 3

### Item: Index searches per second
- **Description**: Number of index searches per second. These are used to start a range scan, reposition a range scan, revalidate a scan point, fetch a single index record, and search down the index to locate where to insert a new row.
- **Interval**: 0
- **Data Type**: 0

### Item: Errors per second (Info errors)
- **Description**: Number of errors per second.
- **Interval**: 0
- **Data Type**: 0

### Item: Get job status
- **Description**: The item gets the SQL agent job status.
- **Interval**: 10m
- **Data Type**: 4

### Item: Errors per second (Kill connection errors)
- **Description**: Number of errors per second.
- **Interval**: 0
- **Data Type**: 0

### Item: Get last backup
- **Description**: The item gets information about backup processes.
- **Interval**: 10m
- **Data Type**: 4

### Item: Get Latches counters
- **Description**: The item gets server information about latches.
- **Interval**: 0
- **Data Type**: 4

### Item: Latch waits per second
- **Description**: The number of latch requests that could not be granted immediately. Latches are lightweight means of holding a very transient server resource, such as an address in memory.
- **Interval**: 0
- **Data Type**: 0

### Item: Lazy writes per second
- **Description**: Indicates the number of buffers written per second by the buffer manager's lazy writer. The lazy writer is a system process that flushes out batches of dirty, aged buffers (buffers that contain changes that must be written back to the disk before the buffer can be reused for a different page) and makes them available to user processes. The lazy writer eliminates the need to perform frequent checkpoints in order to create available buffers.
- **Interval**: 0
- **Data Type**: 0

### Item: Get local DB
- **Description**: Getting the states of the local availability database.
- **Interval**: 1m
- **Data Type**: 4

### Item: Total lock requests per second
- **Description**: Number of new locks and lock conversions per second requested from the lock manager.
- **Interval**: 0
- **Data Type**: 0

### Item: Get Locks counters
- **Description**: The item gets server information about locks.
- **Interval**: 0
- **Data Type**: 4

### Item: Total lock requests per second that timed out
- **Description**: Number of timed out lock requests per second, including requests for NOWAIT locks.
- **Interval**: 0
- **Data Type**: 0

### Item: Total lock requests per second that required waiting
- **Description**: Number of lock requests per second that required the caller to wait.
- **Interval**: 0
- **Data Type**: 0

### Item: Lock wait time
- **Description**: Average of total wait time (in milliseconds) for locks in the last second.
- **Interval**: 0
- **Data Type**: 0

### Item: Total log file size
- **Description**: Total size of all the transaction log files.
- **Interval**: 0
- **Data Type**: 3

### Item: Total log file used size
- **Description**: The cumulative size of all the log files in the database.
- **Interval**: 0
- **Data Type**: 3

### Item: Logins per second
- **Description**: Total number of logins started per second. This does not include pooled connections. Any value over 2 may indicate insufficient connection pooling.
- **Interval**: 0
- **Data Type**: 0

### Item: Logouts per second
- **Description**: Total number of logout operations started per second. Any value over 2 may indicate insufficient connection pooling.
- **Interval**: 0
- **Data Type**: 0

### Item: Maximum workspace memory
- **Description**: Indicates the maximum amount of memory available for executing processes, such as hash, sort, bulk copy, and index creation operations.
- **Interval**: 0
- **Data Type**: 3

### Item: Get Memory counters
- **Description**: The item gets memory information.
- **Interval**: 0
- **Data Type**: 4

### Item: Memory grants outstanding
- **Description**: Specifies the total number of processes that have successfully acquired a workspace memory grant.
- **Interval**: 0
- **Data Type**: 3

### Item: Memory grants pending
- **Description**: Specifies the total number of processes waiting for a workspace memory grant.
- **Interval**: 0
- **Data Type**: 3

### Item: Get DB mirroring
- **Description**: Getting DB mirroring.
- **Interval**: 1m
- **Data Type**: 4

### Item: Get non-local DB
- **Description**: Getting the non-local availability database.
- **Interval**: 1m
- **Data Type**: 4

### Item: Total lock requests per second that have deadlocks
- **Description**: Number of lock requests per second that resulted in a deadlock.
- **Interval**: 0
- **Data Type**: 0

### Item: Errors per second (DB offline errors)
- **Description**: Number of errors per second.
- **Interval**: 0
- **Data Type**: 0

### Item: Page life expectancy
- **Description**: Indicates the number of seconds a page will stay in the buffer pool without references.
- **Interval**: 0
- **Data Type**: 0

### Item: Page lookups per second
- **Description**: Indicates the number of requests per second to find a page in the buffer pool.
- **Interval**: 0
- **Data Type**: 0

### Item: Page reads per second
- **Description**: Indicates the number of physical database page reads that are issued per second. This statistic displays the total number of physical page reads across all databases. As physical I/O is expensive, you may be able to minimize the cost either by using a larger data cache, intelligent indexes, and more efficient queries, or by changing the database design.
- **Interval**: 0
- **Data Type**: 0

### Item: Page splits per second
- **Description**: Number of page splits per second that occur as a result of overflowing index pages.
- **Interval**: 0
- **Data Type**: 0

### Item: Page writes per second
- **Description**: Indicates the number of physical database page writes that are issued per second.
- **Interval**: 0
- **Data Type**: 0

### Item: Percent of ad hoc queries running
- **Description**: The ratio of SQL compilations per second to batch requests per second, in percent.
- **Interval**: 0;m0-59s3
- **Data Type**: 0

### Item: Percent of Recompiled Transact-SQL Objects
- **Description**: The ratio of SQL re-compilations per second to SQL compilations per second, in percent.
- **Interval**: 0;m0-59s3
- **Data Type**: 0

### Item: Get performance counters
- **Description**: The item gets server global status information.
- **Interval**: 0;m0-59
- **Data Type**: 4

### Item: Number of blocked processes
- **Description**: Number of currently blocked processes.
- **Interval**: 0
- **Data Type**: 3

### Item: Get quorum
- **Description**: Getting quorum - cluster name, type, and state.
- **Interval**: 1m
- **Data Type**: 4

### Item: Get quorum member
- **Description**: Getting quorum members - member name, type, state, and number of quorum votes.
- **Interval**: 1m
- **Data Type**: 4

### Item: Read-ahead pages per second
- **Description**: Indicates the number of pages read per second in anticipation of use.
- **Interval**: 0
- **Data Type**: 0

### Item: Get replica
- **Description**: Getting the database replica.
- **Interval**: 1m
- **Data Type**: 4

### Item: Safe auto-params per second
- **Description**: Number of safe auto-parameterization attempts per second. Safe refers to a determination that a cached execution plan can be shared between different similar-looking Transact-SQL statements. SQL Server makes many auto-parameterization attempts, some of which turn out to be safe and others fail. Note that auto-parameterizations are also known as simple parameterizations in the newer versions of SQL Server. This does not include forced parameterizations.
- **Interval**: 0
- **Data Type**: 0

### Item: Full scans to Index searches ratio
- **Description**: The ratio of full scans per second to index searches per second. The threshold recommendation is strictly for OLTP workloads.
- **Interval**: 0;m0-59s3
- **Data Type**: 0

### Item: SQL compilations per second
- **Description**: Number of SQL compilations per second. Indicates the number of times the compile code path is entered. Includes runs caused by statement-level recompilations in SQL Server. After SQL Server user activity is stable, this value reaches a steady state.
- **Interval**: 0
- **Data Type**: 0

### Item: Get SQL Errors counters
- **Description**: The item gets SQL error information.
- **Interval**: 0
- **Data Type**: 4

### Item: SQL re-compilations per second
- **Description**: Number of statement recompiles per second. Counts the number of times statement recompiles are triggered. Generally, you want the recompiles to be low.
- **Interval**: 0
- **Data Type**: 0

### Item: Get SQL Statistics counters
- **Description**: The item gets SQL statistics information.
- **Interval**: 0
- **Data Type**: 4

### Item: Table lock escalations per second
- **Description**: Number of times locks on a table were escalated to the TABLE or HoBT granularity.
- **Interval**: 0
- **Data Type**: 0

### Item: Target pages
- **Description**: The optimal number of pages in the buffer pool.
- **Interval**: 0
- **Data Type**: 3

### Item: Target server memory
- **Description**: Indicates the ideal amount of memory the server can consume.
- **Interval**: 0
- **Data Type**: 3

### Item: Total latch wait time
- **Description**: Total latch wait time (in milliseconds) for latch requests in the last second. This value should stay stable compared to the number of latch waits per second.
- **Interval**: 0
- **Data Type**: 0

### Item: Total server memory
- **Description**: Specifies the amount of memory the server has committed using the memory manager.
- **Interval**: 0
- **Data Type**: 3

### Item: Total transactions number
- **Description**: The number of currently active transactions of all types.
- **Interval**: 0
- **Data Type**: 3

### Item: Total transactions per second
- **Description**: Total number of transactions started for all databases per second.
- **Interval**: 0
- **Data Type**: 0

### Item: Unsafe auto-params per second
- **Description**: Number of unsafe auto-parameterization attempts per second. For example, the query has some characteristics that prevent the cached plan from being shared. These are designated as unsafe. This does not count the number of forced parameterizations.
- **Interval**: 0
- **Data Type**: 0

### Item: Uptime
- **Description**: MSSQL Server uptime in the format "N days, hh:mm:ss".
- **Interval**: 0
- **Data Type**: 3

### Item: Number of users connected
- **Description**: Number of users connected to MSSQL Server.
- **Interval**: 0
- **Data Type**: 3

### Item: Errors per second (User errors)
- **Description**: Number of errors per second.
- **Interval**: 0
- **Data Type**: 0

### Item: Version
- **Description**: MSSQL Server version.
- **Interval**: 1m
- **Data Type**: 1

### Item: Work files created per second
- **Description**: Number of work files created per second. For example, work files can be used to store temporary results for hash joins and hash aggregates.
- **Interval**: 0
- **Data Type**: 0

### Item: Work tables created per second
- **Description**: Number of work tables created per second. For example, work tables can be used to store temporary results for query spool, LOB variables, XML variables, and cursors.
- **Interval**: 0
- **Data Type**: 0

### Item: Worktables from cache ratio
- **Description**: Percentage of work tables created where the initial two pages of the work table were not allocated but were immediately available from the work table cache.
- **Interval**: 0
- **Data Type**: 0

### Item: Service's TCP port state
- **Description**: Test the availability of MSSQL Server on a TCP port.
- **Interval**: 30s
- **Data Type**: 3

