# AWS EC2 by HTTP template description

Get AWS EC2 and attached AWS EBS volumes metrics and uses the script item to make HTTP requests to the CloudWatch API.
Don't forget to read the README.md for the correct setup of the template.

You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback

Generated by official Zabbix template tool "Templator"

## Summary
* [items](#items)
* [macros](#macros)
* [triggers](#triggers)
* [discoveries](#discoveries)
  * [Discovery Instance Alarms discovery ](#discovery_instance_alarms_discovery)
  * [Discovery Instance Volumes discovery ](#discovery_instance_volumes_discovery)

<a name="items"></a>

## Items
| name | description | key | type | delay |
| ------------- |------------- |------------- |------------- |------------- |
| Get alarms check | Check result of the alarm data has been got correctly. | aws.ec2.alarms.check | DEPENDENT | 0 |
| Credit CPU: Balance | The number of earned CPU credits that an instance has accrued since it was launched or started. For T2 Standard, the CPUCreditBalance also includes the number of launch credits that have been accrued.<br>Credits are accrued in the credit balance after they are earned, and removed from the credit balance when they are spent. The credit balance has a maximum limit, determined by the instance size. After the limit is reached, any new credits that are earned are discarded. For T2 Standard, launch credits do not count towards the limit.<br>The credits in the CPUCreditBalance are available for the instance to spend to burst beyond its baseline CPU utilization.<br>When an instance is running, credits in the CPUCreditBalance do not expire. When a T3 or T3a instance stops, the CPUCreditBalance value persists for seven days. Thereafter, all accrued credits are lost. When a T2 instance stops, the CPUCreditBalance value does not persist, and all accrued credits are lost. | aws.ec2.cpu.credit_balance | DEPENDENT | 0 |
| Credit CPU: Usage | The number of CPU credits spent by the instance for CPU utilization.<br>One CPU credit equals one vCPU running at 100% utilization for one minute or an equivalent combination of vCPUs, utilization, and time (for example, one vCPU running at 50% utilization for two minutes or two vCPUs running at 25% utilization for two minutes). | aws.ec2.cpu.credit_usage | DEPENDENT | 0 |
| Credit CPU: Surplus balance | The number of surplus credits that have been spent by an unlimited instance when its CPUCreditBalance value is zero.<br>The CPUSurplusCreditBalance value is paid down by earned CPU credits. If the number of surplus credits exceeds the maximum number of credits that the instance can earn in a 24-hour period, the spent surplus credits above the maximum incur an additional charge. | aws.ec2.cpu.surplus_credit_balance | DEPENDENT | 0 |
| Credit CPU: Surplus charged | The number of spent surplus credits that are not paid down by earned CPU credits, and which thus incur an additional charge.<br><br>Spent surplus credits are charged when any of the following occurs:<br>- The spent surplus credits exceed the maximum number of credits that the instance can earn in a 24-hour period. Spent surplus credits above the maximum are charged at the end of the hour;<br>- The instance is stopped or terminated;<br>- The instance is switched from unlimited to standard. | aws.ec2.cpu.surplus_credit_charged | DEPENDENT | 0 |
| CPU: Utilization | The percentage of allocated EC2 compute units that are currently in use on the instance. This metric identifies the processing power required to run an application on a selected instance.<br>Depending on the instance type, tools in your operating system can show a lower percentage than CloudWatch when the instance is not allocated a full processor core. | aws.ec2.cpu_utilization | DEPENDENT | 0 |
| Disk: Read bytes, rate | Bytes read from all instance store volumes available to the instance.<br>This metric is used to determine the volume of the data the application reads from the hard disk of the instance.<br>This can be used to determine the speed of the application.<br>If there are no instance store volumes, either the value is 0 or the metric is not reported. | aws.ec2.disk.read_bytes.rate | DEPENDENT | 0 |
| Disk: Read, rate | Completed read operations from all instance store volumes available to the instance in a specified period of time.<br>If there are no instance store volumes, either the value is 0 or the metric is not reported. | aws.ec2.disk.read_ops.rate | DEPENDENT | 0 |
| Disk: Write bytes, rate | Bytes written to all instance store volumes available to the instance.<br>This metric is used to determine the volume of the data the application writes onto the hard disk of the instance.<br>This can be used to determine the speed of the application.<br>If there are no instance store volumes, either the value is 0 or the metric is not reported. | aws.ec2.disk_write_bytes.rate | DEPENDENT | 0 |
| Disk: Write ops, rate | Completed write operations to all instance store volumes available to the instance in a specified period of time.<br>If there are no instance store volumes, either the value is 0 or the metric is not reported. | aws.ec2.disk_write_ops.rate | DEPENDENT | 0 |
| EBS: Byte balance | Percentage of throughput credits remaining in the burst bucket for Nitro-based instances. | aws.ec2.ebs.byte_balance | DEPENDENT | 0 |
| EBS: IO balance | Percentage of I/O credits remaining in the burst bucket for Nitro-based instances. | aws.ec2.ebs.io_balance | DEPENDENT | 0 |
| EBS: Read bytes, rate | Bytes read from all EBS volumes attached to the instance for Nitro-based instances. | aws.ec2.ebs.read_bytes.rate | DEPENDENT | 0 |
| EBS: Read, rate | Completed read operations from all Amazon EBS volumes attached to the instance for Nitro-based instances. | aws.ec2.ebs.read_ops.rate | DEPENDENT | 0 |
| EBS: Write bytes, rate | Bytes written to all EBS volumes attached to the instance for Nitro-based instances. | aws.ec2.ebs.write_bytes.rate | DEPENDENT | 0 |
| EBS: Write, rate | Completed write operations to all EBS volumes attached to the instance in a specified period of time. | aws.ec2.ebs.write_ops.rate | DEPENDENT | 0 |
| Get instance alarms data | DescribeAlarms API method: https://docs.aws.amazon.com/AmazonCloudWatch/latest/APIReference/API_DescribeAlarms.html | aws.ec2.get_alarms | SCRIPT | 0s;m/1 |
| Get metrics data | Get instance metrics.<br>Full metrics list related to EC2: https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/viewing_metrics_with_cloudwatch.html | aws.ec2.get_metrics | SCRIPT | 0s;m/5 |
| Get volumes data | Get volumes attached to instance.<br>DescribeVolumes API method: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DescribeVolumes.html | aws.ec2.get_volumes | SCRIPT | 5m |
| Metadata: No token | The number of times the instance metadata service was successfully accessed using a method that does not use a token.<br>This metric is used to determine if there are any processes accessing instance metadata that are using Instance Metadata Service Version 1, which does not use a token.<br>If all requests use token-backed sessions, i.e., Instance Metadata Service Version 2, the value is 0. | aws.ec2.metadata.no_token | DEPENDENT | 0 |
| Get metrics check | Check result of the instance metric data has been got correctly. | aws.ec2.metrics.check | DEPENDENT | 0 |
| Network: Bytes in, rate | The number of bytes received on all network interfaces by the instance.<br>This metric identifies the volume of incoming network traffic to a single instance. | aws.ec2.network_in.rate | DEPENDENT | 0 |
| Network: Bytes out, rate | The number of bytes sent out on all network interfaces by the instance. <br>This metric identifies the volume of outgoing network traffic from a single instance. | aws.ec2.network_out.rate | DEPENDENT | 0 |
| Network: Packets in, rate | The number of packets received on all network interfaces by the instance.<br>This metric identifies the volume of incoming traffic in terms of the number of packets on a single instance.<br>This metric is available for basic monitoring only. | aws.ec2.packets_in.rate | DEPENDENT | 0 |
| Network: Packets out, rate | The number of packets sent out on all network interfaces by the instance.<br>This metric identifies the volume of outgoing traffic in terms of the number of packets on a single instance.<br>This metric is available for basic monitoring only. | aws.ec2.packets_out.rate | DEPENDENT | 0 |
| Status: Check failed | Reports whether the instance has passed both the instance status check and the system status check in the last minute.<br>This metric can be either 0 (passed) or 1 (failed). | aws.ec2.status_check_failed | DEPENDENT | 0 |
| Status: Check failed, instance | Reports whether the instance has passed the instance status check in the last minute.<br>This metric can be either 0 (passed) or 1 (failed). | aws.ec2.status_check_failed_instance | DEPENDENT | 0 |
| Status: Check failed, system | Reports whether the instance has passed the system status check in the last minute.<br>This metric can be either 0 (passed) or 1 (failed). | aws.ec2.status_check_failed_system | DEPENDENT | 0 |
| Get volumes info check | Check result of the volume information has been got correctly. | aws.ec2.volumes.check | DEPENDENT | 0 |


<a name="macros"></a>

## Macros
| macro | value |
| ------------- |------------- |
| {$AWS.ACCESS.KEY.ID} | no value |
| {$AWS.AUTH_TYPE} | access_key |
| {$AWS.EBS.BURST.CREDIT.BALANCE.MIN.WARN} | 20 |
| {$AWS.EBS.BYTE.CREDIT.BALANCE.MIN.WARN} | 20 |
| {$AWS.EBS.IO.CREDIT.BALANCE.MIN.WARN} | 20 |
| {$AWS.EC2.CPU.CREDIT.BALANCE.MIN.WARN} | 50 |
| {$AWS.EC2.CPU.CREDIT.SURPLUS.BALANCE.MAX.WARN} | 100 |
| {$AWS.EC2.CPU.UTIL.WARN.MAX} | 85 |
| {$AWS.EC2.INSTANCE.ID} | no value |
| {$AWS.EC2.LLD.FILTER.ALARM_NAME.MATCHES} | .* |
| {$AWS.EC2.LLD.FILTER.ALARM_NAME.NOT_MATCHES} | CHANGE_IF_NEEDED |
| {$AWS.EC2.LLD.FILTER.ALARM_SERVICE_NAMESPACE.MATCHES} | .* |
| {$AWS.EC2.LLD.FILTER.ALARM_SERVICE_NAMESPACE.NOT_MATCHES} | CHANGE_IF_NEEDED |
| {$AWS.EC2.LLD.FILTER.VOLUME_TYPE.MATCHES} | .* |
| {$AWS.EC2.LLD.FILTER.VOLUME_TYPE.NOT_MATCHES} | CHANGE_IF_NEEDED |
| {$AWS.PROXY} | no value |
| {$AWS.REGION} | us-west-1 |
| {$AWS.SECRET.ACCESS.KEY} | no value |


<a name="triggers"></a>

## Triggers
| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Failed to get alarms data | WARNING | no description | length(last(/AWS EC2 by HTTP/aws.ec2.alarms.check))>0 | [{"tag": "scope", "value": "availability"}] | no url |
| Instance CPU Credit balance is too low | WARNING | The number of earned CPU credits has been less than {$AWS.EC2.CPU.CREDIT.BALANCE.MIN.WARN} in the last 5 minutes. | max(/AWS EC2 by HTTP/aws.ec2.cpu.credit_balance,5m)<{$AWS.EC2.CPU.CREDIT.BALANCE.MIN.WARN} | [{"tag": "scope", "value": "capacity"}] | no url |
| Instance has spent too many CPU surplus credits | WARNING | The number of spent surplus credits that are not paid down and which thus incur an additional charge is over {$AWS.EC2.CPU.CREDIT.SURPLUS.BALANCE.MAX.WARN}. | last(/AWS EC2 by HTTP/aws.ec2.cpu.surplus_credit_charged)>{$AWS.EC2.CPU.CREDIT.SURPLUS.BALANCE.MAX.WARN} | [{"tag": "scope", "value": "capacity"}] | no url |
| High CPU utilization | WARNING | The CPU utilization is too high. The system might be slow to respond. | min(/AWS EC2 by HTTP/aws.ec2.cpu_utilization,15m)>{$AWS.EC2.CPU.UTIL.WARN.MAX} | [{"tag": "scope", "value": "capacity"}, {"tag": "scope", "value": "performance"}] | no url |
| Byte Credit balance is too low | WARNING | no description | max(/AWS EC2 by HTTP/aws.ec2.ebs.byte_balance,5m)<{$AWS.EBS.BYTE.CREDIT.BALANCE.MIN.WARN} | [{"tag": "scope", "value": "capacity"}] | no url |
| I/O Credit balance is too low | WARNING | no description | max(/AWS EC2 by HTTP/aws.ec2.ebs.io_balance,5m)<{$AWS.EBS.IO.CREDIT.BALANCE.MIN.WARN} | [{"tag": "scope", "value": "capacity"}] | no url |
| Failed to get metrics data | WARNING | no description | length(last(/AWS EC2 by HTTP/aws.ec2.metrics.check))>0 | [{"tag": "scope", "value": "availability"}] | no url |
| Instance status check failed | AVERAGE | These checks detect problems that require your involvement to repair.<br>The following are examples of problems that can cause instance status checks to fail:<br><br>Failed system status checks<br>Incorrect networking or startup configuration<br>Exhausted memory<br>Corrupted file system<br>Incompatible kernel | last(/AWS EC2 by HTTP/aws.ec2.status_check_failed_instance)=1 | [{"tag": "scope", "value": "availability"}] | no url |
| System status check failed | AVERAGE | These checks detect underlying problems with your instance that require AWS involvement to repair.<br>The following are examples of problems that can cause system status checks to fail:<br><br>Loss of network connectivity<br>Loss of system power<br>Software issues on the physical host<br>Hardware issues on the physical host that impact network reachability | last(/AWS EC2 by HTTP/aws.ec2.status_check_failed_system)=1 | [{"tag": "scope", "value": "availability"}] | no url |
| Failed to get volumes info | WARNING | no description | length(last(/AWS EC2 by HTTP/aws.ec2.volumes.check))>0 | [{"tag": "scope", "value": "availability"}] | no url |


<a name="discoveries"></a>

## Discoveries
| name | key | description | type | lifetime | delay |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Instance Alarms discovery | aws.ec2.alarms.discovery | Discovery instance and attached EBS volumes alarms. | DEPENDENT | no lifetime | 0 |
| Instance Volumes discovery | aws.ec2.volumes.discovery | Discovery attached EBS volumes. | DEPENDENT | no lifetime | 0 |


<a name="discovery_instance_alarms_discovery"></a>

## Discovery Instance Alarms discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| [{#ALARM_NAME}]: Get metrics | Get alarm metrics about the state and its reason. | aws.ec2.alarm.get_metrics["{#ALARM_NAME}"] | DEPENDENT |
| [{#ALARM_NAME}]: State | The state value for the alarm. Possible values: 0 (OK), 1 (INSUFFICIENT_DATA), 2 (ALARM).<br>Alarm description:<br>{#ALARM_DESCRIPTION} | aws.ec2.alarm.state["{#ALARM_NAME}"] | DEPENDENT |
| [{#ALARM_NAME}]: State reason | An explanation for the alarm state, in text format.<br>Alarm description:<br>{#ALARM_DESCRIPTION} | aws.ec2.alarm.state_reason["{#ALARM_NAME}"] | DEPENDENT |


### Triggers

| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| [{#ALARM_NAME}] has 'Insufficient data' state | INFO | no description | last(/AWS EC2 by HTTP/aws.ec2.alarm.state["{#ALARM_NAME}"])=1 | [{"tag": "scope", "value": "notice"}] | no url |
| [{#ALARM_NAME}] has 'Alarm' state | AVERAGE | Alarm "{#ALARM_NAME}" has 'Alarm' state. <br>Reason: {ITEM.LASTVALUE2} | last(/AWS EC2 by HTTP/aws.ec2.alarm.state["{#ALARM_NAME}"])=2 and length(last(/AWS EC2 by HTTP/aws.ec2.alarm.state_reason["{#ALARM_NAME}"]))>0 | [{"tag": "scope", "value": "availability"}] | no url |


<a name="discovery_instance_volumes_discovery"></a>

## Discovery Instance Volumes discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| [{#VOLUME_ID}]: Attachment state | The attachment state of the volume. Possible values: 0 (attaching), 1 (attached), 2 (detaching). | aws.ec2.ebs.attachment_status["{#VOLUME_ID}"] | DEPENDENT |
| [{#VOLUME_ID}]: Attachment time | The time stamp when the attachment initiated. | aws.ec2.ebs.attachment_time["{#VOLUME_ID}"] | DEPENDENT |
| [{#VOLUME_ID}]: Create time | The time stamp when volume creation was initiated. | aws.ec2.ebs.create_time["{#VOLUME_ID}"] | DEPENDENT |
| [{#VOLUME_ID}]: Device | The device name specified in the block device mapping (for example, /dev/sda1). | aws.ec2.ebs.device["{#VOLUME_ID}"] | DEPENDENT |
| [{#VOLUME_ID}]: Get volume data | Get data of the "{#VOLUME_ID}" volume. | aws.ec2.ebs.get_volume["{#VOLUME_ID}"] | DEPENDENT |
| [{#VOLUME_ID}]: Status | The state of the volume.<br>Possible values: 0 (creating), 1 (available), 2 (in-use), 3 (deleting), 4 (deleted), 5 (error). | aws.ec2.ebs.status["{#VOLUME_ID}"] | DEPENDENT |
| [{#VOLUME_ID}]: Burst balance | Used with General Purpose SSD (gp2), Throughput Optimized HDD (st1), and Cold HDD (sc1) volumes only.<br>Provides information about the percentage of I/O credits (for gp2) or throughput credits (for st1 and sc1) remaining in the burst bucket. <br>Data is reported to CloudWatch only when the volume is active. If the volume is not attached, no data is reported. | aws.ec2.ebs.volume.burst_balance["{#VOLUME_ID}"] | DEPENDENT |
| [{#VOLUME_ID}]: Consumed Read/Write, ops | Used with Provisioned IOPS SSD volumes only.<br>The total amount of read and write operations (normalized to 256K capacity units) consumed in a specified period of time.<br>I/O operations that are smaller than 256K each count as 1 consumed IOPS. I/O operations that are larger than 256K are counted in 256K capacity units. <br>For example, a 1024K I/O would count as 4 consumed IOPS. | aws.ec2.ebs.volume.consumed_read_write_ops["{#VOLUME_ID}"] | DEPENDENT |
| [{#VOLUME_ID}]: Idle time | This metric is not supported with Multi-Attach enabled volumes.<br>The total number of seconds in a specified period of time when no read or write operations were submitted. | aws.ec2.ebs.volume.idle_time["{#VOLUME_ID}"] | DEPENDENT |
| [{#VOLUME_ID}]: Queue length | The number of read and write operation requests waiting to be completed in a specified period of time. | aws.ec2.ebs.volume.queue_length["{#VOLUME_ID}"] | DEPENDENT |
| [{#VOLUME_ID}]: Read, bytes | Provides information on the read operations in a specified period of time.<br>The average size of each read operation during the period, except on volumes attached to a Nitro-based instance, where the average represents the average over the specified period.<br>For Xen instances, data is reported only when there is read activity on the volume. | aws.ec2.ebs.volume.read_bytes["{#VOLUME_ID}"] | DEPENDENT |
| [{#VOLUME_ID}]: Read, ops | The total number of read operations in a specified period of time. Note: read operations are counted on completion. | aws.ec2.ebs.volume.read_ops["{#VOLUME_ID}"] | DEPENDENT |
| [{#VOLUME_ID}]: Throughput, pct | This metric is not supported with Multi-Attach enabled volumes.<br>Used with Provisioned IOPS SSD volumes only. The percentage of I/O operations per second (IOPS) delivered of the total IOPS provisioned for an Amazon EBS volume.<br>Provisioned IOPS SSD volumes deliver their provisioned performance 99.9 percent of the time.<br>During a write, if there are no other pending I/O requests in a minute, the metric value will be 100 percent.<br>Also, a volume's I/O performance may become degraded temporarily due to an action you have taken (for example, creating a snapshot of a volume during peak usage, running the volume on a non-EBS-optimized instance, or accessing data on the volume for the first time). | aws.ec2.ebs.volume.throughput_percentage["{#VOLUME_ID}"] | DEPENDENT |
| [{#VOLUME_ID}]: Read time, total | This metric is not supported with Multi-Attach enabled volumes.<br>The total number of seconds spent by all read operations that completed in a specified period of time.<br>If multiple requests are submitted at the same time, this total could be greater than the length of the period. <br>For example, for a period of 1 minutes (60 seconds): if 150 operations completed during that period, and each operation took 1 second, the value would be 150 seconds. <br>For Xen instances, data is reported only when there is read activity on the volume. | aws.ec2.ebs.volume.total_read_time["{#VOLUME_ID}"] | DEPENDENT |
| [{#VOLUME_ID}]: Write time, total | This metric is not supported with Multi-Attach enabled volumes.<br>The total number of seconds spent by all write operations that completed in a specified period of time.<br>If multiple requests are submitted at the same time, this total could be greater than the length of the period.<br>For example, for a period of 1 minute (60 seconds): if 150 operations completed during that period, and each operation took 1 second, the value would be 150 seconds. <br>For Xen instances, data is reported only when there is write activity on the volume. | aws.ec2.ebs.volume.total_write_time["{#VOLUME_ID}"] | DEPENDENT |
| [{#VOLUME_ID}]: Write, bytes | Provides information on the write operations in a specified period of time.<br>The average size of each write operation during the period, except on volumes attached to a Nitro-based instance, where the average represents the average over the specified period.<br>For Xen instances, data is reported only when there is write activity on the volume. | aws.ec2.ebs.volume.write_bytes["{#VOLUME_ID}"] | DEPENDENT |
| [{#VOLUME_ID}]: Write, ops | The total number of write operations in a specified period of time. Note: write operations are counted on completion. | aws.ec2.ebs.volume.write_ops["{#VOLUME_ID}"] | DEPENDENT |
| [{#VOLUME_ID}]: Get metrics | Get metrics of EBS volume.<br>Full metrics list related to EBS: https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/using_cloudwatch_ebs.html | aws.ec2.get_ebs_metrics["{#VOLUME_ID}"] | SCRIPT |


### Triggers

| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Volume [{#VOLUME_ID}] has 'error' state | WARNING | no description | last(/AWS EC2 by HTTP/aws.ec2.ebs.status["{#VOLUME_ID}"])=5 | [{"tag": "scope", "value": "availability"}] | no url |
| Burst balance is too low | WARNING | no description | max(/AWS EC2 by HTTP/aws.ec2.ebs.volume.burst_balance["{#VOLUME_ID}"],5m)<{$AWS.EBS.BURST.CREDIT.BALANCE.MIN.WARN} | [{"tag": "scope", "value": "capacity"}] | no url |

