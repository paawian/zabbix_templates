# GCP Cloud SQL PostgreSQL by HTTP template description

Get GCP Cloud SQL PostgreSQL instances monitoring with script item usage to perform HTTP requests to Google Cloud Platform Monitoring API.
This template will be automatically connected to discovered entities with all their required parameters pre-defined.

You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback.


Generated by official Zabbix template tool "Templator"

## Summary
* [items](#items)
* [macros](#macros)
* [triggers](#triggers)
* [discoveries](#discoveries)
  * [Discovery GCP Cloud SQL PostgreSQL: Databases discovery ](#discovery_gcp_cloud_sql_postgresql:_databases_discovery)

<a name="items"></a>

## Items
| name | description | key | type | delay |
| ------------- |------------- |------------- |------------- |------------- |
| Reserved CPU cores | Number of cores reserved for the database. | gcp.cloudsql.pgsql.cpu.reserved_cores | DEPENDENT | 0 |
| CPU usage time | Cumulative CPU usage time in seconds. | gcp.cloudsql.pgsql.cpu.usage_time | DEPENDENT | 0 |
| CPU utilization | Current CPU utilization represented as a percentage of the reserved CPU that is currently in use. | gcp.cloudsql.pgsql.cpu.utilization | DEPENDENT | 0 |
| DB engine state | GCP Cloud SQL PostgreSQL DB Engine State. | gcp.cloudsql.pgsql.db.state | HTTP_AGENT | no delay |
| Disk bytes used | Data utilization in bytes. | gcp.cloudsql.pgsql.disk.bytes_used | DEPENDENT | 0 |
| Disk size | Maximum data disk size in bytes. | gcp.cloudsql.pgsql.disk.quota | DEPENDENT | 0 |
| Disk read I/O | Delta count of data disk read I/O operations. | gcp.cloudsql.pgsql.disk.read_ops_count | DEPENDENT | 0 |
| Disk utilization | The fraction of the disk quota that is currently in use. <br>Shown as percentage. | gcp.cloudsql.pgsql.disk.utilization | DEPENDENT | 0 |
| Disk write I/O | Delta count of data disk write I/O operations. | gcp.cloudsql.pgsql.disk.write_ops_count | DEPENDENT | 0 |
| Instance state | GCP Cloud SQL PostgreSQL Current instance state. | gcp.cloudsql.pgsql.inst.state | HTTP_AGENT | no delay |
| Memory size | Maximum RAM size in bytes. | gcp.cloudsql.pgsql.memory.quota | DEPENDENT | 0 |
| Memory used by DB engine | Total RAM usage in bytes. <br>This metric reports the RAM usage of the database process, including the buffer/cache. | gcp.cloudsql.pgsql.memory.total_usage | DEPENDENT | 0 |
| Memory usage | The RAM usage in bytes. <br>This metric reports the RAM usage of the server, excluding the buffer/cache. | gcp.cloudsql.pgsql.memory.usage | DEPENDENT | 0 |
| Memory utilization | The fraction of the memory quota that is currently in use.<br>Shown as percentage. | gcp.cloudsql.pgsql.memory.utilization | DEPENDENT | 0 |
| Metrics get | PostgreSQL metrics data in raw format. | gcp.cloudsql.pgsql.metrics.get | SCRIPT | {$GCP.TIME.WINDOW} |
| Network: Received bytes | Delta count of bytes received through the network. | gcp.cloudsql.pgsql.network.received_bytes_count | DEPENDENT | 0 |
| Network: Sent bytes | Delta count of bytes sent through the network. | gcp.cloudsql.pgsql.network.sent_bytes_count | DEPENDENT | 0 |
| Connections | The number of the connections to the Cloud SQL PostgreSQL instance.<br>Includes connections to the system databases, which aren't visible by default. | gcp.cloudsql.pgsql.num_backends | DEPENDENT | 0 |
| Oldest prepared transaction age | Age of the oldest prepared transaction yet to be vacuumed in the Cloud SQL PostgreSQL instance, measured in number of transactions that have happened since the oldest transaction.<br>Empty value when there is no such transaction type. | gcp.cloudsql.pgsql.oldest_transaction.prepared | DEPENDENT | 0 |
| Oldest replica transaction age | Age of the oldest replica transaction yet to be vacuumed in the Cloud SQL PostgreSQL instance, measured in number of transactions that have happened since the oldest transaction.<br>Empty value when there is no such transaction type. | gcp.cloudsql.pgsql.oldest_transaction.replica | DEPENDENT | 0 |
| Oldest replication slot transaction age | Age of the oldest replication slot transaction yet to be vacuumed in the Cloud SQL PostgreSQL instance, measured in number of transactions that have happened since the oldest transaction.<br>Empty value when there is no such transaction type. | gcp.cloudsql.pgsql.oldest_transaction.replication_slot | DEPENDENT | 0 |
| Oldest running transaction age | Age of the oldest running transaction yet to be vacuumed in the Cloud SQL PostgreSQL instance, measured in number of transactions that have happened since the oldest transaction.<br>Empty value when there is no such transaction type. | gcp.cloudsql.pgsql.oldest_transaction.running | DEPENDENT | 0 |
| Data written to temporary | Total data size (in bytes) written to temporary files by the queries. | gcp.cloudsql.pgsql.temp_bytes_written_count | DEPENDENT | 0 |
| Temporary files used for writing data | Total number of temporary files used for writing data while performing algorithms such as join and sort. | gcp.cloudsql.pgsql.temp_files_written_count | DEPENDENT | 0 |
| Assigned transactions | Delta count of assigned transaction IDs. | gcp.cloudsql.pgsql.transaction_id_count_assigned | DEPENDENT | 0 |
| Frozen transactions | Delta count of frozen transaction IDs. | gcp.cloudsql.pgsql.transaction_id_count_frozen | DEPENDENT | 0 |
| Transaction ID utilization | Current utilization represented as a percentage of transaction IDs consumed by the Cloud SQL PostgreSQL instance. | gcp.cloudsql.pgsql.transaction_id_utilization | DEPENDENT | 0 |


<a name="macros"></a>

## Macros
| macro | value |
| ------------- |------------- |
| {$CLOUD_SQL.PGSQL.CPU.UTIL.MAX} | 95 |
| {$CLOUD_SQL.PGSQL.DISK.UTIL.CRIT} | 90 |
| {$CLOUD_SQL.PGSQL.DISK.UTIL.WARN} | 80 |
| {$CLOUD_SQL.PGSQL.RAM.UTIL.MAX} | 90 |
| {$GCP.CLOUD_SQL.DB.NAME.MATCHES} | .* |
| {$GCP.CLOUD_SQL.DB.NAME.NOT_MATCHES} | CHANGE_IF_NEEDED |
| {$GCP.DATA.TIMEOUT} | 15s |
| {$GCP.PROXY} | no value |
| {$GCP.TIME.WINDOW} | 5m |


<a name="triggers"></a>

## Triggers
| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| High CPU utilization | AVERAGE | The CPU utilization is too high. The system might be slow to respond. | min(/GCP Cloud SQL PostgreSQL by HTTP/gcp.cloudsql.pgsql.cpu.utilization,5m) >= {$CLOUD_SQL.PGSQL.CPU.UTIL.MAX} | [{"tag": "scope", "value": "performance"}] | no url |
| Database engine is down | AVERAGE | Database engine is down.<br>If an instance experiences unplanned (non-maintenance) downtime, the instance state will still be RUNNING, but the database engine state metric will report 0. | last(/GCP Cloud SQL PostgreSQL by HTTP/gcp.cloudsql.pgsql.db.state)=0 | [{"tag": "scope", "value": "availability"}] | no url |
| Disk space is critically low | AVERAGE | Critical utilization of the disk space. | last(/GCP Cloud SQL PostgreSQL by HTTP/gcp.cloudsql.pgsql.disk.utilization) >= {$CLOUD_SQL.PGSQL.DISK.UTIL.CRIT} | [{"tag": "scope", "value": "capacity"}] | no url |
| Disk space is low | WARNING | High utilization of the storage space. | last(/GCP Cloud SQL PostgreSQL by HTTP/gcp.cloudsql.pgsql.disk.utilization) >= {$CLOUD_SQL.PGSQL.DISK.UTIL.WARN} | [{"tag": "scope", "value": "capacity"}] | no url |
| Failed to get the instance state | AVERAGE | Failed to get the instance state. <br>Check access permissions to GCP API or service account. | last(/GCP Cloud SQL PostgreSQL by HTTP/gcp.cloudsql.pgsql.inst.state) = 10 | [{"tag": "scope", "value": "availability"}] | no url |
| Instance is in failed state | AVERAGE | The instance creation failed, or an operation left the instance in an own bad state. | last(/GCP Cloud SQL PostgreSQL by HTTP/gcp.cloudsql.pgsql.inst.state) = 5 | [{"tag": "scope", "value": "availability"}] | no url |
| Instance is in maintenance | INFO | The instance is down for maintenance. | last(/GCP Cloud SQL PostgreSQL by HTTP/gcp.cloudsql.pgsql.inst.state) = 4 | [{"tag": "scope", "value": "availability"}] | no url |
| Instance is in suspended state | WARNING | The instance is in suspended state. <br>It is not available, for example, due to problems with billing. | last(/GCP Cloud SQL PostgreSQL by HTTP/gcp.cloudsql.pgsql.inst.state) = 1 | [{"tag": "scope", "value": "availability"}] | no url |
| Instance is in unknown state | AVERAGE | The state of the instance is unknown. | last(/GCP Cloud SQL PostgreSQL by HTTP/gcp.cloudsql.pgsql.inst.state) = 6 | [{"tag": "scope", "value": "availability"}] | no url |
| Instance is stopped by the owner | INFO | The instance has been stopped by the owner. <br>It is not currently running, but it's ready to be restarted. | last(/GCP Cloud SQL PostgreSQL by HTTP/gcp.cloudsql.pgsql.inst.state) = 2 | [{"tag": "scope", "value": "availability"}] | no url |
| High memory utilization | HIGH | RAM utilization is too high. The system might be slow to respond. | min(/GCP Cloud SQL PostgreSQL by HTTP/gcp.cloudsql.pgsql.memory.utilization,5m) >= {$CLOUD_SQL.PGSQL.RAM.UTIL.MAX} | [{"tag": "scope", "value": "performance"}] | no url |


<a name="discoveries"></a>

## Discoveries
| name | key | description | type | lifetime | delay |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| GCP Cloud SQL PostgreSQL: Databases discovery | gcp.cloudsql.pgsql.db.discovery | Databases discovery for the particular PostgreSQL instance. | HTTP_AGENT | no lifetime | 1h |


<a name="discovery_gcp_cloud_sql_postgresql:_databases_discovery" />

## Discovery GCP Cloud SQL PostgreSQL: Databases discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| Database [{#PGSQL.DB.NAME}]: Buffer cache blocks read. | Number of buffer cache blocks read by the [{#PGSQL.DB.NAME}] database. | gcp.cloudsql.pgsql.blocks_read_count_buffer_cache[{#PGSQL.DB.NAME}] | DEPENDENT |
| Database [{#PGSQL.DB.NAME}]: Disk blocks read. | Number of disk blocks read by the [{#PGSQL.DB.NAME}] database. | gcp.cloudsql.pgsql.blocks_read_count_disk[{#PGSQL.DB.NAME}] | DEPENDENT |
| Database [{#PGSQL.DB.NAME}]: Metrics raw | PostgreSQL metrics in raw format. | gcp.cloudsql.pgsql.db.metrics.get[{#PGSQL.DB.NAME}] | SCRIPT |
| Database [{#PGSQL.DB.NAME}]: Deadlocks count | Number of deadlocks detected in the [{#PGSQL.DB.NAME}] database. | gcp.cloudsql.pgsql.deadlock_count[{#PGSQL.DB.NAME}] | DEPENDENT |
| Database [{#PGSQL.DB.NAME}]: Committed transactions | Delta count of number of committed transactions to the [{#PGSQL.DB.NAME}] database. | gcp.cloudsql.pgsql.transaction_count_commit[{#PGSQL.DB.NAME}] | DEPENDENT |
| Database [{#PGSQL.DB.NAME}]: Rolled-back transactions | Delta count of number of rolled-back transactions in the [{#PGSQL.DB.NAME}] database. | gcp.cloudsql.pgsql.transaction_count_rollback[{#PGSQL.DB.NAME}] | DEPENDENT |
| Database [{#PGSQL.DB.NAME}]: Tuples fetched | Total number of rows fetched as a result of queries to the [{#PGSQL.DB.NAME}] database. | gcp.cloudsql.pgsql.tuples_fetched_count[{#PGSQL.DB.NAME}] | DEPENDENT |
| Database [{#PGSQL.DB.NAME}]: Deleted rows processed | Number of tuples(rows) processed for delete operations for the database with the name [{#PGSQL.DB.NAME}]. | gcp.cloudsql.pgsql.tuples_processed_count_delete[{#PGSQL.DB.NAME}] | DEPENDENT |
| Database [{#PGSQL.DB.NAME}]: Inserted rows processed. | Number of tuples(rows) processed for insert operations for the database with the name [{#PGSQL.DB.NAME}]. | gcp.cloudsql.pgsql.tuples_processed_count_insert[{#PGSQL.DB.NAME}] | DEPENDENT |
| Database [{#PGSQL.DB.NAME}]: Updated rows processed | Number of tuples(rows) processed for update operations for the database with the name [{#PGSQL.DB.NAME}]. | gcp.cloudsql.pgsql.tuples_processed_count_update[{#PGSQL.DB.NAME}] | DEPENDENT |
| Database [{#PGSQL.DB.NAME}]: Tuples returned | Total number of rows scanned while processing the queries of the [{#PGSQL.DB.NAME}] database. | gcp.cloudsql.pgsql.tuples_returned_count[{#PGSQL.DB.NAME}] | DEPENDENT |
| Database [{#PGSQL.DB.NAME}]: Dead tuples | Number of live tuples(rows) in the [{#PGSQL.DB.NAME}] database. | gcp.cloudsql.pgsql.tuple_size_dead[{#PGSQL.DB.NAME}] | DEPENDENT |
| Database [{#PGSQL.DB.NAME}]: Live tuples | Number of live tuples(rows) in the [{#PGSQL.DB.NAME}] database. | gcp.cloudsql.pgsql.tuple_size_live[{#PGSQL.DB.NAME}] | DEPENDENT |

