# AWS ELB Network Load Balancer by HTTP template description

The template is designed to monitor AWS ELB Network Load Balancer by HTTP via Zabbix, and it works without any external scripts.
Don't forget to read the README.md for the correct setup of the template.

You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback

Generated by official Zabbix template tool "Templator"

## Summary
* [items](#items)
* [macros](#macros)
* [triggers](#triggers)
* [discoveries](#discoveries)
  * [Discovery Load Balancer alarm discovery ](#discovery_load_balancer_alarm_discovery)
  * [Discovery Target groups discovery ](#discovery_target_groups_discovery)

<a name="items"></a>

## Items
| name | description | key | type | delay |
| ------------- |------------- |------------- |------------- |------------- |
| Active Flow Count | The total number of concurrent flows (or connections) from clients to targets.<br>This metric includes connections in the `SYN_SENT` and `ESTABLISHED` states.<br>TCP connections are not terminated at the load balancer, so a client opening a TCP connection to a target counts as a single flow. | aws.elb.nlb.active_flow_count | DEPENDENT | 0 |
| Active Flow Count TCP | The total number of concurrent TCP flows (or connections) from clients to targets.<br>This metric includes connections in the `SYN_SENT` and `ESTABLISHED` states.<br>TCP connections are not terminated at the load balancer, so a client opening a TCP connection to a target counts as a single flow. | aws.elb.nlb.active_flow_count_tcp | DEPENDENT | 0 |
| Active Flow Count TLS | The total number of concurrent TLS flows (or connections) from clients to targets.<br>This metric includes connections in the `SYN_SENT` and `ESTABLISHED` states. | aws.elb.nlb.active_flow_count_tls | DEPENDENT | 0 |
| Active Flow Count UDP | The total number of concurrent UDP flows (or connections) from clients to targets. | aws.elb.nlb.active_flow_count_udp | DEPENDENT | 0 |
| Get alarms check | Check that the alarm data has been received correctly. | aws.elb.nlb.alarms.check | DEPENDENT | 0 |
| Consumed LCUs | The number of load balancer capacity units (LCU) used by your load balancer.<br>You pay for the number of LCUs that you use per hour.<br>More information on Elastic Load Balancing pricing here: https://aws.amazon.com/elasticloadbalancing/pricing/ | aws.elb.nlb.capacity_units | DEPENDENT | 0 |
| Consumed LCUs TCP | The number of load balancer capacity units (LCU) used by your load balancer for TCP.<br>You pay for the number of LCUs that you use per hour.<br>More information on Elastic Load Balancing pricing here: https://aws.amazon.com/elasticloadbalancing/pricing/ | aws.elb.nlb.capacity_units_tcp | DEPENDENT | 0 |
| Consumed LCUs TLS | The number of load balancer capacity units (LCU) used by your load balancer for TLS.<br>You pay for the number of LCUs that you use per hour.<br>More information on Elastic Load Balancing pricing here: https://aws.amazon.com/elasticloadbalancing/pricing/ | aws.elb.nlb.capacity_units_tls | DEPENDENT | 0 |
| Consumed LCUs UDP | The number of load balancer capacity units (LCU) used by your load balancer for UDP.<br>You pay for the number of LCUs that you use per hour.<br>More information on Elastic Load Balancing pricing here: https://aws.amazon.com/elasticloadbalancing/pricing/ | aws.elb.nlb.capacity_units_udp | DEPENDENT | 0 |
| Client TLS Negotiation Error Count | The total number of TLS handshakes that failed during negotiation between a client and a TLS listener. | aws.elb.nlb.client_tls_negotiation_error_count | DEPENDENT | 0 |
| Get ELB NLB alarms data | `DescribeAlarms` API method: https://docs.aws.amazon.com/AmazonCloudWatch/latest/APIReference/API_DescribeAlarms.html | aws.elb.nlb.get_alarms | SCRIPT | 0s;m/1 |
| Get metrics data | Get ELB Network Load Balancer metrics.<br>Full metrics list related to Network Load Balancer: https://docs.aws.amazon.com/elasticloadbalancing/latest/network/load-balancer-cloudwatch-metrics.html | aws.elb.nlb.get_metrics | SCRIPT | 0s;m/1 |
| Get target groups | Get ELB target group.<br>`DescribeTargetGroups` API method: https://docs.aws.amazon.com/elasticloadbalancing/latest/APIReference/API_DescribeTargetGroups.html | aws.elb.nlb.get_target_groups | SCRIPT | 0s;m/30 |
| Get metrics check | Check that the Network Load Balancer metrics data has been received correctly. | aws.elb.nlb.metrics.check | DEPENDENT | 0 |
| New Flow Count | The total number of new flows (or connections) established from clients to targets in the specified time period. | aws.elb.nlb.new_flow_count | DEPENDENT | 0 |
| New Flow Count TCP | The total number of new TCP flows (or connections) established from clients to targets in the specified time period. | aws.elb.nlb.new_flow_count_tcp | DEPENDENT | 0 |
| New Flow Count TLS | The total number of new TLS flows (or connections) established from clients to targets in the specified time period. | aws.elb.nlb.new_flow_count_tls | DEPENDENT | 0 |
| New Flow Count UDP | The total number of new UDP flows (or connections) established from clients to targets in the specified time period. | aws.elb.nlb.new_flow_count_udp | DEPENDENT | 0 |
| Peak Packets per second | Highest average packet rate (packets processed per second), calculated every 10 seconds during the sampling window.<br>This metric includes health check traffic. | aws.elb.nlb.peak_packets.rate | DEPENDENT | 0 |
| Port Allocation Error Count | The total number of ephemeral port allocation errors during a client IP translation operation. A non-zero value indicates dropped client connections.<br>Note: Network Load Balancers support 55,000 simultaneous connections or about 55,000 connections per minute to each unique target (IP address and port) when performing client address translation.<br>To fix port allocation errors, add more targets to the target group. | aws.elb.nlb.port_allocation_error_count | DEPENDENT | 0 |
| Processed Bytes | The total number of bytes processed by the load balancer, including TCP/IP headers. This count includes traffic to and from targets, minus health check traffic. | aws.elb.nlb.processed_bytes | DEPENDENT | 0 |
| Processed Bytes TCP | The total number of bytes processed by TCP listeners. | aws.elb.nlb.processed_bytes_tcp | DEPENDENT | 0 |
| Processed Bytes TLS | The total number of bytes processed by TLS listeners. | aws.elb.nlb.processed_bytes_tls | DEPENDENT | 0 |
| Processed Bytes UDP | The total number of bytes processed by UDP listeners. | aws.elb.nlb.processed_bytes_udp | DEPENDENT | 0 |
| Processed Packets | The total number of packets processed by the load balancer. This count includes traffic to and from targets, including health check traffic. | aws.elb.nlb.processed_packets | DEPENDENT | 0 |
| Security Group Blocked Flow Count Inbound ICMP | The number of new ICMP messages rejected by the inbound rules of the load balancer security groups. | aws.elb.nlb.sg_blocked_inbound_icmp | DEPENDENT | 0 |
| Security Group Blocked Flow Count Inbound TCP | The number of new TCP flows rejected by the inbound rules of the load balancer security groups. | aws.elb.nlb.sg_blocked_inbound_tcp | DEPENDENT | 0 |
| Security Group Blocked Flow Count Inbound UDP | The number of new UDP flows rejected by the inbound rules of the load balancer security groups. | aws.elb.nlb.sg_blocked_inbound_udp | DEPENDENT | 0 |
| Security Group Blocked Flow Count Outbound ICMP | The number of new ICMP messages rejected by the outbound rules of the load balancer security groups. | aws.elb.nlb.sg_blocked_outbound_icmp | DEPENDENT | 0 |
| Security Group Blocked Flow Count Outbound TCP | The number of new TCP flows rejected by the outbound rules of the load balancer security groups. | aws.elb.nlb.sg_blocked_outbound_tcp | DEPENDENT | 0 |
| Security Group Blocked Flow Count Outbound UDP | The number of new UDP flows rejected by the outbound rules of the load balancer security groups. | aws.elb.nlb.sg_blocked_outbound_udp | DEPENDENT | 0 |
| Target TLS Negotiation Error Count | The total number of TLS handshakes that failed during negotiation between a TLS listener and a target. | aws.elb.nlb.target_tls_negotiation_error_count | DEPENDENT | 0 |
| TCP Client Reset Count | The total number of reset (RST) packets sent from a client to a target.<br>These resets are generated by the client and forwarded by the load balancer. | aws.elb.nlb.tcp_client_reset_count | DEPENDENT | 0 |
| TCP ELB Reset Count | The total number of reset (RST) packets generated by the load balancer.<br>For more information, see: https://docs.aws.amazon.com/elasticloadbalancing/latest/network/load-balancer-troubleshooting.html#elb-reset-count-metric | aws.elb.nlb.tcp_elb_reset_count | DEPENDENT | 0 |
| TCP Target Reset Count | The total number of reset (RST) packets sent from a target to a client.<br>These resets are generated by the target and forwarded by the load balancer. | aws.elb.nlb.tcp_target_reset_count | DEPENDENT | 0 |
| Unhealthy Routing Flow Count | The number of flows (or connections) that are routed using the routing failover action (fail open). | aws.elb.nlb.unhealthy_routing_flow_count | DEPENDENT | 0 |


<a name="macros"></a>

## Macros
| macro | value |
| ------------- |------------- |
| {$AWS.ACCESS.KEY.ID} | no value |
| {$AWS.AUTH_TYPE} | access_key |
| {$AWS.DATA.TIMEOUT} | 60s |
| {$AWS.ELB.ARN} | no value |
| {$AWS.ELB.LLD.FILTER.ALARM_NAME.MATCHES} | .* |
| {$AWS.ELB.LLD.FILTER.ALARM_NAME.NOT_MATCHES} | CHANGE_IF_NEEDED |
| {$AWS.ELB.LLD.FILTER.ALARM_SERVICE_NAMESPACE.MATCHES} | .* |
| {$AWS.ELB.LLD.FILTER.ALARM_SERVICE_NAMESPACE.NOT_MATCHES} | CHANGE_IF_NEEDED |
| {$AWS.ELB.LLD.FILTER.TARGET.GROUP.MATCHES} | .* |
| {$AWS.ELB.LLD.FILTER.TARGET.GROUP.NOT_MATCHES} | CHANGE_IF_NEEDED |
| {$AWS.ELB.UNHEALTHY.HOST.MAX} | 0 |
| {$AWS.PROXY} | no value |
| {$AWS.REGION} | us-west-1 |
| {$AWS.SECRET.ACCESS.KEY} | no value |


<a name="triggers"></a>

## Triggers
| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Failed to get alarms data | WARNING | Failed to get CloudWatch alarms for Network Load Balancer. | length(last(/AWS ELB Network Load Balancer by HTTP/aws.elb.nlb.alarms.check))>0 | [{"tag": "scope", "value": "availability"}] | no url |
| Failed to get metrics data | WARNING | Failed to get CloudWatch metrics for Network Load Balancer. | length(last(/AWS ELB Network Load Balancer by HTTP/aws.elb.nlb.metrics.check))>0 | [{"tag": "scope", "value": "availability"}] | no url |


<a name="discoveries"></a>

## Discoveries
| name | key | description | type | lifetime | delay |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Load Balancer alarm discovery | aws.elb.nlb.alarms.discovery | Used for the discovery of alarm balancers. | DEPENDENT | no lifetime | 0 |
| Target groups discovery | aws.elb.nlb.target_groups.discovery | Used for the discovery of `{$AWS.ELB.TARGET.GROUP.NAME}` target groups. | DEPENDENT | no lifetime | 0 |


<a name="discovery_load_balancer_alarm_discovery" />

## Discovery Load Balancer alarm discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| [{#ALARM_NAME}]: Get metrics | Get metrics about the alarm state and its reason. | aws.elb.nlb.alarm.get_metrics["{#ALARM_NAME}"] | DEPENDENT |
| [{#ALARM_NAME}]: State | The value of the alarm state. Possible values:<br>0 - OK;<br>1 - INSUFFICIENT_DATA;<br>2 - ALARM.<br>Alarm description:<br>`{#ALARM_DESCRIPTION}` | aws.elb.nlb.alarm.state["{#ALARM_NAME}"] | DEPENDENT |
| [{#ALARM_NAME}]: State reason | An explanation for the alarm state reason in text format.<br>Alarm description:<br>`{#ALARM_DESCRIPTION}` | aws.elb.nlb.alarm.state_reason["{#ALARM_NAME}"] | DEPENDENT |


### Triggers

| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| [{#ALARM_NAME}] has 'Insufficient data' state | INFO | Either the alarm has just started, the metric is not available, or not enough data is available for the metric to determine the alarm state. | last(/AWS ELB Network Load Balancer by HTTP/aws.elb.nlb.alarm.state["{#ALARM_NAME}"])=1 | [{"tag": "scope", "value": "notice"}] | no url |
| [{#ALARM_NAME}] has 'Alarm' state | AVERAGE | The alarm `{#ALARM_NAME}` is in the ALARM state.<br>Reason: `{ITEM.LASTVALUE2}` | last(/AWS ELB Network Load Balancer by HTTP/aws.elb.nlb.alarm.state["{#ALARM_NAME}"])=2 and length(last(/AWS ELB Network Load Balancer by HTTP/aws.elb.nlb.alarm.state_reason["{#ALARM_NAME}"]))>0 | [{"tag": "scope", "value": "availability"}] | no url |


<a name="discovery_target_groups_discovery" />

## Discovery Target groups discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| [{#AWS.ELB.TARGET.GROUP.NAME}]: Get metrics | Get the metrics of the ELB target group `{#AWS.ELB.TARGET.GROUP.NAME}`.<br>Full list of metrics related to AWS ELB here: https://docs.aws.amazon.com/elasticloadbalancing/latest/network/load-balancer-cloudwatch-metrics.html#user-authentication-metric-table | aws.elb.nlb.target_groups.get_metrics["{#AWS.ELB.TARGET.GROUP.NAME}"] | SCRIPT |
| [{#AWS.ELB.TARGET.GROUP.NAME}]: Healthy Host Count | The number of targets that are considered healthy. | aws.elb.nlb.target_groups.healthy_host_count["{#AWS.ELB.TARGET.GROUP.NAME}"] | DEPENDENT |
| [{#AWS.ELB.TARGET.GROUP.NAME}]: Unhealthy Host Count | The number of targets that are considered unhealthy. | aws.elb.nlb.target_groups.unhealthy_host_count["{#AWS.ELB.TARGET.GROUP.NAME}"] | DEPENDENT |


### Triggers

| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| [{#AWS.ELB.TARGET.GROUP.NAME}]: Target have become unhealthy | AVERAGE | This trigger helps in identifying when your targets have become unhealthy. | last(/AWS ELB Network Load Balancer by HTTP/aws.elb.nlb.target_groups.healthy_host_count["{#AWS.ELB.TARGET.GROUP.NAME}"]) = 0 | [{"tag": "scope", "value": "availability"}] | no url |
| [{#AWS.ELB.TARGET.GROUP.NAME}]: Target have unhealthy host | WARNING | This trigger allows you to become aware when there are no more registered targets. | last(/AWS ELB Network Load Balancer by HTTP/aws.elb.nlb.target_groups.unhealthy_host_count["{#AWS.ELB.TARGET.GROUP.NAME}"]) > {$AWS.ELB.UNHEALTHY.HOST.MAX} | [{"tag": "scope", "value": "availability"}] | no url |

