# AWS S3 bucket by HTTP template description

The template gets AWS S3 bucket metrics and uses the script item to make HTTP requests to the CloudWatch API.
Don't forget to read the README.md for the correct setup of the template.

You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback

Generated by official Zabbix template tool "Templator"

## Summary
* [items](#items)
* [macros](#macros)
* [triggers](#triggers)
* [discoveries](#discoveries)
  * [Discovery Bucket Alarms discovery ](#discovery_bucket_alarms_discovery)
  * [Discovery Request Metrics discovery ](#discovery_request_metrics_discovery)

<a name="items"></a>

## Items
| name | description | key | type | delay |
| ------------- |------------- |------------- |------------- |------------- |
| Get alarms check | Data collection check. | aws.s3.alarms.check | DEPENDENT | 0 |
| Bucket Size | This is a daily metric for the bucket.<br>The amount of data in bytes stored in a bucket in the STANDARD storage class, INTELLIGENT_TIERING storage class, Standard-Infrequent Access (STANDARD_IA) storage class, OneZone-Infrequent Access (ONEZONE_IA), Reduced Redundancy Storage (RRS) class, S3 Glacier Instant Retrieval storage class, Deep Archive Storage (S3 Glacier Deep Archive) class, or S3 Glacier Flexible Retrieval (GLACIER) storage class.<br>This value is calculated by summing the size of all objects and metadata in the bucket (both current and noncurrent objects), including the size of all parts for all incomplete multipart uploads to the bucket. | aws.s3.bucket_size_bytes | DEPENDENT | 0 |
| Get alarms data | Get alarms data.<br>DescribeAlarms API method: https://docs.aws.amazon.com/AmazonCloudWatch/latest/APIReference/API_DescribeAlarms.html | aws.s3.get_alarms | SCRIPT | 0s;m/1 |
| Get metrics data | Get bucket metrics.<br>Full metrics list related to S3: https://docs.aws.amazon.com/AmazonS3/latest/userguide/metrics-dimensions.html | aws.s3.get_metrics | SCRIPT | 0s;h/8 |
| Get metrics check | Data collection check. | aws.s3.metrics.check | DEPENDENT | 0 |
| Number of objects | This is a daily metric for the bucket.<br>The total number of objects stored in a bucket for all storage classes.<br>This value is calculated by counting all objects in the bucket (both current and noncurrent objects) and the total number of parts for all incomplete multipart uploads to the bucket. | aws.s3.number_of_objects | DEPENDENT | 0 |


<a name="macros"></a>

## Macros
| macro | value |
| ------------- |------------- |
| {$AWS.ACCESS.KEY.ID} | no value |
| {$AWS.AUTH_TYPE} | access_key |
| {$AWS.PROXY} | no value |
| {$AWS.S3.BUCKET.NAME} | no value |
| {$AWS.S3.LLD.FILTER.ALARM_NAME.MATCHES} | .* |
| {$AWS.S3.LLD.FILTER.ALARM_NAME.NOT_MATCHES} | CHANGE_IF_NEEDED |
| {$AWS.S3.LLD.FILTER.ID.NAME.MATCHES} | .* |
| {$AWS.S3.LLD.FILTER.ID.NAME.NOT_MATCHES} | CHANGE_IF_NEEDED |
| {$AWS.S3.UPDATE.INTERVAL} | 1800 |
| {$AWS.SECRET.ACCESS.KEY} | no value |


<a name="triggers"></a>

## Triggers
| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Failed to get alarms data | WARNING | no description | length(last(/AWS S3 bucket by HTTP/aws.s3.alarms.check))>0 | [{"tag": "scope", "value": "availability"}] | no url |
| Failed to get metrics data | WARNING | no description | length(last(/AWS S3 bucket by HTTP/aws.s3.metrics.check))>0 | [{"tag": "scope", "value": "availability"}] | no url |


<a name="discoveries"></a>

## Discoveries
| name | key | description | type | lifetime | delay |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Bucket Alarms discovery | aws.s3.alarms.discovery | Discovery of bucket alarms. | DEPENDENT | no lifetime | 0 |
| Request Metrics discovery | aws.s3.configuration.discovery | Discovery of request metrics. | DEPENDENT | no lifetime | 0 |


<a name="discovery_bucket_alarms_discovery" />

## Discovery Bucket Alarms discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| [{#ALARM_NAME}]: State | The state value for the alarm. Possible values: 0 (OK), 1 (INSUFFICIENT_DATA), 2 (ALARM).<br>Alarm description:<br>{#ALARM_DESCRIPTION} | aws.s3.alarm.state["{#ALARM_NAME}"] | DEPENDENT |
| [{#ALARM_NAME}]: State reason | An explanation for the alarm state, in text format.<br>Alarm description:<br>{#ALARM_DESCRIPTION} | aws.s3.alarm.state_reason["{#ALARM_NAME}"] | DEPENDENT |


### Triggers

| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| [{#ALARM_NAME}] has 'Insufficient data' state | INFO | no description | last(/AWS S3 bucket by HTTP/aws.s3.alarm.state["{#ALARM_NAME}"])=1 | [{"tag": "scope", "value": "notice"}] | no url |
| [{#ALARM_NAME}] has 'Alarm' state | AVERAGE | Alarm "{#ALARM_NAME}" has 'Alarm' state. <br>Reason: {ITEM.LASTVALUE2} | last(/AWS S3 bucket by HTTP/aws.s3.alarm.state["{#ALARM_NAME}"])=2 and length(last(/AWS S3 bucket by HTTP/aws.s3.alarm.state_reason["{#ALARM_NAME}"]))>0 | [{"tag": "scope", "value": "availability"}] | no url |


<a name="discovery_request_metrics_discovery" />

## Discovery Request Metrics discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| Filter [{#AWS.S3.FILTER.ID.NAME}]: Requests: Errors, 4xx | The number of HTTP 4xx client error status code requests made to an Amazon S3 bucket with a value of either 0 or 1.<br>The average statistic shows the error rate, and the sum statistic shows the count of that type of error, during each period.<br>Statistic: Average (reports per request). | aws.s3.4xx_errors["{#AWS.S3.FILTER.ID.NAME}"] | DEPENDENT |
| Filter [{#AWS.S3.FILTER.ID.NAME}]: Requests: Errors, 5xx | The number of HTTP 5xx server error status code requests made to an Amazon S3 bucket with a value of either 0 or 1.<br>The average statistic shows the error rate, and the sum statistic shows the count of that type of error, during each period.<br>Statistic: Average (reports per request). | aws.s3.5xx_errors["{#AWS.S3.FILTER.ID.NAME}"] | DEPENDENT |
| Filter [{#AWS.S3.FILTER.ID.NAME}]: Requests: All | The total number of HTTP requests made to an Amazon S3 bucket, regardless of type.<br>If you're using a metrics configuration with a filter, then this metric only returns the HTTP requests that meet the filter's requirements. | aws.s3.all_requests["{#AWS.S3.FILTER.ID.NAME}"] | DEPENDENT |
| Filter [{#AWS.S3.FILTER.ID.NAME}]: Requests: Bytes downloaded | The number of bytes downloaded for requests made to an Amazon S3 bucket, where the response includes a body.<br>Statistic: Average (bytes per request). | aws.s3.bytes_downloaded["{#AWS.S3.FILTER.ID.NAME}"] | DEPENDENT |
| Filter [{#AWS.S3.FILTER.ID.NAME}]: Replication: Bytes pending | The total number of bytes of objects pending replication for a given replication rule. | aws.s3.bytes_pending_replication["{#AWS.S3.FILTER.ID.NAME}"] | DEPENDENT |
| Filter [{#AWS.S3.FILTER.ID.NAME}]: Requests: Bytes uploaded | The number of bytes uploaded that contain a request body, made to an Amazon S3 bucket.<br>Statistic: Average (bytes per request). | aws.s3.bytes_uploaded["{#AWS.S3.FILTER.ID.NAME}"] | DEPENDENT |
| Filter [{#AWS.S3.FILTER.ID.NAME}]: Requests: Delete | The number of HTTP DELETE requests made for objects in an Amazon S3 bucket.<br>This also includes Delete Multiple Objects requests. This metric shows the number of requests, not the number of objects deleted. | aws.s3.delete_requests["{#AWS.S3.FILTER.ID.NAME}"] | DEPENDENT |
| Filter [{#AWS.S3.FILTER.ID.NAME}]: First byte latency, avg | The per-request time from the complete request being received by an Amazon S3 bucket to when the response starts to be returned.<br>Statistic: Average. | aws.s3.first_byte_latency.avg["{#AWS.S3.FILTER.ID.NAME}"] | DEPENDENT |
| Filter [{#AWS.S3.FILTER.ID.NAME}]: First byte latency, p90 | The per-request time from the complete request being received by an Amazon S3 bucket to when the response starts to be returned.<br>Statistic: 90th percentile. | aws.s3.first_byte_latency.p90["{#AWS.S3.FILTER.ID.NAME}"] | DEPENDENT |
| Filter [{#AWS.S3.FILTER.ID.NAME}]: Get request metrics | Get bucket request metrics filter: '{#AWS.S3.FILTER.ID.NAME}'.<br>Full metrics list related to S3: https://docs.aws.amazon.com/AmazonS3/latest/userguide/metrics-dimensions.html | aws.s3.get_metrics["{#AWS.S3.FILTER.ID.NAME}"] | SCRIPT |
| Filter [{#AWS.S3.FILTER.ID.NAME}]: Requests: Get | The number of HTTP GET requests made for objects in an Amazon S3 bucket. This doesn't include list operations.<br>Paginated list-oriented requests, like List Multipart Uploads, List Parts, Get Bucket Object versions, and others, are not included in this metric. | aws.s3.get_requests["{#AWS.S3.FILTER.ID.NAME}"] | DEPENDENT |
| Filter [{#AWS.S3.FILTER.ID.NAME}]: Requests: Head | The number of HTTP HEAD requests made to an Amazon S3 bucket. | aws.s3.head_requests["{#AWS.S3.FILTER.ID.NAME}"] | DEPENDENT |
| Filter [{#AWS.S3.FILTER.ID.NAME}]: Requests: List | The number of HTTP requests that list the contents of a bucket. | aws.s3.list_requests["{#AWS.S3.FILTER.ID.NAME}"] | DEPENDENT |
| Filter [{#AWS.S3.FILTER.ID.NAME}]: Replication: Operations pending | The number of operations pending replication for a given replication rule. | aws.s3.operations_pending_replication["{#AWS.S3.FILTER.ID.NAME}"] | DEPENDENT |
| Filter [{#AWS.S3.FILTER.ID.NAME}]: Requests: Post | The number of HTTP POST requests made to an Amazon S3 bucket.<br>Delete Multiple Objects and SELECT Object Content requests are not included in this metric. | aws.s3.post_requests["{#AWS.S3.FILTER.ID.NAME}"] | DEPENDENT |
| Filter [{#AWS.S3.FILTER.ID.NAME}]: Requests: Put | The number of HTTP PUT requests made for objects in an Amazon S3 bucket. | aws.s3.put_requests["{#AWS.S3.FILTER.ID.NAME}"] | DEPENDENT |
| Filter [{#AWS.S3.FILTER.ID.NAME}]: Replication: Latency | The maximum number of seconds by which the replication destination region is behind the source Region for a given replication rule. | aws.s3.replication_latency["{#AWS.S3.FILTER.ID.NAME}"] | DEPENDENT |
| Filter [{#AWS.S3.FILTER.ID.NAME}]: Requests: Select, bytes returned | The number of bytes of data returned with Amazon S3 SELECT Object Content requests in an Amazon S3 bucket.<br>Statistic: Average (bytes per request). | aws.s3.select_bytes_returned["{#AWS.S3.FILTER.ID.NAME}"] | DEPENDENT |
| Filter [{#AWS.S3.FILTER.ID.NAME}]: Requests: Select, bytes scanned | The number of bytes of data scanned with Amazon S3 SELECT Object Content requests in an Amazon S3 bucket.<br>Statistic: Average (bytes per request). | aws.s3.select_bytes_scanned["{#AWS.S3.FILTER.ID.NAME}"] | DEPENDENT |
| Filter [{#AWS.S3.FILTER.ID.NAME}]: Requests: Select | The number of Amazon S3 SELECT Object Content requests made for objects in an Amazon S3 bucket. | aws.s3.select_requests["{#AWS.S3.FILTER.ID.NAME}"] | DEPENDENT |
| Filter [{#AWS.S3.FILTER.ID.NAME}]: Total request latency, avg | The elapsed per-request time from the first byte received to the last byte sent to an Amazon S3 bucket.<br>This includes the time taken to receive the request body and send the response body, which is not included in FirstByteLatency.<br>Statistic: Average. | aws.s3.total_request_latency.avg["{#AWS.S3.FILTER.ID.NAME}"] | DEPENDENT |
| Filter [{#AWS.S3.FILTER.ID.NAME}]: Total request latency, p90 | The elapsed per-request time from the first byte received to the last byte sent to an Amazon S3 bucket.<br>This includes the time taken to receive the request body and send the response body, which is not included in FirstByteLatency.<br>Statistic: 90th percentile. | aws.s3.total_request_latency.p90["{#AWS.S3.FILTER.ID.NAME}"] | DEPENDENT |

