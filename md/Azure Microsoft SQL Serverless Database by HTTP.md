# Azure Microsoft SQL Serverless Database by HTTP template description

This template is designed to monitor Microsoft SQL serverless databases by HTTP.
It works without any external scripts and uses the script item.

Setup:
  1. Create an Azure service principal via the Azure command-line interface (Azure CLI) for your subscription.
    `az ad sp create-for-rbac --name zabbix --role reader --scope /subscriptions/<subscription_id>`
    See https://docs.microsoft.com/en-us/cli/azure/create-an-azure-service-principal-azure-cli for more details.
  2. Link the template to a host.
  3. Configure the macros: {$AZURE.APP.ID}, {$AZURE.PASSWORD}, {$AZURE.TENANT.ID}, {$AZURE.SUBSCRIPTION.ID}, and {$AZURE.RESOURCE.ID}.

You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback/

Generated by official Zabbix template tool "Templator"

## Summary
* [items](#items)
* [macros](#macros)
* [triggers](#triggers)

<a name="items" />

## Items
| name | description | key | type | delay |
| ------------- |------------- |------------- |------------- |------------- |
| App CPU billed | App CPU billed. Applies to serverless databases. | azure.db.mssql.app.cpu.billed | DEPENDENT | 0 |
| App CPU percentage | App CPU percentage. Applies to serverless databases. | azure.db.mssql.app.cpu.percent | DEPENDENT | 0 |
| App memory percentage | App memory percentage. Applies to serverless databases. | azure.db.mssql.app.memory.percent | DEPENDENT | 0 |
| Availability status detailed | The summary description of the availability status. | azure.db.mssql.availability.details | DEPENDENT | 0 |
| Availability state | The availability status of the resource. | azure.db.mssql.availability.state | DEPENDENT | 0 |
| Connections failed: System errors | The count of failed connections with system errors. | azure.db.mssql.connections.failed.system | DEPENDENT | 0 |
| Connections successful | The count of successful connections. | azure.db.mssql.connections.successful | DEPENDENT | 0 |
| CPU limit | The CPU limit. Applies to the vCore-based databases. | azure.db.mssql.cpu.limit | DEPENDENT | 0 |
| Percentage CPU | The CPU percent of a host. | azure.db.mssql.cpu.percentage | DEPENDENT | 0 |
| CPU used | The CPU used. Applies to the vCore-based databases. | azure.db.mssql.cpu.used | DEPENDENT | 0 |
| Get errors | A list of errors from API requests. | azure.db.mssql.data.errors | DEPENDENT | 0 |
| Get data | The result of API requests is expressed in the JSON. | azure.db.mssql.data.get | SCRIPT | no delay |
| Data IO percentage | The physical data read percentage. | azure.db.mssql.data.read.percentage | DEPENDENT | 0 |
| Deadlocks | The count of deadlocks. Not applicable to the data warehouses. | azure.db.mssql.deadlocks | DEPENDENT | 0 |
| Connections blocked by firewall | The count of connections blocked by firewall. | azure.db.mssql.firewall.blocked | DEPENDENT | 0 |
| Log IO percentage | The percentage of I/O log. Not applicable to the data warehouses. | azure.db.mssql.log.write.percentage | DEPENDENT | 0 |
| SQL Server process core percent | The CPU usage as a percentage of the SQL DB process. Not applicable to the data warehouses. | azure.db.mssql.server.cpu.percent | DEPENDENT | 0 |
| SQL Server process memory percent | Memory usage as a percentage of the SQL DB process. Not applicable to the data warehouses. | azure.db.mssql.server.memory.percent | DEPENDENT | 0 |
| Sessions percentage | The percentage of sessions. Not applicable to the data warehouses. | azure.db.mssql.sessions.percent | DEPENDENT | 0 |
| Data space allocated | The allocated data storage. Not applicable to the data warehouses. | azure.db.mssql.storage.allocated | DEPENDENT | 0 |
| Data space used percent | The percentage of used data space. Not applicable to the data warehouses or Hyperscale databases. | azure.db.mssql.storage.percent | DEPENDENT | 0 |
| Data space used | Data space used. Not applicable to the data warehouses. | azure.db.mssql.storage.used | DEPENDENT | 0 |
| In-Memory OLTP storage percent | In-Memory OLTP storage percent. Not applicable to the data warehouses. | azure.db.mssql.storage.xtp.percent | DEPENDENT | 0 |
| Tempdb data file size | Space used in `tempdb` data files, expressed in bytes. Not applicable to the data warehouses. | azure.db.mssql.tempdb.data.size | DEPENDENT | 0 |
| Tempdb log used percent | The percentage of space used in `tempdb` transaction log files. Not applicable to the data warehouses. | azure.db.mssql.tempdb.log.percent | DEPENDENT | 0 |
| Tempdb log file size | Space used in `tempdb` transaction log files, expressed in bytes. Not applicable to the data warehouses. | azure.db.mssql.tempdb.log.size | DEPENDENT | 0 |
| Workers percentage | The percentage of workers. Not applicable to the data warehouses. | azure.db.mssql.workers.percent | DEPENDENT | 0 |


<a name="macros" />

## Macros
| macro | value |
| ------------- |------------- |
| {$AZURE.APP.ID} | no value |
| {$AZURE.DATA.TIMEOUT} | 15s |
| {$AZURE.DB.CPU.UTIL.CRIT} | 90 |
| {$AZURE.DB.MEMORY.UTIL.CRIT} | 90 |
| {$AZURE.DB.STORAGE.PUSED.CRIT} | 90 |
| {$AZURE.DB.STORAGE.PUSED.WARN} | 80 |
| {$AZURE.PASSWORD} | no value |
| {$AZURE.PROXY} | no value |
| {$AZURE.RESOURCE.ID} | no value |
| {$AZURE.SUBSCRIPTION.ID} | no value |
| {$AZURE.TENANT.ID} | no value |


<a name="triggers" />

## Triggers
| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Microsoft SQL database is degraded | AVERAGE | The resource is in degraded state. | last(/Azure Microsoft SQL Serverless Database by HTTP/azure.db.mssql.availability.state)=1 | [{"tag": "scope", "value": "availability"}] | no url |
| Microsoft SQL database is in unknown state | WARNING | The resource state is unknown. | last(/Azure Microsoft SQL Serverless Database by HTTP/azure.db.mssql.availability.state)=3 | [{"tag": "scope", "value": "availability"}] | no url |
| Microsoft SQL database is unavailable | HIGH | The resource state is unavailable. | last(/Azure Microsoft SQL Serverless Database by HTTP/azure.db.mssql.availability.state)=2 | [{"tag": "scope", "value": "availability"}] | no url |
| High CPU utilization | HIGH | The CPU utilization is too high. The system might be slow to respond. | min(/Azure Microsoft SQL Serverless Database by HTTP/azure.db.mssql.cpu.percentage,5m)>{$AZURE.DB.CPU.UTIL.CRIT} | [{"tag": "scope", "value": "performance"}] | no url |
| There are errors in requests to API | AVERAGE | Zabbix has received errors in response to API requests. | length(last(/Azure Microsoft SQL Serverless Database by HTTP/azure.db.mssql.data.errors))>0 | [{"tag": "scope", "value": "availability"}] | no url |
| Storage space is critically low | AVERAGE | Critical utilization of the storage space. | last(/Azure Microsoft SQL Serverless Database by HTTP/azure.db.mssql.storage.percent)>{$AZURE.DB.STORAGE.PUSED.CRIT} | [{"tag": "scope", "value": "capacity"}] | no url |
| Storage space is low | WARNING | High utilization of the storage space. | last(/Azure Microsoft SQL Serverless Database by HTTP/azure.db.mssql.storage.percent)>{$AZURE.DB.STORAGE.PUSED.WARN} | [{"tag": "scope", "value": "capacity"}] | no url |

