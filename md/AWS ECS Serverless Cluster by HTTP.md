# AWS ECS Serverless Cluster by HTTP template description

The template gets AWS ECS Serverless Cluster metrics and uses the script item to make HTTP requests to the CloudWatch API.
Don't forget to read the README.md for the correct setup of the template.

You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback

Generated by official Zabbix template tool "Templator"

## Summary
* [items](#items)
* [macros](#macros)
* [triggers](#triggers)
* [discoveries](#discoveries)
  * [Discovery Cluster Alarms discovery ](#discovery_cluster_alarms_discovery)
  * [Discovery Cluster Services discovery ](#discovery_cluster_services_discovery)

<a name="items" />

## Items
| name | description | key | type | delay |
| ------------- |------------- |------------- |------------- |------------- |
| Get alarms check | Data collection check. | aws.ecs.alarms.check | DEPENDENT | 0 |
| Container Instance Count | 'The number of EC2 instances running the Amazon ECS agent that are registered with a cluster.' | aws.ecs.container_instance_count | DEPENDENT | 0 |
| CPU Utilization | Cluster CPU utilization | aws.ecs.cpu_utilization | DEPENDENT | 0 |
| Ephemeral Storage Utilization | 'The calculated Disk Utilization' | aws.ecs.disk.utilization | DEPENDENT | 0 |
| Ephemeral Storage Reserved | 'The number of bytes reserved from ephemeral storage in the resource that is specified by the dimensions that you're using. Ephemeral storage is used for the container root filesystem and any bind mount host volumes defined in the container image and task definition. The amount of ephemeral storage can’t be changed in a running task.<br> This metric is only available for tasks that run on Fargate Linux platform version 1.4.0 or later.' | aws.ecs.ephemeral.storage.reserved | DEPENDENT | 0 |
| Ephemeral Storage Utilized | 'The number of bytes used from ephemeral storage in the resource that is specified by the dimensions that you're using. Ephemeral storage is used for the container root filesystem and any bind mount host volumes defined in the container image and task definition. The amount of ephemeral storage can’t be changed in a running task.<br> This metric is only available for tasks that run on Fargate Linux platform version 1.4.0 or later.' | aws.ecs.ephemeral.storage.utilized | DEPENDENT | 0 |
| Get alarms data | Get alarms data.<br>DescribeAlarms API method: https://docs.aws.amazon.com/AmazonCloudWatch/latest/APIReference/API_DescribeAlarms.html | aws.ecs.get_alarms | SCRIPT | 0s;m/1 |
| Get cluster services | Get cluster services.<br>Full metrics list related to ECS: https://docs.aws.amazon.com/AmazonECS/latest/userguide/metrics-dimensions.html | aws.ecs.get_cluster_services | SCRIPT | 5m |
| Get cluster metrics | Get cluster metrics.<br>Full metrics list related to ECS: https://docs.aws.amazon.com/AmazonECS/latest/userguide/metrics-dimensions.html | aws.ecs.get_metrics | SCRIPT | 0s;m/1 |
| Memory Utilization | 'The memory being used by tasks in the resource that is specified by the dimension set that you're using.<br> This metric is only collected for tasks that have a defined memory reservation in their task definition.' | aws.ecs.memory_utilization | DEPENDENT | 0 |
| Get metrics check | Data collection check. | aws.ecs.metrics.check | DEPENDENT | 0 |
| Network rx bytes | 'The number of bytes received by the resource that is specified by the dimensions that you're using.<br> This metric is only available for containers in tasks using the awsvpc or bridge network modes.' | aws.ecs.network.rx | DEPENDENT | 0 |
| Network tx bytes | 'The number of bytes transmitted by the resource that is specified by the dimensions that you're using.<br> This metric is only available for containers in tasks using the awsvpc or bridge network modes.' | aws.ecs.network.tx | DEPENDENT | 0 |
| Service Count | 'The number of services in the cluster.' | aws.ecs.service_count | DEPENDENT | 0 |
| Task Count | 'The number of tasks running in the cluster.' | aws.ecs.task_count | DEPENDENT | 0 |


<a name="macros" />

## Macros
| macro | value |
| ------------- |------------- |
| {$AWS.ACCESS.KEY.ID} | no value |
| {$AWS.AUTH_TYPE} | access_key |
| {$AWS.ECS.CLUSTER.CPU.UTIL.WARN} | 70 |
| {$AWS.ECS.CLUSTER.MEMORY.UTIL.WARN} | 70 |
| {$AWS.ECS.CLUSTER.NAME} | no value |
| {$AWS.ECS.CLUSTER.SERVICE.CPU.UTIL.WARN} | 80 |
| {$AWS.ECS.CLUSTER.SERVICE.MEMORY.UTIL.WARN} | 80 |
| {$AWS.ECS.LLD.FILTER.ALARM_NAME.MATCHES} | .* |
| {$AWS.ECS.LLD.FILTER.ALARM_NAME.NOT_MATCHES} | CHANGE_IF_NEEDED |
| {$AWS.ECS.LLD.FILTER.ALARM_SERVICE_NAMESPACE.MATCHES} | .* |
| {$AWS.ECS.LLD.FILTER.ALARM_SERVICE_NAMESPACE.NOT_MATCHES} | CHANGE_IF_NEEDED |
| {$AWS.ECS.LLD.FILTER.SERVICE.MATCHES} | .* |
| {$AWS.ECS.LLD.FILTER.SERVICE.NOT_MATCHES} | CHANGE_IF_NEEDED |
| {$AWS.PROXY} | no value |
| {$AWS.REGION} | us-west-1 |
| {$AWS.SECRET.ACCESS.KEY} | no value |


<a name="triggers" />

## Triggers
| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Failed to get alarms data | WARNING | no description | length(last(/AWS ECS Serverless Cluster by HTTP/aws.ecs.alarms.check))>0 | [{"tag": "scope", "value": "availability"}] | no url |
| High CPU utilization | WARNING | The CPU utilization is too high. The system might be slow to respond. | min(/AWS ECS Serverless Cluster by HTTP/aws.ecs.cpu_utilization,15m)>{$AWS.ECS.CLUSTER.CPU.UTIL.WARN} | [{"tag": "scope", "value": "capacity"}, {"tag": "scope", "value": "performance"}] | no url |
| High memory utilization | WARNING | The system is running out of free memory. | min(/AWS ECS Serverless Cluster by HTTP/aws.ecs.memory_utilization,15m)>{$AWS.ECS.CLUSTER.MEMORY.UTIL.WARN} | [{"tag": "scope", "value": "capacity"}, {"tag": "scope", "value": "performance"}] | no url |
| Failed to get metrics data | WARNING | no description | length(last(/AWS ECS Serverless Cluster by HTTP/aws.ecs.metrics.check))>0 | [{"tag": "scope", "value": "availability"}] | no url |


<a name="discoveries" />

## Discoveries
| name | key | description | type | lifetime | delay |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Cluster Alarms discovery | aws.ecs.alarms.discovery | Discovery instance alarms. | DEPENDENT | no lifetime | 0 |
| Cluster Services discovery | aws.ecs.services.discovery | Discovery {$AWS.ECS.CLUSTER.NAME} services. | DEPENDENT | no lifetime | 0 |


<a name="discovery_cluster_alarms_discovery" />

## Discovery Cluster Alarms discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| [{#ALARM_NAME}]: Get metrics | Get alarm metrics about the state and its reason. | aws.ecs.alarm.get_metrics["{#ALARM_NAME}"] | DEPENDENT |
| [{#ALARM_NAME}]: State | The state value for the alarm. Possible values: 0 (OK), 1 (INSUFFICIENT_DATA), 2 (ALARM).<br>Alarm description:<br>{#ALARM_DESCRIPTION} | aws.ecs.alarm.state["{#ALARM_NAME}"] | DEPENDENT |
| [{#ALARM_NAME}]: State reason | An explanation for the alarm state, in text format.<br>Alarm description:<br>{#ALARM_DESCRIPTION} | aws.ecs.alarm.state_reason["{#ALARM_NAME}"] | DEPENDENT |


### Triggers

| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| [{#ALARM_NAME}] has 'Insufficient data' state | INFO | no description | last(/AWS ECS Serverless Cluster by HTTP/aws.ecs.alarm.state["{#ALARM_NAME}"])=1 | [{"tag": "scope", "value": "notice"}] | no url |
| [{#ALARM_NAME}] has 'Alarm' state | AVERAGE | Alarm "{#ALARM_NAME}" has 'Alarm' state. <br>Reason: {ITEM.LASTVALUE2} | last(/AWS ECS Serverless Cluster by HTTP/aws.ecs.alarm.state["{#ALARM_NAME}"])=2 and length(last(/AWS ECS Serverless Cluster by HTTP/aws.ecs.alarm.state_reason["{#ALARM_NAME}"]))>0 | [{"tag": "scope", "value": "availability"}] | no url |


<a name="discovery_cluster_services_discovery" />

## Discovery Cluster Services discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| [{#AWS.ECS.SERVICE.NAME}]: CPU Utilization | "A number of CPU units used by tasks in the resource that is specified by the dimension set that you're using.<br> This metric is only collected for tasks that have a defined CPU reservation in their task definition." | aws.ecs.services.cpu.utilization["{#AWS.ECS.SERVICE.NAME}"] | DEPENDENT |
| [{#AWS.ECS.SERVICE.NAME}]: CPU Reserved | "A number of CPU units reserved by tasks in the resource that is specified by the dimension set that you're using.<br> This metric is only collected for tasks that have a defined CPU reservation in their task definition." | aws.ecs.services.cpu_reserved["{#AWS.ECS.SERVICE.NAME}"] | DEPENDENT |
| [{#AWS.ECS.SERVICE.NAME}]: Desired Task | The desired number of tasks for an {#AWS.ECS.SERVICE.NAME} service. | aws.ecs.services.desired.task["{#AWS.ECS.SERVICE.NAME}"] | DEPENDENT |
| [{#AWS.ECS.SERVICE.NAME}]: Ephemeral storage reserved | 'The number of bytes reserved from ephemeral storage in the resource that is specified by the dimensions that you're using. Ephemeral storage is used for the container root filesystem and any bind mount host volumes defined in the container image and task definition. The amount of ephemeral storage can’t be changed in a running task.<br>This metric is only available for tasks that run on Fargate Linux platform version 1.4.0 or later.' | aws.ecs.services.ephemeral.storage.reserved["{#AWS.ECS.SERVICE.NAME}"] | DEPENDENT |
| [{#AWS.ECS.SERVICE.NAME}]: Ephemeral storage utilized | 'The number of bytes used from ephemeral storage in the resource that is specified by the dimensions that you're using. Ephemeral storage is used for the container root filesystem and any bind mount host volumes defined in the container image and task definition. The amount of ephemeral storage can’t be changed in a running task.<br>This metric is only available for tasks that run on Fargate Linux platform version 1.4.0 or later.' | aws.ecs.services.ephemeral.storage.utilized["{#AWS.ECS.SERVICE.NAME}"] | DEPENDENT |
| [{#AWS.ECS.SERVICE.NAME}]: Get metrics | Get metrics of ESC services.<br>Full metrics list related to ECS : https://docs.aws.amazon.com/ecs/index.html | aws.ecs.services.get_metrics["{#AWS.ECS.SERVICE.NAME}"] | SCRIPT |
| [{#AWS.ECS.SERVICE.NAME}]: Memory utilization | 'The memory being used by tasks in the resource that is specified by the dimension set that you're using.<br>This metric is only collected for tasks that have a defined memory reservation in their task definition.' | aws.ecs.services.memory.utilization["{#AWS.ECS.SERVICE.NAME}"] | DEPENDENT |
| [{#AWS.ECS.SERVICE.NAME}]: Memory reserved | 'The memory that is reserved by tasks in the resource that is specified by the dimension set that you're using.<br>This metric is only collected for tasks that have a defined memory reservation in their task definition.' | aws.ecs.services.memory_reserved["{#AWS.ECS.SERVICE.NAME}"] | DEPENDENT |
| [{#AWS.ECS.SERVICE.NAME}]: Memory utilized | 'The memory being used by tasks in the resource that is specified by the dimension set that you're using.<br>This metric is only collected for tasks that have a defined memory reservation in their task definition.' | aws.ecs.services.memory_utilized["{#AWS.ECS.SERVICE.NAME}"] | DEPENDENT |
| [{#AWS.ECS.SERVICE.NAME}]: Network rx bytes | 'The number of bytes received by the resource that is specified by the dimensions that you're using.<br>This metric is only available for containers in tasks using the awsvpc or bridge network modes.' | aws.ecs.services.network.rx["{#AWS.ECS.SERVICE.NAME}"] | DEPENDENT |
| [{#AWS.ECS.SERVICE.NAME}]: Network tx bytes | 'The number of bytes transmitted by the resource that is specified by the dimensions that you're using.<br>This metric is only available for containers in tasks using the awsvpc or bridge network modes.' | aws.ecs.services.network.tx["{#AWS.ECS.SERVICE.NAME}"] | DEPENDENT |
| [{#AWS.ECS.SERVICE.NAME}]: Pending Task | The number of tasks currently in the `pending` state. | aws.ecs.services.pending.task["{#AWS.ECS.SERVICE.NAME}"] | DEPENDENT |
| [{#AWS.ECS.SERVICE.NAME}]: Running Task | The number of tasks currently in the `running` state. | aws.ecs.services.running.task["{#AWS.ECS.SERVICE.NAME}"] | DEPENDENT |
| [{#AWS.ECS.SERVICE.NAME}]: Storage read bytes | 'The number of bytes read from storage in the resource that is specified by the dimensions that you're using.' | aws.ecs.services.storage.read.bytes["{#AWS.ECS.SERVICE.NAME}"] | DEPENDENT |
| [{#AWS.ECS.SERVICE.NAME}]: Storage write bytes | 'The number of bytes written to storage in the resource that is specified by the dimensions that you're using.' | aws.ecs.services.storage.write.bytes["{#AWS.ECS.SERVICE.NAME}"] | DEPENDENT |
| [{#AWS.ECS.SERVICE.NAME}]: Task Set | The number of task sets in the {#AWS.ECS.SERVICE.NAME} service. | aws.ecs.services.task.set["{#AWS.ECS.SERVICE.NAME}"] | DEPENDENT |


### Triggers

| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| [{#AWS.ECS.SERVICE.NAME}]: High CPU utilization | WARNING | The CPU utilization is too high. The system might be slow to respond. | min(/AWS ECS Serverless Cluster by HTTP/aws.ecs.services.cpu.utilization["{#AWS.ECS.SERVICE.NAME}"],15m)>{$AWS.ECS.CLUSTER.SERVICE.CPU.UTIL.WARN} | [{"tag": "scope", "value": "capacity"}, {"tag": "scope", "value": "performance"}, {"tag": "service", "value": "{#AWS.ECS.SERVICE.NAME}"}] | no url |
| [{#AWS.ECS.SERVICE.NAME}]: High memory utilization | WARNING | The system is running out of free memory. | min(/AWS ECS Serverless Cluster by HTTP/aws.ecs.services.memory.utilization["{#AWS.ECS.SERVICE.NAME}"],15m)>{$AWS.ECS.CLUSTER.SERVICE.MEMORY.UTIL.WARN} | [{"tag": "scope", "value": "capacity"}, {"tag": "scope", "value": "performance"}, {"tag": "service", "value": "{#AWS.ECS.SERVICE.NAME}"}] | no url |

