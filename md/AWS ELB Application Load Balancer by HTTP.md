# AWS ELB Application Load Balancer by HTTP template description

The template is designed to monitor AWS ELB Application Load Balancer by HTTP via Zabbix, and it works without any external scripts.
Don't forget to read the README.md for the correct setup of the template.

You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback

Generated by official Zabbix template tool "Templator"

## Summary
* [items](#items)
* [macros](#macros)
* [triggers](#triggers)
* [discoveries](#discoveries)
  * [Discovery Load Balancer alarm discovery ](#discovery_load_balancer_alarm_discovery)
  * [Discovery Target groups discovery ](#discovery_target_groups_discovery)

<a name="items" />

## Items
| name | description | key | type | delay |
| ------------- |------------- |------------- |------------- |------------- |
| Active Connection Count | The total number of active concurrent TCP connections from clients to the load balancer and from the load balancer to targets. | aws.elb.alb.active_connection_count | DEPENDENT | 0 |
| Get alarms check | Check that the alarm data has been received correctly. | aws.elb.alb.alarms.check | DEPENDENT | 0 |
| ELB Auth Error | The number of user authentications that could not be completed because an authenticate action was misconfigured, the load balancer could not establish a connection with the IdP, or the load balancer could not complete the authentication flow due to an internal error. | aws.elb.alb.auth_error | DEPENDENT | 0 |
| ELB Auth Failure | The number of user authentications that could not be completed because the IdP denied access to the user or an authorization code was used more than once. | aws.elb.alb.auth_failure | DEPENDENT | 0 |
| ELB Auth Latency | The time elapsed, in milliseconds, to query the IdP for the ID token and user info.<br>If one or more of these operations fail, this is the time to failure. | aws.elb.alb.auth_latency | DEPENDENT | 0 |
| ELB Auth Success | The number of authenticate actions that were successful.<br>This metric is incremented at the end of the authentication workflow, after the load balancer has retrieved the user claims from the IdP. | aws.elb.alb.auth_success | DEPENDENT | 0 |
| ELB Auth User Claims Size Exceeded | The number of times that a configured IdP returned user claims that exceeded 11K bytes in size. | aws.elb.alb.auth_user_claims_size_exceeded | DEPENDENT | 0 |
| Consumed LCUs | The number of load balancer capacity units (LCU) used by your load balancer.<br>You pay for the number of LCUs that you use per hour.<br>More information on Elastic Load Balancing pricing here: https://aws.amazon.com/elasticloadbalancing/pricing/ | aws.elb.alb.capacity_units | DEPENDENT | 0 |
| Client TLS Negotiation Error Count | The number of TLS connections initiated by the client that did not establish a session with the load balancer due to a TLS error.<br>Possible causes include a mismatch of ciphers or protocols or the client failing to verify the server certificate and closing the connection. | aws.elb.alb.client_tls_negotiation_error_count | DEPENDENT | 0 |
| Get ELB ALB alarms data | `DescribeAlarms` API method: https://docs.aws.amazon.com/AmazonCloudWatch/latest/APIReference/API_DescribeAlarms.html | aws.elb.alb.get_alarms | SCRIPT | 0s;m/1 |
| Get metrics data | Get ELB Application Load Balancer metrics.<br>Full metrics list related to Application Load Balancer: https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-cloudwatch-metrics.html | aws.elb.alb.get_metrics | SCRIPT | 0s;m/1 |
| Get target groups | Get ELB target group.<br>`DescribeTargetGroups` API method: https://docs.aws.amazon.com/elasticloadbalancing/latest/APIReference/API_DescribeTargetGroups.html | aws.elb.alb.get_target_groups | SCRIPT | 0s;m/30 |
| ELB HTTP 3XX Count | The number of HTTP 3XX redirection codes that originate from the load balancer.<br>This count does not include response codes generated by targets. | aws.elb.alb.http_3xx_count | DEPENDENT | 0 |
| ELB HTTP 4XX Count | The number of HTTP 4XX client error codes that originate from the load balancer.<br>Client errors are generated when requests are malformed or incomplete. These requests were not received by the target, other than in the case where the load balancer returns an HTTP 460 error code.<br>This count does not include any response codes generated by the targets. | aws.elb.alb.http_4xx_count | DEPENDENT | 0 |
| ELB HTTP 5XX Count | The number of HTTP 5XX server error codes that originate from the load balancer.<br>This count does not include any response codes generated by the targets. | aws.elb.alb.http_5xx_count | DEPENDENT | 0 |
| ELB HTTP 500 Count | The number of HTTP 500 error codes that originate from the load balancer. | aws.elb.alb.http_500_count | DEPENDENT | 0 |
| ELB HTTP 502 Count | The number of HTTP 502 error codes that originate from the load balancer. | aws.elb.alb.http_502_count | DEPENDENT | 0 |
| ELB HTTP 503 Count | The number of HTTP 503 error codes that originate from the load balancer. | aws.elb.alb.http_503_count | DEPENDENT | 0 |
| ELB HTTP 504 Count | The number of HTTP 504 error codes that originate from the load balancer. | aws.elb.alb.http_504_count | DEPENDENT | 0 |
| HTTP Fixed Response Count | The number of fixed-response actions that were successful. | aws.elb.alb.http_fixed_response_count | DEPENDENT | 0 |
| HTTP Redirect Count | The number of redirect actions that were successful. | aws.elb.alb.http_redirect_count | DEPENDENT | 0 |
| HTTP Redirect Url Limit Exceeded Count | The number of redirect actions that could not be completed because the URL in the response location header is larger than 8K bytes. | aws.elb.alb.http_redirect_url_limit_exceeded_count | DEPENDENT | 0 |
| Get metrics check | Check that the Application Load Balancer metrics data has been received correctly. | aws.elb.alb.metrics.check | DEPENDENT | 0 |
| New Connection Count | The total number of new TCP connections established from clients to the load balancer and from the load balancer to targets. | aws.elb.alb.new_connection_count | DEPENDENT | 0 |
| Desync Mitigation Mode Non Compliant Request Count | The number of requests that fail to comply with HTTP protocols. | aws.elb.alb.non_compliant_request_count | DEPENDENT | 0 |
| Processed Bytes | The total number of bytes processed by the load balancer over IPv4 and IPv6 (HTTP header and HTTP payload).<br>This count includes traffic to and from clients and Lambda functions, and traffic from an Identity Provider (IdP) if user authentication is enabled. | aws.elb.alb.processed_bytes | DEPENDENT | 0 |
| Rejected Connection Count | The number of connections that were rejected because the load balancer had reached its maximum number of connections. | aws.elb.alb.rejected_connection_count | DEPENDENT | 0 |
| Requests Count | The number of requests processed over IPv4 and IPv6.<br>This metric is only incremented for requests where the load balancer node was able to choose a target.<br>Requests that are rejected before a target is chosen are not reflected in this metric. | aws.elb.alb.requests_count | DEPENDENT | 0 |
| Rule Evaluations | The number of rules processed by the load balancer given a request rate averaged over an hour. | aws.elb.alb.rule_evaluations | DEPENDENT | 0 |
| Target Connection Error Count | The number of connections that were not successfully established between the load balancer and target.<br>This metric does not apply if the target is a Lambda function. | aws.elb.alb.target_connection_error_count | DEPENDENT | 0 |
| Target Response Time | The time elapsed, in seconds, after the request leaves the load balancer until a response from the target is received.<br>This is equivalent to the `target_processing_time` field in the access logs. | aws.elb.alb.target_response_time | DEPENDENT | 0 |
| Target TLS Negotiation Error Count | The number of TLS connections initiated by the load balancer that did not establish a session with the target.<br>Possible causes include a mismatch of ciphers or protocols. This metric does not apply if the target is a Lambda function. | aws.elb.alb.target_tls_negotiation_error_count | DEPENDENT | 0 |


<a name="macros" />

## Macros
| macro | value |
| ------------- |------------- |
| {$AWS.ACCESS.KEY.ID} | no value |
| {$AWS.AUTH_TYPE} | access_key |
| {$AWS.DATA.TIMEOUT} | 60s |
| {$AWS.ELB.ARN} | no value |
| {$AWS.ELB.LLD.FILTER.ALARM_NAME.MATCHES} | .* |
| {$AWS.ELB.LLD.FILTER.ALARM_NAME.NOT_MATCHES} | CHANGE_IF_NEEDED |
| {$AWS.ELB.LLD.FILTER.ALARM_SERVICE_NAMESPACE.MATCHES} | .* |
| {$AWS.ELB.LLD.FILTER.ALARM_SERVICE_NAMESPACE.NOT_MATCHES} | CHANGE_IF_NEEDED |
| {$AWS.ELB.LLD.FILTER.TARGET.GROUP.MATCHES} | .* |
| {$AWS.ELB.LLD.FILTER.TARGET.GROUP.NOT_MATCHES} | CHANGE_IF_NEEDED |
| {$AWS.HTTP.4XX.FAIL.MAX.WARN} | 5 |
| {$AWS.HTTP.5XX.FAIL.MAX.WARN} | 5 |
| {$AWS.PROXY} | no value |
| {$AWS.REGION} | us-west-1 |
| {$AWS.SECRET.ACCESS.KEY} | no value |


<a name="triggers" />

## Triggers
| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Failed to get alarms data | WARNING | Failed to get CloudWatch alarms for Application Load Balancer. | length(last(/AWS ELB Application Load Balancer by HTTP/aws.elb.alb.alarms.check))>0 | [{"tag": "scope", "value": "availability"}] | no url |
| Too many HTTP 4XX error codes | WARNING | Too many requests failed with HTTP 4XX code. | min(/AWS ELB Application Load Balancer by HTTP/aws.elb.alb.http_4xx_count,5m)>{$AWS.HTTP.4XX.FAIL.MAX.WARN} | [{"tag": "scope", "value": "availability"}] | no url |
| Too many HTTP 5XX error codes | WARNING | Too many requests failed with HTTP 5XX code. | min(/AWS ELB Application Load Balancer by HTTP/aws.elb.alb.http_5xx_count,5m)>{$AWS.HTTP.5XX.FAIL.MAX.WARN} | [{"tag": "scope", "value": "availability"}] | no url |
| Failed to get metrics data | WARNING | Failed to get CloudWatch metrics for Application Load Balancer. | length(last(/AWS ELB Application Load Balancer by HTTP/aws.elb.alb.metrics.check))>0 | [{"tag": "scope", "value": "availability"}] | no url |


<a name="discoveries" />

## Discoveries
| name | key | description | type | lifetime | delay |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Load Balancer alarm discovery | aws.elb.alb.alarms.discovery | Used for the discovery of alarm balancers. | DEPENDENT | no lifetime | 0 |
| Target groups discovery | aws.elb.alb.target_groups.discovery | Used for the discovery of `{$AWS.ELB.TARGET.GROUP.NAME}` target groups. | DEPENDENT | no lifetime | 0 |


<a name="discovery_load_balancer_alarm_discovery" />

## Discovery Load Balancer alarm discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| [{#ALARM_NAME}]: Get metrics | Get metrics about the alarm state and its reason. | aws.elb.alb.alarm.get_metrics["{#ALARM_NAME}"] | DEPENDENT |
| [{#ALARM_NAME}]: State | The value of the alarm state. Possible values:<br>0 - OK;<br>1 - INSUFFICIENT_DATA;<br>2 - ALARM.<br>Alarm description:<br>`{#ALARM_DESCRIPTION}` | aws.elb.alb.alarm.state["{#ALARM_NAME}"] | DEPENDENT |
| [{#ALARM_NAME}]: State reason | An explanation for the alarm state reason in text format.<br>Alarm description:<br>`{#ALARM_DESCRIPTION}` | aws.elb.alb.alarm.state_reason["{#ALARM_NAME}"] | DEPENDENT |


### Triggers

| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| [{#ALARM_NAME}] has 'Insufficient data' state | INFO | Either the alarm has just started, the metric is not available, or not enough data is available for the metric to determine the alarm state. | last(/AWS ELB Application Load Balancer by HTTP/aws.elb.alb.alarm.state["{#ALARM_NAME}"])=1 | [{"tag": "scope", "value": "notice"}] | no url |
| [{#ALARM_NAME}] has 'Alarm' state | AVERAGE | The alarm `{#ALARM_NAME}` is in the ALARM state.<br>Reason: `{ITEM.LASTVALUE2}` | last(/AWS ELB Application Load Balancer by HTTP/aws.elb.alb.alarm.state["{#ALARM_NAME}"])=2 and length(last(/AWS ELB Application Load Balancer by HTTP/aws.elb.alb.alarm.state_reason["{#ALARM_NAME}"]))>0 | [{"tag": "scope", "value": "availability"}] | no url |


<a name="discovery_target_groups_discovery" />

## Discovery Target groups discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| [{#AWS.ELB.TARGET.GROUP.NAME}]: Anomalous Host Count | The number of hosts detected with anomalies. | aws.elb.alb.target_groups.anomalous_host_count["{#AWS.ELB.TARGET.GROUP.NAME}"] | DEPENDENT |
| [{#AWS.ELB.TARGET.GROUP.NAME}]: Get metrics | Get the metrics of the ELB target group `{#AWS.ELB.TARGET.GROUP.NAME}`.<br>Full list of metrics related to AWS ELB here: https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-cloudwatch-metrics.html#user-authentication-metric-table | aws.elb.alb.target_groups.get_metrics["{#AWS.ELB.TARGET.GROUP.NAME}"] | SCRIPT |
| [{#AWS.ELB.TARGET.GROUP.NAME}]: Healthy Host Count | The number of targets that are considered healthy. | aws.elb.alb.target_groups.healthy_host_count["{#AWS.ELB.TARGET.GROUP.NAME}"] | DEPENDENT |
| [{#AWS.ELB.TARGET.GROUP.NAME}]: Healthy State DNS | The number of zones that meet the DNS healthy state requirements. | aws.elb.alb.target_groups.healthy_state_dns["{#AWS.ELB.TARGET.GROUP.NAME}"] | DEPENDENT |
| [{#AWS.ELB.TARGET.GROUP.NAME}]: Healthy State Routing | The number of zones that meet the routing healthy state requirements. | aws.elb.alb.target_groups.healthy_state_routing["{#AWS.ELB.TARGET.GROUP.NAME}"] | DEPENDENT |
| [{#AWS.ELB.TARGET.GROUP.NAME}]: HTTP Code Target 2XX Count | The number of HTTP response 2XX codes generated by the targets.<br>This does not include any response codes generated by the load balancer. | aws.elb.alb.target_groups.http_2xx_count["{#AWS.ELB.TARGET.GROUP.NAME}"] | DEPENDENT |
| [{#AWS.ELB.TARGET.GROUP.NAME}]: HTTP Code Target 3XX Count | The number of HTTP response 3XX codes generated by the targets.<br>This does not include any response codes generated by the load balancer. | aws.elb.alb.target_groups.http_3xx_count["{#AWS.ELB.TARGET.GROUP.NAME}"] | DEPENDENT |
| [{#AWS.ELB.TARGET.GROUP.NAME}]: HTTP Code Target 4XX Count | The number of HTTP response 4XX codes generated by the targets.<br>This does not include any response codes generated by the load balancer. | aws.elb.alb.target_groups.http_4xx_count["{#AWS.ELB.TARGET.GROUP.NAME}"] | DEPENDENT |
| [{#AWS.ELB.TARGET.GROUP.NAME}]: HTTP Code Target 5XX Count | The number of HTTP response 5XX codes generated by the targets.<br>This does not include any response codes generated by the load balancer. | aws.elb.alb.target_groups.http_5xx_count["{#AWS.ELB.TARGET.GROUP.NAME}"] | DEPENDENT |
| [{#AWS.ELB.TARGET.GROUP.NAME}]: Mitigated Host Count | The number of targets under mitigation. | aws.elb.alb.target_groups.mitigated_host_count["{#AWS.ELB.TARGET.GROUP.NAME}"] | DEPENDENT |
| [{#AWS.ELB.TARGET.GROUP.NAME}]: Request Count Per Target | The average request count per target, in a target group.<br>You must specify the target group using the TargetGroup dimension. | aws.elb.alb.target_groups.request["{#AWS.ELB.TARGET.GROUP.NAME}"] | DEPENDENT |
| [{#AWS.ELB.TARGET.GROUP.NAME}]: Unhealthy Host Count | The number of targets that are considered unhealthy. | aws.elb.alb.target_groups.unhealthy_host_count["{#AWS.ELB.TARGET.GROUP.NAME}"] | DEPENDENT |
| [{#AWS.ELB.TARGET.GROUP.NAME}]: Unhealthy Routing Request Count | The average request count per target, in a target group. | aws.elb.alb.target_groups.unhealthy_routing_request_count["{#AWS.ELB.TARGET.GROUP.NAME}"] | DEPENDENT |
| [{#AWS.ELB.TARGET.GROUP.NAME}]: Unhealthy State DNS | The number of zones that do not meet the DNS healthy state requirements and therefore were marked unhealthy in DNS. | aws.elb.alb.target_groups.unhealthy_state_dns["{#AWS.ELB.TARGET.GROUP.NAME}"] | DEPENDENT |
| [{#AWS.ELB.TARGET.GROUP.NAME}]: Unhealthy State Routing | The number of zones that do not meet the routing healthy state requirements, and therefore the load balancer distributes traffic to all targets in the zone, including the unhealthy targets. | aws.elb.alb.target_groups.unhealthy_state_routing["{#AWS.ELB.TARGET.GROUP.NAME}"] | DEPENDENT |

