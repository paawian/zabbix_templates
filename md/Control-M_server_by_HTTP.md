# Control-M server by HTTP template description

This template is designed to get metrics from the Control-M server using the Control-M Automation API with HTTP agent.

This template monitors server statistics, discovers jobs and agents using Low Level Discovery.

To use this template, macros `{$API.TOKEN}`, `{$API.URI.ENDPOINT}`, and `{$SERVER.NAME}` need to be set.

Generated by official Zabbix template tool "Templator"

## Summary
* [items](#items)
* [macros](#macros)
* [triggers](#triggers)
* [discoveries](#discoveries)
  * [Discovery Agent discovery ](#discovery_agent_discovery)
  * [Discovery Jobs discovery ](#discovery_jobs_discovery)

<a name="items"></a>

## Items
| name | description | key | type | delay |
| ------------- |------------- |------------- |------------- |------------- |
| Get agents | Gets agents for the server. | controlm.agents | HTTP_AGENT | no delay |
| Get jobs | Gets the status of jobs. | controlm.jobs | HTTP_AGENT | no delay |
| Jobs statistics | Gets the statistics of jobs. | controlm.jobs.statistics | DEPENDENT | 0 |
| Jobs returned | Gets the count of returned jobs. | controlm.jobs.statistics.returned | DEPENDENT | 0 |
| Jobs total | Gets the count of total jobs. | controlm.jobs.statistics.total | DEPENDENT | 0 |
| Get Control-M server stats | Gets the statistics of the server. | controlm.server.stats | HTTP_AGENT | no delay |
| Server message | Gets the metric of the server message. | server.message | DEPENDENT | 0 |
| Server state | Gets the metric of the server state. | server.state | DEPENDENT | 0 |
| Server version | Gets the metric of the server version. | server.version | DEPENDENT | 0 |


<a name="macros"></a>

## Macros
| macro | value |
| ------------- |------------- |
| {$API.TOKEN} | no value |
| {$API.URI.ENDPOINT} | <set the api uri endpoint here> |
| {$SERVER.NAME} | <set the server name here> |


<a name="triggers"></a>

## Triggers
| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Server disconnected | HIGH | The server is disconnected. | last(/Control-M server by HTTP/server.message,#1)="Disconnected" | [{"tag": "scope", "value": "availability"}] | no url |
| Server error | HIGH | The server has encountered an error. | last(/Control-M server by HTTP/server.message,#1)<>"Connected" and<br>last(/Control-M server by HTTP/server.message,#1)<>"Disconnected" and<br>last(/Control-M server by HTTP/server.message,#1)<>"" | [{"tag": "scope", "value": "availability"}] | no url |
| Server is down | HIGH | The server is down. | last(/Control-M server by HTTP/server.state)=0 or<br>last(/Control-M server by HTTP/server.state)=10 | [{"tag": "scope", "value": "availability"}] | no url |
| Server version has changed | INFO | The server version has changed. Acknowledge to close the problem manually. | last(/Control-M server by HTTP/server.version,#1)<>last(/Control-M server by HTTP/server.version,#2) and<br>length(last(/Control-M server by HTTP/server.version))>0 | [{"tag": "scope", "value": "notice"}] | no url |


<a name="discoveries"></a>

## Discoveries
| name | key | description | type | lifetime | delay |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Agent discovery | controlm.agent.discovery | Discovers agents on the server. | DEPENDENT | no lifetime | 0 |
| Jobs discovery | controlm.jobs.discovery | Discovers jobs on the server. | DEPENDENT | 1d | 0 |


<a name="discovery_agent_discovery"></a>

## Discovery Agent discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| Agent [{#AGENT.NAME}]: stats | Gets the statistics of an agent. | agent.stats['{#AGENT.NAME}'] | DEPENDENT |
| Agent [{#AGENT.NAME}]: status | Gets the status of an agent. | agent.status['{#AGENT.NAME}'] | DEPENDENT |
| Agent [{#AGENT.NAME}]: version | Gets the version number of an agent. | agent.version['{#AGENT.NAME}'] | DEPENDENT |


### Triggers

| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Agent [{#AGENT.NAME}]: status [{ITEM.VALUE}] | AVERAGE | The agent has encountered an issue. | last(/Control-M server by HTTP/agent.status['{#AGENT.NAME}'],#1)=1 or<br>last(/Control-M server by HTTP/agent.status['{#AGENT.NAME}'],#1)=10 | [{"tag": "scope", "value": "availability"}] | no url |
| Agent [{#AGENT.NAME}}: status disabled | INFO | The agent is disabled. | last(/Control-M server by HTTP/agent.status['{#AGENT.NAME}'],#1)=2 or<br>last(/Control-M server by HTTP/agent.status['{#AGENT.NAME}'],#1)=3 | [{"tag": "scope", "value": "availability"}] | no url |
| Agent [{#AGENT.NAME}]: unknown version | WARNING | The agent version is unknown. | last(/Control-M server by HTTP/agent.version['{#AGENT.NAME}'],#1)="Unknown" | [{"tag": "scope", "value": "notice"}] | no url |
| Agent [{#AGENT.NAME}]: version has changed | INFO | The agent version has changed. Acknowledge to close the problem manually. | last(/Control-M server by HTTP/agent.version['{#AGENT.NAME}'],#1)<>last(/Control-M server by HTTP/agent.version['{#AGENT.NAME}'],#2) | [{"tag": "scope", "value": "notice"}] | no url |


<a name="discovery_jobs_discovery"></a>

## Discovery Jobs discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| Job [{#JOB.ID}]: held status | Gets the held status of a job. | job.held['{#JOB.ID}'] | DEPENDENT |
| Job [{#JOB.ID}]: number of runs | Gets the number of runs for a job. | job.numberOfRuns['{#JOB.ID}'] | DEPENDENT |
| Job [{#JOB.ID}]: stats | Gets the statistics of a job. | job.stats['{#JOB.ID}'] | DEPENDENT |
| Job [{#JOB.ID}]: status | Gets the status of a job. | job.status['{#JOB.ID}'] | DEPENDENT |
| Job [{#JOB.ID}]: type | Gets the job type. | job.type['{#JOB.ID}'] | DEPENDENT |


### Triggers

| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Job [{#JOB.ID}]: status [{ITEM.VALUE}] | WARNING | The job has encountered an issue. | last(/Control-M server by HTTP/job.status['{#JOB.ID}'],#1)=1 or<br>last(/Control-M server by HTTP/job.status['{#JOB.ID}'],#1)=10 | [{"tag": "scope", "value": "availability"}] | no url |

