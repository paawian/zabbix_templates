# MongoDB cluster by Zabbix agent 2 template description

Get MongoDB metrics from plugin for the zabbix-agent2.
  1. Setup and configure zabbix-agent2 compiled with the MongoDB monitoring plugin.
  2. Set the {$MONGODB.CONNSTRING} such as <protocol(host:port)> or named session.
  3. Set the user name and password in host macros ({$MONGODB.USER}, {$MONGODB.PASSWORD}) if you want to override parameters from the Zabbix agent configuration file.

  All sharded Mongodb nodes (mongod) will be discovered with attached template "MongoDB node".

You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback/420659-discussion-thread-for-official-zabbix-template-db-mongodb

Generated by official Zabbix template tool "Templator"

## Summary
* [items](#items)
* [macros](#macros)
* [triggers](#triggers)
* [discoveries](#discoveries)
  * [Discovery Collection discovery ](#discovery_collection_discovery)
  * [Discovery Database discovery ](#discovery_database_discovery)

<a name="items" />

## Items
| name | description | key | type | delay |
| ------------- |------------- |------------- |------------- |------------- |
| Configserver heartbeat | Difference between the latest optime of the CSRS primary that the mongos has seen and cluster time. | mongodb.config_server_heartbeat | DEPENDENT | 0 |
| Connections, active | The number of active client connections to the server.<br>Active client connections refers to client connections that currently have operations in progress.<br>Available starting in  4.0.7, 0 for older versions. | mongodb.connections.active | DEPENDENT | 0 |
| Connections, available | "The number of unused incoming connections available." | mongodb.connections.available | DEPENDENT | 0 |
| Connections, current | The number of incoming connections from clients to the database server.<br>This number includes the current shell session. | mongodb.connections.current | DEPENDENT | 0 |
| New connections, rate | "Rate of all incoming connections created to the server." | mongodb.connections.rate | DEPENDENT | 0 |
| Connection pool: available | The total number of available outgoing connections from the current mongos instance to other members of the sharded cluster. | mongodb.connection_pool.available | DEPENDENT | 0 |
| Connection pool: client connections | The number of active and stored outgoing synchronous connections from the current mongos instance to other members of the sharded cluster. | mongodb.connection_pool.client | DEPENDENT | 0 |
| Connection pool: created, rate | The total number of outgoing connections created per second by the current mongos instance to other members of the sharded cluster. | mongodb.connection_pool.created.rate | DEPENDENT | 0 |
| Connection pool: in use | Reports the total number of outgoing connections from the current mongos instance to other members of the sharded cluster set that are currently in use. | mongodb.connection_pool.in_use | DEPENDENT | 0 |
| Connection pool: refreshing | Reports the total number of outgoing connections from the current mongos instance to other members of the sharded cluster that are currently being refreshed. | mongodb.connection_pool.refreshing | DEPENDENT | 0 |
| Connection pool: scoped | Number of active and stored outgoing scoped synchronous connections from the current mongos instance to other members of the sharded cluster. | mongodb.connection_pool.scoped | DEPENDENT | 0 |
| Get mongodb.connpool.stats | Returns current info about connpool.stats. | mongodb.connpool.stats["{$MONGODB.CONNSTRING}","{$MONGODB.USER}","{$MONGODB.PASSWORD}"] | no type | no delay |
| Cursor: open pinned | Number of pinned open cursors. | mongodb.cursor.open.pinned | DEPENDENT | 0 |
| Cursor: open total | Number of cursors that MongoDB is maintaining for clients. | mongodb.cursor.open.total | DEPENDENT | 0 |
| Cursor: timed out, rate | Number of cursors that time out, per second. | mongodb.cursor.timed_out.rate | DEPENDENT | 0 |
| Jumbo chunks | Total number of 'jumbo' chunks in the mongo cluster. | mongodb.jumbo_chunks.count["{$MONGODB.CONNSTRING}","{$MONGODB.USER}","{$MONGODB.PASSWORD}"] | no type | no delay |
| Last seen configserver | The latest optime of the CSRS primary that the mongos has seen. | mongodb.last_seen_config_server | DEPENDENT | 0 |
| Architecture | A number, either 64 or 32, that indicates whether the MongoDB instance is compiled for 64-bit or 32-bit architecture. | mongodb.mem.bits | DEPENDENT | 0 |
| Memory: resident | Amount of memory currently used by the database process. | mongodb.mem.resident | DEPENDENT | 0 |
| Memory: virtual | Amount of virtual memory used by the mongos process. | mongodb.mem.virtual | DEPENDENT | 0 |
| Cursor: open no timeout | Number of open cursors with the option DBQuery.Option.noTimeout set to prevent timeout after a period of inactivity. | mongodb.metrics.cursor.open.no_timeout | DEPENDENT | 0 |
| Bytes in, rate | The total number of bytes that the server has received over network connections initiated by clients or other mongod/mongos instances per second. | mongodb.network.bytes_in.rate | DEPENDENT | 0 |
| Bytes out, rate | The total number of bytes that the server has sent over network connections initiated by clients or other mongod/mongos instances per second. | mongodb.network.bytes_out.rate | DEPENDENT | 0 |
| Requests, rate | Number of distinct requests that the server has received per second. | mongodb.network.numRequests.rate | DEPENDENT | 0 |
| Operations: command | The number of commands issued to the database per second.<br>Counts all commands except the write commands: insert, update, and delete. | mongodb.opcounters.command.rate | DEPENDENT | 0 |
| Operations: delete | The number of delete operations the mongos instance per second. | mongodb.opcounters.delete.rate | DEPENDENT | 0 |
| Operations: getmore, rate | The number of "getmore" operations the mongos per second. This counter can be high even if the query count is low.<br>Secondary nodes send getMore operations as part of the replication process. | mongodb.opcounters.getmore.rate | DEPENDENT | 0 |
| Operations: insert, rate | The number of insert operations received the mongos instance per second. | mongodb.opcounters.insert.rate | DEPENDENT | 0 |
| Operations: query, rate | The number of queries received the mongos instance per second. | mongodb.opcounters.query.rate | DEPENDENT | 0 |
| Operations: update, rate | The number of update operations the mongos instance per second. | mongodb.opcounters.update.rate | DEPENDENT | 0 |
| Ping | Test if a connection is alive or not. | mongodb.ping["{$MONGODB.CONNSTRING}","{$MONGODB.USER}","{$MONGODB.PASSWORD}"] | no type | 30s |
| Get server status | The mongos statistic | mongodb.server.status["{$MONGODB.CONNSTRING}","{$MONGODB.USER}","{$MONGODB.PASSWORD}"] | no type | no delay |
| Uptime | Number of seconds since the Mongos server start. | mongodb.uptime | DEPENDENT | 0 |
| Mongos version | Version of the Mongos server | mongodb.version | DEPENDENT | 0 |


<a name="macros" />

## Macros
| macro | value |
| ------------- |------------- |
| {$MONGODB.CONNS.AVAILABLE.MIN.WARN} | 1000 |
| {$MONGODB.CONNSTRING} | tcp://localhost:27017 |
| {$MONGODB.CURSOR.OPEN.MAX.WARN} | 10000 |
| {$MONGODB.CURSOR.TIMEOUT.MAX.WARN} | 1 |
| {$MONGODB.LLD.FILTER.COLLECTION.MATCHES} | .* |
| {$MONGODB.LLD.FILTER.COLLECTION.NOT_MATCHES} | CHANGE_IF_NEEDED |
| {$MONGODB.LLD.FILTER.DB.MATCHES} | .* |
| {$MONGODB.LLD.FILTER.DB.NOT_MATCHES} | (admin\|config\|local) |
| {$MONGODB.PASSWORD} | no value |
| {$MONGODB.USER} | no value |


<a name="triggers" />

## Triggers
| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Available connections is low | WARNING | Too few available connections.<br>Consider this value in combination with the value of connections current to understand the connection load on the database. | max(/MongoDB cluster by Zabbix agent 2/mongodb.connections.available,5m)<{$MONGODB.CONNS.AVAILABLE.MIN.WARN} | [{"tag": "scope", "value": "capacity"}] | no url |
| Too many cursors opened by MongoDB for clients | WARNING | no description | min(/MongoDB cluster by Zabbix agent 2/mongodb.cursor.open.total,5m)>{$MONGODB.CURSOR.OPEN.MAX.WARN} | [{"tag": "scope", "value": "capacity"}] | no url |
| Too many cursors are timing out | WARNING | no description | min(/MongoDB cluster by Zabbix agent 2/mongodb.cursor.timed_out.rate,5m)>{$MONGODB.CURSOR.TIMEOUT.MAX.WARN} | [{"tag": "scope", "value": "performance"}] | no url |
| Connection to mongos proxy is unavailable | HIGH | Connection to mongos proxy instance is currently unavailable. | last(/MongoDB cluster by Zabbix agent 2/mongodb.ping["{$MONGODB.CONNSTRING}","{$MONGODB.USER}","{$MONGODB.PASSWORD}"])=0 | [{"tag": "scope", "value": "availability"}] | no url |
| Failed to fetch info data | WARNING | Zabbix has not received data for items for the last 10 minutes | nodata(/MongoDB cluster by Zabbix agent 2/mongodb.uptime,10m)=1 | [{"tag": "scope", "value": "notice"}] | no url |
| Mongos server has been restarted | INFO | Uptime is less than 10 minutes. | last(/MongoDB cluster by Zabbix agent 2/mongodb.uptime)<10m | [{"tag": "scope", "value": "notice"}] | no url |
| Version has changed | INFO | MongoDB cluster version has changed. Acknowledge to close the problem manually. | last(/MongoDB cluster by Zabbix agent 2/mongodb.version,#1)<>last(/MongoDB cluster by Zabbix agent 2/mongodb.version,#2) and length(last(/MongoDB cluster by Zabbix agent 2/mongodb.version))>0 | [{"tag": "scope", "value": "notice"}] | no url |


<a name="discoveries" />

## Discoveries
| name | key | description | type | lifetime | delay |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Config servers discovery | mongodb.cfg.discovery["{$MONGODB.CONNSTRING}","{$MONGODB.USER}","{$MONGODB.PASSWORD}"] | Discovery shared cluster config servers. | no type | no lifetime | 30m |
| Collection discovery | mongodb.collections.discovery["{$MONGODB.CONNSTRING}","{$MONGODB.USER}","{$MONGODB.PASSWORD}"] | Collect collections metrics.<br>Note, depending on the number of DBs and collections this discovery operation may be expensive. Use filters with macros {$MONGODB.LLD.FILTER.DB.MATCHES}, {$MONGODB.LLD.FILTER.DB.NOT_MATCHES}, {$MONGODB.LLD.FILTER.COLLECTION.MATCHES}, {$MONGODB.LLD.FILTER.COLLECTION.NOT_MATCHES}. | no type | no lifetime | 30m |
| Database discovery | mongodb.db.discovery["{$MONGODB.CONNSTRING}","{$MONGODB.USER}","{$MONGODB.PASSWORD}"] | Collect database metrics.<br>Note, depending on the number of DBs this discovery operation may be expensive. Use filters with macros {$MONGODB.LLD.FILTER.DB.MATCHES}, {$MONGODB.LLD.FILTER.DB.NOT_MATCHES}. | no type | no lifetime | 30m |
| Shards discovery | mongodb.sh.discovery["{$MONGODB.CONNSTRING}","{$MONGODB.USER}","{$MONGODB.PASSWORD}"] | Discovery shared cluster hosts. | no type | no lifetime | 30m |


<a name="discovery_collection_discovery" />

## Discovery Collection discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| MongoDB {#DBNAME}.{#COLLECTION}: Objects, avg size | The size of the average object in the collection in bytes. | mongodb.collection.avg_obj_size["{#DBNAME}","{#COLLECTION}"] | DEPENDENT |
| MongoDB {#DBNAME}.{#COLLECTION}: Capped | Whether or not the collection is capped. | mongodb.collection.capped["{#DBNAME}","{#COLLECTION}"] | DEPENDENT |
| MongoDB {#DBNAME}.{#COLLECTION}: Objects, count | Total number of objects in the collection. | mongodb.collection.count["{#DBNAME}","{#COLLECTION}"] | DEPENDENT |
| MongoDB {#DBNAME}.{#COLLECTION}: Capped, max number | Maximum number of documents in a capped collection. | mongodb.collection.max["{#DBNAME}","{#COLLECTION}"] | DEPENDENT |
| MongoDB {#DBNAME}.{#COLLECTION}: Capped, max size | Maximum size of a capped collection in bytes. | mongodb.collection.max_size["{#DBNAME}","{#COLLECTION}"] | DEPENDENT |
| MongoDB {#DBNAME}.{#COLLECTION}: Indexes | Total number of indices on the collection. | mongodb.collection.nindexes["{#DBNAME}","{#COLLECTION}"] | DEPENDENT |
| MongoDB {#DBNAME}.{#COLLECTION}: Size | The total size in bytes of the data in the collection plus the size of every indexes on the mongodb.collection. | mongodb.collection.size["{#DBNAME}","{#COLLECTION}"] | DEPENDENT |
| MongoDB {#DBNAME}.{#COLLECTION}: Get collection stats {#DBNAME}.{#COLLECTION} | Returns a variety of storage statistics for a given collection. | mongodb.collection.stats["{$MONGODB.CONNSTRING}","{$MONGODB.USER}","{$MONGODB.PASSWORD}","{#DBNAME}","{#COLLECTION}"] | no type |
| MongoDB {#DBNAME}.{#COLLECTION}: Storage size | Total storage space allocated to this collection for document storage. | mongodb.collection.storage_size["{#DBNAME}","{#COLLECTION}"] | DEPENDENT |


<a name="discovery_database_discovery" />

## Discovery Database discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| MongoDB {#DBNAME}: Size, data | Total size of the data held in this database including the padding factor. | mongodb.db.data_size["{#DBNAME}"] | DEPENDENT |
| MongoDB {#DBNAME}: Extents | Contains a count of the number of extents in the database across all collections. | mongodb.db.extents["{#DBNAME}"] | DEPENDENT |
| MongoDB {#DBNAME}: Size, file | Total size of the data held in this database including the padding factor (only available with the mmapv1 storage engine). | mongodb.db.file_size["{#DBNAME}"] | DEPENDENT |
| MongoDB {#DBNAME}: Size, index | Total size of all indexes created on this database. | mongodb.db.index_size["{#DBNAME}"] | DEPENDENT |
| MongoDB {#DBNAME}: Objects, count | Number of objects (documents) in the database across all collections. | mongodb.db.objects["{#DBNAME}"] | DEPENDENT |
| MongoDB {#DBNAME}: Objects, avg size | The average size of each document in bytes. | mongodb.db.size["{#DBNAME}"] | DEPENDENT |
| MongoDB {#DBNAME}: Get db stats {#DBNAME} | Returns statistics reflecting the database system's state. | mongodb.db.stats["{$MONGODB.CONNSTRING}","{$MONGODB.USER}","{$MONGODB.PASSWORD}","{#DBNAME}"] | no type |
| MongoDB {#DBNAME}: Size, storage | Total amount of space allocated to collections in this database for document storage. | mongodb.db.storage_size["{#DBNAME}"] | DEPENDENT |

