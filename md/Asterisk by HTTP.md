# Asterisk by HTTP template description

The template gets Asterisk metrics from AMI by HTTP agent.
You should enable the mini-HTTP Server, add the option webenabled=yes in the general section of the manager.conf file and create Asterisk Manager user with system and command write permissions within your Asterisk instance.
Disable the PJSIP driver if you do not use PJSIP or do not have PJSIP endpoints.
Please, define AMI address in the {$AMI.URL} macro. Also, set the hostname or IP address of the AMI host in the {$AMI.HOST} macro for Zabbix to check Asterisk service status.
Then you can define {$AMI.USERNAME} and {$AMI.SECRET} macros in the template for using on the host level.
If there are errors, increase the logging to debug level and see the Zabbix server log.

You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback/410060-discussion-thread-for-official-zabbix-template-asterisk

Generated by official Zabbix template tool "Templator"

## Summary
* [items](#items)
* [macros](#macros)
* [triggers](#triggers)
* [discoveries](#discoveries)
  * [Discovery IAX peers discovery ](#discovery_iax_peers_discovery)
  * [Discovery PJSIP endpoints discovery ](#discovery_pjsip_endpoints_discovery)
  * [Discovery Queues discovery ](#discovery_queues_discovery)
  * [Discovery SIP peers discovery ](#discovery_sip_peers_discovery)

<a name="items" />

## Items
| name | description | key | type | delay |
| ------------- |------------- |------------- |------------- |------------- |
| Active calls | The number of active calls at the moment. | asterisk.active_calls | DEPENDENT | 0 |
| Active channels | The number of active channels at the moment. | asterisk.active_channels | DEPENDENT | 0 |
| Calls processed | The number of calls processed after the last service restart. | asterisk.calls_processed | DEPENDENT | 0 |
| Calls processed per second | The number of calls processed per second. | asterisk.calls_processed.rate | DEPENDENT | 0 |
| Get stats | Asterisk system information in JSON format. | asterisk.get_stats | HTTP_AGENT | no delay |
| IAX trunks active channels | The total number of IAX trunks active channels. | asterisk.iax.active_channels | DEPENDENT | 0 |
| IAX offline peers | The number of offline IAX peers. | asterisk.iax.offline | DEPENDENT | 0 |
| IAX online peers | The number of online IAX peers. | asterisk.iax.online | DEPENDENT | 0 |
| IAX peers | The total number of IAX peers. | asterisk.iax.total | DEPENDENT | 0 |
| IAX unmonitored peers | The number of unmonitored IAX peers. | asterisk.iax.unmonitored | DEPENDENT | 0 |
| PJSIP trunks active channels | The total number of PJSIP trunks active channels. | asterisk.pjsip.active_channels | DEPENDENT | 0 |
| PJSIP available endpoints | The number of available PJSIP peers. | asterisk.pjsip.available | DEPENDENT | 0 |
| PJSIP endpoints | The total number of PJSIP peers. | asterisk.pjsip.total | DEPENDENT | 0 |
| PJSIP unavailable endpoints | The number of unavailable PJSIP peers. | asterisk.pjsip.unavailable | DEPENDENT | 0 |
| SIP trunks active channels | The total number of SIP trunks active channels. | asterisk.sip.active_channels | DEPENDENT | 0 |
| SIP monitored offline | The number of monitored offline SIP peers. | asterisk.sip.monitored_offline | DEPENDENT | 0 |
| SIP monitored online | The number of monitored online SIP peers. | asterisk.sip.monitored_online | DEPENDENT | 0 |
| SIP peers | The total number of SIP peers. | asterisk.sip.total | DEPENDENT | 0 |
| SIP unmonitored offline | The number of unmonitored offline SIP peers. | asterisk.sip.unmonitored_offline | DEPENDENT | 0 |
| SIP unmonitored online | The number of unmonitored online SIP peers. | asterisk.sip.unmonitored_online | DEPENDENT | 0 |
| Total queues | The number of configured queues. | asterisk.total_queues | DEPENDENT | 0 |
| Uptime | The system uptime expressed in the following format: "N days, hh:mm:ss". | asterisk.uptime | DEPENDENT | 0 |
| Uptime after reload | System uptime after a config reload in 'N days, hh:mm:ss' format. | asterisk.uptime_reload | DEPENDENT | 0 |
| Version | Service version | asterisk.version | DEPENDENT | 0 |
| Service response time | Asterisk Manager API performance. | net.tcp.service.perf["tcp","{$AMI.HOST}","{$AMI.PORT}"] | SIMPLE | no delay |
| Service status | Asterisk Manager API port availability. | net.tcp.service["tcp","{$AMI.HOST}","{$AMI.PORT}"] | SIMPLE | no delay |


<a name="macros" />

## Macros
| macro | value |
| ------------- |------------- |
| {$AMI.HOST} | <SET AMI HOST> |
| {$AMI.PORT} | 5038 |
| {$AMI.QUEUE_CALLERS.MAX.WARN} | 10 |
| {$AMI.RESPONSE_TIME.MAX.WARN} | 10s |
| {$AMI.SECRET} | zabbix |
| {$AMI.TRUNK_ACTIVE_CHANNELS.MAX.WARN} | 28 |
| {$AMI.TRUNK_ACTIVE_CHANNELS_TOTAL.MAX.WARN:"IAX"} | 28 |
| {$AMI.TRUNK_ACTIVE_CHANNELS_TOTAL.MAX.WARN:"PJSIP"} | 28 |
| {$AMI.TRUNK_ACTIVE_CHANNELS_TOTAL.MAX.WARN:"SIP"} | 28 |
| {$AMI.TRUNK_REGEXP} | trunk |
| {$AMI.URL} | http://asterisk:8088/asterisk/rawman |
| {$AMI.USERNAME} | zabbix |


<a name="triggers" />

## Triggers
| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Total number of active channels of IAX trunks is too high | WARNING | The IAX trunks may not be able to process new calls. | min(/Asterisk by HTTP/asterisk.iax.active_channels,10m)>={$AMI.TRUNK_ACTIVE_CHANNELS_TOTAL.MAX.WARN:"IAX"} | [{"tag": "scope", "value": "performance"}] | no url |
| Total number of active channels of PJSIP trunks is too high | WARNING | The PJSIP trunks may not be able to process new calls. | min(/Asterisk by HTTP/asterisk.pjsip.active_channels,10m)>={$AMI.TRUNK_ACTIVE_CHANNELS_TOTAL.MAX.WARN:"PJSIP"} | [{"tag": "scope", "value": "performance"}] | no url |
| Total number of active channels of SIP trunks is too high | WARNING | The SIP trunks may not be able to process new calls. | min(/Asterisk by HTTP/asterisk.sip.active_channels,10m)>={$AMI.TRUNK_ACTIVE_CHANNELS_TOTAL.MAX.WARN:"SIP"} | [{"tag": "scope", "value": "performance"}] | no url |
| Failed to fetch AMI page | WARNING | Zabbix has not received any data for items for the last 30 minutes. | nodata(/Asterisk by HTTP/asterisk.uptime,30m)=1 | [{"tag": "scope", "value": "availability"}] | no url |
| Host has been restarted | INFO | Uptime is less than 10 minutes. | last(/Asterisk by HTTP/asterisk.uptime)<10m | [{"tag": "scope", "value": "notice"}] | no url |
| has been reloaded | INFO | Uptime is less than 10 minutes. | last(/Asterisk by HTTP/asterisk.uptime_reload)<10m | [{"tag": "scope", "value": "notice"}] | no url |
| Version has changed | INFO | The Asterisk version has changed. Acknowledge to close the problem manually. | last(/Asterisk by HTTP/asterisk.version,#1)<>last(/Asterisk by HTTP/asterisk.version,#2) and length(last(/Asterisk by HTTP/asterisk.version))>0 | [{"tag": "scope", "value": "notice"}] | no url |
| Service response time is too high | WARNING | no description | min(/Asterisk by HTTP/net.tcp.service.perf["tcp","{$AMI.HOST}","{$AMI.PORT}"],5m)>{$AMI.RESPONSE_TIME.MAX.WARN} | [{"tag": "scope", "value": "performance"}] | no url |
| Service is down | AVERAGE | no description | last(/Asterisk by HTTP/net.tcp.service["tcp","{$AMI.HOST}","{$AMI.PORT}"])=0 | [{"tag": "scope", "value": "availability"}] | no url |


<a name="discoveries" />

## Discoveries
| name | key | description | type | lifetime | delay |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| IAX peers discovery | asterisk.iax_peers.discovery | no description | DEPENDENT | no lifetime | 0 |
| PJSIP endpoints discovery | asterisk.pjsip_endpoints.discovery | no description | DEPENDENT | no lifetime | 0 |
| Queues discovery | asterisk.queues.discovery | no description | DEPENDENT | no lifetime | 0 |
| SIP peers discovery | asterisk.sip_peers.discovery | no description | DEPENDENT | no lifetime | 0 |


<a name="discovery_iax_peers_discovery" />

## Discovery IAX peers discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| IAX trunk "{#OBJECTNAME}": Active channels | The total number of active IAX trunk channels. | asterisk.iax.trunk.active_channels[{#OBJECTNAME}] | DEPENDENT |
| IAX trunk "{#OBJECTNAME}": Get IAX trunk | Raw data for an IAX trunk. | asterisk.iax.trunk.get[{#OBJECTNAME}] | DEPENDENT |
| IAX trunk "{#OBJECTNAME}": Status | IAX trunk status. Here are the possible states that a device state may have:<br>Unmonitored<br>UNKNOWN<br>UNREACHABLE<br>OK | asterisk.iax.trunk.status[{#OBJECTNAME}] | DEPENDENT |


### Triggers

| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| IAX trunk "{#OBJECTNAME}": Number of the IAX trunk "{#OBJECTNAME}" active channels is too high | WARNING | The IAX trunk may not be able to process new calls. | min(/Asterisk by HTTP/asterisk.iax.trunk.active_channels[{#OBJECTNAME}],10m)>={$AMI.TRUNK_ACTIVE_CHANNELS.MAX.WARN:"{#OBJECTNAME}"} | [{"tag": "scope", "value": "performance"}] | no url |
| IAX trunk "{#OBJECTNAME}": IAX trunk {#OBJECTNAME} has a state {ITEM.VALUE} | AVERAGE | The IAX trunk is unable to establish a connection with a neighbor due to network issues or incorrect configuration. | last(/Asterisk by HTTP/asterisk.iax.trunk.status[{#OBJECTNAME}])="UNKNOWN" or last(/Asterisk by HTTP/asterisk.iax.trunk.status[{#OBJECTNAME}])="UNREACHABLE" | [{"tag": "scope", "value": "availability"}] | no url |


<a name="discovery_pjsip_endpoints_discovery" />

## Discovery PJSIP endpoints discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| PJSIP trunk "{#OBJECTNAME}": Active channels | The total number of active PJSIP trunk channels. | asterisk.pjsip.trunk.active_channels[{#OBJECTNAME}] | DEPENDENT |
| PJSIP trunk "{#OBJECTNAME}": Device state | PJSIP trunk status. Here are the possible states that a device state may have:<br>Unavailable<br>Not in use<br>In use | asterisk.pjsip.trunk.devicestate[{#OBJECTNAME}] | DEPENDENT |
| PJSIP trunk "{#OBJECTNAME}": Get PJSIP trunk | Raw data for a PJSIP trunk. | asterisk.pjsip.trunk.get[{#OBJECTNAME}] | DEPENDENT |


### Triggers

| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| PJSIP trunk "{#OBJECTNAME}": Number of the PJSIP trunk "{#OBJECTNAME}" active channels is too high | WARNING | The PJSIP trunk may not be able to process new calls. | min(/Asterisk by HTTP/asterisk.pjsip.trunk.active_channels[{#OBJECTNAME}],10m)>={$AMI.TRUNK_ACTIVE_CHANNELS.MAX.WARN:"{#OBJECTNAME}"} | [{"tag": "scope", "value": "performance"}] | no url |
| PJSIP trunk "{#OBJECTNAME}": PJSIP trunk {#OBJECTNAME} has a state Unavailable | AVERAGE | The PJSIP trunk is unable to establish a connection with a neighbor due to network issues or incorrect configuration. | last(/Asterisk by HTTP/asterisk.pjsip.trunk.devicestate[{#OBJECTNAME}])="Unavailable" | [{"tag": "scope", "value": "availability"}] | no url |


<a name="discovery_queues_discovery" />

## Discovery Queues discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| "{#QUEUE}": Available | The number of available queue members. | asterisk.queue.available[{#QUEUE}] | DEPENDENT |
| "{#QUEUE}": Callers | The number incoming calls in queue. | asterisk.queue.callers[{#QUEUE}] | DEPENDENT |
| "{#QUEUE}": Get queue | Raw data for a queue. | asterisk.queue.get[{#QUEUE}] | DEPENDENT |
| "{#QUEUE}": Logged in | The number of queue members. | asterisk.queue.loggedin[{#QUEUE}] | DEPENDENT |


### Triggers

| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| "{#QUEUE}": Number of callers in the queue "{#QUEUE}" is too high | WARNING | There is a large number of calls in the queue. | min(/Asterisk by HTTP/asterisk.queue.callers[{#QUEUE}],10m)>{$AMI.QUEUE_CALLERS.MAX.WARN:"{#QUEUE}"} | [{"tag": "scope", "value": "performance"}] | no url |


<a name="discovery_sip_peers_discovery" />

## Discovery SIP peers discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| SIP trunk "{#OBJECTNAME}": Active channels | The total number of active SIP trunk channels. | asterisk.sip.trunk.active_channels[{#OBJECTNAME}] | DEPENDENT |
| SIP trunk "{#OBJECTNAME}": Get SIP trunk | Raw data for a SIP trunk. | asterisk.sip.trunk.get[{#OBJECTNAME}] | DEPENDENT |
| SIP trunk "{#OBJECTNAME}": Status | SIP trunk status. Here are the possible states that a device state may have:<br>Unmonitored<br>UNKNOWN<br>UNREACHABLE<br>OK | asterisk.sip.trunk.status[{#OBJECTNAME}] | DEPENDENT |


### Triggers

| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| SIP trunk "{#OBJECTNAME}": Number of the SIP trunk "{#OBJECTNAME}" active channels is too high | WARNING | The SIP trunk may not be able to process new calls. | min(/Asterisk by HTTP/asterisk.sip.trunk.active_channels[{#OBJECTNAME}],10m)>={$AMI.TRUNK_ACTIVE_CHANNELS.MAX.WARN:"{#OBJECTNAME}"} | [{"tag": "scope", "value": "performance"}] | no url |
| SIP trunk "{#OBJECTNAME}": SIP trunk {#OBJECTNAME} has a state {ITEM.VALUE} | AVERAGE | The SIP trunk is unable to establish a connection with a neighbor due to network issues or incorrect configuration. | last(/Asterisk by HTTP/asterisk.sip.trunk.status[{#OBJECTNAME}])="UNKNOWN" or last(/Asterisk by HTTP/asterisk.sip.trunk.status[{#OBJECTNAME}])="UNREACHABLE" | [{"tag": "scope", "value": "availability"}] | no url |

