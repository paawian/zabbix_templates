# Azure Cosmos DB for MongoDB by HTTP template description

This template is designed to monitor Microsoft Azure Cosmos DB for MongoDB by HTTP.
It works without any external scripts and uses the script item.

Setup:
  1. Create an Azure service principal via the Azure command-line interface (Azure CLI) for your subscription.
    `az ad sp create-for-rbac --name zabbix --role reader --scope /subscriptions/<subscription_id>`
    See https://docs.microsoft.com/en-us/cli/azure/create-an-azure-service-principal-azure-cli for more details.
  2. Link the template to a host.
  3. Configure the macros: {$AZURE.APP.ID}, {$AZURE.PASSWORD}, {$AZURE.TENANT.ID}, {$AZURE.SUBSCRIPTION.ID}, and {$AZURE.RESOURCE.ID}.

You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback/

Generated by official Zabbix template tool "Templator"

## Summary
* [items](#items)
* [macros](#macros)
* [triggers](#triggers)

<a name="items"></a>

## Items
| name | description | key | type | delay |
| ------------- |------------- |------------- |------------- |------------- |
| Autoscale max throughput | The autoscale max throughput. | azure.cosmosdb.autoscale.max.throughput | DEPENDENT | 0 |
| Get errors | A list of errors from API requests. | azure.cosmosdb.data.errors | DEPENDENT | 0 |
| Get data | The result of API requests is expressed in the JSON. | azure.cosmosdb.data.get | SCRIPT | no delay |
| Data usage | The total data usage. | azure.cosmosdb.data.usage | DEPENDENT | 0 |
| Document count | The total document count. | azure.cosmosdb.document.count | DEPENDENT | 0 |
| Document quota | The total storage quota. | azure.cosmosdb.document.quota | DEPENDENT | 0 |
| Index usage | The total index usage. | azure.cosmosdb.index.usage | DEPENDENT | 0 |
| Metadata requests | The count of metadata requests.<br>Cosmos DB maintains system metadata collection for each account, which allows you to enumerate collections, databases, etc., and their configurations, free of charge. | azure.cosmosdb.metadata.requests | DEPENDENT | 0 |
| Mongo requests | The number of Mongo requests made. | azure.cosmosdb.mongo.requests | DEPENDENT | 0 |
| Mongo request charge | The Mongo request units consumed. | azure.cosmosdb.mongo.requests.charge | DEPENDENT | 0 |
| Normalized RU consumption | The max RU consumption percentage per minute. | azure.cosmosdb.normalized.ru.consumption | DEPENDENT | 0 |
| Physical partition size | The physical partition size in bytes. | azure.cosmosdb.physical.partition.size | DEPENDENT | 0 |
| Physical partition throughput | The physical partition throughput. | azure.cosmosdb.physical.partition.throughput | DEPENDENT | 0 |
| Provisioned throughput | The provisioned throughput. | azure.cosmosdb.provisioned.throughput | DEPENDENT | 0 |
| Replication latency, P99 | The P99 replication latency across source and target regions for geo-enabled account. | azure.cosmosdb.replication.latency | DEPENDENT | 0 |
| Server side latency | The server side latency. | azure.cosmosdb.server.side.latency | DEPENDENT | 0 |
| Server side latency, direct | The server side latency in direct connection mode. | azure.cosmosdb.server.side.latency.direct | DEPENDENT | 0 |
| Server side latency, gateway | The server side latency in gateway connection mode. | azure.cosmosdb.server.side.latency.gateway | DEPENDENT | 0 |
| Service availability | The account requests availability at one hour granularity. | azure.cosmosdb.service.availability | DEPENDENT | 0 |
| Total request units | The request units consumed per minute. | azure.cosmosdb.total.request.units | DEPENDENT | 0 |
| Total requests | Number of requests per minute. | azure.cosmosdb.total.requests | DEPENDENT | 0 |


<a name="macros"></a>

## Macros
| macro | value |
| ------------- |------------- |
| {$AZURE.APP.ID} | no value |
| {$AZURE.DATA.TIMEOUT} | 15s |
| {$AZURE.DB.COSMOS.MONGO.AVAILABILITY} | 70 |
| {$AZURE.PASSWORD} | no value |
| {$AZURE.PROXY} | no value |
| {$AZURE.RESOURCE.ID} | no value |
| {$AZURE.SUBSCRIPTION.ID} | no value |
| {$AZURE.TENANT.ID} | no value |


<a name="triggers"></a>

## Triggers
| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| There are errors in requests to API | AVERAGE | Zabbix has received errors in response to API requests. | length(last(/Azure Cosmos DB for MongoDB by HTTP/azure.cosmosdb.data.errors))>0 | [{"tag": "scope", "value": "availability"}] | no url |
| Cosmos DB for MongoDB account: Availability is low | WARNING | no description | (min(/Azure Cosmos DB for MongoDB by HTTP/azure.cosmosdb.service.availability,#3))<{$AZURE.DB.COSMOS.MONGO.AVAILABILITY} | [{"tag": "scope", "value": "availability"}] | no url |

