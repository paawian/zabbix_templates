# Nextcloud by HTTP template description

This template is designed for monitoring Nextcloud by HTTP via Zabbix, and it works without any external scripts.
  Nextcloud is a suite of client-server software for creating and using file hosting services.
  For more information, see the [`official documentation`](https://docs.nextcloud.com/server/latest/developer_manual/client_apis/OCS/ocs-api-overview.html#)

Generated by official Zabbix template tool "Templator"

## Summary
* [items](#items)
* [macros](#macros)
* [triggers](#triggers)
* [discoveries](#discoveries)
  * [Discovery Nextcloud: User discovery ](#discovery_nextcloud:_user_discovery)

<a name="items"></a>

## Items
| name | description | key | type | delay |
| ------------- |------------- |------------- |------------- |------------- |
| Active users, last 1 hour | The number of active users in the last 1 hour. | nextcloud.serverinfo.active_users.last1h | DEPENDENT | 0 |
| Active users, last 5 minutes | The number of active users in the last 5 minutes. | nextcloud.serverinfo.active_users.last5m | DEPENDENT | 0 |
| Active users, last 24 hours | The number of active users in the last day. | nextcloud.serverinfo.active_users.last24hours | DEPENDENT | 0 |
| Apps installed | The number of installed applications. | nextcloud.serverinfo.apps.installed | DEPENDENT | 0 |
| Apps update available | The number of applications for which an update is available. | nextcloud.serverinfo.apps.update | DEPENDENT | 0 |
| Web server | Web server description. | nextcloud.serverinfo.apps.webserver | DEPENDENT | 0 |
| CPU load, avg 1m | The average system load (the number of processes in the system run queue), last 1 minute. | nextcloud.serverinfo.cpu.avg.1m | DEPENDENT | 0 |
| CPU load, avg 5m | The average system load (the number of processes in the system run queue), last 5 minutes. | nextcloud.serverinfo.cpu.avg.5m | DEPENDENT | 0 |
| CPU load, avg 15m | The average system load (the number of processes in the system run queue), last 15 minutes. | nextcloud.serverinfo.cpu.avg.15m | DEPENDENT | 0 |
| Database size | Size of database. | nextcloud.serverinfo.db.size | DEPENDENT | 0 |
| Database type | Database type. | nextcloud.serverinfo.db.type | DEPENDENT | 0 |
| Database version | Database description. | nextcloud.serverinfo.db.version | DEPENDENT | 0 |
| Free space | The amount of free disk space. | nextcloud.serverinfo.freespace | DEPENDENT | 0 |
| Get server information | This item provides useful server information, such as CPU load, RAM usage, disk usage, number of users, etc.<br>https://github.com/nextcloud/serverinfo | nextcloud.serverinfo.get_data | HTTP_AGENT | no delay |
| Memory free | The amount of free RAM. | nextcloud.serverinfo.mem.free | DEPENDENT | 0 |
| Memory used, in % | RAM usage, in percent. | nextcloud.serverinfo.mem.pused | DEPENDENT | 0 |
| Memory total | The size of the RAM. | nextcloud.serverinfo.mem.total | DEPENDENT | 0 |
| PHP maximum execution time | By default, the maximum execution time for PHP scripts is set to 30 seconds. If a script runs for longer than 30 seconds, PHP stops the script and reports an error. You can control the amount of time PHP allows scripts to run by changing the 'max_execution_time' directive in your php.ini file. | nextcloud.serverinfo.php.max_execution_time | DEPENDENT | 0 |
| PHP memory free | PHP free memory size. | nextcloud.serverinfo.php.memory.free | DEPENDENT | 0 |
| PHP memory limit | By default, the PHP memory limit is generally set to 128 MB, but it can be customized based on the application's specific needs. The php.ini file is usually the standard location to set the PHP memory limit. | nextcloud.serverinfo.php.memory.limit | DEPENDENT | 0 |
| PHP memory used, in % | PHP memory used percentage | nextcloud.serverinfo.php.memory.pused | DEPENDENT | 0 |
| PHP memory used | PHP memory used | nextcloud.serverinfo.php.memory.used | DEPENDENT | 0 |
| PHP memory wasted | Memory allocated to the service but not in use. | nextcloud.serverinfo.php.memory.wasted | DEPENDENT | 0 |
| PHP memory wasted, in % | Memory allocated to the service but not in use, in percent. | nextcloud.serverinfo.php.memory.wasted_percentage | DEPENDENT | 0 |
| PHP maximum upload file size | By default, the maximum upload file size for PHP scripts is set to 128 megabytes. However, you may want to change this limit. For example, you can set a lower limit to prevent users from uploading large files to your site. To do this, change the 'upload_max_filesize' and 'post_max_size' directives. | nextcloud.serverinfo.php.upload_max_filesize | DEPENDENT | 0 |
| PHP version | PHP version | nextcloud.serverinfo.php.version | DEPENDENT | 0 |
| Server information status | Server information API status | nextcloud.serverinfo.status | DEPENDENT | 0 |
| Swap free | The amount of free swap. | nextcloud.serverinfo.swap.free | DEPENDENT | 0 |
| Swap used, in % | Swap usage, in percent. | nextcloud.serverinfo.swap.pused | DEPENDENT | 0 |
| Swap total | The size of the swap memory. | nextcloud.serverinfo.swap.total | DEPENDENT | 0 |
| Version | Nextcloud service version. | nextcloud.serverinfo.version | DEPENDENT | 0 |


<a name="macros"></a>

## Macros
| macro | value |
| ------------- |------------- |
| {$NEXTCLOUD.ADDRESS} | 127.0.0.1 |
| {$NEXTCLOUD.CPU.LOAD.MAX} | 95 |
| {$NEXTCLOUD.LLD.FILTER.USER.MATCHES} | .* |
| {$NEXTCLOUD.LLD.FILTER.USER.NOT_MATCHES} | CHANGE_IF_NEEDED |
| {$NEXTCLOUD.MEM.PUSED.MAX} | 90 |
| {$NEXTCLOUD.PHP.MEM.PUSED.MAX} | 90 |
| {$NEXTCLOUD.PROXY} | no value |
| {$NEXTCLOUD.SCHEMA} | https |
| {$NEXTCLOUD.STORAGE.FREE.MIN} | 1G |
| {$NEXTCLOUD.SWAP.PUSED.MAX} | 90 |
| {$NEXTCLOUD.USER.MAX.INACTIVE} | 30 |
| {$NEXTCLOUD.USER.NAME} | root |
| {$NEXTCLOUD.USER.PASSWORD} | no value |
| {$NEXTCLOUD.USER.QUOTA.PUSED.MAX} | 90 |


<a name="triggers"></a>

## Triggers
| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Number of installed apps has been changed | INFO | Applications have been installed or removed. | change(/Nextcloud by HTTP/nextcloud.serverinfo.apps.installed)<>0 | [{"tag": "scope", "value": "notice"}] | no url |
| Application updates are available | WARNING | Updates are available for some of the installed applications. | last(/Nextcloud by HTTP/nextcloud.serverinfo.apps.update)<>0 | [{"tag": "scope", "value": "notice"}] | no url |
| CPU load is too high | AVERAGE | High CPU load. | min(/Nextcloud by HTTP/nextcloud.serverinfo.cpu.avg.1m,5m) > {$NEXTCLOUD.CPU.LOAD.MAX} | [{"tag": "scope", "value": "performance"}] | no url |
| Database version has changed | INFO | The Database version has changed. Acknowledge to close the problem manually. | change(/Nextcloud by HTTP/nextcloud.serverinfo.db.version)=1 and length(last(/Nextcloud by HTTP/nextcloud.serverinfo.db.version))>0 | [{"tag": "scope", "value": "notice"}] | no url |
| Disk space is low | AVERAGE | Condition should be the following:<br>- the disk free space is less than `{$NEXTCLOUD.STORAGE.FREE.MIN}`; | last(/Nextcloud by HTTP/nextcloud.serverinfo.freespace)<{$NEXTCLOUD.STORAGE.FREE.MIN} | [{"tag": "scope", "value": "availability"}, {"tag": "scope", "value": "capacity"}] | no url |
| High memory utilization | AVERAGE | The system is running out of free memory. | min(/Nextcloud by HTTP/nextcloud.serverinfo.mem.pused,5m) > {$NEXTCLOUD.MEM.PUSED.MAX} | [{"tag": "scope", "value": "performance"}] | no url |
| High PHP memory utilization | AVERAGE | The PHP is running out of free memory. | min(/Nextcloud by HTTP/nextcloud.serverinfo.php.memory.pused,5m) > {$NEXTCLOUD.PHP.MEM.PUSED.MAX} | [{"tag": "scope", "value": "performance"}] | no url |
| PHP version has changed | INFO | The PHP version has changed. Acknowledge to close the problem manually. | change(/Nextcloud by HTTP/nextcloud.serverinfo.php.version)=1 and length(last(/Nextcloud by HTTP/nextcloud.serverinfo.php.version))>0 | [{"tag": "scope", "value": "notice"}] | no url |
| Server information unavailable | HIGH | Failed to get server information. | last(/Nextcloud by HTTP/nextcloud.serverinfo.status)<>"OK" | [{"tag": "scope", "value": "availability"}] | no url |
| High swap utilization | AVERAGE | The system is running out of free swap. | min(/Nextcloud by HTTP/nextcloud.serverinfo.swap.pused,5m) > {$NEXTCLOUD.SWAP.PUSED.MAX} | [{"tag": "scope", "value": "performance"}] | no url |
| Version has changed | INFO | Nextcloud version has changed. Acknowledge to close the problem manually. | change(/Nextcloud by HTTP/nextcloud.serverinfo.version)=1 and length(last(/Nextcloud by HTTP/nextcloud.serverinfo.version))>0 | [{"tag": "scope", "value": "notice"}] | no url |


<a name="discoveries"></a>

## Discoveries
| name | key | description | type | lifetime | delay |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Nextcloud: User discovery | nextcloud.user.discovery | User discovery. | HTTP_AGENT | 1d | 1h |


<a name="discovery_nextcloud:_user_discovery" />

## Discovery Nextcloud: User discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| User "{#NEXTCLOUD.USER}": Display name | User visible name. | nextcloud.user.displayname[{#NEXTCLOUD.USER}] | DEPENDENT |
| User "{#NEXTCLOUD.USER}": Status | User account status. | nextcloud.user.enabled[{#NEXTCLOUD.USER}] | DEPENDENT |
| User "{#NEXTCLOUD.USER}": Get data | Get common information about user | nextcloud.user.get_data[{#NEXTCLOUD.USER}] | HTTP_AGENT |
| User "{#NEXTCLOUD.USER}": Last login, days ago | The number of days since the user has last logged in. | nextcloud.user.inactive[{#NEXTCLOUD.USER}] | DEPENDENT |
| User "{#NEXTCLOUD.USER}": Language | User language. | nextcloud.user.language[{#NEXTCLOUD.USER}] | DEPENDENT |
| User "{#NEXTCLOUD.USER}": Last login | The time the user has last logged in. | nextcloud.user.lastLogin[{#NEXTCLOUD.USER}] | DEPENDENT |
| User "{#NEXTCLOUD.USER}": Quota free space | The size of the free available space in the user's storage. | nextcloud.user.quota.free[{#NEXTCLOUD.USER}] | DEPENDENT |
| User "{#NEXTCLOUD.USER}": Quota used space, in % | Usage of the allocated storage space, in percent. | nextcloud.user.quota.pused[{#NEXTCLOUD.USER}] | DEPENDENT |
| User "{#NEXTCLOUD.USER}": Quota total space | The size of space available in the user's storage. | nextcloud.user.quota.total[{#NEXTCLOUD.USER}] | DEPENDENT |
| User "{#NEXTCLOUD.USER}": Quota used space | The size of the used available space in the user storage. | nextcloud.user.quota.used[{#NEXTCLOUD.USER}] | DEPENDENT |
| User "{#NEXTCLOUD.USER}": Quota | The size of space available in the user's storage. | nextcloud.user.quota[{#NEXTCLOUD.USER}] | DEPENDENT |
| User "{#NEXTCLOUD.USER}": Storage location | The location of the user's store. | nextcloud.user.storageLocation[{#NEXTCLOUD.USER}] | DEPENDENT |


### Triggers

| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| User "{#NEXTCLOUD.USER}" status changed | INFO | User account status has changed. | change(/Nextcloud by HTTP/nextcloud.user.enabled[{#NEXTCLOUD.USER}]) = 1 | [{"tag": "scope", "value": "notice"}] | no url |
| User "{#NEXTCLOUD.USER}": inactive | INFO | The user has not logged in for more than {$NEXTCLOUD.USER.MAX.INACTIVE:"{#NEXTCLOUD.USER}"} days. | last(/Nextcloud by HTTP/nextcloud.user.inactive[{#NEXTCLOUD.USER}]) > {$NEXTCLOUD.USER.MAX.INACTIVE:"{#NEXTCLOUD.USER}"} | [{"tag": "scope", "value": "notice"}] | no url |
| User "{#NEXTCLOUD.USER}": High quota utilization | WARNING | More than {$NEXTCLOUD.USER.QUOTA.PUSED.MAX:"{#NEXTCLOUD.USER}"} percent of the allocated storage space has been used. | min(/Nextcloud by HTTP/nextcloud.user.quota.pused[{#NEXTCLOUD.USER}],5m) > {$NEXTCLOUD.USER.QUOTA.PUSED.MAX:"{#NEXTCLOUD.USER}"} | [{"tag": "scope", "value": "capacity"}] | no url |

