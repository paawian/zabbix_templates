# GCP Cloud SQL MSSQL by HTTP template description

Get GCP Cloud SQL MSSQL instances monitoring with script item usage to perform HTTP requests to Google Cloud Platform Monitoring API.
This template will be automatically connected to discovered entities with all their required parameters pre-defined.

You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback.


Generated by official Zabbix template tool "Templator"

## Summary
* [items](#items)
* [macros](#macros)
* [triggers](#triggers)
* [discoveries](#discoveries)
  * [Discovery Databases discovery ](#discovery_databases_discovery)
  * [Discovery Resources discovery ](#discovery_resources_discovery)
  * [Discovery Schedulers discovery ](#discovery_schedulers_discovery)

<a name="items" />

## Items
| name | description | key | type | delay |
| ------------- |------------- |------------- |------------- |------------- |
| Audits size | Tracks the size in bytes of stored SQLServer audit files on an instance.<br>Empty value if there are no audits enabled. | gcp.cloudsql.mssql.audits_size | DEPENDENT | 0 |
| Audits successfully uploaded | Tracks the size in bytes of stored SQLServer audit files on an instance.<br>Empty value if there are no audits enabled. | gcp.cloudsql.mssql.audits_upload_count | DEPENDENT | 0 |
| Connection resets | Total number of login operations started from the connection pool since the last restart of SQL Server service. | gcp.cloudsql.mssql.conn.connection_reset_count | DEPENDENT | 0 |
| Login attempts | Total number of login attempts since the last restart of SQL Server service.<br>This does not include pooled connections. | gcp.cloudsql.mssql.conn.login_attempt_count | DEPENDENT | 0 |
| Logouts | Total number of logout operations since the last restart of SQL Server service. | gcp.cloudsql.mssql.conn.logout_count | DEPENDENT | 0 |
| Processes blocked | Current number of blocked processes. | gcp.cloudsql.mssql.conn.processes_blocked | DEPENDENT | 0 |
| Reserved CPU cores | Number of cores reserved for the database. | gcp.cloudsql.mssql.cpu.reserved_cores | DEPENDENT | 0 |
| CPU usage time | Cumulative CPU usage time in seconds. | gcp.cloudsql.mssql.cpu.usage_time | DEPENDENT | 0 |
| CPU utilization | Current CPU utilization represented as a percentage of the reserved CPU that is currently in use. | gcp.cloudsql.mssql.cpu.utilization | DEPENDENT | 0 |
| Databases get | MSSQL databases data in raw format. | gcp.cloudsql.mssql.db.get | SCRIPT | {$GCP.TIME.WINDOW} |
| DB engine state | GCP Cloud SQL MSSQL DB Engine State. | gcp.cloudsql.mssql.db.state | HTTP_AGENT | no delay |
| Disk bytes used | Data utilization in bytes. | gcp.cloudsql.mssql.disk.bytes_used | DEPENDENT | 0 |
| Disk size | Maximum data disk size in bytes. | gcp.cloudsql.mssql.disk.quota | DEPENDENT | 0 |
| Disk read I/O | Delta count of data disk read I/O operations. | gcp.cloudsql.mssql.disk.read_ops_count | DEPENDENT | 0 |
| Disk utilization | The fraction of the disk quota that is currently in use. <br>Shown as percentage. | gcp.cloudsql.mssql.disk.utilization | DEPENDENT | 0 |
| Disk write I/O | Delta count of data disk write I/O operations. | gcp.cloudsql.mssql.disk.write_ops_count | DEPENDENT | 0 |
| Instance state | GCP Cloud SQL MSSQL Current instance state. | gcp.cloudsql.mssql.inst.state | HTTP_AGENT | no delay |
| Buffer cache hit ratio | Current percentage of pages found in the buffer cache without having to read from disk.<br>The ratio is the total number of cache hits divided by the total number of cache lookups. | gcp.cloudsql.mssql.memory.buffer_cache_hit_ratio | DEPENDENT | 0 |
| Checkpoint pages | Total number of pages flushed to disk by a checkpoint or other operation that requires all dirty pages to be flushed. | gcp.cloudsql.mssql.memory.checkpoint_page_count | DEPENDENT | 0 |
| Free list stalls | Total number of requests that had to wait for a free page. | gcp.cloudsql.mssql.memory.free_list_stall_count | DEPENDENT | 0 |
| Lazy writes | Total number of buffers written by the buffer manager's lazy writer.<br>The lazy writer is a system process that flushes out batches of dirty, aged buffers<br>(buffers that contain changes that must be written back to disk before the buffer can be reused for a different page)<br>and makes them available to user processes. | gcp.cloudsql.mssql.memory.lazy_write_count | DEPENDENT | 0 |
| Memory grants pending | Current number of processes waiting for a workspace memory grant. | gcp.cloudsql.mssql.memory.memory_grants_pending | DEPENDENT | 0 |
| Page life expectancy | Current number of seconds a page will stay in the buffer pool without references. | gcp.cloudsql.mssql.memory.page_life_expectancy | DEPENDENT | 0 |
| Read page operations | Total number of physical database page reads.<br>This metric counts physical page reads across all databases. | gcp.cloudsql.mssql.memory.page_ops.read | DEPENDENT | 0 |
| Write age operations | Total number of physical database page writes.<br>This metric counts physical page writes across all databases. | gcp.cloudsql.mssql.memory.page_ops.write | DEPENDENT | 0 |
| Memory size | Maximum RAM size in bytes. | gcp.cloudsql.mssql.memory.quota | DEPENDENT | 0 |
| Memory used by DB engine | Total RAM usage in bytes. <br>This metric reports the RAM usage of the database process, including the buffer/cache. | gcp.cloudsql.mssql.memory.total_usage | DEPENDENT | 0 |
| Memory usage | The RAM usage in bytes. <br>This metric reports the RAM usage of the server, excluding the buffer/cache. | gcp.cloudsql.mssql.memory.usage | DEPENDENT | 0 |
| Memory utilization | The fraction of the memory quota that is currently in use.<br>Shown as percentage. | gcp.cloudsql.mssql.memory.utilization | DEPENDENT | 0 |
| Metrics get | MSSQL metrics data in raw format. | gcp.cloudsql.mssql.metrics.get | SCRIPT | {$GCP.TIME.WINDOW} |
| Connections | Number of connections to the databases on the Cloud SQL instance. | gcp.cloudsql.mssql.network.connections | DEPENDENT | 0 |
| Network: Received bytes | Delta count of bytes received through the network. | gcp.cloudsql.mssql.network.received_bytes_count | DEPENDENT | 0 |
| Network: Sent bytes | Delta count of bytes sent through the network. | gcp.cloudsql.mssql.network.sent_bytes_count | DEPENDENT | 0 |
| Resources get | MSSQL resources data in raw format. | gcp.cloudsql.mssql.resources.get | SCRIPT | {$GCP.TIME.WINDOW} |
| Schedulers get | MSSQL schedulers data in raw format. | gcp.cloudsql.mssql.schedulers.get | SCRIPT | {$GCP.TIME.WINDOW} |
| Batch requests | Total number of Transact-SQL command batches received. | gcp.cloudsql.mssql.trans.batch_request_count | DEPENDENT | 0 |
| Forwarded records | Total number of records fetched through forwarded record pointers. | gcp.cloudsql.mssql.trans.forwarded_record_count | DEPENDENT | 0 |
| Full scans | Total number of unrestricted full scans.<br>These can be either base-table or full-index scans. | gcp.cloudsql.mssql.trans.full_scan_count | DEPENDENT | 0 |
| Page splits | Total number of page splits that occur as the result of overflowing index pages. | gcp.cloudsql.mssql.trans.page_split_count | DEPENDENT | 0 |
| Probe scans | Total number of probe scans that are used to find at least one single qualified row in an index or base table directly. | gcp.cloudsql.mssql.trans.probe_scan_count | DEPENDENT | 0 |
| SQL compilations | Total number of SQL compilations. | gcp.cloudsql.mssql.trans.sql_compilation_count | DEPENDENT | 0 |
| SQL recompilations | Total number of SQL recompilations. | gcp.cloudsql.mssql.trans.sql_recompilation_count | DEPENDENT | 0 |


<a name="macros" />

## Macros
| macro | value |
| ------------- |------------- |
| {$CLOUD_SQL.MSSQL.CPU.UTIL.MAX} | 95 |
| {$CLOUD_SQL.MSSQL.DB.NAME.MATCHES} | .* |
| {$CLOUD_SQL.MSSQL.DB.NAME.NOT_MATCHES} | CHANGE_IF_NEEDED |
| {$CLOUD_SQL.MSSQL.DISK.UTIL.CRIT} | 90 |
| {$CLOUD_SQL.MSSQL.DISK.UTIL.WARN} | 80 |
| {$CLOUD_SQL.MSSQL.RAM.UTIL.MAX} | 90 |
| {$CLOUD_SQL.MSSQL.RES.NAME.MATCHES} | .* |
| {$CLOUD_SQL.MSSQL.RES.NAME.NOT_MATCHES} | CHANGE_IF_NEEDED |
| {$CLOUD_SQL.MSSQL.SCHEDULER.ID.MATCHES} | .* |
| {$CLOUD_SQL.MSSQL.SCHEDULER.ID.NOT_MATCHES} | CHANGE_IF_NEEDED |
| {$GCP.DATA.TIMEOUT} | 15s |
| {$GCP.PROXY} | no value |
| {$GCP.TIME.WINDOW} | 5m |


<a name="triggers" />

## Triggers
| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| High CPU utilization | AVERAGE | The CPU utilization is too high. The system might be slow to respond. | min(/GCP Cloud SQL MSSQL by HTTP/gcp.cloudsql.mssql.cpu.utilization,5m) >= {$CLOUD_SQL.MSSQL.CPU.UTIL.MAX} | [{"tag": "scope", "value": "performance"}] | no url |
| Database engine is down | AVERAGE | Database engine is down.<br>If an instance experiences unplanned (non-maintenance) downtime, the instance state will still be RUNNING, but the database engine state metric will report 0. | last(/GCP Cloud SQL MSSQL by HTTP/gcp.cloudsql.mssql.db.state)=0 | [{"tag": "scope", "value": "availability"}] | no url |
| Disk space is critically low | AVERAGE | Critical utilization of the disk space. | last(/GCP Cloud SQL MSSQL by HTTP/gcp.cloudsql.mssql.disk.utilization) >= {$CLOUD_SQL.MSSQL.DISK.UTIL.CRIT} | [{"tag": "scope", "value": "capacity"}] | no url |
| Disk space is low | WARNING | High utilization of the storage space. | last(/GCP Cloud SQL MSSQL by HTTP/gcp.cloudsql.mssql.disk.utilization) >= {$CLOUD_SQL.MSSQL.DISK.UTIL.WARN} | [{"tag": "scope", "value": "capacity"}] | no url |
| Failed to get the instance state | AVERAGE | Failed to get the instance state. <br>Check access permissions to GCP API or service account. | last(/GCP Cloud SQL MSSQL by HTTP/gcp.cloudsql.mssql.inst.state) = 10 | [{"tag": "scope", "value": "availability"}] | no url |
| Instance is in failed state | AVERAGE | The instance creation failed, or an operation left the instance in an own bad state. | last(/GCP Cloud SQL MSSQL by HTTP/gcp.cloudsql.mssql.inst.state) = 5 | [{"tag": "scope", "value": "availability"}] | no url |
| Instance is in maintenance | INFO | The instance is down for maintenance. | last(/GCP Cloud SQL MSSQL by HTTP/gcp.cloudsql.mssql.inst.state) = 4 | [{"tag": "scope", "value": "availability"}] | no url |
| Instance is in suspended state | WARNING | The instance is in suspended state. <br>It is not available, for example, due to problems with billing. | last(/GCP Cloud SQL MSSQL by HTTP/gcp.cloudsql.mssql.inst.state) = 1 | [{"tag": "scope", "value": "availability"}] | no url |
| Instance is in unknown state | AVERAGE | The state of the instance is unknown. | last(/GCP Cloud SQL MSSQL by HTTP/gcp.cloudsql.mssql.inst.state) = 6 | [{"tag": "scope", "value": "availability"}] | no url |
| Instance is stopped by the owner | INFO | The instance has been stopped by the owner. <br>It is not currently running, but it's ready to be restarted. | last(/GCP Cloud SQL MSSQL by HTTP/gcp.cloudsql.mssql.inst.state) = 2 | [{"tag": "scope", "value": "availability"}] | no url |
| High memory utilization | HIGH | RAM utilization is too high. The system might be slow to respond. | min(/GCP Cloud SQL MSSQL by HTTP/gcp.cloudsql.mssql.memory.utilization,5m) >= {$CLOUD_SQL.MSSQL.RAM.UTIL.MAX} | [{"tag": "scope", "value": "performance"}] | no url |


<a name="discoveries" />

## Discoveries
| name | key | description | type | lifetime | delay |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Databases discovery | gcp.cloudsql.db.discovery | Databases discovery. | DEPENDENT | no lifetime | 0 |
| Resources discovery | gcp.cloudsql.resources.discovery | Resources discovery. | DEPENDENT | no lifetime | 0 |
| Schedulers discovery | gcp.cloudsql.schedulers.discovery | Schedulers discovery. | DEPENDENT | no lifetime | 0 |


<a name="discovery_databases_discovery" />

## Discovery Databases discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| Database [{#DB.NAME}]: Log bytes flushed | Total number of log bytes flushed for the [{#DB.NAME}] database. | gcp.cloudsql.mssql.db.log_bytes_flushed_count[{#DB.NAME}] | DEPENDENT |
| Database [{#DB.NAME}]: Raw data | Data in raw format for the [{#DB.NAME}] database. | gcp.cloudsql.mssql.db.raw[{#DB.NAME}] | DEPENDENT |
| Database [{#DB.NAME}]: Transactions started | Total number of transactions started for the [{#DB.NAME}] database. | gcp.cloudsql.mssql.db.transaction_count[{#DB.NAME}] | DEPENDENT |


<a name="discovery_resources_discovery" />

## Discovery Resources discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| Resource [{#RESOURCE.NAME}]: Deadlocks | Total number of lock requests that resulted in a deadlock for the [{#RESOURCE.NAME}] resource. | gcp.cloudsql.mssql.resource.deadlock_count[{#RESOURCE.NAME}] | DEPENDENT |
| Resource [{#RESOURCE.NAME}]: Lock waits | Total number of lock requests that required the caller to wait for the [{#RESOURCE.NAME}] resource. | gcp.cloudsql.mssql.resource.lock_wait_count[{#RESOURCE.NAME}] | DEPENDENT |
| Resource [{#RESOURCE.NAME}]: Lock wait time | Total time lock requests were waiting for locks for the [{#RESOURCE.NAME}] resource. | gcp.cloudsql.mssql.resource.lock_wait_time[{#RESOURCE.NAME}] | DEPENDENT |
| Resource [{#RESOURCE.NAME}]: Raw data | Data in raw format for the [{#RESOURCE.NAME}] resource. | gcp.cloudsql.mssql.resource.raw[{#RESOURCE.NAME}] | DEPENDENT |


<a name="discovery_schedulers_discovery" />

## Discovery Schedulers discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| Scheduler [{#SCHEDULER.ID}]: Active workers | Current number of active workers associated with the scheduler that goes by its ID [{#SCHEDULER.ID}].<br>An active worker is never preemptive, must have an associated task, and is either running, runnable, or suspended. | gcp.cloudsql.mssql.scheduler.active_workers[{#SCHEDULER.ID}] | DEPENDENT |
| Scheduler [{#SCHEDULER.ID}]: Current tasks | Current number of present tasks associated with the scheduler that goes by its ID [{#SCHEDULER.ID}].<br>This count includes tasks that are waiting for a worker to execute them and tasks that are currently waiting or running (in SUSPENDED or RUNNABLE state). | gcp.cloudsql.mssql.scheduler.current_tasks[{#SCHEDULER.ID}] | DEPENDENT |
| Scheduler [{#SCHEDULER.ID}]: Current workers | Current number of workers associated with the scheduler that goes by its ID [{#SCHEDULER.ID}].<br>It includes workers that are not assigned any task. | gcp.cloudsql.mssql.scheduler.current_workers[{#SCHEDULER.ID}] | DEPENDENT |
| Scheduler [{#SCHEDULER.ID}]: Pending I/O operations | Current number of pending I/Os waiting to be completed that are associated with the scheduler that goes by its ID [{#SCHEDULER.ID}].<br>Each scheduler has a list of pending I/Os that are checked to determine whether they have been completed every time there is a context switch.<br>The count is incremented when the request is inserted.<br>This count is decremented when the request is completed.<br>This number does not indicate the state of the I/Os. | gcp.cloudsql.mssql.scheduler.pending_disk_io[{#SCHEDULER.ID}] | DEPENDENT |
| Scheduler [{#SCHEDULER.ID}]: Raw data | Data in raw format associated with the scheduler that goes by its ID [{#SCHEDULER.ID}]. | gcp.cloudsql.mssql.scheduler.raw[{#SCHEDULER.ID}] | DEPENDENT |
| Scheduler [{#SCHEDULER.ID}]: Runnable tasks | Current number of workers that are associated with the scheduler that goes by its ID [{#SCHEDULER.ID}] and have assigned tasks waiting to be scheduled on the runnable queue. | gcp.cloudsql.mssql.scheduler.runnable_tasks[{#SCHEDULER.ID}] | DEPENDENT |
| Scheduler [{#SCHEDULER.ID}]: Work queue | Current number of tasks in the pending queue associated with the scheduler that goes by its ID [{#SCHEDULER.ID}].<br>These tasks are waiting for a worker to pick them up. | gcp.cloudsql.mssql.scheduler.work_queue[{#SCHEDULER.ID}] | DEPENDENT |

