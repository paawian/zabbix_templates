# Azure by HTTP template description

This template is designed to monitor Microsoft Azure by HTTP.
It works without any external scripts and uses the script item.
Currently the template supports the discovery of virtual machines (VMs), Cosmos DB for MongoDB, storage accounts, Microsoft SQL, MySQL, and PostgreSQL servers.

Setup:
  1. Create an Azure service principal via the Azure command-line interface (Azure CLI) for your subscription.
    `az ad sp create-for-rbac --name zabbix --role reader --scope /subscriptions/<subscription_id>`
    See https://docs.microsoft.com/en-us/cli/azure/create-an-azure-service-principal-azure-cli for more details.
  2. Link the template to a host.
  3. Configure the macros: `{$AZURE.APP.ID}`, `{$AZURE.PASSWORD}`, `{$AZURE.TENANT.ID}`, and `{$AZURE.SUBSCRIPTION.ID}`.

You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback/

Generated by official Zabbix template tool "Templator"

## Summary
* [items](#items)
* [macros](#macros)
* [triggers](#triggers)
* [discoveries](#discoveries)
  * [Discovery Storage accounts discovery ](#discovery_storage_accounts_discovery)

<a name="items"></a>

## Items
| name | description | key | type | delay |
| ------------- |------------- |------------- |------------- |------------- |
| Get errors | A list of errors from API requests. | azure.get.errors | DEPENDENT | 0 |
| Get resources | The result of API requests is expressed in the JSON. | azure.get.resources | SCRIPT | 10m |
| Get storage accounts | The result of API requests is expressed in the JSON. | azure.get.storage.acc | SCRIPT | 10m |
| Get storage accounts errors | The errors from API requests. | azure.get.storage.acc.errors | DEPENDENT | 0 |


<a name="macros"></a>

## Macros
| macro | value |
| ------------- |------------- |
| {$AZURE.APP.ID} | no value |
| {$AZURE.COSMOS.MONGO.DB.LOCATION.MATCHES} | .* |
| {$AZURE.COSMOS.MONGO.DB.LOCATION.NOT.MATCHES} | CHANGE_IF_NEEDED |
| {$AZURE.COSMOS.MONGO.DB.NAME.MATCHES} | .* |
| {$AZURE.COSMOS.MONGO.DB.NAME.NOT.MATCHES} | CHANGE_IF_NEEDED |
| {$AZURE.DATA.TIMEOUT} | 15s |
| {$AZURE.MSSQL.DB.LOCATION.MATCHES} | .* |
| {$AZURE.MSSQL.DB.LOCATION.NOT.MATCHES} | CHANGE_IF_NEEDED |
| {$AZURE.MSSQL.DB.NAME.MATCHES} | .* |
| {$AZURE.MSSQL.DB.NAME.NOT.MATCHES} | CHANGE_IF_NEEDED |
| {$AZURE.MSSQL.DB.SIZE.NOT.MATCHES} | ^System$ |
| {$AZURE.MYSQL.DB.LOCATION.MATCHES} | .* |
| {$AZURE.MYSQL.DB.LOCATION.NOT.MATCHES} | CHANGE_IF_NEEDED |
| {$AZURE.MYSQL.DB.NAME.MATCHES} | .* |
| {$AZURE.MYSQL.DB.NAME.NOT.MATCHES} | CHANGE_IF_NEEDED |
| {$AZURE.PASSWORD} | no value |
| {$AZURE.PGSQL.DB.LOCATION.MATCHES} | .* |
| {$AZURE.PGSQL.DB.LOCATION.NOT.MATCHES} | CHANGE_IF_NEEDED |
| {$AZURE.PGSQL.DB.NAME.MATCHES} | .* |
| {$AZURE.PGSQL.DB.NAME.NOT.MATCHES} | CHANGE_IF_NEEDED |
| {$AZURE.PROXY} | no value |
| {$AZURE.RESOURCE.GROUP.MATCHES} | .* |
| {$AZURE.RESOURCE.GROUP.NOT.MATCHES} | CHANGE_IF_NEEDED |
| {$AZURE.STORAGE.ACC.AVAILABILITY} | 70 |
| {$AZURE.STORAGE.ACC.BLOB.AVAILABILITY} | 70 |
| {$AZURE.STORAGE.ACC.LOCATION.MATCHES} | .* |
| {$AZURE.STORAGE.ACC.LOCATION.NOT.MATCHES} | CHANGE_IF_NEEDED |
| {$AZURE.STORAGE.ACC.NAME.MATCHES} | .* |
| {$AZURE.STORAGE.ACC.NAME.NOT.MATCHES} | CHANGE_IF_NEEDED |
| {$AZURE.STORAGE.ACC.TABLE.AVAILABILITY} | 70 |
| {$AZURE.SUBSCRIPTION.ID} | no value |
| {$AZURE.TENANT.ID} | no value |
| {$AZURE.VM.LOCATION.MATCHES} | .* |
| {$AZURE.VM.LOCATION.NOT.MATCHES} | CHANGE_IF_NEEDED |
| {$AZURE.VM.NAME.MATCHES} | .* |
| {$AZURE.VM.NAME.NOT.MATCHES} | CHANGE_IF_NEEDED |


<a name="triggers"></a>

## Triggers
| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| There are errors in requests to API | AVERAGE | Zabbix has received errors in response to API requests. | length(last(/Azure by HTTP/azure.get.errors))>0 | [{"tag": "scope", "value": "availability"}] | no url |
| There are errors in storages requests to API | AVERAGE | Zabbix has received errors in response to API requests. | length(last(/Azure by HTTP/azure.get.storage.acc.errors))>0 | [{"tag": "scope", "value": "availability"}] | no url |


<a name="discoveries"></a>

## Discoveries
| name | key | description | type | lifetime | delay |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Cosmos DB account discovery | azure.cosmos.mongo.db.discovery | The list of the Cosmos databases is provided by the subscription. | DEPENDENT | no lifetime | 0 |
| Microsoft SQL databases discovery | azure.mssql.databases.discovery | The list of the Microsoft SQL databases is provided by the subscription. | DEPENDENT | no lifetime | 0 |
| MySQL servers discovery | azure.mysql.servers.discovery | The list of the MySQL servers is provided by the subscription. | DEPENDENT | no lifetime | 0 |
| PostgreSQL servers discovery | azure.pgsql.servers.discovery | The list of the PostgreSQL servers is provided by the subscription. | DEPENDENT | no lifetime | 0 |
| Storage accounts discovery | azure.storage.acc.discovery | The list of all storage accounts available under the subscription. | DEPENDENT | no lifetime | 0 |
| Virtual machines discovery | azure.vm.discovery | The list of the virtual machines is provided by the subscription. | DEPENDENT | no lifetime | 0 |


<a name="discovery_storage_accounts_discovery"></a>

## Discovery Storage accounts discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| Storage account [{#NAME}]: Get data | The HTTP API endpoint that returns storage metrics with the name `[{#NAME}]`. | azure.get.storage.acc[{#NAME}] | SCRIPT |
| Storage account [{#NAME}]: Availability | The percentage of availability for the storage service or a specified API operation.<br>Availability is calculated by taking the `TotalBillableRequests` value and dividing it by the number of applicable requests, including those that produced unexpected errors.<br>All unexpected errors result in reduced availability for the storage service or the specified API operation. | azure.storage.availability[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: Blob Availability | The percentage of availability for the storage service or a specified API operation.<br>Availability is calculated by taking the `TotalBillableRequests` value and dividing it by the number of applicable requests, including those that produced unexpected errors.<br>All unexpected errors result in reduced availability for the storage service or the specified API operation. | azure.storage.blob.availability[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: Blob Capacity | The amount of storage used by the blob service of the storage account with the name `[{#NAME}]`, expressed in bytes. | azure.storage.blob.capacity[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: Blob Container Count | The number of containers in the storage account with the name `[{#NAME}]`. | azure.storage.blob.container.count[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: Blob Count | The number of blob objects stored in the storage account with the name `[{#NAME}]`. | azure.storage.blob.count[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: Blob Egress | The amount of egress data. This number includes egress to external client from Azure Storage and also egress within Azure.<br>As a result, this number does not reflect billable egress. | azure.storage.blob.engress[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: Blob Index Capacity | The amount of storage with the name `[{#NAME}]` used by the Azure Data Lake Storage Gen2 hierarchical index. | azure.storage.blob.index.capacity[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: Blob Ingress | The amount of ingress data, expressed in bytes. This number includes ingress from an external client into Azure Storage and also ingress within Azure. | azure.storage.blob.ingress[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: Blob Success E2E Latency | The average end-to-end latency of successful requests made to a storage service or the specified API operation, expressed in milliseconds.<br>This value includes the required processing time within Azure Storage to read the request, send the response, and receive acknowledgment of the response. | azure.storage.blob.success.e2e.latency[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: Blob Success Server Latency | The average time used to process a successful request by Azure Storage.<br>This value does not include the network latency specified in `SuccessE2ELatency`. | azure.storage.blob.success.server.latency[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: Blob Transactions | The number of requests made to the storage service or a specified API operation.<br>This number includes successful and failed requests and also requests that produced errors.<br>Use `ResponseType` dimension for the number of different types of responses. | azure.storage.blob.transactions[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: Egress | The amount of egress data. This number includes egress to external client from Azure Storage and also egress within Azure.<br>As a result, this number does not reflect billable egress. | azure.storage.engress[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: File Capacity | The amount of file storage used by the storage account with the name `[{#NAME}]`, expressed in bytes. | azure.storage.file.capacity[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: File Count | The number of files in the storage account with the name `[{#NAME}]`. | azure.storage.file.count[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: File Egress | The amount of egress data. This number includes egress to external client from Azure Storage and also egress within Azure.<br>As a result, this number does not reflect billable egress. | azure.storage.file.engress[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: File Ingress | The amount of ingress data, expressed in bytes. This number includes ingress from an external client into Azure Storage and also ingress within Azure. | azure.storage.file.ingress[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: File Share Capacity Quota | The upper limit on the amount of storage that can be used by Azure Files Service, in bytes. | azure.storage.file.share.capacity.quota[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: File Share Count | The number of file shares in the storage account. | azure.storage.file.share.count[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: File Share Snapshot Size | The amount of storage used by the snapshots in storage account's File service, in bytes. | azure.storage.file.share.snapshot.size[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: File Share Snapshot Count | The number of snapshots present on the share in storage account's Files Service. | azure.storage.file.shares.snapshot.count[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: File Success E2E Latency | The average end-to-end latency of successful requests made to a storage service or the specified API operation, expressed in milliseconds.<br>This value includes the required processing time within Azure Storage to read the request, send the response, and receive acknowledgment of the response. | azure.storage.file.success.e2e.latency[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: File Success Server Latency | The average time used to process a successful request by Azure Storage.<br>This value does not include the network latency specified in `SuccessE2ELatency`. | azure.storage.file.success.server.latency[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: File Transactions | The number of requests made to the storage service or a specified API operation.<br>This number includes successful and failed requests and also requests that produced errors.<br>Use `ResponseType` dimension for the number of different types of responses. | azure.storage.file.transactions[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: Ingress | The amount of ingress data, expressed in bytes. This number includes ingress from an external client into Azure Storage and also ingress within Azure. | azure.storage.ingress[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: Queue Capacity | The amount of queue storage used by the storage account with the name `[{#NAME}]`, expressed in bytes. | azure.storage.queue.capacity[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: Queue Count | The number of queues in the storage account with the name `[{#NAME}]`. | azure.storage.queue.count[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: Queue Egress | The amount of egress data. This number includes egress to external client from Azure Storage and also egress within Azure.<br>As a result, this number does not reflect billable egress. | azure.storage.queue.engress[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: Queue Ingress | The amount of ingress data, expressed in bytes. This number includes ingress from an external client into Azure Storage and also ingress within Azure. | azure.storage.queue.ingress[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: Queue Message Count | The number of unexpired queue messages in the storage account with the name `[{#NAME}]`. | azure.storage.queue.message.count[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: Queue Success E2E Latency | The average end-to-end latency of successful requests made to a storage service or the specified API operation, expressed in milliseconds.<br>This value includes the required processing time within Azure Storage to read the request, send the response, and receive acknowledgment of the response. | azure.storage.queue.success.e2e.latency[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: Queue Success Server Latency | The average time used to process a successful request by Azure Storage.<br>This value does not include the network latency specified in `SuccessE2ELatency`. | azure.storage.queue.success.server.latency[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: Queue Transactions | The number of requests made to the storage service or a specified API operation.<br>This number includes successful and failed requests and also requests that produced errors.<br>Use `ResponseType` dimension for the number of different types of responses. | azure.storage.queue.transactions[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: Success E2E Latency | The average end-to-end latency of successful requests made to a storage service or the specified API operation, expressed in milliseconds.<br>This value includes the required processing time within Azure Storage to read the request, send the response, and receive acknowledgment of the response. | azure.storage.success.e2e.latency[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: Success Server Latency | The average time used to process a successful request by Azure Storage.<br>This value does not include the network latency specified in `SuccessE2ELatency`. | azure.storage.success.server.latency[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: Table Availability | The percentage of availability for the storage service or a specified API operation.<br>Availability is calculated by taking the `TotalBillableRequests` value and dividing it by the number of applicable requests, including those that produced unexpected errors.<br>All unexpected errors result in reduced availability for the storage service or the specified API operation. | azure.storage.table.availability[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: Table Capacity | The amount of storage used by the table service of the storage account with the name `[{#NAME}]`, expressed in bytes. | azure.storage.table.capacity[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: Table Count | The number of tables in the storage account with the name `[{#NAME}]`. | azure.storage.table.count[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: Table Egress | The amount of egress data. This number includes egress to external client from Azure Storage and also egress within Azure.<br>As a result, this number does not reflect billable egress. | azure.storage.table.engress[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: Table Entity Count | The number of table entities in the storage account with the name `[{#NAME}]`. | azure.storage.table.entity.count[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: Table Ingress | The amount of ingress data, expressed in bytes. This number includes ingress from an external client into Azure Storage and also ingress within Azure. | azure.storage.table.ingress[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: Table Success E2E Latency | The average end-to-end latency of successful requests made to a storage service or the specified API operation, expressed in milliseconds.<br>This value includes the required processing time within Azure Storage to read the request, send the response, and receive acknowledgment of the response. | azure.storage.table.success.e2e.latency[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: Table Success Server Latency | The average time used to process a successful request by Azure Storage.<br>This value does not include the network latency specified in `SuccessE2ELatency`. | azure.storage.table.success.server.latency[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: Table Transactions | The number of requests made to the storage service or a specified API operation.<br>This number includes successful and failed requests and also requests that produced errors.<br>Use `ResponseType` dimension for the number of different types of responses. | azure.storage.table.transactions[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: Transactions | The number of requests made to the storage service or a specified API operation.<br>This number includes successful and failed requests and also requests that produced errors.<br>Use `ResponseType` dimension for the number of different types of responses. | azure.storage.transactions[{#NAME}] | DEPENDENT |
| Storage account [{#NAME}]: Used Capacity | The amount of storage used by the storage account with the name `[{#NAME}]`, expressed in bytes.<br>For standard storage accounts, it's the sum of capacity used by blob, table, file, and queue.<br>For premium storage accounts and blob storage accounts, it is the same as BlobCapacity or FileCapacity. | azure.storage.used.capacity[{#NAME}] | DEPENDENT |


### Triggers

| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Storage account [{#NAME}]: Availability is low | WARNING | no description | (min(/Azure by HTTP/azure.storage.availability[{#NAME}],#3))<{$AZURE.STORAGE.ACC.AVAILABILITY:"{#NAME}"} | [{"tag": "scope", "value": "availability"}] | no url |
| Storage account [{#NAME}]: Blob Availability is low | WARNING | no description | (min(/Azure by HTTP/azure.storage.blob.availability[{#NAME}],#3))<{$AZURE.STORAGE.ACC.BLOB.AVAILABILITY:"{#NAME}"} | [{"tag": "scope", "value": "availability"}] | no url |
| Storage account [{#NAME}]: Table Availability is low | WARNING | no description | (min(/Azure by HTTP/azure.storage.table.availability[{#NAME}],#3))<{$AZURE.STORAGE.ACC.TABLE.AVAILABILITY:"{#NAME}"} | [{"tag": "scope", "value": "availability"}] | no url |

