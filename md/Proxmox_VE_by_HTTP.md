# Proxmox VE by HTTP template description

This template is designed for the effortless deployment of Proxmox VE monitoring by Zabbix via HTTP and doesn't require any external scripts.

Proxmox VE uses a REST like API. The concept is described in Resource Oriented Architecture (ROA).

Check the API documentation for details:
https://pve.proxmox.com/pve-docs/api-viewer/index.html

Setup:

1. Create an API token for the monitoring user. Important note: for security reasons, it is recommended to create a separate user (Datacenter - Permissions).

Please provide the necessary access levels for both the User and the Token:

* Check: ["perm","/",["Sys.Audit"]]
* Check: ["perm","/storage",["Datastore.Audit"]]
* Check: ["perm","/vms",["VM.Audit"]]

2. Copy the resulting Token ID and Secret into the host macros '{$PVE.TOKEN.ID}' and '{$PVE.TOKEN.SECRET}'.

3. Set the hostname or IP address of the Proxmox VE API host in the '{$PVE.URL.HOST}' macro. You can also change the API port in the '{$PVE.URL.PORT}' macro if necessary.

Generated by official Zabbix template tool "Templator"

## Summary
* [items](#items)
* [macros](#macros)
* [triggers](#triggers)
* [discoveries](#discoveries)
  * [Discovery Cluster discovery ](#discovery_cluster_discovery)
  * [Discovery LXC discovery ](#discovery_lxc_discovery)
  * [Discovery Node discovery ](#discovery_node_discovery)
  * [Discovery QEMU discovery ](#discovery_qemu_discovery)
  * [Discovery Storage discovery ](#discovery_storage_discovery)

<a name="items"></a>

## Items
| name | description | key | type | delay |
| ------------- |------------- |------------- |------------- |------------- |
| API service status | Get API service status. | proxmox.api.available | SCRIPT | 5m |
| Get cluster resources | Resources index. | proxmox.cluster.resources | HTTP_AGENT | 5m |
| Get cluster status | Get cluster status information. | proxmox.cluster.status | HTTP_AGENT | 5m |


<a name="macros"></a>

## Macros
| macro | value |
| ------------- |------------- |
| {$PVE.CPU.PUSE.MAX.WARN} | 90 |
| {$PVE.LXC.CPU.PUSE.MAX.WARN} | 90 |
| {$PVE.LXC.MEMORY.PUSE.MAX.WARN} | 90 |
| {$PVE.MEMORY.PUSE.MAX.WARN} | 90 |
| {$PVE.ROOT.PUSE.MAX.WARN} | 90 |
| {$PVE.STORAGE.PUSE.MAX.WARN} | 90 |
| {$PVE.SWAP.PUSE.MAX.WARN} | 90 |
| {$PVE.TOKEN.ID} | USER@REALM!TOKENID |
| {$PVE.TOKEN.SECRET} | xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx |
| {$PVE.URL.HOST} | <SET PVE HOST> |
| {$PVE.URL.PORT} | 8006 |
| {$PVE.VM.CPU.PUSE.MAX.WARN} | 90 |
| {$PVE.VM.MEMORY.PUSE.MAX.WARN} | 90 |


<a name="triggers"></a>

## Triggers
| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| API service not available | HIGH | The API service is not available. Check your network and authorization settings. | last(/Proxmox VE by HTTP/proxmox.api.available) <> 200 | [{"tag": "scope", "value": "availability"}] | no url |


<a name="discoveries"></a>

## Discoveries
| name | key | description | type | lifetime | delay |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Cluster discovery | proxmox.cluster.discovery | no description | DEPENDENT | no lifetime | 0 |
| LXC discovery | proxmox.lxc.discovery | no description | DEPENDENT | no lifetime | 0 |
| Node discovery | proxmox.node.discovery | no description | DEPENDENT | no lifetime | 0 |
| QEMU discovery | proxmox.qemu.discovery | no description | DEPENDENT | no lifetime | 0 |
| Storage discovery | proxmox.storage.discovery | no description | DEPENDENT | no lifetime | 0 |


<a name="discovery_cluster_discovery"></a>

## Discovery Cluster discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| Cluster [{#RESOURCE.NAME}]: Quorate | Indicates if there is a majority of nodes online to make decisions. | proxmox.cluster.quorate[{#RESOURCE.NAME}] | DEPENDENT |


### Triggers

| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Cluster [{#RESOURCE.NAME}] not quorum | HIGH | Proxmox VE use a quorum-based technique to provide a consistent state among all cluster nodes. | last(/Proxmox VE by HTTP/proxmox.cluster.quorate[{#RESOURCE.NAME}]) <> 1 | [{"tag": "scope", "value": "availability"}] | no url |


<a name="discovery_lxc_discovery"></a>

## Discovery LXC discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| LXC [{#NODE.NAME}/{#LXC.NAME} ({#LXC.ID})]: CPU usage | CPU load. | proxmox.lxc.cpu[{#LXC.ID}] | DEPENDENT |
| LXC [{#NODE.NAME}/{#LXC.NAME} ({#LXC.ID})]: Disk read, rate | Disk read. | proxmox.lxc.diskread[{#LXC.ID}] | DEPENDENT |
| LXC [{#NODE.NAME}/{#LXC.NAME} ({#LXC.ID})]: Disk write, rate | Disk write. | proxmox.lxc.diskwrite[{#LXC.ID}] | DEPENDENT |
| LXC [{#NODE.NAME}/{#LXC.NAME}]: Get data | Get LXC status data. | proxmox.lxc.get.data[{#LXC.ID}] | HTTP_AGENT |
| LXC [{#NODE.NAME}/{#LXC.NAME} ({#LXC.ID})]: Memory total | The total memory expressed in bytes. | proxmox.lxc.maxmem[{#LXC.ID}] | DEPENDENT |
| LXC [{#NODE.NAME}/{#LXC.NAME} ({#LXC.ID})]: Memory usage | Used memory in bytes. | proxmox.lxc.mem[{#LXC.ID}] | DEPENDENT |
| LXC [{#NODE.NAME}/{#LXC.NAME} ({#LXC.ID})]: Incoming data, rate | Incoming data rate. | proxmox.lxc.netin[{#LXC.ID}] | DEPENDENT |
| LXC [{#NODE.NAME}/{#LXC.NAME} ({#LXC.ID})]: Outgoing data, rate | Outgoing data rate. | proxmox.lxc.netout[{#LXC.ID}] | DEPENDENT |
| LXC [{#NODE.NAME}/{#LXC.NAME} ({#LXC.ID})]: Uptime | The system uptime expressed in the following format: "N days, hh:mm:ss". | proxmox.lxc.uptime[{#LXC.ID}] | DEPENDENT |
| LXC [{#NODE.NAME}/{#LXC.NAME} ({#LXC.ID})]: Status | Status of LXC container. | proxmox.lxc.vmstatus[{#LXC.ID}] | DEPENDENT |


### Triggers

| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| LXC [{#NODE.NAME}/{#LXC.NAME} ({#LXC.ID})] high CPU usage | WARNING | CPU usage. | min(/Proxmox VE by HTTP/proxmox.lxc.cpu[{#LXC.ID}],5m) > {$PVE.LXC.CPU.PUSE.MAX.WARN:"{#LXC.ID}"} | [{"tag": "scope", "value": "performance"}] | no url |
| LXC [{#NODE.NAME}/{#LXC.NAME}]: has been restarted | INFO | Uptime is less than 10 minutes. | last(/Proxmox VE by HTTP/proxmox.lxc.uptime[{#LXC.ID}])<10m | [{"tag": "scope", "value": "notice"}] | no url |
| LXC [{#NODE.NAME}/{#LXC.NAME} ({#LXC.ID})]: Not running | AVERAGE | LXC state is not "running". | last(/Proxmox VE by HTTP/proxmox.lxc.vmstatus[{#LXC.ID}])<>"running" | [{"tag": "scope", "value": "notice"}] | no url |
| LXC [{#NODE.NAME}/{#LXC.NAME} ({#LXC.ID})] high memory usage | WARNING | Memory usage. | min(/Proxmox VE by HTTP/proxmox.lxc.mem[{#LXC.ID}],5m) / last(/Proxmox VE by HTTP/proxmox.lxc.maxmem[{#LXC.ID}]) * 100 >{$PVE.LXC.MEMORY.PUSE.MAX.WARN:"{#LXC.ID}"} | [{"tag": "scope", "value": "performance"}] | no url |


<a name="discovery_node_discovery"></a>

## Discovery Node discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| Node [{#NODE.NAME}]: CPU, usage | CPU usage. | proxmox.node.cpu[{#NODE.NAME}] | DEPENDENT |
| Node [{#NODE.NAME}]: CPU, iowait | CPU iowait time. | proxmox.node.iowait[{#NODE.NAME}] | DEPENDENT |
| Node [{#NODE.NAME}]: Kernel version | Kernel version info. | proxmox.node.kernelversion[{#NODE.NAME}] | DEPENDENT |
| Node [{#NODE.NAME}]: CPU, loadavg | CPU average load. | proxmox.node.loadavg[{#NODE.NAME}] | DEPENDENT |
| Node [{#NODE.NAME}]: Localtime | Seconds since 1970-01-01 00:00:00 (local time). | proxmox.node.localtime[{#NODE.NAME}] | DEPENDENT |
| Node [{#NODE.NAME}]: Memory, total | Memory total. | proxmox.node.memtotal[{#NODE.NAME}] | DEPENDENT |
| Node [{#NODE.NAME}]: Memory, used | Memory usage. | proxmox.node.memused[{#NODE.NAME}] | DEPENDENT |
| Node [{#NODE.NAME}]: Incoming data, rate | Network usage. | proxmox.node.netin[{#NODE.NAME}] | DEPENDENT |
| Node [{#NODE.NAME}]: Outgoing data, rate | Network usage. | proxmox.node.netout[{#NODE.NAME}] | DEPENDENT |
| Node [{#NODE.NAME}]: Status | Indicates if the node is online or offline. | proxmox.node.online[{#NODE.NAME}] | DEPENDENT |
| Node [{#NODE.NAME}]: PVE version | PVE manager version. | proxmox.node.pveversion[{#NODE.NAME}] | DEPENDENT |
| Node [{#NODE.NAME}]: Root filesystem, total | Root filesystem total. | proxmox.node.roottotal[{#NODE.NAME}] | DEPENDENT |
| Node [{#NODE.NAME}]: Root filesystem, used | Root filesystem usage. | proxmox.node.rootused[{#NODE.NAME}] | DEPENDENT |
| Node [{#NODE.NAME}]: RRD statistics | Read node RRD statistics. | proxmox.node.rrd[{#NODE.NAME}] | HTTP_AGENT |
| Node [{#NODE.NAME}]: Status | Read node status. | proxmox.node.status[{#NODE.NAME}] | HTTP_AGENT |
| Node [{#NODE.NAME}]: Swap filesystem, total | Swap total. | proxmox.node.swaptotal[{#NODE.NAME}] | DEPENDENT |
| Node [{#NODE.NAME}]: Swap filesystem, used | Swap used. | proxmox.node.swapused[{#NODE.NAME}] | DEPENDENT |
| Node [{#NODE.NAME}]: Time zone | Time zone. | proxmox.node.timezone[{#NODE.NAME}] | DEPENDENT |
| Node [{#NODE.NAME}]: Time | Read server time and time zone settings. | proxmox.node.time[{#NODE.NAME}] | HTTP_AGENT |
| Node [{#NODE.NAME}]: Uptime | The system uptime expressed in the following format: "N days, hh:mm:ss". | proxmox.node.uptime[{#NODE.NAME}] | DEPENDENT |
| Node [{#NODE.NAME}]: Time | Seconds since 1970-01-01 00:00:00 UTC. | proxmox.node.utctime[{#NODE.NAME}] | DEPENDENT |


### Triggers

| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Node [{#NODE.NAME}] high CPU usage | WARNING | CPU usage. | min(/Proxmox VE by HTTP/proxmox.node.cpu[{#NODE.NAME}],5m) > {$PVE.CPU.PUSE.MAX.WARN:"{#NODE.NAME}"} | [{"tag": "scope", "value": "performance"}] | no url |
| Node [{#NODE.NAME}]: Kernel version has changed | INFO | Firmware version has changed. Acknowledge to close the problem manually. | last(/Proxmox VE by HTTP/proxmox.node.kernelversion[{#NODE.NAME}],#1)<>last(/Proxmox VE by HTTP/proxmox.node.kernelversion[{#NODE.NAME}],#2) and length(last(/Proxmox VE by HTTP/proxmox.node.kernelversion[{#NODE.NAME}]))>0 | [{"tag": "scope", "value": "notice"}] | no url |
| Node [{#NODE.NAME}] offline | HIGH | Node offline. | last(/Proxmox VE by HTTP/proxmox.node.online[{#NODE.NAME}]) <> 1 | [{"tag": "scope", "value": "availability"}] | no url |
| Node [{#NODE.NAME}]: PVE manager has changed | INFO | Firmware version has changed. Acknowledge to close the problem manually. | last(/Proxmox VE by HTTP/proxmox.node.pveversion[{#NODE.NAME}],#1)<>last(/Proxmox VE by HTTP/proxmox.node.pveversion[{#NODE.NAME}],#2) and length(last(/Proxmox VE by HTTP/proxmox.node.pveversion[{#NODE.NAME}]))>0 | [{"tag": "scope", "value": "notice"}] | no url |
| Node [{#NODE.NAME}]: has been restarted | INFO | Uptime is less than 10 minutes. | last(/Proxmox VE by HTTP/proxmox.node.uptime[{#NODE.NAME}])<10m | [{"tag": "scope", "value": "notice"}] | no url |
| Node [{#NODE.NAME}] high memory usage | WARNING | Memory usage. | min(/Proxmox VE by HTTP/proxmox.node.memused[{#NODE.NAME}],5m) / last(/Proxmox VE by HTTP/proxmox.node.memtotal[{#NODE.NAME}]) * 100 >{$PVE.MEMORY.PUSE.MAX.WARN:"{#NODE.NAME}"} | [{"tag": "scope", "value": "performance"}] | no url |
| Node [{#NODE.NAME}] high root filesystem space usage | WARNING | Root filesystem space usage. | min(/Proxmox VE by HTTP/proxmox.node.rootused[{#NODE.NAME}],5m) / last(/Proxmox VE by HTTP/proxmox.node.roottotal[{#NODE.NAME}]) * 100 >{$PVE.ROOT.PUSE.MAX.WARN:"{#NODE.NAME}"} | [{"tag": "scope", "value": "capacity"}] | no url |
| Node [{#NODE.NAME}] high swap space usage | WARNING | If there is no swap configured, this trigger is ignored. | min(/Proxmox VE by HTTP/proxmox.node.swapused[{#NODE.NAME}],5m) / last(/Proxmox VE by HTTP/proxmox.node.swaptotal[{#NODE.NAME}]) * 100 > {$PVE.SWAP.PUSE.MAX.WARN:"{#NODE.NAME}"} and last(/Proxmox VE by HTTP/proxmox.node.swaptotal[{#NODE.NAME}]) > 0 | [{"tag": "scope", "value": "capacity"}] | no url |


<a name="discovery_qemu_discovery"></a>

## Discovery QEMU discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| VM [{#NODE.NAME}/{#QEMU.NAME} ({#QEMU.ID})]: CPU usage | CPU load. | proxmox.qemu.cpu[{#QEMU.ID}] | DEPENDENT |
| VM [{#NODE.NAME}/{#QEMU.NAME} ({#QEMU.ID})]: Disk read, rate | Disk read. | proxmox.qemu.diskread[{#QEMU.ID}] | DEPENDENT |
| VM [{#NODE.NAME}/{#QEMU.NAME} ({#QEMU.ID})]: Disk write, rate | Disk write. | proxmox.qemu.diskwrite[{#QEMU.ID}] | DEPENDENT |
| VM [{#NODE.NAME}/{#QEMU.NAME}]: Get data | Get VM status data. | proxmox.qemu.get.data[{#QEMU.ID}] | HTTP_AGENT |
| VM [{#NODE.NAME}/{#QEMU.NAME} ({#QEMU.ID})]: Memory total | The total memory expressed in bytes. | proxmox.qemu.maxmem[{#QEMU.ID}] | DEPENDENT |
| VM [{#NODE.NAME}/{#QEMU.NAME} ({#QEMU.ID})]: Memory usage | Used memory in bytes. | proxmox.qemu.mem[{#QEMU.ID}] | DEPENDENT |
| VM [{#NODE.NAME}/{#QEMU.NAME} ({#QEMU.ID})]: Incoming data, rate | Incoming data rate. | proxmox.qemu.netin[{#QEMU.ID}] | DEPENDENT |
| VM [{#NODE.NAME}/{#QEMU.NAME} ({#QEMU.ID})]: Outgoing data, rate | Outgoing data rate. | proxmox.qemu.netout[{#QEMU.ID}] | DEPENDENT |
| VM [{#NODE.NAME}/{#QEMU.NAME} ({#QEMU.ID})]: Uptime | The system uptime expressed in the following format: "N days, hh:mm:ss". | proxmox.qemu.uptime[{#QEMU.ID}] | DEPENDENT |
| VM [{#NODE.NAME}/{#QEMU.NAME} ({#QEMU.ID})]: Status | Status of Virtual Machine. | proxmox.qemu.vmstatus[{#QEMU.ID}] | DEPENDENT |


### Triggers

| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| VM [{#NODE.NAME}/{#QEMU.NAME} ({#QEMU.ID})] high CPU usage | WARNING | CPU usage. | min(/Proxmox VE by HTTP/proxmox.qemu.cpu[{#QEMU.ID}],5m) > {$PVE.VM.CPU.PUSE.MAX.WARN:"{#QEMU.ID}"} | [{"tag": "scope", "value": "performance"}] | no url |
| VM [{#NODE.NAME}/{#QEMU.NAME}]: has been restarted | INFO | Uptime is less than 10 minutes. | last(/Proxmox VE by HTTP/proxmox.qemu.uptime[{#QEMU.ID}])<10m | [{"tag": "scope", "value": "notice"}] | no url |
| VM [{#NODE.NAME}/{#QEMU.NAME} ({#QEMU.ID})]: Not running | AVERAGE | VM state is not "running". | last(/Proxmox VE by HTTP/proxmox.qemu.vmstatus[{#QEMU.ID}])<>"running" | [{"tag": "scope", "value": "notice"}] | no url |
| VM [{#NODE.NAME}/{#QEMU.NAME} ({#QEMU.ID})] high memory usage | WARNING | Memory usage. | min(/Proxmox VE by HTTP/proxmox.qemu.mem[{#QEMU.ID}],5m) / last(/Proxmox VE by HTTP/proxmox.qemu.maxmem[{#QEMU.ID}]) * 100 >{$PVE.VM.MEMORY.PUSE.MAX.WARN:"{#QEMU.ID}"} | [{"tag": "scope", "value": "performance"}] | no url |


<a name="discovery_storage_discovery"></a>

## Discovery Storage discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| Storage [{#NODE.NAME}/{#STORAGE.NAME}]: Content | Allowed storage content types. | proxmox.node.content[{#NODE.NAME},{#STORAGE.NAME}] | DEPENDENT |
| Storage [{#NODE.NAME}/{#STORAGE.NAME}]: Used | Used disk space in bytes. | proxmox.node.disk[{#NODE.NAME},{#STORAGE.NAME}] | DEPENDENT |
| Storage [{#NODE.NAME}/{#STORAGE.NAME}]: Size | Storage size in bytes. | proxmox.node.maxdisk[{#NODE.NAME},{#STORAGE.NAME}] | DEPENDENT |
| Storage [{#NODE.NAME}/{#STORAGE.NAME}]: Type | More specific type, if available. | proxmox.node.plugintype[{#NODE.NAME},{#STORAGE.NAME}] | DEPENDENT |


### Triggers

| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Storage [{#NODE.NAME}/{#STORAGE.NAME}] high filesystem space usage | WARNING | Root filesystem space usage. | min(/Proxmox VE by HTTP/proxmox.node.disk[{#NODE.NAME},{#STORAGE.NAME}],5m) / last(/Proxmox VE by HTTP/proxmox.node.maxdisk[{#NODE.NAME},{#STORAGE.NAME}]) * 100 >{$PVE.STORAGE.PUSE.MAX.WARN:"{#NODE.NAME}/{#STORAGE.NAME}"} | [{"tag": "scope", "value": "capacity"}] | no url |

