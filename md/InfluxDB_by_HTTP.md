# InfluxDB by HTTP template description

Get InfluxDB metrics by HTTP agent from Prometheus metrics endpoint.
For organization discovery template need to use Authorization via API token. See docs: https://docs.influxdata.com/influxdb/v2.0/security/tokens/

Don't forget change macros {$INFLUXDB.URL}, {$INFLUXDB.API.TOKEN}.
Some metrics may not be collected depending on your InfluxDB instance version and configuration.

You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback

Generated by official Zabbix template tool "Templator"

## Summary
* [items](#items)
* [macros](#macros)
* [triggers](#triggers)
* [discoveries](#discoveries)
  * [Discovery Organizations discovery ](#discovery_organizations_discovery)

<a name="items"></a>

## Items
| name | description | key | type | delay |
| ------------- |------------- |------------- |------------- |------------- |
| Get instance metrics | no description | influx.get_metrics | HTTP_AGENT | no delay |
| Instance status | Get the health of an instance. | influx.healthcheck | HTTP_AGENT | no delay |
| Boltdb reads, rate | Total number of boltdb reads per second. | influxdb.boltdb_reads.rate | DEPENDENT | 0 |
| Boltdb writes, rate | Total number of boltdb writes per second. | influxdb.boltdb_writes.rate | DEPENDENT | 0 |
| Buckets, total | Number of total buckets on the server. | influxdb.buckets.total | DEPENDENT | 0 |
| Dashboards, total | Number of total dashboards on the server. | influxdb.dashboards.total | DEPENDENT | 0 |
| Organizations, total | Number of total organizations on the server. | influxdb.organizations.total | DEPENDENT | 0 |
| Scrapers, total | Number of total scrapers on the server. | influxdb.scrapers.total | DEPENDENT | 0 |
| Task runs failed, rate | Total number of failure runs across all tasks. | influxdb.task_executor_complete.failed.rate | DEPENDENT | 0 |
| Task runs successful, rate | Total number of runs successful completed across all tasks. | influxdb.task_executor_complete.successful.rate | DEPENDENT | 0 |
| Workers currently running | Total number of workers currently running tasks. | influxdb.task_executor_runs_active.total | DEPENDENT | 0 |
| Workers busy, pct | Percent of total available workers that are currently busy. | influxdb.task_executor_workers_busy.pct | DEPENDENT | 0 |
| Telegrafs, total | Number of total telegraf configurations on the server. | influxdb.telegrafs.total | DEPENDENT | 0 |
| Telegraf plugins, total | Number of individual telegraf plugins configured. | influxdb.telegraf_plugins.total | DEPENDENT | 0 |
| Tokens, total | Number of total tokens on the server. | influxdb.tokens.total | DEPENDENT | 0 |
| Uptime | InfluxDB process uptime in seconds. | influxdb.uptime | DEPENDENT | 0 |
| Users, total | Number of total users on the server. | influxdb.users.total | DEPENDENT | 0 |
| Version | Version of the InfluxDB instance. | influxdb.version | DEPENDENT | 0 |


<a name="macros"></a>

## Macros
| macro | value |
| ------------- |------------- |
| {$INFLUXDB.API.TOKEN} | no value |
| {$INFLUXDB.ORG_NAME.MATCHES} | .* |
| {$INFLUXDB.ORG_NAME.NOT_MATCHES} | CHANGE_IF_NEEDED |
| {$INFLUXDB.REQ.FAIL.MAX.WARN} | 2 |
| {$INFLUXDB.TASK.RUN.FAIL.MAX.WARN} | 2 |
| {$INFLUXDB.URL} | http://localhost:8086 |


<a name="triggers"></a>

## Triggers
| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Health check was failed | HIGH | The InfluxDB instance is not available or unhealthy. | last(/InfluxDB by HTTP/influx.healthcheck)=0 | [{"tag": "scope", "value": "availability"}] | no url |
| Too many tasks failure runs | WARNING | "Number of failure runs completed across all tasks is too high." | min(/InfluxDB by HTTP/influxdb.task_executor_complete.failed.rate,5m)>{$INFLUXDB.TASK.RUN.FAIL.MAX.WARN} | [{"tag": "scope", "value": "performance"}] | no url |
| has been restarted | INFO | Uptime is less than 10 minutes. | last(/InfluxDB by HTTP/influxdb.uptime)<10m | [{"tag": "scope", "value": "notice"}] | no url |
| Version has changed | INFO | InfluxDB version has changed. Acknowledge to close the problem manually. | last(/InfluxDB by HTTP/influxdb.version,#1)<>last(/InfluxDB by HTTP/influxdb.version,#2) and length(last(/InfluxDB by HTTP/influxdb.version))>0 | [{"tag": "scope", "value": "notice"}] | no url |


<a name="discoveries"></a>

## Discoveries
| name | key | description | type | lifetime | delay |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Organizations discovery | influxdb.orgs.discovery | Discovery of organizations metrics. | HTTP_AGENT | no lifetime | 10m |


<a name="discovery_organizations_discovery" />

## Discovery Organizations discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| [{#ORG_NAME}] Query response bytes, failed | Count of bytes returned with status not 200 per second. | influxdb.org.http_query_response_bytes.failed.rate["{#ORG_NAME}"] | DEPENDENT |
| [{#ORG_NAME}] Query response bytes, success | Count of bytes returned with status 200 per second. | influxdb.org.http_query_response_bytes.success.rate["{#ORG_NAME}"] | DEPENDENT |
| [{#ORG_NAME}] Query requests, failed | Total number of query requests with status not 200 per second. | influxdb.org.query_request.failed.rate["{#ORG_NAME}"] | DEPENDENT |
| [{#ORG_NAME}] Query requests, success | Total number of query requests with status 200 per second. | influxdb.org.query_request.success.rate["{#ORG_NAME}"] | DEPENDENT |
| [{#ORG_NAME}] Query requests bytes, failed | Count of bytes received with status not 200 per second. | influxdb.org.query_request_bytes.failed.rate["{#ORG_NAME}"] | DEPENDENT |
| [{#ORG_NAME}] Query requests bytes, success | Count of bytes received with status 200 per second. | influxdb.org.query_request_bytes.success.rate["{#ORG_NAME}"] | DEPENDENT |


### Triggers

| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| [{#ORG_NAME}]: Too many requests failures | WARNING | Too many query requests failed. | min(/InfluxDB by HTTP/influxdb.org.query_request.failed.rate["{#ORG_NAME}"],5m)>{$INFLUXDB.REQ.FAIL.MAX.WARN} | [{"tag": "scope", "value": "performance"}] | no url |

