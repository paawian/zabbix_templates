# HashiCorp Nomad Client by HTTP template description

Get HashiCorp Nomad client metrics by HTTP from metrics endpoint.

More information about metrics is available in the official documentation: https://developer.hashicorp.com/nomad/docs/operations/metrics-reference.

You can discuss this template or leave feedback on our forum: https://www.zabbix.com/forum/zabbix-suggestions-and-feedback.

Generated by official Zabbix template tool "Templator"

## Summary
* [items](#items)
* [macros](#macros)
* [triggers](#triggers)
* [discoveries](#discoveries)
  * [Discovery Allocated jobs discovery ](#discovery_allocated_jobs_discovery)
  * [Discovery Physical disks discovery ](#discovery_physical_disks_discovery)
  * [Discovery Drivers discovery ](#discovery_drivers_discovery)

<a name="items" />

## Items
| name | description | key | type | delay |
| ------------- |------------- |------------- |------------- |------------- |
| Service [rpc] state | Current [rpc] service state. | net.tcp.service[tcp,,{$NOMAD.CLIENT.RPC.PORT}] | SIMPLE | no delay |
| Service [serf] state | Current [serf] service state. | net.tcp.service[tcp,,{$NOMAD.CLIENT.SERF.PORT}] | SIMPLE | no delay |
| CPU allocated | Total amount of CPU shares the scheduler has allocated to tasks. | nomad.client.allocated.cpu | DEPENDENT | 0 |
| Disk allocated | Total amount of disk space the scheduler has allocated to tasks. | nomad.client.allocated.disk | DEPENDENT | 0 |
| Memory allocated | Total amount of memory the scheduler has allocated to tasks. | nomad.client.allocated.memory | DEPENDENT | 0 |
| Allocations blocked | Number of allocations waiting for previous versions. | nomad.client.allocations.blocked | DEPENDENT | 0 |
| Allocations completed, rate | Number of allocations completed. | nomad.client.allocations.complete | DEPENDENT | 0 |
| Allocations failed, rate | Number of allocations failed. | nomad.client.allocations.failed | DEPENDENT | 0 |
| Allocations migrating | Number of allocations migrating data from previous versions. | nomad.client.allocations.migrating | DEPENDENT | 0 |
| Allocations OOM killed | Number of allocations OOM killed. | nomad.client.allocations.oom_killed | DEPENDENT | 0 |
| Allocations pending | Number of allocations pending (received by the client but not yet running). | nomad.client.allocations.pending | DEPENDENT | 0 |
| Allocations restarted, rate | Number of allocations restarted. | nomad.client.allocations.restart | DEPENDENT | 0 |
| Allocations running | Number of allocations running. | nomad.client.allocations.running | DEPENDENT | 0 |
| Allocations starting | Number of allocations starting. | nomad.client.allocations.start | DEPENDENT | 0 |
| Allocations terminal | Number of allocations terminal. | nomad.client.allocations.terminal | DEPENDENT | 0 |
| CPU idle utilization | CPU utilization in idle state. | nomad.client.cpu.idle | DEPENDENT | 0 |
| CPU system utilization | CPU utilization in system space. | nomad.client.cpu.system | DEPENDENT | 0 |
| CPU total utilization | Total CPU utilization. | nomad.client.cpu.total | DEPENDENT | 0 |
| CPU user utilization | CPU utilization in user space. | nomad.client.cpu.user | DEPENDENT | 0 |
| Monitoring API response | Monitoring API response message. | nomad.client.data.api.response | DEPENDENT | 0 |
| Telemetry get | Telemetry data in raw format. | nomad.client.data.get | HTTP_AGENT | no delay |
| Allocations API response | Allocations API response message. | nomad.client.job.allocs.api.response | DEPENDENT | 0 |
| Allocated jobs get | Allocated jobs data in raw format. | nomad.client.job.allocs.get | HTTP_AGENT | 1h |
| Memory available | Total amount of memory available to processes which includes free and cached memory. | nomad.client.memory.available | DEPENDENT | 0 |
| Memory free | Amount of memory which is free. | nomad.client.memory.free | DEPENDENT | 0 |
| Memory size | Total amount of physical memory on the node. | nomad.client.memory.total | DEPENDENT | 0 |
| Memory used | Amount of memory used by processes. | nomad.client.memory.used | DEPENDENT | 0 |
| Metrics | Nomad client metrics in raw format. | nomad.client.metrics.get | DEPENDENT | 0 |
| Nodes API response | Nodes API response message. | nomad.client.node.info.api.response | DEPENDENT | 0 |
| Node info get | Node info data in raw format. | nomad.client.node.info.get | HTTP_AGENT | 1h |
| CPU unallocated | Total amount of CPU shares free for the scheduler to allocate to tasks. | nomad.client.unallocated.cpu | DEPENDENT | 0 |
| Disk unallocated | Total amount of disk space free for the scheduler to allocate to tasks. | nomad.client.unallocated.disk | DEPENDENT | 0 |
| Memory unallocated | Total amount of memory free for the scheduler to allocate to tasks. | nomad.client.unallocated.memory | DEPENDENT | 0 |
| Uptime | Uptime of the host running the Nomad client. | nomad.client.uptime | DEPENDENT | 0 |
| Nomad client version | Nomad client version. | nomad.client.version | DEPENDENT | 0 |


<a name="macros" />

## Macros
| macro | value |
| ------------- |------------- |
| {$NOMAD.API.RESPONSE.SUCCESS} | 200 |
| {$NOMAD.CLIENT.API.PORT} | 4646 |
| {$NOMAD.CLIENT.API.SCHEME} | http |
| {$NOMAD.CLIENT.OPEN.FDS.MAX.WARN} | 90 |
| {$NOMAD.CLIENT.RPC.PORT} | 4647 |
| {$NOMAD.CLIENT.SERF.PORT} | 4648 |
| {$NOMAD.CPU.UTIL.MIN} | 90 |
| {$NOMAD.DATA.TIMEOUT} | 15s |
| {$NOMAD.DISK.NAME.MATCHES} | .* |
| {$NOMAD.DISK.NAME.NOT_MATCHES} | CHANGE_IF_NEEDED |
| {$NOMAD.DRIVER.DETECT.MATCHES} | .* |
| {$NOMAD.DRIVER.DETECT.NOT_MATCHES} | CHANGE_IF_NEEDED |
| {$NOMAD.DRIVER.NAME.MATCHES} | .* |
| {$NOMAD.DRIVER.NAME.NOT_MATCHES} | CHANGE_IF_NEEDED |
| {$NOMAD.HTTP.PROXY} | no value |
| {$NOMAD.INODES.FREE.MIN.CRIT} | 10 |
| {$NOMAD.INODES.FREE.MIN.WARN} | 20 |
| {$NOMAD.JOB.NAME.MATCHES} | .* |
| {$NOMAD.JOB.NAME.NOT_MATCHES} | CHANGE_IF_NEEDED |
| {$NOMAD.JOB.NAMESPACE.MATCHES} | .* |
| {$NOMAD.JOB.NAMESPACE.NOT_MATCHES} | CHANGE_IF_NEEDED |
| {$NOMAD.JOB.TASK.GROUP.MATCHES} | .* |
| {$NOMAD.JOB.TASK.GROUP.NOT_MATCHES} | CHANGE_IF_NEEDED |
| {$NOMAD.JOB.TYPE.MATCHES} | .* |
| {$NOMAD.JOB.TYPE.NOT_MATCHES} | CHANGE_IF_NEEDED |
| {$NOMAD.RAM.AVAIL.MIN} | 5 |
| {$NOMAD.TOKEN} | <PUT YOUR AUTH TOKEN> |


<a name="triggers" />

## Triggers
| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Service [rpc] is down | AVERAGE | Cannot establish the connection to [rpc] service port {$NOMAD.CLIENT.RPC.PORT}.<br>Check the Nomad state and network connectivity between Nomad and Zabbix. | last(/HashiCorp Nomad Client by HTTP/net.tcp.service[tcp,,{$NOMAD.CLIENT.RPC.PORT}]) = 0 | [{"tag": "scope", "value": "availability"}] | no url |
| Service [serf] is down | AVERAGE | Cannot establish the connection to [serf] service port {$NOMAD.CLIENT.SERF.PORT}.<br>Check the Nomad state and network connectivity between Nomad and Zabbix. | last(/HashiCorp Nomad Client by HTTP/net.tcp.service[tcp,,{$NOMAD.CLIENT.SERF.PORT}]) = 0 | [{"tag": "scope", "value": "availability"}] | no url |
| OOM killed allocations found | WARNING | OOM killed allocations found. | last(/HashiCorp Nomad Client by HTTP/nomad.client.allocations.oom_killed) > 0 | [{"tag": "scope", "value": "performance"}] | no url |
| High CPU utilization | AVERAGE | CPU utilization is too high. The system might be slow to respond. | min(/HashiCorp Nomad Client by HTTP/nomad.client.cpu.total, 10m) >= {$NOMAD.CPU.UTIL.MIN} | [{"tag": "scope", "value": "performance"}] | no url |
| Monitoring API connection has failed | AVERAGE | Monitoring API connection has failed.<br>Ensure that Nomad API URL and the necessary permissions have been defined correctly, check the service state and network connectivity between Nomad and Zabbix. | find(/HashiCorp Nomad Client by HTTP/nomad.client.data.api.response,,"like","{$NOMAD.API.RESPONSE.SUCCESS}")=0 | [{"tag": "scope", "value": "availability"}] | no url |
| Allocations API connection has failed | AVERAGE | Allocations API connection has failed.<br>Ensure that Nomad API URL and the necessary permissions have been defined correctly, check the service state and network connectivity between Nomad and Zabbix. | find(/HashiCorp Nomad Client by HTTP/nomad.client.job.allocs.api.response,,"like","{$NOMAD.API.RESPONSE.SUCCESS}")=0 | [{"tag": "scope", "value": "availability"}] | no url |
| Nodes API connection has failed | AVERAGE | Nodes API connection has failed.<br>Ensure that Nomad API URL and the necessary permissions have been defined correctly, check the service state and network connectivity between Nomad and Zabbix. | find(/HashiCorp Nomad Client by HTTP/nomad.client.node.info.api.response,,"like","{$NOMAD.API.RESPONSE.SUCCESS}")=0 | [{"tag": "scope", "value": "availability"}] | no url |
| The host has been restarted | WARNING | The host uptime is less than 10 minutes. | last(/HashiCorp Nomad Client by HTTP/nomad.client.uptime) < 10m | [{"tag": "scope", "value": "notice"}] | no url |
| Nomad client version has changed | INFO | Nomad client version has changed. | change(/HashiCorp Nomad Client by HTTP/nomad.client.version)<>0 | [{"tag": "scope", "value": "availability"}] | no url |
| High memory utilization | AVERAGE | RAM utilization is too high. The system might be slow to respond. | (min(/HashiCorp Nomad Client by HTTP/nomad.client.memory.available, 10m) / last(/HashiCorp Nomad Client by HTTP/nomad.client.memory.total))*100 <= {$NOMAD.RAM.AVAIL.MIN} | [{"tag": "scope", "value": "performance"}] | no url |


<a name="discoveries" />

## Discoveries
| name | key | description | type | lifetime | delay |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Allocated jobs discovery | nomad.client.alloc.discovery | Allocated jobs discovery. | DEPENDENT | 0 | 0 |
| Physical disks discovery | nomad.client.disk.discovery | Physical disks discovery. | DEPENDENT | no lifetime | 0 |
| Drivers discovery | nomad.client.drivers.discovery | Client drivers discovery. | DEPENDENT | no lifetime | 0 |


<a name="discovery_allocated_jobs_discovery" />

## Discovery Allocated jobs discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| Job ["{#JOB.NAME}"] CPU allocated | Total CPU resources allocated by the ["{#JOB.NAME}"] job across all cores. | nomad.client.allocs.cpu.allocated["{#JOB.NAME}","{#JOB.TASK.GROUP}","{#JOB.NAMESPACE}"] | DEPENDENT |
| Job ["{#JOB.NAME}"] CPU system utilization | Total CPU resources consumed by the ["{#JOB.NAME}"] job in system space. | nomad.client.allocs.cpu.system["{#JOB.NAME}","{#JOB.TASK.GROUP}","{#JOB.NAMESPACE}"] | DEPENDENT |
| Job ["{#JOB.NAME}"] CPU throttled periods time | Total number of CPU periods that the ["{#JOB.NAME}"] job was throttled. | nomad.client.allocs.cpu.throttled_periods["{#JOB.NAME}","{#JOB.TASK.GROUP}","{#JOB.NAMESPACE}"] | DEPENDENT |
| Job ["{#JOB.NAME}"] CPU throttled time | Total time that the ["{#JOB.NAME}"] job was throttled. | nomad.client.allocs.cpu.throttled_time["{#JOB.NAME}","{#JOB.TASK.GROUP}","{#JOB.NAMESPACE}"] | DEPENDENT |
| Job ["{#JOB.NAME}"] CPU total utilization | Total CPU resources consumed by the ["{#JOB.NAME}"] job across all cores. | nomad.client.allocs.cpu.total_percent["{#JOB.NAME}","{#JOB.TASK.GROUP}","{#JOB.NAMESPACE}"] | DEPENDENT |
| Job ["{#JOB.NAME}"] CPU ticks | CPU ticks consumed by the process for the ["{#JOB.NAME}"] job in the last collection interval. | nomad.client.allocs.cpu.total_ticks["{#JOB.NAME}","{#JOB.TASK.GROUP}","{#JOB.NAMESPACE}"] | DEPENDENT |
| Job ["{#JOB.NAME}"] CPU user utilization | Total CPU resources consumed by the ["{#JOB.NAME}"] job in user space. | nomad.client.allocs.cpu.user["{#JOB.NAME}","{#JOB.TASK.GROUP}","{#JOB.NAMESPACE}"] | DEPENDENT |
| Job ["{#JOB.NAME}"] Memory allocated | Amount of memory allocated by the ["{#JOB.NAME}"] job. | nomad.client.allocs.memory.allocated["{#JOB.NAME}","{#JOB.TASK.GROUP}","{#JOB.NAMESPACE}"] | DEPENDENT |
| Job ["{#JOB.NAME}"] Memory cached | Amount of memory cached by the ["{#JOB.NAME}"] job. | nomad.client.allocs.memory.cache["{#JOB.NAME}","{#JOB.TASK.GROUP}","{#JOB.NAMESPACE}"] | DEPENDENT |
| Job ["{#JOB.NAME}"] Memory swapped | Amount of memory swapped by the ["{#JOB.NAME}"] job. | nomad.client.allocs.memory.swap["{#JOB.NAME}","{#JOB.TASK.GROUP}","{#JOB.NAMESPACE}"] | DEPENDENT |
| Job ["{#JOB.NAME}"] Memory used | Total amount of memory used by the ["{#JOB.NAME}"] job. | nomad.client.allocs.memory.usage["{#JOB.NAME}","{#JOB.TASK.GROUP}","{#JOB.NAMESPACE}"] | DEPENDENT |


<a name="discovery_physical_disks_discovery" />

## Discovery Physical disks discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| Disk ["{#DEV.NAME}"] space available | Amount of space which is available on ["{#DEV.NAME}"] disk. | nomad.client.disk.available["{#DEV.NAME}"] | DEPENDENT |
| Disk ["{#DEV.NAME}"] inodes utilization | Disk space consumed by the inodes on ["{#DEV.NAME}"] disk. | nomad.client.disk.inodes_percent["{#DEV.NAME}"] | DEPENDENT |
| Disk ["{#DEV.NAME}"] size | Total size of the ["{#DEV.NAME}"] device. | nomad.client.disk.size["{#DEV.NAME}"] | DEPENDENT |
| Disk ["{#DEV.NAME}"] space used | Amount of disk ["{#DEV.NAME}"] space which has been used. | nomad.client.disk.used["{#DEV.NAME}"] | DEPENDENT |
| Disk ["{#DEV.NAME}"] space utilization | Percentage of disk ["{#DEV.NAME}"] space used. | nomad.client.disk.used_percent["{#DEV.NAME}"] | DEPENDENT |


### Triggers

| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Running out of free inodes on [{#DEV.NAME}] device | AVERAGE | It may become impossible to write to a disk if there are no index nodes left.<br>The following error messages may be returned as symptoms, even though the free space:<br>- No space left on device;<br>- Disk is full. | min(/HashiCorp Nomad Client by HTTP/nomad.client.disk.inodes_percent["{#DEV.NAME}"],5m) >= {$NOMAD.INODES.FREE.MIN.CRIT:"{#DEV.NAME}"} | [{"tag": "scope", "value": "capacity"}] | no url |
| Running out of free inodes on [{#DEV.NAME}] device | WARNING | It may become impossible to write to a disk if there are no index nodes left.<br>The following error messages may be returned as symptoms, even though the free space:<br>- No space left on device;<br>- Disk is full. | min(/HashiCorp Nomad Client by HTTP/nomad.client.disk.inodes_percent["{#DEV.NAME}"],5m) >= {$NOMAD.INODES.FREE.MIN.WARN:"{#DEV.NAME}"} | [{"tag": "scope", "value": "capacity"}] | no url |
| High disk [{#DEV.NAME}] utilization | AVERAGE | High disk [{#DEV.NAME}] utilization. | min(/HashiCorp Nomad Client by HTTP/nomad.client.disk.used_percent["{#DEV.NAME}"],5m) >= {$NOMAD.DISK.UTIL.MIN.CRIT:"{#DEV.NAME}"} | [{"tag": "scope", "value": "capacity"}] | no url |
| High disk [{#DEV.NAME}] utilization | WARNING | High disk [{#DEV.NAME}] utilization. | min(/HashiCorp Nomad Client by HTTP/nomad.client.disk.used_percent["{#DEV.NAME}"],5m) >= {$NOMAD.DISK.UTIL.MIN.WARN:"{#DEV.NAME}"} | [{"tag": "scope", "value": "capacity"}] | no url |


<a name="discovery_drivers_discovery" />

## Discovery Drivers discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| Driver [{#DRIVER.NAME}] detection state | Driver [{#DRIVER.NAME}] detection state. | nomad.client.driver.detected["{#DRIVER.NAME}"] | DEPENDENT |
| Driver [{#DRIVER.NAME}] state | Driver [{#DRIVER.NAME}] state. | nomad.client.driver.state["{#DRIVER.NAME}"] | DEPENDENT |


### Triggers

| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Driver [{#DRIVER.NAME}] detection state has changed | INFO | The [{#DRIVER.NAME}] driver detection state has changed. | change(/HashiCorp Nomad Client by HTTP/nomad.client.driver.detected["{#DRIVER.NAME}"]) <> 0 | [{"tag": "scope", "value": "availability"}] | no url |
| Driver [{#DRIVER.NAME}] is in unhealthy state | WARNING | The [{#DRIVER.NAME}] driver detected, but its state is unhealthy. | last(/HashiCorp Nomad Client by HTTP/nomad.client.driver.state["{#DRIVER.NAME}"]) = 0 and last(/HashiCorp Nomad Client by HTTP/nomad.client.driver.detected["{#DRIVER.NAME}"]) = 1 | [{"tag": "scope", "value": "availability"}] | no url |

