# Apache Kafka by JMX template description

Official JMX Template for Apache Kafka.
  The metrics are collected by JMX.
  You can set {$KAFKA.USER} and {$KAFKA.PASSWORD} macros in the template for using on the host level.

You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback

Generated by official Zabbix template tool "Templator"

## Summary
* [items](#items)
* [macros](#macros)
* [triggers](#triggers)
* [discoveries](#discoveries)
  * [Discovery Topic Metrics (read) ](#discovery_topic_metrics_(read))
  * [Discovery Topic Metrics (errors) ](#discovery_topic_metrics_(errors))
  * [Discovery Topic Metrics (write) ](#discovery_topic_metrics_(write))

<a name="items" />

## Items
| name | description | key | type | delay |
| ------------- |------------- |------------- |------------- |------------- |
| Leader election per second | Number of leader elections per second. | jmx["kafka.controller:type=ControllerStats,name=LeaderElectionRateAndTimeMs","Count"] | JMX | no delay |
| Unclean leader election per second | Number of “unclean” elections per second. | jmx["kafka.controller:type=ControllerStats,name=UncleanLeaderElectionsPerSec","Count"] | JMX | no delay |
| Controller state on broker | One indicates that the broker is the controller for the cluster. | jmx["kafka.controller:type=KafkaController,name=ActiveControllerCount","Value"] | JMX | no delay |
| Offline partitions count | Number of partitions that don't have an active leader. | jmx["kafka.controller:type=KafkaController,name=OfflinePartitionsCount","Value"] | JMX | no delay |
| Ineligible pending replica deletes | The number of ineligible pending replica deletes. | jmx["kafka.controller:type=KafkaController,name=ReplicasIneligibleToDeleteCount","Value"] | JMX | no delay |
| Pending replica deletes | The number of pending replica deletes. | jmx["kafka.controller:type=KafkaController,name=ReplicasToDeleteCount","Value"] | JMX | no delay |
| Ineligible pending topic deletes | The number of ineligible pending topic deletes. | jmx["kafka.controller:type=KafkaController,name=TopicsIneligibleToDeleteCount","Value"] | JMX | no delay |
| Pending topic deletes | The number of pending topic deletes. | jmx["kafka.controller:type=KafkaController,name=TopicsToDeleteCount","Value"] | JMX | no delay |
| Offline log directory count | The number of offline log directories (for example, after a hardware failure). | jmx["kafka.log:type=LogManager,name=OfflineLogDirectoryCount","Value"] | JMX | no delay |
| Fetch-Consumer response send time, p95 | The time taken, in milliseconds, to send the response for 95th percentile. | jmx["kafka.network:type=RequestMetrics,name=ResponseSendTimeMs,request=FetchConsumer","95thPercentile"] | JMX | no delay |
| Fetch-Consumer response send time, p99 | The time taken, in milliseconds, to send the response for 99th percentile. | jmx["kafka.network:type=RequestMetrics,name=ResponseSendTimeMs,request=FetchConsumer","99thPercentile"] | JMX | no delay |
| Fetch-Consumer response send time, mean | Average time taken, in milliseconds, to send the response. | jmx["kafka.network:type=RequestMetrics,name=ResponseSendTimeMs,request=FetchConsumer","Mean"] | JMX | no delay |
| Fetch-Follower response send time, p95 | The time taken, in milliseconds, to send the response for 95th percentile. | jmx["kafka.network:type=RequestMetrics,name=ResponseSendTimeMs,request=FetchFollower","95thPercentile"] | JMX | no delay |
| Fetch-Follower response send time, p99 | The time taken, in milliseconds, to send the response for 99th percentile. | jmx["kafka.network:type=RequestMetrics,name=ResponseSendTimeMs,request=FetchFollower","99thPercentile"] | JMX | no delay |
| Fetch-Follower response send time, mean | Average time taken, in milliseconds, to send the response. | jmx["kafka.network:type=RequestMetrics,name=ResponseSendTimeMs,request=FetchFollower","Mean"] | JMX | no delay |
| Produce response send time, p95 | The time taken, in milliseconds, to send the response for 95th percentile. | jmx["kafka.network:type=RequestMetrics,name=ResponseSendTimeMs,request=Produce","95thPercentile"] | JMX | no delay |
| Produce response send time, p99 | The time taken, in milliseconds, to send the response for 99th percentile. | jmx["kafka.network:type=RequestMetrics,name=ResponseSendTimeMs,request=Produce","99thPercentile"] | JMX | no delay |
| Produce response send time, mean | Average time taken, in milliseconds, to send the response. | jmx["kafka.network:type=RequestMetrics,name=ResponseSendTimeMs,request=Produce","Mean"] | JMX | no delay |
| Temporary memory size in bytes (Fetch), max | The maximum of temporary memory used for converting message formats and decompressing messages. | jmx["kafka.network:type=RequestMetrics,name=TemporaryMemoryBytes,request=Fetch","Max"] | JMX | no delay |
| Temporary memory size in bytes (Fetch), min | The minimum of temporary memory used for converting message formats and decompressing messages. | jmx["kafka.network:type=RequestMetrics,name=TemporaryMemoryBytes,request=Fetch","Mean"] | JMX | no delay |
| Temporary memory size in bytes (Produce), max | The maximum of temporary memory used for converting message formats and decompressing messages. | jmx["kafka.network:type=RequestMetrics,name=TemporaryMemoryBytes,request=Produce","Max"] | JMX | no delay |
| Temporary memory size in bytes (Produce), avg | The amount of temporary memory used for converting message formats and decompressing messages. | jmx["kafka.network:type=RequestMetrics,name=TemporaryMemoryBytes,request=Produce","Mean"] | JMX | no delay |
| Temporary memory size in bytes (Produce), min | The minimum of temporary memory used for converting message formats and decompressing messages. | jmx["kafka.network:type=RequestMetrics,name=TemporaryMemoryBytes,request=Produce","Min"] | JMX | no delay |
| Fetch-Consumer request total time, p95 | Time in ms to serve the Fetch-Consumer request for 95th percentile. | jmx["kafka.network:type=RequestMetrics,name=TotalTimeMs,request=FetchConsumer","95thPercentile"] | JMX | no delay |
| Fetch-Consumer request total time, p99 | Time in ms to serve the specified Fetch-Consumer for 99th percentile. | jmx["kafka.network:type=RequestMetrics,name=TotalTimeMs,request=FetchConsumer","99thPercentile"] | JMX | no delay |
| Fetch-Consumer request total time, mean | Average time in ms to serve the Fetch-Consumer request. | jmx["kafka.network:type=RequestMetrics,name=TotalTimeMs,request=FetchConsumer","Mean"] | JMX | no delay |
| Fetch-Follower request total time, p95 | Time in ms to serve the Fetch-Follower request for 95th percentile. | jmx["kafka.network:type=RequestMetrics,name=TotalTimeMs,request=FetchFollower","95thPercentile"] | JMX | no delay |
| Fetch-Follower request total time, p99 | Time in ms to serve the Fetch-Follower request for 99th percentile. | jmx["kafka.network:type=RequestMetrics,name=TotalTimeMs,request=FetchFollower","99thPercentile"] | JMX | no delay |
| Fetch-Follower request total time, mean | Average time in ms to serve the Fetch-Follower request. | jmx["kafka.network:type=RequestMetrics,name=TotalTimeMs,request=FetchFollower","Mean"] | JMX | no delay |
| Produce request total time, p95 | Time in ms  to serve the Produce requests for 95th percentile. | jmx["kafka.network:type=RequestMetrics,name=TotalTimeMs,request=Produce","95thPercentile"] | JMX | no delay |
| Produce request total time, p99 | Time in ms  to serve the Produce requests for 99th percentile. | jmx["kafka.network:type=RequestMetrics,name=TotalTimeMs,request=Produce","99thPercentile"] | JMX | no delay |
| Produce request total time, mean | Average time in ms to serve the Produce request. | jmx["kafka.network:type=RequestMetrics,name=TotalTimeMs,request=Produce","Mean"] | JMX | no delay |
| UpdateMetadata request total time, p95 | Time for update metadata requests for 95th percentile. | jmx["kafka.network:type=RequestMetrics,name=TotalTimeMs,request=UpdateMetadata","95thPercentile"] | JMX | no delay |
| UpdateMetadata request total time, p99 | Time for update metadata requests for 99th percentile. | jmx["kafka.network:type=RequestMetrics,name=TotalTimeMs,request=UpdateMetadata","99thPercentile"] | JMX | no delay |
| Fetch-Consumer request total time, mean | Average time for a request to update metadata. | jmx["kafka.network:type=RequestMetrics,name=TotalTimeMs,request=UpdateMetadata","Mean"] | JMX | no delay |
| Network processor average idle percent | The average percentage of time that the network processors are idle. | jmx["kafka.network:type=SocketServer,name=NetworkProcessorAvgIdlePercent","Value"] | JMX | no delay |
| Uptime | The service uptime expressed in seconds. | jmx["kafka.server:type=app-info","start-time-ms"] | JMX | no delay |
| Version | Current version of broker. | jmx["kafka.server:type=app-info","version"] | JMX | no delay |
| Bytes in per second | The rate at which data sent from producers is consumed by the broker. | jmx["kafka.server:type=BrokerTopicMetrics,name=BytesInPerSec","Count"] | JMX | no delay |
| Bytes out per second | The rate at which data is fetched and read from the broker by consumers. | jmx["kafka.server:type=BrokerTopicMetrics,name=BytesOutPerSec","Count"] | JMX | no delay |
| Bytes rejected per second | The rate at which bytes rejected per second by the broker. | jmx["kafka.server:type=BrokerTopicMetrics,name=BytesRejectedPerSec","Count"] | JMX | no delay |
| Client fetch request failed per second | Number of client fetch request failures per second. | jmx["kafka.server:type=BrokerTopicMetrics,name=FailedFetchRequestsPerSec","Count"] | JMX | no delay |
| Produce requests failed per second | Number of failed produce requests per second. | jmx["kafka.server:type=BrokerTopicMetrics,name=FailedProduceRequestsPerSec","Count"] | JMX | no delay |
| Messages in per second | The rate at which individual messages are consumed by the broker. | jmx["kafka.server:type=BrokerTopicMetrics,name=MessagesInPerSec","Count"] | JMX | no delay |
| Requests in producer purgatory | Number of requests waiting in producer purgatory. | jmx["kafka.server:type=DelayedOperationPurgatory,name=PurgatorySize,delayedOperation=Fetch","Value"] | JMX | no delay |
| Requests in fetch purgatory | Number of requests waiting in fetch purgatory. | jmx["kafka.server:type=DelayedOperationPurgatory,name=PurgatorySize,delayedOperation=Produce","Value"] | JMX | no delay |
| Request handler average idle percent | Indicates the percentage of time that the request handler (IO) threads are not in use. | jmx["kafka.server:type=KafkaRequestHandlerPool,name=RequestHandlerAvgIdlePercent","OneMinuteRate"] | JMX | no delay |
| Replication maximum lag | The maximum lag between the time that messages are received by the leader replica and by the follower replicas. | jmx["kafka.server:type=ReplicaFetcherManager,name=MaxLag,clientId=Replica","Value"] | JMX | no delay |
| ISR expands per second | The rate at which the number of ISRs in the broker increases. | jmx["kafka.server:type=ReplicaManager,name=IsrExpandsPerSec","Count"] | JMX | no delay |
| ISR shrink per second | Rate of replicas leaving the ISR pool. | jmx["kafka.server:type=ReplicaManager,name=IsrShrinksPerSec","Count"] | JMX | no delay |
| Leader count | The number of replicas for which this broker is the leader. | jmx["kafka.server:type=ReplicaManager,name=LeaderCount","Value"] | JMX | no delay |
| Partition count | The number of partitions in the broker. | jmx["kafka.server:type=ReplicaManager,name=PartitionCount","Value"] | JMX | no delay |
| Number of reassigning partitions | The number of reassigning leader partitions on a broker. | jmx["kafka.server:type=ReplicaManager,name=ReassigningPartitions","Value"] | JMX | no delay |
| Under minimum ISR partition count | The number of partitions under the minimum In-Sync Replica (ISR) count. | jmx["kafka.server:type=ReplicaManager,name=UnderMinIsrPartitionCount","Value"] | JMX | no delay |
| Under replicated partitions | The number of partitions that have not been fully replicated in the follower replicas (the number of non-reassigning replicas - the number of ISR > 0). | jmx["kafka.server:type=ReplicaManager,name=UnderReplicatedPartitions","Value"] | JMX | no delay |
| Request queue size | The size of the delay queue. | jmx["kafka.server:type=Request","queue-size"] | JMX | no delay |
| ZooKeeper connection status | Connection status of broker's ZooKeeper session. | jmx["kafka.server:type=SessionExpireListener,name=SessionState","Value"] | JMX | no delay |
| ZooKeeper disconnect rate | ZooKeeper client disconnect per second. | jmx["kafka.server:type=SessionExpireListener,name=ZooKeeperDisconnectsPerSec","Count"] | JMX | no delay |
| ZooKeeper session expiration rate | ZooKeeper client session expiration per second. | jmx["kafka.server:type=SessionExpireListener,name=ZooKeeperExpiresPerSec","Count"] | JMX | no delay |
| ZooKeeper readonly rate | ZooKeeper client readonly per second. | jmx["kafka.server:type=SessionExpireListener,name=ZooKeeperReadOnlyConnectsPerSec","Count"] | JMX | no delay |
| ZooKeeper sync rate | ZooKeeper client sync per second. | jmx["kafka.server:type=SessionExpireListener,name=ZooKeeperSyncConnectsPerSec","Count"] | JMX | no delay |
| ZooKeeper client request latency | Latency in milliseconds for ZooKeeper requests from broker. | jmx["kafka.server:type=ZooKeeperClientMetrics,name=ZooKeeperRequestLatencyMs","Count"] | JMX | no delay |


<a name="macros" />

## Macros
| macro | value |
| ------------- |------------- |
| {$KAFKA.NET_PROC_AVG_IDLE.MIN.WARN} | 30 |
| {$KAFKA.PASSWORD} | zabbix |
| {$KAFKA.REQUEST_HANDLER_AVG_IDLE.MIN.WARN} | 30 |
| {$KAFKA.TOPIC.MATCHES} | .* |
| {$KAFKA.TOPIC.NOT_MATCHES} | __consumer_offsets |
| {$KAFKA.USER} | zabbix |


<a name="triggers" />

## Triggers
| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Unclean leader election detected | AVERAGE | Unclean leader elections occur when there is no qualified partition leader among Kafka brokers. If Kafka is configured to allow an unclean leader election, a leader is chosen from the out-of-sync replicas, and any messages that were not synced prior to the loss of the former leader are lost forever. Essentially, unclean leader elections sacrifice consistency for availability. | last(/Apache Kafka by JMX/jmx["kafka.controller:type=ControllerStats,name=UncleanLeaderElectionsPerSec","Count"])>0 | [{"tag": "scope", "value": "notice"}] | no url |
| One or more partitions have no leader | WARNING | Any partition without an active leader will be completely inaccessible, and both consumers and producers of that partition will be blocked until a leader becomes available. | last(/Apache Kafka by JMX/jmx["kafka.controller:type=KafkaController,name=OfflinePartitionsCount","Value"]) > 0 | [{"tag": "scope", "value": "notice"}] | no url |
| There are offline log directories | WARNING | The offline log directory count metric indicate the number of log directories which are offline (due to a hardware failure for example) so that the broker cannot store incoming messages anymore. | last(/Apache Kafka by JMX/jmx["kafka.log:type=LogManager,name=OfflineLogDirectoryCount","Value"]) > 0 | [{"tag": "scope", "value": "notice"}] | no url |
| Failed to fetch info data | WARNING | Zabbix has not received data for items for the last 15 minutes | nodata(/Apache Kafka by JMX/jmx["kafka.network:type=SocketServer,name=NetworkProcessorAvgIdlePercent","Value"],15m)=1 | [{"tag": "scope", "value": "availability"}] | no url |
| Network processor average idle percent is too low | AVERAGE | The network processor idle ratio metric indicates the percentage of time the network processor are not in use. The lower this number, the more loaded the broker is. | max(/Apache Kafka by JMX/jmx["kafka.network:type=SocketServer,name=NetworkProcessorAvgIdlePercent","Value"],15m)<{$KAFKA.NET_PROC_AVG_IDLE.MIN.WARN} | [{"tag": "scope", "value": "notice"}] | no url |
| Kafka service has been restarted | INFO | Uptime is less than 10 minutes. | last(/Apache Kafka by JMX/jmx["kafka.server:type=app-info","start-time-ms"])<10m | [{"tag": "scope", "value": "notice"}] | no url |
| Version has changed | INFO | The Kafka version has changed. Acknowledge to close the problem manually. | last(/Apache Kafka by JMX/jmx["kafka.server:type=app-info","version"],#1)<>last(/Apache Kafka by JMX/jmx["kafka.server:type=app-info","version"],#2) and length(last(/Apache Kafka by JMX/jmx["kafka.server:type=app-info","version"]))>0 | [{"tag": "scope", "value": "notice"}] | no url |
| Request handler average idle percent is too low | AVERAGE | The request handler idle ratio metric indicates the percentage of time the request handlers are not in use. The lower this number, the more loaded the broker is. | max(/Apache Kafka by JMX/jmx["kafka.server:type=KafkaRequestHandlerPool,name=RequestHandlerAvgIdlePercent","OneMinuteRate"],15m)<{$KAFKA.REQUEST_HANDLER_AVG_IDLE.MIN.WARN} | [{"tag": "scope", "value": "notice"}] | no url |
| There are partitions under the min ISR | AVERAGE | The Under min ISR partitions metric displays the number of partitions, where the number of In-Sync Replicas (ISR) is less than the minimum number of in-sync replicas specified. The two most common causes of under-min ISR partitions are that one or more brokers is unresponsive, or the cluster is experiencing performance issues and one or more brokers are falling behind. | last(/Apache Kafka by JMX/jmx["kafka.server:type=ReplicaManager,name=UnderMinIsrPartitionCount","Value"])>0 | [{"tag": "scope", "value": "notice"}] | no url |
| There are under replicated partitions | AVERAGE | The Under replicated partitions metric displays the number of partitions that do not have enough replicas to meet the desired replication factor. A partition will also be considered under-replicated if the correct number of replicas exist, but one or more of the replicas have fallen significantly behind the partition leader. The two most common causes of under-replicated partitions are that one or more brokers is unresponsive, or the cluster is experiencing performance issues and one or more brokers have fallen behind. | last(/Apache Kafka by JMX/jmx["kafka.server:type=ReplicaManager,name=UnderReplicatedPartitions","Value"])>0 | [{"tag": "scope", "value": "notice"}] | no url |
| Broker is not connected to ZooKeeper | AVERAGE | no description | find(/Apache Kafka by JMX/jmx["kafka.server:type=SessionExpireListener,name=SessionState","Value"],,"regexp","CONNECTED")=0 | [{"tag": "scope", "value": "availability"}] | no url |


<a name="discoveries" />

## Discoveries
| name | key | description | type | lifetime | delay |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Topic Metrics (read) | jmx.discovery[beans,"kafka.server:type=BrokerTopicMetrics,name=BytesOutPerSec,topic=*"] | no description | JMX | no lifetime | 1h |
| Topic Metrics (errors) | jmx.discovery[beans,"kafka.server:type=BrokerTopicMetrics,name=BytesRejectedPerSec,topic=*"] | no description | JMX | no lifetime | 1h |
| Topic Metrics (write) | jmx.discovery[beans,"kafka.server:type=BrokerTopicMetrics,name=MessagesInPerSec,topic=*"] | no description | JMX | no lifetime | 1h |


<a name="discovery_topic_metrics_(read)" />

## Discovery Topic Metrics (read)

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| Kafka {#JMXTOPIC}: Bytes out per second | The rate at which data is fetched and read from the broker by consumers (by topic). | jmx["kafka.server:type=BrokerTopicMetrics,name=BytesOutPerSec,topic={#JMXTOPIC}","Count"] | JMX |


<a name="discovery_topic_metrics_(errors)" />

## Discovery Topic Metrics (errors)

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| Kafka {#JMXTOPIC}: Bytes rejected per second | Rejected bytes rate by topic. | jmx["kafka.server:type=BrokerTopicMetrics,name=BytesRejectedPerSec,topic={#JMXTOPIC}","Count"] | JMX |


<a name="discovery_topic_metrics_(write)" />

## Discovery Topic Metrics (write)

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| Kafka {#JMXTOPIC}: Bytes in per second | The rate at which data sent from producers is consumed by topic. | jmx["kafka.server:type=BrokerTopicMetrics,name=BytesInPerSec,topic={#JMXTOPIC}","Count"] | JMX |
| Kafka {#JMXTOPIC}: Messages in per second | The rate at which individual messages are consumed by topic. | jmx["kafka.server:type=BrokerTopicMetrics,name=MessagesInPerSec,topic={#JMXTOPIC}","Count"] | JMX |

