# Kubernetes nodes by HTTP template description

Get Kubernetes nodes metrics by HTTP.
Metrics are collected by requests to Kubernetes API.

Don't forget to read the README.md for the correct setup of the template.

You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback

Generated by official Zabbix template tool "Templator"

## Summary
* [items](#items)
* [macros](#macros)
* [triggers](#triggers)
* [discoveries](#discoveries)
  * [Discovery Node discovery ](#discovery_node_discovery)
  * [Discovery Pod discovery ](#discovery_pod_discovery)

<a name="items"></a>

## Items
| name | description | key | type | delay |
| ------------- |------------- |------------- |------------- |------------- |
| Get nodes | Collecting and processing cluster nodes data via Kubernetes API. | kube.nodes | SCRIPT | 0;s00 |
| Get nodes check | Data collection check. | kube.nodes.check | DEPENDENT | 0 |


<a name="macros"></a>

## Macros
| macro | value |
| ------------- |------------- |
| {$KUBE.API.TOKEN} | no value |
| {$KUBE.API.URL} | https://kubernetes.default.svc.cluster.local:443 |
| {$KUBE.HTTP.PROXY} | no value |
| {$KUBE.LLD.FILTER.NODE.MATCHES} | .* |
| {$KUBE.LLD.FILTER.NODE.NOT_MATCHES} | CHANGE_IF_NEEDED |
| {$KUBE.LLD.FILTER.NODE.ROLE.MATCHES} | .* |
| {$KUBE.LLD.FILTER.NODE.ROLE.NOT_MATCHES} | CHANGE_IF_NEEDED |
| {$KUBE.LLD.FILTER.POD.NAMESPACE.MATCHES} | .* |
| {$KUBE.LLD.FILTER.POD.NAMESPACE.NOT_MATCHES} | CHANGE_IF_NEEDED |
| {$KUBE.NODE.FILTER.ANNOTATIONS} | no value |
| {$KUBE.NODE.FILTER.LABELS} | no value |
| {$KUBE.NODES.ENDPOINT.NAME} | zabbix-zabbix-helm-chrt-agent |
| {$KUBE.POD.FILTER.ANNOTATIONS} | no value |
| {$KUBE.POD.FILTER.LABELS} | no value |


<a name="triggers"></a>

## Triggers
| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Kubernetes: Failed to get nodes | WARNING | no description | length(last(/Kubernetes nodes by HTTP/kube.nodes.check))>0 | [{"tag": "scope", "value": "availability"}] | no url |


<a name="discoveries"></a>

## Discoveries
| name | key | description | type | lifetime | delay |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Node discovery | kube.node.discovery | no description | DEPENDENT | no lifetime | 0 |
| Pod discovery | kube.pod.discovery | no description | DEPENDENT | 0 | 0 |


<a name="discovery_node_discovery" />

## Discovery Node discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| Node [{#NAME}] Addresses: External IP | Typically the IP address of the node that is externally routable (available from outside the cluster). | kube.node.addresses.external_ip[{#NAME}] | DEPENDENT |
| Node [{#NAME}] Addresses: Internal IP | Typically the IP address of the node that is routable only within the cluster. | kube.node.addresses.internal_ip[{#NAME}] | DEPENDENT |
| Node [{#NAME}] Allocatable: CPU | Allocatable CPU.<br><br>'Allocatable' on a Kubernetes node is defined as the amount of compute resources that are available for pods. The scheduler does not over-subscribe 'Allocatable'. 'CPU', 'memory' and 'ephemeral-storage' are supported as of now. | kube.node.allocatable.cpu[{#NAME}] | DEPENDENT |
| Node [{#NAME}] Allocatable: Memory | Allocatable Memory.<br><br>'Allocatable' on a Kubernetes node is defined as the amount of compute resources that are available for pods. The scheduler does not over-subscribe 'Allocatable'. 'CPU', 'memory' and 'ephemeral-storage' are supported as of now. | kube.node.allocatable.memory[{#NAME}] | DEPENDENT |
| Node [{#NAME}] Allocatable: Pods | https://kubernetes.io/docs/tasks/administer-cluster/reserve-compute-resources/ | kube.node.allocatable.pods[{#NAME}] | DEPENDENT |
| Node [{#NAME}] Capacity: CPU | CPU resource capacity.<br><br>https://kubernetes.io/docs/concepts/architecture/nodes/#capacity | kube.node.capacity.cpu[{#NAME}] | DEPENDENT |
| Node [{#NAME}] Capacity: Memory | Memory resource capacity.<br><br>https://kubernetes.io/docs/concepts/architecture/nodes/#capacity | kube.node.capacity.memory[{#NAME}] | DEPENDENT |
| Node [{#NAME}] Capacity: Pods | https://kubernetes.io/docs/tasks/administer-cluster/reserve-compute-resources/ | kube.node.capacity.pods[{#NAME}] | DEPENDENT |
| Node [{#NAME}] Conditions: Disk pressure | True if pressure exists on the disk size - that is, if the disk capacity is low; otherwise False. | kube.node.conditions.diskpressure[{#NAME}] | DEPENDENT |
| Node [{#NAME}] Conditions: Memory pressure | True if pressure exists on the node memory - that is, if the node memory is low; otherwise False. | kube.node.conditions.memorypressure[{#NAME}] | DEPENDENT |
| Node [{#NAME}] Conditions: Network unavailable | True if the network for the node is not correctly configured, otherwise False. | kube.node.conditions.networkunavailable[{#NAME}] | DEPENDENT |
| Node [{#NAME}] Conditions: PID pressure | True if pressure exists on the processes - that is, if there are too many processes on the node; otherwise False. | kube.node.conditions.pidpressure[{#NAME}] | DEPENDENT |
| Node [{#NAME}] Conditions: Ready | True if the node is healthy and ready to accept pods, False if the node is not healthy and is not accepting pods, and Unknown if the node controller has not heard from the node in the last node-monitor-grace-period (default is 40 seconds). | kube.node.conditions.ready[{#NAME}] | DEPENDENT |
| Node [{#NAME}]: Get data | Collecting and processing cluster by node [{#NAME}] data via Kubernetes API. | kube.node.get[{#NAME}] | DEPENDENT |
| Node [{#NAME}] Info: Architecture | Node architecture. | kube.node.info.architecture[{#NAME}] | DEPENDENT |
| Node [{#NAME}] Info: Container runtime | Container runtime.<br><br>https://kubernetes.io/docs/setup/production-environment/container-runtimes/ | kube.node.info.containerruntime[{#NAME}] | DEPENDENT |
| Node [{#NAME}] Info: Kernel version | Node kernel version. | kube.node.info.kernelversion[{#NAME}] | DEPENDENT |
| Node [{#NAME}] Info: Kubelet version | Version of Kubelet. | kube.node.info.kubeletversion[{#NAME}] | DEPENDENT |
| Node [{#NAME}] Info: KubeProxy version | Version of KubeProxy. | kube.node.info.kubeproxyversion[{#NAME}] | DEPENDENT |
| Node [{#NAME}] Info: Operating system | Node operating system. | kube.node.info.operatingsystem[{#NAME}] | DEPENDENT |
| Node [{#NAME}] Info: OS image | Node OS image. | kube.node.info.osversion[{#NAME}] | DEPENDENT |
| Node [{#NAME}] Info: Roles | Node roles. | kube.node.info.roles[{#NAME}] | DEPENDENT |
| Node [{#NAME}] Limits: CPU | Node CPU limits.<br><br>https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/ | kube.node.limits.cpu[{#NAME}] | DEPENDENT |
| Node [{#NAME}] Limits: Memory | Node Memory limits.<br><br>https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/ | kube.node.limits.memory[{#NAME}] | DEPENDENT |
| Node [{#NAME}] Requests: CPU | Node CPU requests.<br><br>https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/ | kube.node.requests.cpu[{#NAME}] | DEPENDENT |
| Node [{#NAME}] Requests: Memory | Node Memory requests.<br><br>https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/ | kube.node.requests.memory[{#NAME}] | DEPENDENT |
| Node [{#NAME}] Uptime | Node uptime. | kube.node.uptime[{#NAME}] | DEPENDENT |
| Node [{#NAME}] Used: Pods | Current number of pods on the node. | kube.node.used.pods[{#NAME}] | DEPENDENT |


### Triggers

| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Node [{#NAME}] Conditions: Pressure exists on the disk size | WARNING | True - pressure exists on the disk size - that is, if the disk capacity is low; otherwise False. | last(/Kubernetes nodes by HTTP/kube.node.conditions.diskpressure[{#NAME}])=1 | [{"tag": "scope", "value": "performance"}] | no url |
| Node [{#NAME}] Conditions: Pressure exists on the node memory | WARNING | True - pressure exists on the node memory - that is, if the node memory is low; otherwise False | last(/Kubernetes nodes by HTTP/kube.node.conditions.memorypressure[{#NAME}])=1 | [{"tag": "scope", "value": "performance"}] | no url |
| Node [{#NAME}] Conditions: Network is not correctly configured | WARNING | True - the network for the node is not correctly configured, otherwise False | last(/Kubernetes nodes by HTTP/kube.node.conditions.networkunavailable[{#NAME}])=1 | [{"tag": "scope", "value": "availability"}] | no url |
| Node [{#NAME}] Conditions: Pressure exists on the processes | WARNING | True - pressure exists on the processes - that is, if there are too many processes on the node; otherwise False | last(/Kubernetes nodes by HTTP/kube.node.conditions.pidpressure[{#NAME}])=1 | [{"tag": "scope", "value": "performance"}] | no url |
| Node [{#NAME}] Conditions: Is not in Ready state | WARNING | False - if the node is not healthy and is not accepting pods.<br>Unknown - if the node controller has not heard from the node in the last node-monitor-grace-period (default is 40 seconds). | last(/Kubernetes nodes by HTTP/kube.node.conditions.ready[{#NAME}])<>1 | [{"tag": "scope", "value": "availability"}] | no url |
| Node [{#NAME}]: Has been restarted | INFO | Uptime is less than 10 minutes. | last(/Kubernetes nodes by HTTP/kube.node.uptime[{#NAME}])<10 | [{"tag": "scope", "value": "notice"}] | no url |
| Node [{#NAME}] Limits: Total CPU limits are too high | WARNING | no description | last(/Kubernetes nodes by HTTP/kube.node.limits.cpu[{#NAME}]) / last(/Kubernetes nodes by HTTP/kube.node.allocatable.cpu[{#NAME}]) > 0.9 | [{"tag": "scope", "value": "performance"}] | no url |
| Node [{#NAME}] Limits: Total CPU limits are too high | AVERAGE | no description | last(/Kubernetes nodes by HTTP/kube.node.limits.cpu[{#NAME}]) / last(/Kubernetes nodes by HTTP/kube.node.allocatable.cpu[{#NAME}]) > 1 | [{"tag": "scope", "value": "performance"}] | no url |
| Node [{#NAME}] Limits: Total memory limits are too high | WARNING | no description | last(/Kubernetes nodes by HTTP/kube.node.limits.memory[{#NAME}]) / last(/Kubernetes nodes by HTTP/kube.node.allocatable.memory[{#NAME}]) > 0.9 | [{"tag": "scope", "value": "performance"}] | no url |
| Node [{#NAME}] Limits: Total memory limits are too high | AVERAGE | no description | last(/Kubernetes nodes by HTTP/kube.node.limits.memory[{#NAME}]) / last(/Kubernetes nodes by HTTP/kube.node.allocatable.memory[{#NAME}]) > 1 | [{"tag": "scope", "value": "performance"}] | no url |
| Node [{#NAME}] Requests: Total CPU requests are too high | WARNING | no description | last(/Kubernetes nodes by HTTP/kube.node.requests.cpu[{#NAME}]) / last(/Kubernetes nodes by HTTP/kube.node.allocatable.cpu[{#NAME}]) > 0.5 | [{"tag": "scope", "value": "performance"}] | no url |
| Node [{#NAME}] Requests: Total CPU requests are too high | AVERAGE | no description | last(/Kubernetes nodes by HTTP/kube.node.requests.cpu[{#NAME}]) / last(/Kubernetes nodes by HTTP/kube.node.allocatable.cpu[{#NAME}]) > 0.8 | [{"tag": "scope", "value": "performance"}] | no url |
| Node [{#NAME}] Requests: Total memory requests are too high | WARNING | no description | last(/Kubernetes nodes by HTTP/kube.node.requests.memory[{#NAME}]) / last(/Kubernetes nodes by HTTP/kube.node.allocatable.memory[{#NAME}]) > 0.5 | [{"tag": "scope", "value": "performance"}] | no url |
| Node [{#NAME}] Requests: Total memory requests are too high | AVERAGE | no description | last(/Kubernetes nodes by HTTP/kube.node.requests.memory[{#NAME}]) / last(/Kubernetes nodes by HTTP/kube.node.allocatable.memory[{#NAME}]) > 0.8 | [{"tag": "scope", "value": "performance"}] | no url |
| Node [{#NAME}] Used: Kubelet too many pods | WARNING | Kubelet is running at capacity. | last(/Kubernetes nodes by HTTP/kube.node.used.pods[{#NAME}])/ last(/Kubernetes nodes by HTTP/kube.node.capacity.pods[{#NAME}]) > 0.9 | [{"tag": "scope", "value": "performance"}] | no url |


<a name="discovery_pod_discovery" />

## Discovery Pod discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| Node [{#NODE}] Pod [{#POD}] Conditions: Containers ready | All containers in the Pod are ready.<br><br>https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#pod-conditions | kube.pod.conditions.containers_ready[{#POD}] | DEPENDENT |
| Node [{#NODE}] Pod [{#POD}] Conditions: Initialized | All init containers have started successfully.<br><br>https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#pod-conditions | kube.pod.conditions.initialized[{#POD}] | DEPENDENT |
| Node [{#NODE}] Pod [{#POD}] Conditions: Ready | The Pod is able to serve requests and should be added to the load balancing pools of all matching Services.<br><br>https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#pod-conditions | kube.pod.conditions.ready[{#POD}] | DEPENDENT |
| Node [{#NODE}] Pod [{#POD}] Conditions: Scheduled | The Pod has been scheduled to a node.<br><br>https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle/#pod-conditions | kube.pod.conditions.scheduled[{#POD}] | DEPENDENT |
| Node [{#NODE}] Pod [{#POD}] Containers: Restarts | The number of times the container has been restarted, currently based on the number of dead containers that have not yet been removed. Note that this is calculated from dead containers. But those containers are subject to garbage collection. | kube.pod.containers.restartcount[{#POD}] | DEPENDENT |
| Node [{#NODE}] Pod [{#POD}]: Get data | Collecting and processing cluster by node [{#NODE}] data via Kubernetes API. | kube.pod.get[{#POD}] | DEPENDENT |
| Node [{#NODE}] Pod [{#POD}] Status: Phase | The phase of a Pod is a simple, high-level summary of where the Pod is in its lifecycle.<br><br>https://kubernetes.io/docs/concepts/workloads/pods/pod-lifecycle#pod-phase | kube.pod.status.phase[{#POD}] | DEPENDENT |
| Node [{#NODE}] Pod [{#POD}] Uptime | Pod uptime. | kube.pod.uptime[{#POD}] | DEPENDENT |


### Triggers

| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Node [{#NODE}] Pod [{#POD}]: Pod is crash looping | WARNING | Containers of the pod keep restarting. This most likely indicates that the pod is in the CrashLoopBackOff state. | (last(/Kubernetes nodes by HTTP/kube.pod.containers.restartcount[{#POD}])-min(/Kubernetes nodes by HTTP/kube.pod.containers.restartcount[{#POD}],15m))>1 | [{"tag": "scope", "value": "availability"}] | no url |
| Node [{#NODE}] Pod [{#POD}] Status: Kubernetes Pod not healthy | HIGH | Pod has been in a non-ready state for longer than 10 minutes. | count(/Kubernetes nodes by HTTP/kube.pod.status.phase[{#POD}],10m, "regexp","^(1\|4\|5)$")>=9 | [{"tag": "scope", "value": "availability"}] | no url |

