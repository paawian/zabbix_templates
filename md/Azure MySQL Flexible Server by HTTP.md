# Azure MySQL Flexible Server by HTTP template description

This template is designed to monitor Microsoft Azure MySQL flexible servers by HTTP.
It works without any external scripts and uses the script item.

Setup:
  1. Create an Azure service principal via the Azure command-line interface (Azure CLI) for your subscription.
    `az ad sp create-for-rbac --name zabbix --role reader --scope /subscriptions/<subscription_id>`
    See https://docs.microsoft.com/en-us/cli/azure/create-an-azure-service-principal-azure-cli for more details.
  2. Link the template to a host.
  3. Configure the macros: {$AZURE.APP.ID}, {$AZURE.PASSWORD}, {$AZURE.TENANT.ID}, {$AZURE.SUBSCRIPTION.ID}, and {$AZURE.RESOURCE.ID}.

You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback/

Generated by official Zabbix template tool "Templator"

## Summary
* [items](#items)
* [macros](#macros)
* [triggers](#triggers)

<a name="items" />

## Items
| name | description | key | type | delay |
| ------------- |------------- |------------- |------------- |------------- |
| Availability status detailed | The summary description of the availability status. | azure.db.mysql.availability.details | DEPENDENT | 0 |
| Availability state | The availability status of the resource. | azure.db.mysql.availability.state | DEPENDENT | 0 |
| Connections aborted | The count of aborted connections. | azure.db.mysql.connections.aborted | DEPENDENT | 0 |
| Connections active | The count of active connections. | azure.db.mysql.connections.active | DEPENDENT | 0 |
| Connections total | The count of total connections. | azure.db.mysql.connections.total | DEPENDENT | 0 |
| CPU credits consumed | The consumed CPU credits. | azure.db.mysql.cpu.credits.consumed | DEPENDENT | 0 |
| CPU credits remaining | The remaining CPU credits. | azure.db.mysql.cpu.credits.remaining | DEPENDENT | 0 |
| Percentage CPU | The CPU percent of a host. | azure.db.mysql.cpu.percentage | DEPENDENT | 0 |
| Get errors | A list of errors from API requests. | azure.db.mysql.data.errors | DEPENDENT | 0 |
| Get data | The result of API requests is expressed in the JSON. | azure.db.mysql.data.get | SCRIPT | no delay |
| IO consumption percent | The consumption percent of I/O. | azure.db.mysql.io.consumption.percent | DEPENDENT | 0 |
| Memory utilization | The memory percent of a host. | azure.db.mysql.memory.percentage | DEPENDENT | 0 |
| Network out | Network egress of a host, expressed in bytes. | azure.db.mysql.network.egress | DEPENDENT | 0 |
| Network in | Network ingress of a host, expressed in bytes. | azure.db.mysql.network.ingress | DEPENDENT | 0 |
| Queries | The count of queries. | azure.db.mysql.queries | DEPENDENT | 0 |
| Replication lag | The replication lag, expressed in seconds. | azure.db.mysql.replication.lag | DEPENDENT | 0 |
| Backup storage used | Used backup storage, expressed in bytes. | azure.db.mysql.storage.backup.used | DEPENDENT | 0 |
| Storage limit | The storage limit, expressed in bytes. | azure.db.mysql.storage.limit | DEPENDENT | 0 |
| Storage percent | The storage utilization, expressed in %. | azure.db.mysql.storage.percent | DEPENDENT | 0 |
| Storage used | Used storage space, expressed in bytes. | azure.db.mysql.storage.used | DEPENDENT | 0 |


<a name="macros" />

## Macros
| macro | value |
| ------------- |------------- |
| {$AZURE.APP.ID} | no value |
| {$AZURE.DATA.TIMEOUT} | 15s |
| {$AZURE.DB.ABORTED.CONN.MAX.WARN} | 25 |
| {$AZURE.DB.CPU.UTIL.CRIT} | 90 |
| {$AZURE.DB.STORAGE.PUSED.CRIT} | 90 |
| {$AZURE.DB.STORAGE.PUSED.WARN} | 80 |
| {$AZURE.PASSWORD} | no value |
| {$AZURE.PROXY} | no value |
| {$AZURE.RESOURCE.ID} | no value |
| {$AZURE.SUBSCRIPTION.ID} | no value |
| {$AZURE.TENANT.ID} | no value |


<a name="triggers" />

## Triggers
| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| MySQL server is degraded | AVERAGE | The resource is in degraded state. | last(/Azure MySQL Flexible Server by HTTP/azure.db.mysql.availability.state)=1 | [{"tag": "scope", "value": "availability"}] | no url |
| MySQL server is in unknown state | WARNING | The resource state is unknown. | last(/Azure MySQL Flexible Server by HTTP/azure.db.mysql.availability.state)=3 | [{"tag": "scope", "value": "availability"}] | no url |
| MySQL server is unavailable | HIGH | The resource state is unavailable. | last(/Azure MySQL Flexible Server by HTTP/azure.db.mysql.availability.state)=2 | [{"tag": "scope", "value": "availability"}] | no url |
| Server has aborted connections | AVERAGE | The number of failed attempts to connect to the MySQL server is more than `{$AZURE.DB.ABORTED.CONN.MAX.WARN}`. | min(/Azure MySQL Flexible Server by HTTP/azure.db.mysql.connections.aborted,5m)>{$AZURE.DB.ABORTED.CONN.MAX.WARN} | [{"tag": "scope", "value": "availability"}] | no url |
| High CPU utilization | HIGH | The CPU utilization is too high. The system might be slow to respond. | min(/Azure MySQL Flexible Server by HTTP/azure.db.mysql.cpu.percentage,5m)>{$AZURE.DB.CPU.UTIL.CRIT} | [{"tag": "scope", "value": "performance"}] | no url |
| There are errors in requests to API | AVERAGE | Zabbix has received errors in response to API requests. | length(last(/Azure MySQL Flexible Server by HTTP/azure.db.mysql.data.errors))>0 | [{"tag": "scope", "value": "availability"}] | no url |
| Storage space is critically low | AVERAGE | Critical utilization of the storage space. | last(/Azure MySQL Flexible Server by HTTP/azure.db.mysql.storage.percent)>{$AZURE.DB.STORAGE.PUSED.CRIT} | [{"tag": "scope", "value": "capacity"}] | no url |
| Storage space is low | WARNING | High utilization of the storage space. | last(/Azure MySQL Flexible Server by HTTP/azure.db.mysql.storage.percent)>{$AZURE.DB.STORAGE.PUSED.WARN} | [{"tag": "scope", "value": "capacity"}] | no url |

