# Apache ActiveMQ by JMX template description

The template to monitor Apache ActiveMQ by Zabbix that work without any external scripts.
The metrics are collected by JMX.
You can set macro values and add macros with context for specific brokers or destinations following macro description.

You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback/411049-discussion-thread-for-official-zabbix-template-amq

Generated by official Zabbix template tool "Templator"

## Summary
* [macros](#macros)
* [discoveries](#discoveries)
  * [Discovery Brokers discovery ](#discovery_brokers_discovery)
  * [Discovery Destinations discovery ](#discovery_destinations_discovery)

<a name="macros"></a>

## Macros
| macro | value |
| ------------- |------------- |
| {$ACTIVEMQ.BROKER.CONSUMERS.MIN.HIGH} | 1 |
| {$ACTIVEMQ.BROKER.CONSUMERS.MIN.TIME} | 5m |
| {$ACTIVEMQ.BROKER.PRODUCERS.MIN.HIGH} | 1 |
| {$ACTIVEMQ.BROKER.PRODUCERS.MIN.TIME} | 5m |
| {$ACTIVEMQ.DESTINATION.CONSUMERS.MIN.HIGH} | 1 |
| {$ACTIVEMQ.DESTINATION.CONSUMERS.MIN.TIME} | 10m |
| {$ACTIVEMQ.DESTINATION.PRODUCERS.MIN.HIGH} | 1 |
| {$ACTIVEMQ.DESTINATION.PRODUCERS.MIN.TIME} | 10m |
| {$ACTIVEMQ.EXPIRED.WARN} | 0 |
| {$ACTIVEMQ.LLD.FILTER.BROKER.MATCHES} | .* |
| {$ACTIVEMQ.LLD.FILTER.BROKER.NOT_MATCHES} | CHANGE IF NEEDED |
| {$ACTIVEMQ.LLD.FILTER.DESTINATION.MATCHES} | .* |
| {$ACTIVEMQ.LLD.FILTER.DESTINATION.NOT_MATCHES} | CHANGE IF NEEDED |
| {$ACTIVEMQ.MEM.MAX.HIGH} | 90 |
| {$ACTIVEMQ.MEM.MAX.WARN} | 75 |
| {$ACTIVEMQ.MEM.TIME} | 5m |
| {$ACTIVEMQ.MSG.RATE.WARN.TIME} | 15m |
| {$ACTIVEMQ.PASSWORD} | activemq |
| {$ACTIVEMQ.PORT} | 1099 |
| {$ACTIVEMQ.QUEUE.ENABLED} | 1 |
| {$ACTIVEMQ.QUEUE.TIME} | 10m |
| {$ACTIVEMQ.QUEUE.WARN} | 100 |
| {$ACTIVEMQ.STORE.MAX.HIGH} | 90 |
| {$ACTIVEMQ.STORE.MAX.WARN} | 75 |
| {$ACTIVEMQ.STORE.TIME} | 5m |
| {$ACTIVEMQ.TEMP.MAX.HIGH} | 90 |
| {$ACTIVEMQ.TEMP.MAX.WARN} | 75 |
| {$ACTIVEMQ.TEMP.TIME} | 5m |
| {$ACTIVEMQ.TOTAL.CONSUMERS.COUNT} | TotalConsumerCount |
| {$ACTIVEMQ.TOTAL.PRODUCERS.COUNT} | TotalProducerCount |
| {$ACTIVEMQ.USER} | admin |


<a name="discoveries"></a>

## Discoveries
| name | key | description | type | lifetime | delay |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Brokers discovery | jmx.discovery[beans,"org.apache.activemq:type=Broker,brokerName=*"] | Discovery of brokers | JMX | no lifetime | 1h |
| Destinations discovery | jmx.discovery[beans,"org.apache.activemq:type=Broker,brokerName=*,destinationType=*,destinationName=*"] | Discovery of destinations | JMX | no lifetime | 1h |


<a name="discovery_brokers_discovery"></a>

## Discovery Brokers discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| Broker {#JMXBROKERNAME}: Version | The version of the broker. | jmx[{#JMXOBJ},BrokerVersion] | JMX |
| Broker {#JMXBROKERNAME}: Memory limit | Memory limit, in bytes, used for holding undelivered messages before paging to temporary storage. | jmx[{#JMXOBJ},MemoryLimit] | JMX |
| Broker {#JMXBROKERNAME}: Memory usage in percents | Percent of memory limit used. | jmx[{#JMXOBJ}, MemoryPercentUsage] | JMX |
| Broker {#JMXBROKERNAME}: Storage limit | Disk limit, in bytes, used for persistent messages before producers are blocked. | jmx[{#JMXOBJ},StoreLimit] | JMX |
| Broker {#JMXBROKERNAME}: Storage usage in percents | Percent of store limit used. | jmx[{#JMXOBJ},StorePercentUsage] | JMX |
| Broker {#JMXBROKERNAME}: Temp limit | Disk limit, in bytes, used for non-persistent messages and temporary data before producers are blocked. | jmx[{#JMXOBJ},TempLimit] | JMX |
| Broker {#JMXBROKERNAME}: Temp usage in percents | Percent of temp limit used. | jmx[{#JMXOBJ},TempPercentUsage] | JMX |
| Broker {#JMXBROKERNAME}: Consumers count total | Number of consumers attached to this broker. | jmx[{#JMXOBJ},TotalConsumerCount] | JMX |
| Broker {#JMXBROKERNAME}: Messages dequeue rate | Rate of messages that have been delivered by the broker and acknowledged by consumers. | jmx[{#JMXOBJ},TotalDequeueCount] | JMX |
| Broker {#JMXBROKERNAME}: Messages enqueue rate | Rate of messages that have been sent to the broker. | jmx[{#JMXOBJ},TotalEnqueueCount] | JMX |
| Broker {#JMXBROKERNAME}: Producers count total | Number of producers attached to this broker. | jmx[{#JMXOBJ},TotalProducerCount] | JMX |
| Broker {#JMXBROKERNAME}: Uptime | The uptime of the broker. | jmx[{#JMXOBJ},UptimeMillis] | JMX |


### Triggers

| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Broker {#JMXBROKERNAME}: Version has been changed | INFO | The Broker {#JMXBROKERNAME} version has changed. Acknowledge to close the problem manually. | last(/Apache ActiveMQ by JMX/jmx[{#JMXOBJ},BrokerVersion],#1)<>last(/Apache ActiveMQ by JMX/jmx[{#JMXOBJ},BrokerVersion],#2) and length(last(/Apache ActiveMQ by JMX/jmx[{#JMXOBJ},BrokerVersion]))>0 | [{"tag": "scope", "value": "notice"}] | no url |
| Broker {#JMXBROKERNAME}: Memory usage is too high | HIGH | no description | min(/Apache ActiveMQ by JMX/jmx[{#JMXOBJ}, MemoryPercentUsage],{$ACTIVEMQ.MEM.TIME:"{#JMXBROKERNAME}"})>{$ACTIVEMQ.MEM.MAX.HIGH:"{#JMXBROKERNAME}"} | [{"tag": "scope", "value": "performance"}] | no url |
| Broker {#JMXBROKERNAME}: Memory usage is too high | AVERAGE | no description | min(/Apache ActiveMQ by JMX/jmx[{#JMXOBJ}, MemoryPercentUsage],{$ACTIVEMQ.MEM.TIME:"{#JMXBROKERNAME}"})>{$ACTIVEMQ.MEM.MAX.WARN:"{#JMXBROKERNAME}"} | [{"tag": "scope", "value": "performance"}] | no url |
| Broker {#JMXBROKERNAME}: Storage usage is too high | HIGH | no description | min(/Apache ActiveMQ by JMX/jmx[{#JMXOBJ},StorePercentUsage],{$ACTIVEMQ.STORE.TIME:"{#JMXBROKERNAME}"})>{$ACTIVEMQ.STORE.MAX.HIGH:"{#JMXBROKERNAME}"} | [{"tag": "scope", "value": "capacity"}] | no url |
| Broker {#JMXBROKERNAME}: Storage usage is too high | AVERAGE | no description | min(/Apache ActiveMQ by JMX/jmx[{#JMXOBJ},StorePercentUsage],{$ACTIVEMQ.STORE.TIME:"{#JMXBROKERNAME}"})>{$ACTIVEMQ.STORE.MAX.WARN:"{#JMXBROKERNAME}"} | [{"tag": "scope", "value": "capacity"}] | no url |
| Broker {#JMXBROKERNAME}: Temp usage is too high | HIGH | no description | min(/Apache ActiveMQ by JMX/jmx[{#JMXOBJ},TempPercentUsage],{$ACTIVEMQ.TEMP.TIME:"{#JMXBROKERNAME}"})>{$ACTIVEMQ.TEMP.MAX.HIGH} | [{"tag": "scope", "value": "capacity"}] | no url |
| Broker {#JMXBROKERNAME}: Temp usage is too high | AVERAGE | no description | min(/Apache ActiveMQ by JMX/jmx[{#JMXOBJ},TempPercentUsage],{$ACTIVEMQ.TEMP.TIME:"{#JMXBROKERNAME}"})>{$ACTIVEMQ.TEMP.MAX.WARN} | [{"tag": "scope", "value": "capacity"}] | no url |
| Broker {#JMXBROKERNAME}: Consumers count is too low | HIGH | no description | max(/Apache ActiveMQ by JMX/jmx[{#JMXOBJ},TotalConsumerCount],{$ACTIVEMQ.BROKER.CONSUMERS.MIN.TIME:"{#JMXBROKERNAME}"})<{$ACTIVEMQ.BROKER.CONSUMERS.MIN.HIGH:"{#JMXBROKERNAME}"} | [{"tag": "scope", "value": "notice"}] | no url |
| Broker {#JMXBROKERNAME}: Message enqueue rate is higher than dequeue rate | AVERAGE | Enqueue rate is higher than dequeue rate. It may indicate performance problems. | avg(/Apache ActiveMQ by JMX/jmx[{#JMXOBJ},TotalEnqueueCount],{$ACTIVEMQ.MSG.RATE.WARN.TIME:"{#JMXBROKERNAME}"})>avg(/Apache ActiveMQ by JMX/jmx[{#JMXOBJ},TotalEnqueueCount],{$ACTIVEMQ.MSG.RATE.WARN.TIME:"{#JMXBROKERNAME}"}) | [{"tag": "scope", "value": "performance"}] | no url |
| Broker {#JMXBROKERNAME}: Producers count is too low | HIGH | no description | max(/Apache ActiveMQ by JMX/jmx[{#JMXOBJ},TotalProducerCount],{$ACTIVEMQ.BROKER.PRODUCERS.MIN.TIME:"{#JMXBROKERNAME}"})<{$ACTIVEMQ.BROKER.PRODUCERS.MIN.HIGH:"{#JMXBROKERNAME}"} | [{"tag": "scope", "value": "notice"}] | no url |
| Broker {#JMXBROKERNAME}: Broker has been restarted | INFO | Uptime is less than 10 minutes. | last(/Apache ActiveMQ by JMX/jmx[{#JMXOBJ},UptimeMillis])<10m | [{"tag": "scope", "value": "notice"}] | no url |


<a name="discovery_destinations_discovery"></a>

## Discovery Destinations discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| {#JMXBROKERNAME}: {#JMXDESTINATIONTYPE} {#JMXDESTINATIONNAME}: Consumers count total on {#JMXBROKERNAME} | Number of consumers attached to the broker of this destination. Used to suppress destination's triggers when the count of consumers on the broker is lower than threshold. | jmx["org.apache.activemq:type=Broker,brokerName={#JMXBROKERNAME}",{$ACTIVEMQ.TOTAL.CONSUMERS.COUNT: "{#JMXDESTINATIONNAME}"}] | JMX |
| {#JMXBROKERNAME}: {#JMXDESTINATIONTYPE} {#JMXDESTINATIONNAME}: Producers count total on {#JMXBROKERNAME} | Number of producers attached to the broker of this destination. Used to suppress destination's triggers when the count of producers on the broker is lower than threshold. | jmx["org.apache.activemq:type=Broker,brokerName={#JMXBROKERNAME}",{$ACTIVEMQ.TOTAL.PRODUCERS.COUNT: "{#JMXDESTINATIONNAME}"}] | JMX |
| {#JMXBROKERNAME}: {#JMXDESTINATIONTYPE} {#JMXDESTINATIONNAME}: Consumers count | Number of consumers attached to this destination. | jmx[{#JMXOBJ},ConsumerCount] | JMX |
| {#JMXBROKERNAME}: {#JMXDESTINATIONTYPE} {#JMXDESTINATIONNAME}: Messages dequeue rate | Rate of messages that has been acknowledged (and removed) from the destination. | jmx[{#JMXOBJ},DequeueCount] | JMX |
| {#JMXBROKERNAME}: {#JMXDESTINATIONTYPE} {#JMXDESTINATIONNAME}: Messages enqueue rate | Rate of messages that have been sent to the destination. | jmx[{#JMXOBJ},EnqueueCount] | JMX |
| {#JMXBROKERNAME}: {#JMXDESTINATIONTYPE} {#JMXDESTINATIONNAME}: Expired messages count | Number of messages that have been expired. | jmx[{#JMXOBJ},ExpiredCount] | JMX |
| {#JMXBROKERNAME}: {#JMXDESTINATIONTYPE} {#JMXDESTINATIONNAME}: Memory usage in percents | The percentage of the memory limit used. | jmx[{#JMXOBJ},MemoryPercentUsage] | JMX |
| {#JMXBROKERNAME}: {#JMXDESTINATIONTYPE} {#JMXDESTINATIONNAME}: Producers count | Number of producers attached to this destination. | jmx[{#JMXOBJ},ProducerCount] | JMX |
| {#JMXBROKERNAME}: {#JMXDESTINATIONTYPE} {#JMXDESTINATIONNAME}: Queue size | Number of messages on this destination, including any that have been dispatched but not acknowledged. | jmx[{#JMXOBJ},QueueSize] | JMX |


### Triggers

| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| {#JMXBROKERNAME}: {#JMXDESTINATIONTYPE} {#JMXDESTINATIONNAME}: Expired messages count is high | AVERAGE | This metric represents the number of messages that expired before they could be delivered. If you expect all messages to be delivered and acknowledged within a certain amount of time, you can set an expiration for each message, and investigate if your ExpiredCount metric rises above zero. | last(/Apache ActiveMQ by JMX/jmx[{#JMXOBJ},ExpiredCount])>{$ACTIVEMQ.EXPIRED.WARN:"{#JMXDESTINATIONNAME}"} | [{"tag": "scope", "value": "performance"}] | no url |
| {#JMXBROKERNAME}: {#JMXDESTINATIONTYPE} {#JMXDESTINATIONNAME}: Memory usage is too high | HIGH | no description | last(/Apache ActiveMQ by JMX/jmx[{#JMXOBJ},MemoryPercentUsage])>{$ACTIVEMQ.MEM.MAX.HIGH:"{#JMXDESTINATIONNAME}"} | [{"tag": "scope", "value": "performance"}] | no url |
| {#JMXBROKERNAME}: {#JMXDESTINATIONTYPE} {#JMXDESTINATIONNAME}: Memory usage is too high | AVERAGE | no description | last(/Apache ActiveMQ by JMX/jmx[{#JMXOBJ},MemoryPercentUsage])>{$ACTIVEMQ.MEM.MAX.WARN:"{#JMXDESTINATIONNAME}"} | [{"tag": "scope", "value": "performance"}] | no url |
| {#JMXBROKERNAME}: {#JMXDESTINATIONTYPE} {#JMXDESTINATIONNAME}: Queue size is high | AVERAGE | Queue size is higher than threshold. It may indicate performance problems. | min(/Apache ActiveMQ by JMX/jmx[{#JMXOBJ},QueueSize],{$ACTIVEMQ.QUEUE.TIME:"{#JMXDESTINATIONNAME}"})>{$ACTIVEMQ.QUEUE.WARN:"{#JMXDESTINATIONNAME}"} and {$ACTIVEMQ.QUEUE.ENABLED:"{#JMXDESTINATIONNAME}"}=1 | [{"tag": "scope", "value": "performance"}] | no url |
| {#JMXBROKERNAME}: {#JMXDESTINATIONTYPE} {#JMXDESTINATIONNAME}: Consumers count is too low | AVERAGE | no description | max(/Apache ActiveMQ by JMX/jmx[{#JMXOBJ},ConsumerCount],{$ACTIVEMQ.DESTINATION.CONSUMERS.MIN.TIME:"{#JMXDESTINATIONNAME}"})<{$ACTIVEMQ.DESTINATION.CONSUMERS.MIN.HIGH:"{#JMXDESTINATIONNAME}"} and last(/Apache ActiveMQ by JMX/jmx["org.apache.activemq:type=Broker,brokerName={#JMXBROKERNAME}",{$ACTIVEMQ.TOTAL.CONSUMERS.COUNT: "{#JMXDESTINATIONNAME}"}])>{$ACTIVEMQ.BROKER.CONSUMERS.MIN.HIGH:"{#JMXBROKERNAME}"} | [{"tag": "scope", "value": "notice"}] | no url |
| {#JMXBROKERNAME}: {#JMXDESTINATIONTYPE} {#JMXDESTINATIONNAME}: Message enqueue rate is higher than dequeue rate | AVERAGE | Enqueue rate is higher than dequeue rate. It may indicate performance problems. | avg(/Apache ActiveMQ by JMX/jmx[{#JMXOBJ},EnqueueCount],{$ACTIVEMQ.MSG.RATE.WARN.TIME:"{#JMXDESTINATIONNAME}"})>avg(/Apache ActiveMQ by JMX/jmx[{#JMXOBJ},DequeueCount],{$ACTIVEMQ.MSG.RATE.WARN.TIME:"{#JMXDESTINATIONNAME}"}) | [{"tag": "scope", "value": "notice"}] | no url |
| {#JMXBROKERNAME}: {#JMXDESTINATIONTYPE} {#JMXDESTINATIONNAME}: Producers count is too low | AVERAGE | no description | max(/Apache ActiveMQ by JMX/jmx[{#JMXOBJ},ProducerCount],{$ACTIVEMQ.DESTINATION.PRODUCERS.MIN.TIME:"{#JMXDESTINATIONNAME}"})<{$ACTIVEMQ.DESTINATION.PRODUCERS.MIN.HIGH:"{#JMXDESTINATIONNAME}"} and last(/Apache ActiveMQ by JMX/jmx["org.apache.activemq:type=Broker,brokerName={#JMXBROKERNAME}",{$ACTIVEMQ.TOTAL.PRODUCERS.COUNT: "{#JMXDESTINATIONNAME}"}])>{$ACTIVEMQ.BROKER.PRODUCERS.MIN.HIGH:"{#JMXBROKERNAME}"} | [{"tag": "scope", "value": "notice"}] | no url |

