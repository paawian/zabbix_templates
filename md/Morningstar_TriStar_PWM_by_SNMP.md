# Morningstar TriStar PWM by SNMP template description

MIBs used:
TRISTAR

Generated by official Zabbix template tool "Templator"

## Summary
* [items](#items)
* [macros](#macros)
* [triggers](#triggers)
* [discoveries](#discoveries)
  * [Discovery Battery voltage discovery ](#discovery_battery_voltage_discovery)
  * [Discovery Charge mode discovery ](#discovery_charge_mode_discovery)
  * [Discovery Charge + Diversion mode discovery ](#discovery_charge_+_diversion_mode_discovery)
  * [Discovery Diversion mode discovery ](#discovery_diversion_mode_discovery)
  * [Discovery Load mode discovery ](#discovery_load_mode_discovery)
  * [Discovery Load + Diversion mode discovery ](#discovery_load_+_diversion_mode_discovery)

<a name="items"></a>

## Items
| name | description | key | type | delay |
| ------------- |------------- |------------- |------------- |------------- |
| Battery: Battery Voltage discovery | MIB: TRISTAR<br>Description:Battery voltage<br>Scaling Factor:0.002950042724609375<br>Units:V<br>Range:[0.0, 80.0]<br>Modbus address:0x0008 | battery.voltage.discovery[batteryVoltage.0] | SNMP_AGENT | 15m |
| Status: Control Mode | MIB: TRISTAR<br>Description:Control Mode<br>Modbus address:0x001A<br><br>0: charge<br>1: loadControl<br>2: diversion<br>3: lighting | control.mode[controlMode.0] | SNMP_AGENT | no delay |
| Counter: Amp-hours | MIB: TRISTAR<br>Description:Ah (Resettable)<br>Scaling Factor:0.1<br>Units:Ah<br>Range:[0.0, 50000.0]<br>Modbus addresses:H=0x0011 L=0x0012 | counter.charge_amp_hours[ahResettable.0] | SNMP_AGENT | no delay |
| Counter: KW-hours | MIB: TRISTAR<br>Description:Kilowatt Hours<br>Scaling Factor:1.0<br>Units:kWh<br>Range:[0.0, 5000.0]<br>Modbus address:0x001E | counter.charge_kw_hours[kilowattHours.0] | SNMP_AGENT | no delay |
| Status: Alarms | MIB: TRISTAR<br>Description:Alarms<br>Modbus addresses:H=0x001D L=0x0017 | status.alarms[alarms.0] | SNMP_AGENT | no delay |
| Status: Faults | MIB: TRISTAR<br>Description:Battery voltage<br>Scaling Factor:0.002950042724609375<br>Units:V<br>Range:[0.0, 80.0]<br>Modbus address:0x0008 | status.faults[faults.0] | SNMP_AGENT | no delay |
| Status: Uptime (hardware) | The amount of time since this host was last initialized. Note that this is different from sysUpTime in the SNMPv2-MIB [RFC1907] because sysUpTime is the uptime of the network management portion of the system. | status.hw.uptime | SNMP_AGENT | no delay |
| Status: Uptime (network) | The time (in hundredths of a second) since the network management portion of the system was last re-initialized. | status.net.uptime | SNMP_AGENT | no delay |
| Temperature: Battery | MIB: TRISTAR<br>Description:Battery Temperature<br>Scaling Factor:1.0<br>Units:deg C<br>Range:[-40, 120]<br>Modbus address:0x000F | temp.battery[batteryTemperature.0] | SNMP_AGENT | no delay |
| Temperature: Heatsink | MIB: TRISTAR<br>Description:Heatsink Temperature<br>Scaling Factor:1.0<br>Units:deg C<br>Range:[-40, 120]<br>Modbus address:0x000E | temp.heatsink[heatsinkTemperature.0] | SNMP_AGENT | no delay |


<a name="macros"></a>

## Macros
| macro | value |
| ------------- |------------- |
| {$BATTERY.TEMP.MAX.CRIT} | 60 |
| {$BATTERY.TEMP.MAX.WARN} | 45 |
| {$BATTERY.TEMP.MIN.CRIT} | -20 |
| {$BATTERY.TEMP.MIN.WARN} | 0 |
| {$CHARGE.STATE.CRIT} | 4 |
| {$CHARGE.STATE.WARN} | 2 |
| {$LOAD.STATE.CRIT:"fault"} | 4 |
| {$LOAD.STATE.CRIT:"lvd"} | 3 |
| {$LOAD.STATE.WARN:"disconnect"} | 5 |
| {$LOAD.STATE.WARN:"lvdWarning"} | 2 |
| {$LOAD.STATE.WARN:"override"} | 7 |
| {$VOLTAGE.MAX.CRIT} | no value |
| {$VOLTAGE.MAX.WARN} | no value |
| {$VOLTAGE.MIN.CRIT} | no value |
| {$VOLTAGE.MIN.WARN} | no value |


<a name="triggers"></a>

## Triggers
| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Status: Device has "batterySense" alarm flag | WARNING | no description | count(/Morningstar TriStar PWM by SNMP/status.alarms[alarms.0],#3,"like","batterySense")=2 | [{"tag": "scope", "value": "notice"}] | no url |
| Status: Device has "batterySenseDisconnected" alarm flag | WARNING | no description | count(/Morningstar TriStar PWM by SNMP/status.alarms[alarms.0],#3,"like","batterySenseDisconnected")=2 | [{"tag": "scope", "value": "notice"}] | no url |
| Status: Device has "currentLimit" alarm flag | WARNING | no description | count(/Morningstar TriStar PWM by SNMP/status.alarms[alarms.0],#3,"like","currentLimit")=2 | [{"tag": "scope", "value": "notice"}] | no url |
| Status: Device has "currentOffset" alarm flag | WARNING | no description | count(/Morningstar TriStar PWM by SNMP/status.alarms[alarms.0],#3,"like","currentOffset")=2 | [{"tag": "scope", "value": "notice"}] | no url |
| Status: Device has "diversionLoadNearMax" alarm flag | WARNING | no description | count(/Morningstar TriStar PWM by SNMP/status.alarms[alarms.0],#3,"like","diversionLoadNearMax")=2 | [{"tag": "scope", "value": "notice"}] | no url |
| Status: Device has "heatsinkTempSensorOpen" alarm flag | WARNING | no description | count(/Morningstar TriStar PWM by SNMP/status.alarms[alarms.0],#3,"like","heatsinkTempSensorOpen")=2 | [{"tag": "scope", "value": "notice"}] | no url |
| Status: Device has "heatsinkTempSensorShorted" alarm flag | WARNING | no description | count(/Morningstar TriStar PWM by SNMP/status.alarms[alarms.0],#3,"like","heatsinkTempSensorShorted")=2 | [{"tag": "scope", "value": "notice"}] | no url |
| Status: Device has "highVoltageDisconnect" alarm flag | WARNING | no description | count(/Morningstar TriStar PWM by SNMP/status.alarms[alarms.0],#3,"like","highVoltageDisconnect")=2 | [{"tag": "scope", "value": "notice"}] | no url |
| Status: Device has "loadDisconnectState" alarm flag | WARNING | no description | count(/Morningstar TriStar PWM by SNMP/status.alarms[alarms.0],#3,"like","loadDisconnectState")=2 | [{"tag": "scope", "value": "notice"}] | no url |
| Status: Device has "mosfetSOpen" alarm flag | WARNING | no description | count(/Morningstar TriStar PWM by SNMP/status.alarms[alarms.0],#3,"like","mosfetSOpen")=2 | [{"tag": "scope", "value": "notice"}] | no url |
| Status: Device has "p12VoltageReferenceOff" alarm flag | WARNING | no description | count(/Morningstar TriStar PWM by SNMP/status.alarms[alarms.0],#3,"like","p12VoltageReferenceOff")=2 | [{"tag": "scope", "value": "notice"}] | no url |
| Status: Device has "rtsDisconnected" alarm flag | WARNING | no description | count(/Morningstar TriStar PWM by SNMP/status.alarms[alarms.0],#3,"like","rtsDisconnected")=2 | [{"tag": "scope", "value": "notice"}] | no url |
| Status: Device has "rtsMiswire" alarm flag | WARNING | no description | count(/Morningstar TriStar PWM by SNMP/status.alarms[alarms.0],#3,"like","rtsMiswire")=2 | [{"tag": "scope", "value": "notice"}] | no url |
| Status: Device has "rtsShorted" alarm flag | WARNING | no description | count(/Morningstar TriStar PWM by SNMP/status.alarms[alarms.0],#3,"like","rtsShorted")=2 | [{"tag": "scope", "value": "notice"}] | no url |
| Status: Device has "systemMiswire" alarm flag | WARNING | no description | count(/Morningstar TriStar PWM by SNMP/status.alarms[alarms.0],#3,"like","systemMiswire")=2 | [{"tag": "scope", "value": "notice"}] | no url |
| Status: Device has "tristarHot" alarm flag | WARNING | no description | count(/Morningstar TriStar PWM by SNMP/status.alarms[alarms.0],#3,"like","tristarHot")=2 | [{"tag": "scope", "value": "notice"}] | no url |
| Status: Device has "uncalibrated" alarm flag | WARNING | no description | count(/Morningstar TriStar PWM by SNMP/status.alarms[alarms.0],#3,"like","uncalibrated")=2 | [{"tag": "scope", "value": "notice"}] | no url |
| Status: Device has "customSettingsEdit" faults flag | HIGH | no description | count(/Morningstar TriStar PWM by SNMP/status.faults[faults.0],#3,"like","customSettingsEdit")=2 | [{"tag": "scope", "value": "notice"}] | no url |
| Status: Device has "dipSwitchChange" faults flag | HIGH | no description | count(/Morningstar TriStar PWM by SNMP/status.faults[faults.0],#3,"like","dipSwitchChange")=2 | [{"tag": "scope", "value": "notice"}] | no url |
| Status: Device has "externalShort" faults flag | HIGH | no description | count(/Morningstar TriStar PWM by SNMP/status.faults[faults.0],#3,"like","externalShort")=2 | [{"tag": "scope", "value": "notice"}] | no url |
| Status: Device has "highVoltageDisconnect" faults flag | HIGH | no description | count(/Morningstar TriStar PWM by SNMP/status.faults[faults.0],#3,"like","highVoltageDisconnect")=2 | [{"tag": "scope", "value": "notice"}] | no url |
| Status: Device has "mosfetSShorted" faults flag | HIGH | no description | count(/Morningstar TriStar PWM by SNMP/status.faults[faults.0],#3,"like","mosfetSShorted")=2 | [{"tag": "scope", "value": "notice"}] | no url |
| Status: Device has "overcurrent" faults flag | HIGH | no description | count(/Morningstar TriStar PWM by SNMP/status.faults[faults.0],#3,"like","overcurrent")=2 | [{"tag": "scope", "value": "notice"}] | no url |
| Status: Device has "reset" faults flag | HIGH | no description | count(/Morningstar TriStar PWM by SNMP/status.faults[faults.0],#3,"like","reset")=2 | [{"tag": "scope", "value": "notice"}] | no url |
| Status: Device has "rtsDisconnected" faults flag | HIGH | no description | count(/Morningstar TriStar PWM by SNMP/status.faults[faults.0],#3,"like","rtsDisconnected")=2 | [{"tag": "scope", "value": "notice"}] | no url |
| Status: Device has "rtsShorted" faults flag | HIGH | no description | count(/Morningstar TriStar PWM by SNMP/status.faults[faults.0],#3,"like","rtsShorted")=2 | [{"tag": "scope", "value": "notice"}] | no url |
| Status: Device has "softwareFault" faults flag | HIGH | no description | count(/Morningstar TriStar PWM by SNMP/status.faults[faults.0],#3,"like","softwareFault")=2 | [{"tag": "scope", "value": "notice"}] | no url |
| Status: Device has "systemMiswire" faults flag | HIGH | no description | count(/Morningstar TriStar PWM by SNMP/status.faults[faults.0],#3,"like","systemMiswire")=2 | [{"tag": "scope", "value": "notice"}] | no url |
| Status: Device has "tristarHot" faults flag | HIGH | no description | count(/Morningstar TriStar PWM by SNMP/status.faults[faults.0],#3,"like","tristarHot")=2 | [{"tag": "scope", "value": "notice"}] | no url |
| Status: Failed to fetch data | WARNING | Zabbix has not received data for items for the last 5 minutes. | nodata(/Morningstar TriStar PWM by SNMP/status.net.uptime,5m)=1 | [{"tag": "scope", "value": "availability"}] | no url |
| Temperature: Critically high battery temperature | HIGH | no description | min(/Morningstar TriStar PWM by SNMP/temp.battery[batteryTemperature.0],5m)>{$BATTERY.TEMP.MAX.CRIT} | [{"tag": "scope", "value": "notice"}] | no url |
| Temperature: Critically low battery temperature | HIGH | no description | max(/Morningstar TriStar PWM by SNMP/temp.battery[batteryTemperature.0],5m)<{$BATTERY.TEMP.MIN.CRIT} | [{"tag": "scope", "value": "notice"}] | no url |
| Temperature: High battery temperature | WARNING | no description | min(/Morningstar TriStar PWM by SNMP/temp.battery[batteryTemperature.0],5m)>{$BATTERY.TEMP.MAX.WARN} | [{"tag": "scope", "value": "notice"}] | no url |
| Temperature: Low battery temperature | WARNING | no description | max(/Morningstar TriStar PWM by SNMP/temp.battery[batteryTemperature.0],5m)<{$BATTERY.TEMP.MIN.WARN} | [{"tag": "scope", "value": "notice"}] | no url |
| Status: Device has been restarted | INFO | Uptime is less than 10 minutes. | (last(/Morningstar TriStar PWM by SNMP/status.hw.uptime)>0 and last(/Morningstar TriStar PWM by SNMP/status.hw.uptime)<10m) or (last(/Morningstar TriStar PWM by SNMP/status.hw.uptime)=0 and last(/Morningstar TriStar PWM by SNMP/status.net.uptime)<10m) | [{"tag": "scope", "value": "notice"}] | no url |


<a name="discoveries"></a>

## Discoveries
| name | key | description | type | lifetime | delay |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Battery voltage discovery | battery.voltage.discovery | Discovery for battery voltage triggers | DEPENDENT | no lifetime | 0 |
| Charge mode discovery | controlmode.charge.discovery | Discovery for device in charge mode | DEPENDENT | 1h | 0 |
| Charge + Diversion mode discovery | controlmode.charge_diversion.discovery | Discovery for device in charge and diversion modes | DEPENDENT | 1h | 0 |
| Diversion mode discovery | controlmode.diversion.discovery | Discovery for device in diversion mode | DEPENDENT | 1h | 0 |
| Load mode discovery | controlmode.load.discovery | Discovery for device in load mode | DEPENDENT | 1h | 0 |
| Load + Diversion mode discovery | controlmode.load_diversion.discovery | Discovery for device in load and diversion modes | DEPENDENT | 1h | 0 |


<a name="discovery_battery_voltage_discovery" />

## Discovery Battery voltage discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| Battery: Voltage{#SINGLETON} | MIB: TRISTAR<br>Description:Battery voltage<br>Scaling Factor:0.002950042724609375<br>Units:V<br>Range:[0.0, 80.0]<br>Modbus address:0x0008 | battery.voltage[batteryVoltage.0{#SINGLETON}] | SNMP_AGENT |


### Triggers

| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Battery: Critically high battery voltage | HIGH | no description | min(/Morningstar TriStar PWM by SNMP/battery.voltage[batteryVoltage.0{#SINGLETON}],5m)>{#VOLTAGE.MAX.CRIT} | [{"tag": "scope", "value": "capacity"}] | no url |
| Battery: Critically low battery voltage | HIGH | no description | max(/Morningstar TriStar PWM by SNMP/battery.voltage[batteryVoltage.0{#SINGLETON}],5m)<{#VOLTAGE.MIN.CRIT} | [{"tag": "scope", "value": "capacity"}] | no url |
| Battery: High battery voltage | WARNING | no description | min(/Morningstar TriStar PWM by SNMP/battery.voltage[batteryVoltage.0{#SINGLETON}],5m)>{#VOLTAGE.MAX.WARN} | [{"tag": "scope", "value": "capacity"}] | no url |
| Battery: Low battery voltage | WARNING | no description | max(/Morningstar TriStar PWM by SNMP/battery.voltage[batteryVoltage.0{#SINGLETON}],5m)<{#VOLTAGE.MIN.WARN} | [{"tag": "scope", "value": "capacity"}] | no url |


<a name="discovery_charge_mode_discovery" />

## Discovery Charge mode discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| Array: Voltage{#SINGLETON} | MIB: TRISTAR<br>Description:Array/Load Voltage<br>Scaling Factor:0.00424652099609375<br>Units:V<br>Range:[0, 80]<br>Modbus address:0x000A | array.voltage[arrayloadVoltage.0{#SINGLETON}] | SNMP_AGENT |
| Battery: Charge Current{#SINGLETON} | MIB: TRISTAR<br>Description:Charge Current<br>Scaling Factor:0.002034515380859375<br>Units:A<br>Range:[0, 60]<br>Modbus address:0x000B | charge.current[chargeCurrent.0{#SINGLETON}] | SNMP_AGENT |


<a name="discovery_charge_+_diversion_mode_discovery" />

## Discovery Charge + Diversion mode discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| Battery: Charge State{#SINGLETON} | MIB: TRISTAR<br>Description:Control State<br>Modbus address:0x001B | charge.state[controlState.0{#SINGLETON}] | SNMP_AGENT |
| Battery: Target Voltage{#SINGLETON} | MIB: TRISTAR<br>Description:Target Regulation Voltage<br>Scaling Factor:0.002950042724609375<br>Units:V<br>Range:[0.0, 80.0]<br>Modbus address:0x0010 | target.voltage[targetVoltage.0{#SINGLETON}] | SNMP_AGENT |


### Triggers

| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Battery: Device charge in critical state | HIGH | no description | last(/Morningstar TriStar PWM by SNMP/charge.state[controlState.0{#SINGLETON}])={$CHARGE.STATE.CRIT} | [{"tag": "scope", "value": "notice"}] | no url |
| Battery: Device charge in warning state | WARNING | no description | last(/Morningstar TriStar PWM by SNMP/charge.state[controlState.0{#SINGLETON}])={$CHARGE.STATE.WARN} | [{"tag": "scope", "value": "notice"}] | no url |


<a name="discovery_diversion_mode_discovery" />

## Discovery Diversion mode discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| Load: PWM Duty Cycle{#SINGLETON} | MIB: TRISTAR<br>Description:PWM Duty Cycle<br>Scaling Factor:0.392156862745098<br>Units:%<br>Range:[0.0, 100.0]<br>Modbus address:0x001C | diversion.pwm_duty_cycle[pwmDutyCycle.0{#SINGLETON}] | SNMP_AGENT |


<a name="discovery_load_mode_discovery" />

## Discovery Load mode discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| Load: State{#SINGLETON} | MIB: TRISTAR<br>Description:Load State<br>Modbus address:0x001B<br><br>0: Start<br>1: Normal<br>2: LvdWarning<br>3: Lvd<br>4: Fault<br>5: Disconnect<br>6: LvdWarning1<br>7: OverrideLvd<br>8: Equalize | load.state[loadState.0{#SINGLETON}] | SNMP_AGENT |


### Triggers

| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Load: Device load in critical state | HIGH | no description | last(/Morningstar TriStar PWM by SNMP/load.state[loadState.0{#SINGLETON}])={$LOAD.STATE.CRIT:"lvd"} or last(/Morningstar TriStar PWM by SNMP/load.state[loadState.0{#SINGLETON}])={$LOAD.STATE.CRIT:"fault"} | [{"tag": "scope", "value": "notice"}] | no url |
| Load: Device load in warning state | WARNING | no description | last(/Morningstar TriStar PWM by SNMP/load.state[loadState.0{#SINGLETON}])={$LOAD.STATE.WARN:"lvdWarning"}  or last(/Morningstar TriStar PWM by SNMP/load.state[loadState.0{#SINGLETON}])={$LOAD.STATE.WARN:"override"} | [{"tag": "scope", "value": "notice"}] | no url |


<a name="discovery_load_+_diversion_mode_discovery" />

## Discovery Load + Diversion mode discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| Load: Current{#SINGLETON} | MIB: TRISTAR<br>Description:Load Current<br>Scaling Factor:0.00966400146484375<br>Units:A<br>Range:[0, 60]<br>Modbus address:0x000C | load.current[loadCurrent.0{#SINGLETON}] | SNMP_AGENT |
| Load: Voltage{#SINGLETON} | MIB: TRISTAR<br>Description:Array/Load Voltage<br>Scaling Factor:0.00424652099609375<br>Units:V<br>Range:[0, 80]<br>Modbus address:0x000A | load.voltage[arrayloadVoltage.0{#SINGLETON}] | SNMP_AGENT |

