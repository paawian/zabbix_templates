# Apache by HTTP template description

This template is designed for the effortless deployment of Apache monitoring by Zabbix via HTTP and doesn't require any external scripts.

The template collects metrics by polling 'mod_status' with HTTP agent remotely.

Setup:

1. See the setup instructions for mod_status:
https://httpd.apache.org/docs/current/mod/mod_status.html

Check the availability of the module with this command line:
httpd -M 2>/dev/null | grep status_module

This is an example configuration of the Apache web server:

<Location "/server-status">
  SetHandler server-status
  Require host example.com
</Location>

2. Set the hostname or IP address of the Apache status page host in the '{$APACHE.STATUS.HOST}' macro. You can also change the status page port in the '{$APACHE.STATUS.PORT}' macro and status page path in the '{$APACHE.STATUS.PATH}' macro if necessary.

You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback/384764-discussion-thread-for-official-zabbix-template-apache

Generated by official Zabbix template tool "Templator"

## Summary
* [items](#items)
* [macros](#macros)
* [triggers](#triggers)
* [discoveries](#discoveries)
  * [Discovery Event MPM discovery ](#discovery_event_mpm_discovery)

<a name="items"></a>

## Items
| name | description | key | type | delay |
| ------------- |------------- |------------- |------------- |------------- |
| Total bytes | The total bytes served. | apache.bytes | DEPENDENT | 0 |
| Bytes per second | It is calculated as a rate of change for total bytes statistics.<br>`BytesPerSec` is not used, as it counts the average since the last Apache server start. | apache.bytes.rate | DEPENDENT | 0 |
| Get status | Getting data from a machine-readable version of the Apache status page.<br>For more information see Apache Module [mod_status](https://httpd.apache.org/docs/current/mod/mod_status.html). | apache.get_status | HTTP_AGENT | no delay |
| Total requests | The total number of the Apache server accesses. | apache.requests | DEPENDENT | 0 |
| Requests per second | It is calculated as a rate of change for the "Total requests" statistics.<br>`ReqPerSec` is not used, as it counts the average since the last Apache server start. | apache.requests.rate | DEPENDENT | 0 |
| Uptime | The service uptime expressed in seconds. | apache.uptime | DEPENDENT | 0 |
| Version | The Apache service version. | apache.version | DEPENDENT | 0 |
| Workers idle cleanup | The number of workers in cleanup state. | apache.workers.cleanup | DEPENDENT | 0 |
| Workers closing connection | The number of workers in closing state. | apache.workers.closing | DEPENDENT | 0 |
| Workers DNS lookup | The number of workers in `dnslookup` state. | apache.workers.dnslookup | DEPENDENT | 0 |
| Workers finishing | The number of workers in finishing state. | apache.workers.finishing | DEPENDENT | 0 |
| Workers keepalive (read) | The number of workers in `keepalive` state. | apache.workers.keepalive | DEPENDENT | 0 |
| Workers logging | The number of workers in logging state. | apache.workers.logging | DEPENDENT | 0 |
| Workers reading request | The number of workers in reading state. | apache.workers.reading | DEPENDENT | 0 |
| Workers sending reply | The number of workers in sending state. | apache.workers.sending | DEPENDENT | 0 |
| Workers slot with no current process | The number of slots with no current process. | apache.workers.slot | DEPENDENT | 0 |
| Workers starting up | The number of workers in starting state. | apache.workers.starting | DEPENDENT | 0 |
| Workers waiting for connection | The number of workers in waiting state. | apache.workers.waiting | DEPENDENT | 0 |
| Total workers busy | The total number of busy worker threads/processes. | apache.workers_total.busy | DEPENDENT | 0 |
| Total workers idle | The total number of idle worker threads/processes. | apache.workers_total.idle | DEPENDENT | 0 |
| Service response time | no description | net.tcp.service.perf[http,"{$APACHE.STATUS.HOST}","{$APACHE.STATUS.PORT}"] | SIMPLE | no delay |
| Service ping | no description | net.tcp.service[http,"{$APACHE.STATUS.HOST}","{$APACHE.STATUS.PORT}"] | SIMPLE | no delay |


<a name="macros"></a>

## Macros
| macro | value |
| ------------- |------------- |
| {$APACHE.RESPONSE_TIME.MAX.WARN} | 10 |
| {$APACHE.STATUS.HOST} | <SET APACHE HOST> |
| {$APACHE.STATUS.PATH} | server-status?auto |
| {$APACHE.STATUS.PORT} | 80 |
| {$APACHE.STATUS.SCHEME} | http |


<a name="triggers"></a>

## Triggers
| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Failed to fetch status page | WARNING | Zabbix has not received any data for items for the last 30 minutes. | nodata(/Apache by HTTP/apache.get_status,30m)=1 | [{"tag": "scope", "value": "availability"}] | no url |
| Host has been restarted | INFO | Uptime is less than 10 minutes. | last(/Apache by HTTP/apache.uptime)<10m | [{"tag": "scope", "value": "notice"}] | no url |
| Version has changed | INFO | Apache version has changed. Acknowledge to close the problem manually. | last(/Apache by HTTP/apache.version,#1)<>last(/Apache by HTTP/apache.version,#2) and length(last(/Apache by HTTP/apache.version))>0 | [{"tag": "scope", "value": "notice"}] | no url |
| Service response time is too high | WARNING | no description | min(/Apache by HTTP/net.tcp.service.perf[http,"{$APACHE.STATUS.HOST}","{$APACHE.STATUS.PORT}"],5m)>{$APACHE.RESPONSE_TIME.MAX.WARN} | [{"tag": "scope", "value": "performance"}] | no url |
| Service is down | AVERAGE | no description | last(/Apache by HTTP/net.tcp.service[http,"{$APACHE.STATUS.HOST}","{$APACHE.STATUS.PORT}"])=0 | [{"tag": "scope", "value": "availability"}] | no url |


<a name="discoveries"></a>

## Discoveries
| name | key | description | type | lifetime | delay |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Event MPM discovery | apache.mpm.event.discovery | The discovery of additional metrics if the event Multi-Processing Module (MPM) is used.<br>For more details see [Apache MPM event](https://httpd.apache.org/docs/current/mod/event.html). | DEPENDENT | no lifetime | 0 |


<a name="discovery_event_mpm_discovery" />

## Discovery Event MPM discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| Bytes per request | The average number of client requests per second. | apache.bytes[per_request{#SINGLETON}] | DEPENDENT |
| Connections async closing | The number of asynchronous connections in closing state (applicable only to the event MPM). | apache.connections[async_closing{#SINGLETON}] | DEPENDENT |
| Connections async keepalive | The number of asynchronous connections in keepalive state (applicable only to the event MPM). | apache.connections[async_keep_alive{#SINGLETON}] | DEPENDENT |
| Connections async writing | The number of asynchronous connections in writing state (applicable only to the event MPM). | apache.connections[async_writing{#SINGLETON}] | DEPENDENT |
| Connections total | The number of total connections. | apache.connections[total{#SINGLETON}] | DEPENDENT |
| Number of async processes | The number of asynchronous processes. | apache.process[num{#SINGLETON}] | DEPENDENT |

