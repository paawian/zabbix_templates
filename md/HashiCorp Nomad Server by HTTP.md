# HashiCorp Nomad Server by HTTP template description

Get HashiCorp Nomad server metrics by HTTP from metrics endpoint.

More information about metrics is available in the official documentation: https://developer.hashicorp.com/nomad/docs/operations/metrics-reference.

You can discuss this template or leave feedback on our forum: https://www.zabbix.com/forum/zabbix-suggestions-and-feedback.

Generated by official Zabbix template tool "Templator"

## Summary
* [items](#items)
* [macros](#macros)
* [triggers](#triggers)

<a name="items" />

## Items
| name | description | key | type | delay |
| ------------- |------------- |------------- |------------- |------------- |
| Service [rpc] state | Current [rpc] service state. | net.tcp.service[tcp,,{$NOMAD.SERVER.RPC.PORT}] | SIMPLE | no delay |
| Service [serf] state | Current [serf] service state. | net.tcp.service[tcp,,{$NOMAD.SERVER.SERF.PORT}] | SIMPLE | no delay |
| Nomad raft version | Nomad raft version. | nomad.raft.version | DEPENDENT | 0 |
| FSM allocation client update time | Time elapsed to apply AllocClientUpdate raft entry. | nomad.server.alloc_client_update | DEPENDENT | 0 |
| Autopilot failure tolerance | The number of redundant healthy servers that can fail without causing an outage. | nomad.server.autopilot.failure_tolerance | DEPENDENT | 0 |
| Autopilot state | Current autopilot state. | nomad.server.autopilot.state | DEPENDENT | 0 |
| CPU shares for blocked evaluations | Amount of CPU shares requested by blocked evals. | nomad.server.blocked_evals.cpu | DEPENDENT | 0 |
| CPU shares for blocked job evaluations | Amount of CPU shares requested by blocked evals of a job. | nomad.server.blocked_evals.job.cpu | DEPENDENT | 0 |
| Memory shares for blocked job evaluations | Amount of memory requested by blocked evals of a job. | nomad.server.blocked_evals.job.memory | DEPENDENT | 0 |
| Memory shares by blocked evaluations | Amount of memory requested by blocked evals. | nomad.server.blocked_evals.memory | DEPENDENT | 0 |
| Evaluations blocked | Count of evals in the blocked state for any reason (cluster resource exhaustion or quota limits). | nomad.server.blocked_evals.total_blocked | DEPENDENT | 0 |
| Evaluations escaped | Count of evals that have escaped computed node classes.<br>This indicates a scheduler optimization was skipped and is not usually a source of concern. | nomad.server.blocked_evals.total_escaped | DEPENDENT | 0 |
| Evaluations blocked due to quota limit | Count of blocked evals due to quota limits (the resources for these jobs are not counted in other blocked_evals metrics, except for total_blocked). | nomad.server.blocked_evals.total_quota_limit | DEPENDENT | 0 |
| Evaluations enqueue time | Average time elapsed with evaluations waiting to be enqueued. | nomad.server.broker.eval_waiting | DEPENDENT | 0 |
| Services ready to schedule | Count of service evals ready to be scheduled. | nomad.server.broker.service_ready | DEPENDENT | 0 |
| Services unacknowledged | Count of unacknowledged service evals. | nomad.server.broker.service_unacked | DEPENDENT | 0 |
| System evaluations ready to schedule | Count of service evals ready to be scheduled. | nomad.server.broker.system_ready | DEPENDENT | 0 |
| System evaluations unacknowledged | Count of unacknowledged system evals. | nomad.server.broker.system_unacked | DEPENDENT | 0 |
| Evaluations pending | Evaluations that are pending until an existing evaluation for the same job completes. | nomad.server.broker.total_pending | DEPENDENT | 0 |
| Evaluations ready | Number of evaluations ready to be processed. | nomad.server.broker.total_ready | DEPENDENT | 0 |
| Evaluations unacked | Evaluations dispatched for processing but incomplete. | nomad.server.broker.total_unacked | DEPENDENT | 0 |
| Evaluations waiting | Count of evals waiting to be enqueued. | nomad.server.broker.total_waiting | DEPENDENT | 0 |
| RPC eval dequeue time | Time elapsed for Eval.Dequeue RPC call. | nomad.server.client.dequeue | DEPENDENT | 0 |
| RPC get client allocs time | Time elapsed for Node.GetClientAllocs RPC call. | nomad.server.client.get_client_allocs | DEPENDENT | 0 |
| RPC list time | Time elapsed for Node.List RPC call. | nomad.server.client.list | DEPENDENT | 0 |
| RPC update allocations time | Time elapsed for Node.UpdateAlloc RPC call. | nomad.server.client.update_alloc | DEPENDENT | 0 |
| RPC update status time | Time elapsed for Node.UpdateStatus RPC call. | nomad.server.client.update_status | DEPENDENT | 0 |
| CPU time, rate | Total user and system CPU time spent in seconds. | nomad.server.cpu.time | DEPENDENT | 0 |
| Monitoring API response | Monitoring API response message. | nomad.server.data.api.response | DEPENDENT | 0 |
| Telemetry get | Telemetry data in raw format. | nomad.server.data.get | HTTP_AGENT | no delay |
| RPC evaluation acknowledgement time | Time elapsed for Eval.Ack RPC call. | nomad.server.eval.ack | DEPENDENT | 0 |
| FSM apply plan results time | Time elapsed to apply ApplyPlanResults raft entry. | nomad.server.fsm.apply_plan_results | DEPENDENT | 0 |
| FSM job registration time | Time elapsed to apply RegisterJob raft entry. | nomad.server.fsm.register_job | DEPENDENT | 0 |
| FSM update evaluation time | Time elapsed to apply UpdateEval raft entry. | nomad.server.fsm.update_eval | DEPENDENT | 0 |
| Heartbeats active | Number of active heartbeat timers.<br>Each timer represents a Nomad client connection. | nomad.server.heartbeat.active | DEPENDENT | 0 |
| RPC job allocations time | Time elapsed for Job.Allocations RPC call. | nomad.server.job.allocations | DEPENDENT | 0 |
| RPC job evaluations time | Time elapsed for Job.Evaluations RPC call. | nomad.server.job.evaluations | DEPENDENT | 0 |
| RPC get job time | Time elapsed for Job.GetJob RPC call. | nomad.server.job.get_job | DEPENDENT | 0 |
| Jobs dead | Number of dead jobs. | nomad.server.job_status.dead | DEPENDENT | 0 |
| Jobs pending | Number of pending jobs. | nomad.server.job_status.pending | DEPENDENT | 0 |
| Jobs running | Number of running jobs. | nomad.server.job_status.running | DEPENDENT | 0 |
| Job allocations completed | Number of complete allocations for a job. | nomad.server.job_summary.complete | DEPENDENT | 0 |
| Job allocations failed | Number of failed allocations for a job. | nomad.server.job_summary.failed | DEPENDENT | 0 |
| RPC job summary time | Time elapsed for Job.Summary RPC call. | nomad.server.job_summary.get_job_summary | DEPENDENT | 0 |
| Job allocations lost | Number of lost allocations for a job. | nomad.server.job_summary.lost | DEPENDENT | 0 |
| Job allocations queued | Number of queued allocations for a job. | nomad.server.job_summary.queued | DEPENDENT | 0 |
| Job allocations running | Number of running allocations for a job. | nomad.server.job_summary.running | DEPENDENT | 0 |
| Job allocations starting | Number of starting allocations for a job. | nomad.server.job_summary.starting | DEPENDENT | 0 |
| Job allocations unknown | Number of unknown allocations for a job. | nomad.server.job_summary.unknown | DEPENDENT | 0 |
| Leader barrier time | Time elapsed to establish a raft barrier during leader transition. | nomad.server.leader.barrier | DEPENDENT | 0 |
| Total reconcile time | Time elapsed to reconcile all serf peers with state store. | nomad.server.leader.reconcile | DEPENDENT | 0 |
| Reconcile peer time | Time elapsed to reconcile a serf peer with state store. | nomad.server.leader.reconcile_member | DEPENDENT | 0 |
| Gossip time | Time elapsed to broadcast gossip messages. | nomad.server.memberlist.gossip | DEPENDENT | 0 |
| Metrics | Nomad server metrics in raw format. | nomad.server.metrics.get | DEPENDENT | 0 |
| Namespace list time | Time elapsed for Namespace.ListNamespaces. | nomad.server.namespace.list_namespace | DEPENDENT | 0 |
| Plan apply time | Time elapsed to apply a plan. | nomad.server.plan.apply | DEPENDENT | 0 |
| Plan evaluate time | Time elapsed to evaluate a plan. | nomad.server.plan.evaluate | DEPENDENT | 0 |
| Plan queue | Count of evals in the plan queue. | nomad.server.plan.queue_depth | DEPENDENT | 0 |
| RPC plan submit time | Time elapsed for Plan.Submit RPC call. | nomad.server.plan.submit | DEPENDENT | 0 |
| Plan raft index processing time | Time elapsed that planner waits for the raft index of the plan to be processed. | nomad.server.plan.wait_for_index | DEPENDENT | 0 |
| Open file descriptors, max | Maximum number of open file descriptors. | nomad.server.process_max_fds | DEPENDENT | 0 |
| Open file descriptors | Number of open file descriptors. | nomad.server.process_open_fds | DEPENDENT | 0 |
| FSM index | Current index applied to FSM. | nomad.server.raft.applied_index | DEPENDENT | 0 |
| Raft transactions, rate | Number of Raft transactions. | nomad.server.raft.apply | DEPENDENT | 0 |
| Raft calls blocked, rate | Count of blocking raft API calls. | nomad.server.raft.barrier | DEPENDENT | 0 |
| BoltDB freelist bytes | Number of freelist bytes. | nomad.server.raft.boltdb.freelist_bytes | DEPENDENT | 0 |
| BoltDB free page bytes | Number of free page bytes. | nomad.server.raft.boltdb.free_page_bytes | DEPENDENT | 0 |
| BoltDB free pages | Number of BoltDB free pages. | nomad.server.raft.boltdb.num_free_pages | DEPENDENT | 0 |
| BoltDB pending pages | Number of BoltDB pending pages. | nomad.server.raft.boltdb.num_pending_pages | DEPENDENT | 0 |
| BoltDB open read transactions | Number of current open read transactions. | nomad.server.raft.boltdb.open_read_txn | DEPENDENT | 0 |
| BoltDB read transactions, rate | Count of total read transactions. | nomad.server.raft.boltdb.total_read_txn | DEPENDENT | 0 |
| BoltDB cursors | Count of total database cursors. | nomad.server.raft.boltdb.txstats.cursor_count | DEPENDENT | 0 |
| BoltDB nodes, rate | Count of total database nodes. | nomad.server.raft.boltdb.txstats.node_count | DEPENDENT | 0 |
| BoltDB node dereferences, rate | Count of total database node dereferences. | nomad.server.raft.boltdb.txstats.node_deref | DEPENDENT | 0 |
| BoltDB page allocations, rate | Number of page allocations. | nomad.server.raft.boltdb.txstats.page_alloc | DEPENDENT | 0 |
| BoltDB pages in use | Number of pages in use. | nomad.server.raft.boltdb.txstats.page_count | DEPENDENT | 0 |
| BoltDB rebalance operations, rate | Count of total rebalance operations. | nomad.server.raft.boltdb.txstats.rebalance | DEPENDENT | 0 |
| BoltDB rebalance time | Sample of rebalance operation times. | nomad.server.raft.boltdb.txstats.rebalance_time | DEPENDENT | 0 |
| BoltDB spill operations, rate | Count of total spill operations. | nomad.server.raft.boltdb.txstats.spill | DEPENDENT | 0 |
| BoltDB spill time | Sample of spill operation times. | nomad.server.raft.boltdb.txstats.spill_time | DEPENDENT | 0 |
| BoltDB split operations, rate | Count of total split operations. | nomad.server.raft.boltdb.txstats.split | DEPENDENT | 0 |
| BoltDB write operations, rate | Count of total write operations. | nomad.server.raft.boltdb.txstats.write | DEPENDENT | 0 |
| BoltDB write time | Sample of write operation times. | nomad.server.raft.boltdb.txstats.write_time | DEPENDENT | 0 |
| Cluster role | Current role in the cluster. | nomad.server.raft.cluster_role | DEPENDENT | 0 |
| Raft commit logs enqueued | Count of logs enqueued. | nomad.server.raft.commit_num_logs | DEPENDENT | 0 |
| Raft commit time | Time elapsed to commit writes. | nomad.server.raft.commit_time | DEPENDENT | 0 |
| FSM apply time | Time elapsed to apply write to FSM. | nomad.server.raft.fsm.apply | DEPENDENT | 0 |
| FSM autopilot time | Time elapsed to apply Autopilot raft entry. | nomad.server.raft.fsm.autopilot | DEPENDENT | 0 |
| FSM enqueue time | Time elapsed to enqueue write to FSM. | nomad.server.raft.fsm.enqueue | DEPENDENT | 0 |
| FSM register node time | Time elapsed to apply RegisterNode raft entry. | nomad.server.raft.fsm.register_node | DEPENDENT | 0 |
| Raft last index | Most recent index seen. | nomad.server.raft.last_index | DEPENDENT | 0 |
| Dispatch log time | Time elapsed to write log, mark in flight, and start replication. | nomad.server.raft.leader.dispatch_log | DEPENDENT | 0 |
| Logs dispatched | Count of logs dispatched. | nomad.server.raft.leader.dispatch_num_logs | DEPENDENT | 0 |
| Leader last contact | Time since last contact to leader.<br>General indicator of Raft latency. | nomad.server.raft.leader.lastContact | DEPENDENT | 0 |
| Raft peers | Current cluster raft peers amount. | nomad.server.raft.peers | DEPENDENT | 0 |
| Raft transaction commit time | Raft transaction commit time. | nomad.server.raft.replication.appendEntries | DEPENDENT | 0 |
| Heartbeat fails | Count of failing to heartbeat and starting election. | nomad.server.raft.transition.heartbeat_timeout | DEPENDENT | 0 |
| Resident memory size | Resident memory size in bytes. | nomad.server.resident_memory_bytes | DEPENDENT | 0 |
| RPC queries, rate | Number of RPC queries. | nomad.server.rpc.query | DEPENDENT | 0 |
| RPC requests, rate | Number of RPC requests being handled. | nomad.server.rpc.request | DEPENDENT | 0 |
| RPC error requests, rate | Number of RPC requests being handled that result in an error. | nomad.server.rpc.request_error | DEPENDENT | 0 |
| Memory used | Memory utilization in bytes. | nomad.server.runtime.alloc_bytes | DEPENDENT | 0 |
| Objects freed, rate | Count of objects freed from heap by go runtime GC. | nomad.server.runtime.free_count | DEPENDENT | 0 |
| GC pause time | Go runtime GC pause times. | nomad.server.runtime.gc_pause_ns | DEPENDENT | 0 |
| Heap objects | Number of objects on the heap.<br>General memory pressure indicator. | nomad.server.runtime.heap_objects | DEPENDENT | 0 |
| Goroutines | Number of goroutines and general load pressure indicator. | nomad.server.runtime.num_goroutines | DEPENDENT | 0 |
| GC metadata size | Go runtime GC metadata size in bytes. | nomad.server.runtime.sys_bytes | DEPENDENT | 0 |
| GC runs | Count of go runtime GC runs. | nomad.server.runtime.total_gc_runs | DEPENDENT | 0 |
| Allocation reschedule attempts | Count of attempts to reschedule an allocation. | nomad.server.scheduler.allocs.rescheduled.attempted | DEPENDENT | 0 |
| Memberlist events | Count of memberlist events received. | nomad.server.serf.queue.event | DEPENDENT | 0 |
| Memberlist changes | Count of memberlist changes. | nomad.server.serf.queue.intent | DEPENDENT | 0 |
| Memberlist queries | Count of memberlist queries. | nomad.server.serf.queue.queries | DEPENDENT | 0 |
| Snapshot index | Current snapshot index. | nomad.server.state.snapshot.index | DEPENDENT | 0 |
| Internal stats API response | Internal stats API response message. | nomad.server.stats.api.response | DEPENDENT | 0 |
| Internal stats get | Internal stats data in raw format. | nomad.server.stats.get | HTTP_AGENT | 1h |
| Vault tokens revoked | Count of revoked tokens. | nomad.server.vault.distributed_tokens_revoked | DEPENDENT | 0 |
| Vault token last renewal | Time since last successful Vault token renewal. | nomad.server.vault.token_last_renewal | DEPENDENT | 0 |
| Vault token next renewal | Time until next Vault token renewal attempt. | nomad.server.vault.token_next_renewal | DEPENDENT | 0 |
| Vault token TTL | Time to live for Vault token. | nomad.server.vault.token_ttl | DEPENDENT | 0 |
| Nomad server version | Nomad server version. | nomad.server.version | DEPENDENT | 0 |
| Virtual memory size | Virtual memory size in bytes. | nomad.server.virtual_memory_bytes | DEPENDENT | 0 |
| Worker evaluation create time | Time elapsed for worker to create an eval. | nomad.server.worker.create_eval | DEPENDENT | 0 |
| Worker evaluation dequeue time | Time elapsed for worker to dequeue an eval. | nomad.server.worker.dequeue_eval | DEPENDENT | 0 |
| Worker invoke scheduler time | Time elapsed for worker to invoke the scheduler. | nomad.server.worker.invoke_scheduler_service | DEPENDENT | 0 |
| Worker acknowledgement send time | Time elapsed for worker to send acknowledgement. | nomad.server.worker.send_ack | DEPENDENT | 0 |
| Worker submit plan time | Time elapsed for worker to submit plan. | nomad.server.worker.submit_plan | DEPENDENT | 0 |
| Worker update evaluation time | Time elapsed for worker to submit updated eval. | nomad.server.worker.update_eval | DEPENDENT | 0 |
| Worker log replication time | Time elapsed that worker waits for the raft index of the eval to be processed. | nomad.server.worker.wait_for_index | DEPENDENT | 0 |


<a name="macros" />

## Macros
| macro | value |
| ------------- |------------- |
| {$NOMAD.API.RESPONSE.SUCCESS} | 200 |
| {$NOMAD.DATA.TIMEOUT} | 15s |
| {$NOMAD.HTTP.PROXY} | no value |
| {$NOMAD.OPEN.FDS.MAX} | 90 |
| {$NOMAD.REDUNDANCY.MIN} | 1 |
| {$NOMAD.SERVER.API.PORT} | 4646 |
| {$NOMAD.SERVER.API.SCHEME} | http |
| {$NOMAD.SERVER.LEADER.LATENCY} | 0.3s |
| {$NOMAD.SERVER.RPC.PORT} | 4647 |
| {$NOMAD.SERVER.SERF.PORT} | 4648 |
| {$NOMAD.TOKEN} | <PUT YOUR AUTH TOKEN> |


<a name="triggers" />

## Triggers
| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Service [rpc] is down | AVERAGE | Cannot establish the connection to [rpc] service port {$NOMAD.SERVER.RPC.PORT}.<br>Check the Nomad state and network connectivity between Nomad and Zabbix. | last(/HashiCorp Nomad Server by HTTP/net.tcp.service[tcp,,{$NOMAD.SERVER.RPC.PORT}]) = 0 | [{"tag": "scope", "value": "availability"}] | no url |
| Service [serf] is down | AVERAGE | Cannot establish the connection to [serf] service port {$NOMAD.SERVER.SERF.PORT}.<br>Check the Nomad state and network connectivity between Nomad and Zabbix. | last(/HashiCorp Nomad Server by HTTP/net.tcp.service[tcp,,{$NOMAD.SERVER.SERF.PORT}]) = 0 | [{"tag": "scope", "value": "availability"}] | no url |
| Autopilot redundancy is low | WARNING | The autopilot redundancy is low.<br>Cluster crash risk is high due to one more server failure. | last(/HashiCorp Nomad Server by HTTP/nomad.server.autopilot.failure_tolerance) < {$NOMAD.REDUNDANCY.MIN} and nodata(/HashiCorp Nomad Server by HTTP/nomad.server.autopilot.failure_tolerance,5m) = 0 | [{"tag": "scope", "value": "capacity"}] | no url |
| Autopilot is unhealthy | AVERAGE | The autopilot is in unhealthy state. The successful failover probability is extremely low. | last(/HashiCorp Nomad Server by HTTP/nomad.server.autopilot.state) = 0 and nodata(/HashiCorp Nomad Server by HTTP/nomad.server.autopilot.state,5m) = 0 | [{"tag": "scope", "value": "availability"}] | no url |
| Monitoring API connection has failed | AVERAGE | Monitoring API connection has failed.<br>Ensure that Nomad API URL and the necessary permissions have been defined correctly, check the service state and network connectivity between Nomad and Zabbix. | find(/HashiCorp Nomad Server by HTTP/nomad.server.data.api.response,,"like","{$NOMAD.API.RESPONSE.SUCCESS}")=0 | [{"tag": "scope", "value": "availability"}] | no url |
| Dead jobs found | WARNING | Jobs with the `Dead` state discovered.<br>Check the {$NOMAD.SERVER.API.SCHEME}://{HOST.IP}:{$NOMAD.SERVER.API.PORT}/v1/jobs URL for the details. | last(/HashiCorp Nomad Server by HTTP/nomad.server.job_status.dead) > 0 and nodata(/HashiCorp Nomad Server by HTTP/nomad.server.job_status.dead,5m) = 0 | [{"tag": "scope", "value": "availability"}] | no url |
| Cluster role has changed | INFO | Cluster role has changed. | change(/HashiCorp Nomad Server by HTTP/nomad.server.raft.cluster_role) <> 0 | [{"tag": "scope", "value": "notice"}] | no url |
| Leader last contact timeout exceeded | WARNING | The nomad.raft.leader.lastContact metric is a general indicator of Raft latency which can be used to observe how Raft timing is performing and guide infrastructure provisioning.<br>If this number trends upwards, look at CPU, disk IOPs, and network latency. nomad.raft.leader.lastContact should not get too close to the leader lease timeout of 500ms. | min(/HashiCorp Nomad Server by HTTP/nomad.server.raft.leader.lastContact,5m) >= {$NOMAD.SERVER.LEADER.LATENCY} and nodata(/HashiCorp Nomad Server by HTTP/nomad.server.raft.leader.lastContact,5m) = 0 | [{"tag": "scope", "value": "performance"}] | no url |
| Internal stats API connection has failed | AVERAGE | Internal stats API connection has failed.<br>Ensure that Nomad API URL and the necessary permissions have been defined correctly, check the service state and network connectivity between Nomad and Zabbix. | find(/HashiCorp Nomad Server by HTTP/nomad.server.stats.api.response,,"like","{$NOMAD.API.RESPONSE.SUCCESS}")=0 | [{"tag": "scope", "value": "availability"}] | no url |
| Nomad server version has changed | INFO | Nomad server version has changed. | change(/HashiCorp Nomad Server by HTTP/nomad.server.version)<>0 | [{"tag": "scope", "value": "availability"}] | no url |
| Current number of open files is too high | WARNING | Heavy file descriptor usage (i.e., near the process file descriptor limit) indicates a potential file descriptor exhaustion issue. | min(/HashiCorp Nomad Server by HTTP/nomad.server.process_open_fds,5m)/last(/HashiCorp Nomad Server by HTTP/nomad.server.process_max_fds)*100>{$NOMAD.OPEN.FDS.MAX} | [{"tag": "scope", "value": "capacity"}] | no url |

