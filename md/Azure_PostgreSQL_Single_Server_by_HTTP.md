# Azure PostgreSQL Single Server by HTTP template description

This template is designed to monitor Microsoft Azure PostgreSQL servers by HTTP.
It works without any external scripts and uses the script item.

Setup:
  1. Create an Azure service principal via the Azure command-line interface (Azure CLI) for your subscription.
    `az ad sp create-for-rbac --name zabbix --role reader --scope /subscriptions/<subscription_id>`
    See https://docs.microsoft.com/en-us/cli/azure/create-an-azure-service-principal-azure-cli for more details.
  2. Link the template to a host.
  3. Configure the macros: {$AZURE.APP.ID}, {$AZURE.PASSWORD}, {$AZURE.TENANT.ID}, {$AZURE.SUBSCRIPTION.ID}, and {$AZURE.RESOURCE.ID}.

You can discuss this template or leave feedback on our forum https://www.zabbix.com/forum/zabbix-suggestions-and-feedback/

Generated by official Zabbix template tool "Templator"

## Summary
* [items](#items)
* [macros](#macros)
* [triggers](#triggers)

<a name="items"></a>

## Items
| name | description | key | type | delay |
| ------------- |------------- |------------- |------------- |------------- |
| Availability status detailed | The summary description of the availability status. | azure.db.pgsql.availability.details | DEPENDENT | 0 |
| Availability state | The availability status of the resource. | azure.db.pgsql.availability.state | DEPENDENT | 0 |
| Connections active | The count of active connections. | azure.db.pgsql.connections.active | DEPENDENT | 0 |
| Connections failed | The count of failed connections. | azure.db.pgsql.connections.failed | DEPENDENT | 0 |
| Percentage CPU | The CPU percent of a host. | azure.db.pgsql.cpu.percentage | DEPENDENT | 0 |
| Get errors | A list of errors from API requests. | azure.db.pgsql.data.errors | DEPENDENT | 0 |
| Get data | The result of API requests is expressed in the JSON. | azure.db.pgsql.data.get | SCRIPT | no delay |
| IO consumption percent | The consumption percent of I/O. | azure.db.pgsql.io.consumption.percent | DEPENDENT | 0 |
| Memory utilization | The memory percent of a host. | azure.db.pgsql.memory.percentage | DEPENDENT | 0 |
| Network out | The network outbound traffic across the active connections. | azure.db.pgsql.network.egress | DEPENDENT | 0 |
| Network in | The network inbound traffic across the active connections. | azure.db.pgsql.network.ingress | DEPENDENT | 0 |
| Replication lag | The replication lag, expressed in seconds. | azure.db.pgsql.replica.log.delay | DEPENDENT | 0 |
| Max lag across replicas in bytes | Lag for the most lagging replica, expressed in bytes. | azure.db.pgsql.replica.log.delay.bytes | DEPENDENT | 0 |
| Backup storage used | Used backup storage, expressed in bytes. | azure.db.pgsql.storage.backup.used | DEPENDENT | 0 |
| Storage limit | The storage limit, expressed in bytes. | azure.db.pgsql.storage.limit | DEPENDENT | 0 |
| Storage percent | The storage utilization, expressed in %. | azure.db.pgsql.storage.percent | DEPENDENT | 0 |
| Server log storage limit | The storage limit of server log, expressed in bytes. | azure.db.pgsql.storage.server.log.limit | DEPENDENT | 0 |
| Server log storage percent | The storage utilization by server log, expressed in %. | azure.db.pgsql.storage.server.log.percent | DEPENDENT | 0 |
| Server log storage used | The storage space used by server log, expressed in bytes. | azure.db.pgsql.storage.server.log.used | DEPENDENT | 0 |
| Storage used | Used storage space, expressed in bytes. | azure.db.pgsql.storage.used | DEPENDENT | 0 |


<a name="macros"></a>

## Macros
| macro | value |
| ------------- |------------- |
| {$AZURE.APP.ID} | no value |
| {$AZURE.DATA.TIMEOUT} | 15s |
| {$AZURE.DB.CPU.UTIL.CRIT} | 90 |
| {$AZURE.DB.MEMORY.UTIL.CRIT} | 90 |
| {$AZURE.DB.STORAGE.PUSED.CRIT} | 90 |
| {$AZURE.DB.STORAGE.PUSED.WARN} | 80 |
| {$AZURE.PASSWORD} | no value |
| {$AZURE.PROXY} | no value |
| {$AZURE.RESOURCE.ID} | no value |
| {$AZURE.SUBSCRIPTION.ID} | no value |
| {$AZURE.TENANT.ID} | no value |


<a name="triggers"></a>

## Triggers
| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| PostgreSQL server is degraded | AVERAGE | The resource is in degraded state. | last(/Azure PostgreSQL Single Server by HTTP/azure.db.pgsql.availability.state)=1 | [{"tag": "scope", "value": "availability"}] | no url |
| PostgreSQL server is in unknown state | WARNING | The resource state is unknown. | last(/Azure PostgreSQL Single Server by HTTP/azure.db.pgsql.availability.state)=3 | [{"tag": "scope", "value": "availability"}] | no url |
| PostgreSQL server is unavailable | HIGH | The resource state is unavailable. | last(/Azure PostgreSQL Single Server by HTTP/azure.db.pgsql.availability.state)=2 | [{"tag": "scope", "value": "availability"}] | no url |
| High CPU utilization | HIGH | The CPU utilization is too high. The system might be slow to respond. | min(/Azure PostgreSQL Single Server by HTTP/azure.db.pgsql.cpu.percentage,5m)>{$AZURE.DB.CPU.UTIL.CRIT} | [{"tag": "scope", "value": "performance"}] | no url |
| There are errors in requests to API | AVERAGE | Zabbix has received errors in response to API requests. | length(last(/Azure PostgreSQL Single Server by HTTP/azure.db.pgsql.data.errors))>0 | [{"tag": "scope", "value": "availability"}] | no url |
| High memory utilization | AVERAGE | The system is running out of free memory. | min(/Azure PostgreSQL Single Server by HTTP/azure.db.pgsql.memory.percentage,5m)>{$AZURE.DB.MEMORY.UTIL.CRIT} | [{"tag": "scope", "value": "performance"}] | no url |
| Storage space is critically low | AVERAGE | Critical utilization of the storage space. | last(/Azure PostgreSQL Single Server by HTTP/azure.db.pgsql.storage.percent)>{$AZURE.DB.STORAGE.PUSED.CRIT} | [{"tag": "scope", "value": "capacity"}] | no url |
| Storage space is low | WARNING | High utilization of the storage space. | last(/Azure PostgreSQL Single Server by HTTP/azure.db.pgsql.storage.percent)>{$AZURE.DB.STORAGE.PUSED.WARN} | [{"tag": "scope", "value": "capacity"}] | no url |

