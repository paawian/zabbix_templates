# Control-M enterprise manager by HTTP template description

This template is designed to get metrics from the Control-M Enterprise Manager using the Control-M Automation API with HTTP agent.

This template monitors active Service Level Agreement (SLA) services, discovers Control-M servers using Low Level Discovery and also creates host prototypes for them in conjunction with the `Control-M server by HTTP` template.

To use this template, macros `{$API.TOKEN}` and `{$API.URI.ENDPOINT}` need to be set.

> See [Zabbix template operation](https://www.zabbix.com/documentation/7.0/manual/config/templates_out_of_the_box/http) for basic instructions.

Generated by official Zabbix template tool "Templator"

## Summary
* [items](#items)
* [macros](#macros)
* [discoveries](#discoveries)
  * [Discovery SLA services discovery ](#discovery_sla_services_discovery)

<a name="items" />

## Items
| name | description | key | type | delay |
| ------------- |------------- |------------- |------------- |------------- |
| Get Control-M servers | Gets a list of servers. | controlm.servers | HTTP_AGENT | 10m |
| Get SLA services | Gets all the SLA active services. | controlm.services | HTTP_AGENT | no delay |


<a name="macros" />

## Macros
| macro | value |
| ------------- |------------- |
| {$API.TOKEN} | no value |
| {$API.URI.ENDPOINT} | <set the api uri endpoint here> |


<a name="discoveries" />

## Discoveries
| name | key | description | type | lifetime | delay |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Server discovery | controlm.server.discovery | Discovers the Control-M servers. | DEPENDENT | no lifetime | 0 |
| SLA services discovery | controlm.services.discovery | Discovers the SLA services in the Control-M environment. | DEPENDENT | 1d | 0 |


<a name="discovery_sla_services_discovery" />

## Discovery SLA services discovery

### Items

| name | description | key | type |
| ------------- |------------- |------------- |------------- |
| Service [{#SERVICE.NAME}, {#SERVICE.JOB}]: jobs 'completed' | Gets the number of jobs in the state - `completed`. | service.jobs.status['{#SERVICE.NAME}','{#SERVICE.JOB}',completed] | DEPENDENT |
| Service [{#SERVICE.NAME}, {#SERVICE.JOB}]: jobs 'error' | Gets the number of jobs in the state - `error`. | service.jobs.status['{#SERVICE.NAME}','{#SERVICE.JOB}',error] | DEPENDENT |
| Service [{#SERVICE.NAME}, {#SERVICE.JOB}]: jobs 'executed' | Gets the number of jobs in the state - `executed`. | service.jobs.status['{#SERVICE.NAME}','{#SERVICE.JOB}',executed] | DEPENDENT |
| Service [{#SERVICE.NAME}, {#SERVICE.JOB}]: jobs 'waitCondition' | Gets the number of jobs in the state - `waitCondition`. | service.jobs.status['{#SERVICE.NAME}','{#SERVICE.JOB}',waitCondition] | DEPENDENT |
| Service [{#SERVICE.NAME}, {#SERVICE.JOB}]: jobs 'waitHost' | Gets the number of jobs in the state - `waitHost`. | service.jobs.status['{#SERVICE.NAME}','{#SERVICE.JOB}',waitHost] | DEPENDENT |
| Service [{#SERVICE.NAME}, {#SERVICE.JOB}]: jobs 'waitResource' | Gets the number of jobs in the state - `waitResource`. | service.jobs.status['{#SERVICE.NAME}','{#SERVICE.JOB}',waitResource] | DEPENDENT |
| Service [{#SERVICE.NAME}, {#SERVICE.JOB}]: jobs 'waitWorkload' | Gets the number of jobs in the state - `waitWorkload`. | service.jobs.status['{#SERVICE.NAME}','{#SERVICE.JOB}',waitWorkload] | DEPENDENT |
| Service [{#SERVICE.NAME}, {#SERVICE.JOB}]: stats | Gets the service statistics. | service.stats['{#SERVICE.NAME}','{#SERVICE.JOB}'] | DEPENDENT |
| Service [{#SERVICE.NAME}, {#SERVICE.JOB}]: status | Gets the service status. | service.status['{#SERVICE.NAME}','{#SERVICE.JOB}'] | DEPENDENT |


### Triggers

| name | priority | description | expression | tags | url |
| ------------- |------------- |------------- |------------- |------------- |------------- |
| Service [{#SERVICE.NAME}, {#SERVICE.JOB}]: jobs in 'error' state | AVERAGE | There are services present which are in the state - `error`. | last(/Control-M enterprise manager by HTTP/service.jobs.status['{#SERVICE.NAME}','{#SERVICE.JOB}',error],#1)>0 | [{"tag": "scope", "value": "availability"}] | no url |
| Service [{#SERVICE.NAME}, {#SERVICE.JOB}]: status [{ITEM.VALUE}] | AVERAGE | The service has encountered an issue. | last(/Control-M enterprise manager by HTTP/service.status['{#SERVICE.NAME}','{#SERVICE.JOB}'],#1)=0 or<br>last(/Control-M enterprise manager by HTTP/service.status['{#SERVICE.NAME}','{#SERVICE.JOB}'],#1)=10 | [{"tag": "scope", "value": "availability"}] | no url |
| Service [{#SERVICE.NAME}, {#SERVICE.JOB}]: status [{ITEM.VALUE}] | WARNING | The service has finished its job late. | last(/Control-M enterprise manager by HTTP/service.status['{#SERVICE.NAME}','{#SERVICE.JOB}'],#1)=3 | [{"tag": "scope", "value": "availability"}] | no url |

